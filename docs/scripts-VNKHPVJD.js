var ol=function(){"use strict";function mp(e){e.stopPropagation()}var He=class{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},or="propertychange",as=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function _p(e,t,i){let n,r;i=i||qi;let s=0,o=e.length,a=!1;for(;s<o;)n=s+(o-s>>1),r=+i(e[n],t),r<0?s=n+1:(o=n,a=!r);return a?s:~s}function qi(e,t){return e>t?1:e<t?-1:0}function yp(e,t){return e<t?1:e>t?-1:0}function go(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if(typeof i=="function"){for(let r=1;r<n;++r){const s=e[r];if(s===t)return r;if(s<t)return i(t,e[r-1],s)>0?r-1:r}return n-1}if(i>0){for(let r=1;r<n;++r)if(e[r]<t)return r-1;return n-1}if(i<0){for(let r=1;r<n;++r)if(e[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(e[r]==t)return r;if(e[r]<t)return e[r-1]-t<t-e[r]?r-1:r}return n-1}function xp(e,t,i){for(;t<i;){const n=e[t];e[t]=e[i],e[i]=n,++t,--i}}function ge(e,t){const i=Array.isArray(t)?t:[t],n=i.length;for(let r=0;r<n;r++)e[e.length]=i[r]}function ui(e,t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}function vp(e,t,i){const n=t||qi;return e.every(function(r,s){if(s===0)return!0;const o=n(e[s-1],r);return!(o>0||i&&o===0)})}function Ut(){return!0}function bn(){return!1}function ar(){}function Yc(e){let t,i,n,r=!1;return function(){const s=Array.prototype.slice.call(arguments);return r&&this===n&&ui(s,i)||(r=!0,n=this,i=s,t=e.apply(this,arguments)),t}}function qc(e){return function(){let t;try{t=e()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}()}function Rn(e){for(const t in e)delete e[t]}function qt(e){let t;for(t in e)return!1;return!t}var lr=class extends as{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=t?new He(e):e;r.target||(r.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});let a;i in s||(s[i]=0,o[i]=0),++s[i];for(let l=0,h=n.length;l<h;++l)if(a="handleEvent"in n[l]?n[l].handleEvent(r):n[l].call(this,r),a===!1||r.propagationStopped){a=!1;break}if(--s[i]==0){let l=o[i];for(delete o[i];l--;)this.removeEventListener(i,ar);delete s[i]}return a}disposeInternal(){this.listeners_&&Rn(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=ar,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}},he="change",sw="error",Kc="contextmenu",Fi="click",ow="dblclick",aw="dragenter",lw="dragover",wp="drop",Qa="keydown",Sp="keypress",Ep="load",Tp="touchmove",fo="wheel";function W(e,t,i,n,r){if(n&&n!==e&&(i=i.bind(n)),r){const o=i;i=function(){e.removeEventListener(t,i),o.apply(this,arguments)}}const s={target:e,type:t,listener:i};return e.addEventListener(t,i),s}function hr(e,t,i,n){return W(e,t,i,n,!0)}function fe(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),Rn(e))}class el extends lr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(he)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=W(this,t[s],i);return r}return W(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=hr(this,t[s],i)}else n=hr(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)Cp(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],i);else this.removeEventListener(t,i)}}function Cp(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)fe(e[t]);else fe(e)}el.prototype.on,el.prototype.once,el.prototype.un;var Hc=el;function q(){throw new Error("Unimplemented abstract method.")}let hw=0;function k(e){return e.ol_uid||(e.ol_uid=String(++hw))}class Jc extends He{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}var zt=class extends Hc{constructor(e){super(),this.on,this.once,this.un,k(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Jc(i,e,t)),i=or,this.hasListener(i)&&this.dispatchEvent(new Jc(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],qt(this.values_)&&(this.values_=null),t||this.notify(e,i)}}},di="add",gi="remove";const bp="length";class po extends He{constructor(t,i,n){super(t),this.element=i,this.index=n}}class Je extends zt{constructor(t,i){if(super(),this.on,this.once,this.un,i=i||{},this.unique_=!!i.unique,this.array_=t||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let i=0,n=t.length;i<n;++i)this.push(t[i]);return this}forEach(t){const i=this.array_;for(let n=0,r=i.length;n<r;++n)t(i[n],n,i)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(bp)}insertAt(t,i){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new po(di,i,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const i=this.getLength();return this.insertAt(i,t),this.getLength()}remove(t){const i=this.array_;for(let n=0,r=i.length;n<r;++n)if(i[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new po(gi,i,t)),i}setAt(t,i){if(t>=this.getLength())return void this.insertAt(t,i);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i,t);const n=this.array_[t];this.array_[t]=i,this.dispatchEvent(new po(gi,n,t)),this.dispatchEvent(new po(di,i,t))}updateLength_(){this.set(bp,this.array_.length)}assertUnique_(t,i){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==i)throw new Error("Duplicate item added to a unique collection")}}var Be=0,Kt=1,we=2,Ne=3,De=4;function Qc(e){return Math.pow(e,3)}function Pn(e){return 1-Qc(1-e)}function tl(e){return 3*e*e-2*e*e*e}function Rp(e){return e}var cr=class extends lr{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(he)}release(){this.state===Ne&&this.setState(De)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==we)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==we){e.interimTile=null;break}e.getState()==Kt?t=e:e.getState()==Be?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Ne&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){q()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(i){if(i===-1)return 1}else i=t,this.transitionStarts_[e]=i;const n=t-i+1e3/60;return n>=this.transition_?1:Qc(n/this.transition_)}inTransition(e){return!!this.transition_&&this.transitionStarts_[e]!==-1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}};const Fn=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",Pp=Fn.includes("firefox"),Fp=Fn.includes("safari")&&!Fn.includes("chrom"),Ip=Fp&&(Fn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Fn)),Lp=Fn.includes("webkit")&&!Fn.includes("edge"),il=Fn.includes("macintosh"),nl=typeof devicePixelRatio<"u"?devicePixelRatio:1,rl=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,sl=typeof Image<"u"&&Image.prototype.decode,Mp=typeof createImageBitmap=="function",eu=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}();function ke(e,t,i,n){let r;return r=i&&i.length?i.shift():rl?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(r.width=e),t&&(r.height=t),r.getContext("2d",n)}function In(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function Ap(e){let t=e.offsetWidth;const i=getComputedStyle(e);return t+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),t}function Op(e){let t=e.offsetHeight;const i=getComputedStyle(e);return t+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),t}function ur(e,t){const i=t.parentNode;i&&i.replaceChild(e,t)}function mo(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function tu(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function Np(e,t){const i=e.childNodes;for(let n=0;;++n){const r=i[n],s=t[n];if(!r&&!s)break;r!==s&&(r?s?e.insertBefore(s,r):(e.removeChild(r),--n):e.appendChild(s))}}function _o(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}function al(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}let ls=null;function Dp(e){ls||(ls=ke(e.width,e.height,void 0,{willReadFrequently:!0}));const t=ls.canvas,i=e.width;t.width!==i&&(t.width=i);const n=e.height;return t.height!==n&&(t.height=n),ls.clearRect(0,0,i,n),ls.drawImage(e,0,0),ls.getImageData(0,0,i,n).data}const cw=[256,256];var ll=class extends cr{constructor(e){const t=Be;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=_o(this.data_);return e?[e.width,e.height]:cw}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Be&&this.state!==Ne)return;this.state=Kt,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=we,e.changed()}).catch(function(t){e.error_=t,e.state=Ne,e.changed()})}};function ie(e,t){if(!e)throw new Error(t)}class iu extends zt{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const i=t;this.setGeometry(i)}else{const i=t;this.setProperties(i)}}clone(){const t=new iu(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const i=this.getGeometry();i&&t.setGeometry(i.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(fe(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=W(t,he,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?kp(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function kp(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(ie(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}var Se=iu;const nu=new Array(6);function uw(){return[1,0,0,1,0,0]}function hl(e){return hs(e,1,0,0,1,0,0)}function Ki(e,t){const i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=t[0],h=t[1],c=t[2],u=t[3],g=t[4],f=t[5];return e[0]=i*l+r*h,e[1]=n*l+s*h,e[2]=i*c+r*u,e[3]=n*c+s*u,e[4]=i*g+r*f+o,e[5]=n*g+s*f+a,e}function hs(e,t,i,n,r,s,o){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e}function yo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ye(e,t){const i=t[0],n=t[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t}function Gp(e,t){const i=Math.cos(t),n=Math.sin(t);return Ki(e,hs(nu,i,n,-n,i,0,0))}function dr(e,t,i){return Ki(e,hs(nu,t,0,0,i,0,0))}function jp(e,t,i){return hs(e,t,0,0,i,0,0)}function cs(e,t,i){return Ki(e,hs(nu,1,0,0,1,t,i))}function pt(e,t,i,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return e[0]=n*h,e[1]=r*l,e[2]=-n*l,e[3]=r*h,e[4]=o*n*h-a*n*l+t,e[5]=o*r*l+a*r*h+i,e}function Ht(e,t){const i=Bp(t);ie(i!==0,"Transformation matrix cannot be inverted");const n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return e[0]=o/i,e[1]=-r/i,e[2]=-s/i,e[3]=n/i,e[4]=(s*l-o*a)/i,e[5]=-(n*l-r*a)/i,e}function Bp(e){return e[0]*e[3]-e[1]*e[2]}let Up;function xo(e){const t="matrix("+e.join(", ")+")";if(rl)return t;const i=Up||(Up=document.createElement("div"));return i.style.transform=t,i.style.transform}var lt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Xe(e){const t=zp();for(let i=0,n=e.length;i<n;++i)fr(t,e[i]);return t}function mt(e,t,i){return i?(i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]+t,i[3]=e[3]+t,i):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function ru(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function Ln(e,t,i){let n,r;return n=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,r=i<e[1]?e[1]-i:e[3]<i?i-e[3]:0,n*n+r*r}function Jt(e,t){return cl(e,t[0],t[1])}function ht(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function cl(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function ul(e,t){const i=e[0],n=e[1],r=e[2],s=e[3],o=t[0],a=t[1];let l=lt.UNKNOWN;return o<i?l|=lt.LEFT:o>r&&(l|=lt.RIGHT),a<n?l|=lt.BELOW:a>s&&(l|=lt.ABOVE),l===lt.UNKNOWN&&(l=lt.INTERSECTING),l}function zp(){return[1/0,1/0,-1/0,-1/0]}function Xt(e,t,i,n,r){return r?(r[0]=e,r[1]=t,r[2]=i,r[3]=n,r):[e,t,i,n]}function Hi(e){return Xt(1/0,1/0,-1/0,-1/0,e)}function gr(e,t){const i=e[0],n=e[1];return Xt(i,n,i,n,t)}function dl(e,t,i,n,r){return au(Hi(r),e,t,i,n)}function It(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function Xp(e,t,i){return Math.abs(e[0]-t[0])<i&&Math.abs(e[2]-t[2])<i&&Math.abs(e[1]-t[1])<i&&Math.abs(e[3]-t[3])<i}function su(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function fr(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function ou(e,t){for(let i=0,n=t.length;i<n;++i)fr(e,t[i]);return e}function au(e,t,i,n,r){for(;i<n;i+=r)Wp(e,t[i],t[i+1]);return e}function Vp(e,t){for(let i=0,n=t.length;i<n;++i)ou(e,t[i]);return e}function Wp(e,t,i){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],i),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],i)}function gl(e,t){let i;return i=t(pr(e)),i||(i=t(mr(e)),i||(i=t(ds(e)),i||(i=t(Qt(e)),i||!1)))}function Mn(e){let t=0;return fi(e)||(t=ne(e)*Le(e)),t}function pr(e){return[e[0],e[1]]}function mr(e){return[e[2],e[1]]}function rt(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Zp(e,t){let i;if(t==="bottom-left")i=pr(e);else if(t==="bottom-right")i=mr(e);else if(t==="top-left")i=Qt(e);else{if(t!=="top-right")throw new Error("Invalid corner");i=ds(e)}return i}function us(e,t,i,n,r){const[s,o,a,l,h,c,u,g]=fl(e,t,i,n);return Xt(Math.min(s,a,h,u),Math.min(o,l,c,g),Math.max(s,a,h,u),Math.max(o,l,c,g),r)}function fl(e,t,i,n){const r=t*n[0]/2,s=t*n[1]/2,o=Math.cos(i),a=Math.sin(i),l=r*o,h=r*a,c=s*o,u=s*a,g=e[0],f=e[1];return[g-l+u,f-h-c,g-l-u,f-h+c,g+l-u,f+h+c,g+l+u,f+h-c,g-l+u,f-h-c]}function Le(e){return e[3]-e[1]}function We(e,t,i){const n=i||[1/0,1/0,-1/0,-1/0];return Ie(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Hi(n),n}function Qt(e){return[e[0],e[3]]}function ds(e){return[e[2],e[3]]}function ne(e){return e[2]-e[0]}function Ie(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function fi(e){return e[2]<e[0]||e[3]<e[1]}function $p(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function pl(e,t){const i=(e[2]-e[0])/2*(t-1),n=(e[3]-e[1])/2*(t-1);e[0]-=i,e[2]+=i,e[1]-=n,e[3]+=n}function Yp(e,t,i){let n=!1;const r=ul(e,t),s=ul(e,i);if(r===lt.INTERSECTING||s===lt.INTERSECTING)n=!0;else{const o=e[0],a=e[1],l=e[2],h=e[3],c=t[0],u=t[1],g=i[0],f=i[1],p=(f-u)/(g-c);let m,_;s&lt.ABOVE&&!(r&lt.ABOVE)&&(m=g-(f-h)/p,n=m>=o&&m<=l),n||!(s&lt.RIGHT)||r&lt.RIGHT||(_=f-(g-l)*p,n=_>=a&&_<=h),n||!(s&lt.BELOW)||r&lt.BELOW||(m=g-(f-a)/p,n=m>=o&&m<=l),n||!(s&lt.LEFT)||r&lt.LEFT||(_=f-(g-o)*p,n=_>=a&&_<=h)}return n}function _r(e,t,i,n){if(fi(e))return Hi(i);let r=[];if(n>1){const a=e[2]-e[0],l=e[3]-e[1];for(let h=0;h<n;++h)r.push(e[0]+a*h/n,e[1],e[2],e[1]+l*h/n,e[2]-a*h/n,e[3],e[0],e[3]-l*h/n)}else r=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(r,r,2);const s=[],o=[];for(let a=0,l=r.length;a<l;a+=2)s.push(r[a]),o.push(r[a+1]);return function(a,l,h){return Xt(Math.min.apply(null,a),Math.min.apply(null,l),Math.max.apply(null,a),Math.max.apply(null,l),h)}(s,o,i)}function ml(e,t){const i=t.getExtent(),n=rt(e);if(t.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const r=ne(i),s=Math.floor((n[0]-i[0])/r)*r;e[0]-=s,e[2]-=s}return e}function qp(e,t){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[i[0],e[1],i[2],e[3]]];ml(e,t);const n=ne(i);if(ne(e)>n)return[[i[0],e[1],i[2],e[3]]];if(e[0]<i[0])return[[e[0]+n,e[1],i[2],e[3]],[i[0],e[1],e[2],e[3]]];if(e[2]>i[2])return[[e[0],e[1],i[2],e[3]],[i[0],e[1],e[2]-n,e[3]]]}return[e]}const dw={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function lu(e){return dw[e]}const yr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var xr=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||yr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const gs=6378137,vr=Math.PI*gs,Kp=[-vr,-vr,vr,vr],Hp=[-180,-85,180,85],vo=gs*Math.log(Math.tan(Math.PI/2));class fs extends xr{constructor(t){super({code:t,units:"m",extent:Kp,global:!0,worldExtent:Hp,getPointResolution:function(i,n){return i/Math.cosh(n[1]/gs)}})}}const hu=[new fs("EPSG:3857"),new fs("EPSG:102100"),new fs("EPSG:102113"),new fs("EPSG:900913"),new fs("http://www.opengis.net/def/crs/EPSG/0/3857"),new fs("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Jp(e,t,i){const n=e.length;i=i>1?i:2,t===void 0&&(t=i>2?e.slice():new Array(n));for(let r=0;r<n;r+=i){t[r]=vr*e[r]/180;let s=gs*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));s>vo?s=vo:s<-vo&&(s=-vo),t[r+1]=s}return t}function Qp(e,t,i){const n=e.length;i=i>1?i:2,t===void 0&&(t=i>2?e.slice():new Array(n));for(let r=0;r<n;r+=i)t[r]=180*e[r]/vr,t[r+1]=360*Math.atan(Math.exp(e[r+1]/gs))/Math.PI-90;return t}const em=6378137,cu=[-180,-90,180,90],tm=Math.PI*em/180;class wr extends xr{constructor(t,i){super({code:t,units:"degrees",extent:cu,axisOrientation:i,global:!0,metersPerUnit:tm,worldExtent:cu})}}const uu=[new wr("CRS:84"),new wr("EPSG:4326","neu"),new wr("urn:ogc:def:crs:OGC:1.3:CRS84"),new wr("urn:ogc:def:crs:OGC:2:84"),new wr("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new wr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new wr("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let _l={};function im(){_l={}}function nm(e){return _l[e]||_l[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function rm(e,t){_l[e]=t}let pi={};function sm(){pi={}}function Sr(e,t,i){const n=e.getCode(),r=t.getCode();n in pi||(pi[n]={}),pi[n][r]=i}function du(e,t){let i;return e in pi&&t in pi[e]&&(i=pi[e][t]),i}function H(e,t,i){return Math.min(Math.max(e,t),i)}function gu(e,t,i,n,r,s){const o=r-i,a=s-n;if(o!==0||a!==0){const l=((e-i)*o+(t-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return mi(e,t,i,n)}function mi(e,t,i,n){const r=i-e,s=n-t;return r*r+s*s}function om(e){const t=e.length;for(let n=0;n<t;n++){let r=n,s=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(e[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=e[r];e[r]=e[n],e[n]=o;for(let a=n+1;a<t;a++){const l=-e[a][n]/e[n][n];for(let h=n;h<t+1;h++)n==h?e[a][h]=0:e[a][h]+=l*e[n][h]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=e[n][t]/e[n][n];for(let r=n-1;r>=0;r--)e[r][t]-=e[r][n]*i[n]}return i}function wo(e){return 180*e/Math.PI}function st(e){return e*Math.PI/180}function ei(e,t){const i=e%t;return i*t<0?i+t:i}function Lt(e,t,i){return e+i*(t-e)}function An(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function So(e,t){return Math.round(An(e,t))}function Er(e,t){return Math.floor(An(e,t))}function Ji(e,t){return Math.ceil(An(e,t))}function On(e,t,i){const n=i!==void 0?e.toFixed(i):""+e;let r=n.indexOf(".");return r=r===-1?n.length:r,r>t?n:new Array(1+t-r).join("0")+n}function yl(e,t){const i=(""+e).split("."),n=(""+t).split(".");for(let r=0;r<Math.max(i.length,n.length);r++){const s=parseInt(i[r]||"0",10),o=parseInt(n[r]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function fu(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function am(e,t){const i=t.getRadius(),n=t.getCenter(),r=n[0],s=n[1];let o=e[0]-r;const a=e[1]-s;o===0&&a===0&&(o=1);const l=Math.sqrt(o*o+a*a);return[r+i*o/l,s+i*a/l]}function Eo(e,t){const i=e[0],n=e[1],r=t[0],s=t[1],o=r[0],a=r[1],l=s[0],h=s[1],c=l-o,u=h-a,g=c===0&&u===0?0:(c*(i-o)+u*(n-a))/(c*c+u*u||0);let f,p;return g<=0?(f=o,p=a):g>=1?(f=l,p=h):(f=o+g*c,p=a+g*u),[f,p]}function To(e,t,i){const n=ei(t+180,360)-180,r=Math.abs(3600*n),s=i||0;let o=Math.floor(r/3600),a=Math.floor((r-3600*o)/60),l=An(r-3600*o-60*a,s);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let h=o+"\xB0";return a===0&&l===0||(h+=" "+On(a,2)+"\u2032"),l!==0&&(h+=" "+On(l,2,s)+"\u2033"),n!==0&&(h+=" "+e.charAt(n<0?1:0)),h}function lm(e,t,i){return e?t.replace("{x}",e[0].toFixed(i)).replace("{y}",e[1].toFixed(i)):""}function ti(e,t){let i=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){i=!1;break}return i}function xl(e,t){const i=Math.cos(t),n=Math.sin(t),r=e[0]*i-e[1]*n,s=e[1]*i+e[0]*n;return e[0]=r,e[1]=s,e}function pu(e,t){return e[0]*=t,e[1]*=t,e}function Vt(e,t){const i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function ps(e,t){return Math.sqrt(Vt(e,t))}function vl(e,t){return Vt(e,Eo(e,t))}function hm(e,t){return lm(e,"{x}, {y}",t)}function Co(e,t){if(t.canWrapX()){const i=ne(t.getExtent()),n=mu(e,t,i);n&&(e[0]-=n*i)}return e}function mu(e,t,i){const n=t.getExtent();let r=0;return t.canWrapX()&&(e[0]<n[0]||e[0]>n[2])&&(i=i||ne(n),r=Math.floor((e[0]-n[0])/i)),r}const bo=63710088e-1;function wl(e,t,i){i=i||bo;const n=st(e[1]),r=st(t[1]),s=(r-n)/2,o=st(t[0]-e[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function _u(e,t){let i=0;for(let n=0,r=e.length;n<r-1;++n)i+=wl(e[n],e[n+1],t);return i}function Sl(e,t){let i=0;const n=e.length;let r=e[n-1][0],s=e[n-1][1];for(let o=0;o<n;o++){const a=e[o][0],l=e[o][1];i+=st(a-r)*(2+Math.sin(st(s))+Math.sin(st(l))),r=a,s=l}return i*t*t/2}function cm(e,t,i,n){n=n||bo;const r=st(e[1]),s=st(e[0]),o=t/n,a=Math.asin(Math.sin(r)*Math.cos(o)+Math.cos(r)*Math.sin(o)*Math.cos(i));return[wo(s+Math.atan2(Math.sin(i)*Math.sin(o)*Math.cos(r),Math.cos(o)-Math.sin(r)*Math.sin(a))),wo(a)]}const Ro={info:1,warn:2,error:3,none:4};let El=Ro.info;function yu(...e){El>Ro.warn||console.warn(...e)}function Po(...e){El>Ro.error||console.error(...e)}let xu=!0;function vu(e){xu=!(e===void 0||e)}function Tl(e,t){if(t!==void 0)for(let i=0,n=e.length;i<n;++i)t[i]=e[i];else t=e.slice();return t}function Fo(e,t){if(t!==void 0&&e!==t){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];e=t}return e}function wu(e){rm(e.getCode(),e),Sr(e,e,Tl)}function um(e){e.forEach(wu)}function X(e){return typeof e=="string"?nm(e):e||null}function Io(e,t,i,n){let r;const s=(e=X(e)).getPointResolutionFunc();if(s){if(r=s(t,i),n&&n!==e.getUnits()){const o=e.getMetersPerUnit();o&&(r=r*o/yr[n])}}else{const o=e.getUnits();if(o=="degrees"&&!n||n=="degrees")r=t;else{const a=Mt(e,X("EPSG:4326"));if(a===Fo&&o!=="degrees")r=t*e.getMetersPerUnit();else{let h=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];h=a(h,h,2),r=(wl(h.slice(0,2),h.slice(2,4))+wl(h.slice(4,6),h.slice(6,8)))/2}const l=n?yr[n]:e.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Cl(e){um(e),e.forEach(function(t){e.forEach(function(i){t!==i&&Sr(t,i,Tl)})})}function dm(e,t,i,n){e.forEach(function(r){t.forEach(function(s){Sr(r,s,i),Sr(s,r,n)})})}function bl(e,t){return e?typeof e=="string"?X(e):e:X(t)}function Su(e){return function(t,i,n){const r=t.length;n=n!==void 0?n:2,i=i!==void 0?i:new Array(r);for(let s=0;s<r;s+=n){const o=e(t.slice(s,s+n)),a=o.length;for(let l=0,h=n;l<h;++l)i[s+l]=l>=a?t[s+l]:o[l]}return i}}function gm(e,t,i,n){const r=X(e),s=X(t);Sr(r,s,Su(i)),Sr(s,r,Su(n))}function ct(e,t){if(e===t)return!0;const i=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||Mt(e,t)===Tl)&&i}function Mt(e,t){let i=du(e.getCode(),t.getCode());return i||(i=Fo),i}function ii(e,t){return Mt(X(e),X(t))}function Nn(e,t,i){return ii(t,i)(e,void 0,e.length)}function Lo(e,t,i,n){return _r(e,ii(t,i),void 0,n)}let vt=null;function fm(e){vt=X(e)}function Qe(){return vt}function Qi(e,t){return vt?Nn(e,t,vt):e}function Ee(e,t){return vt?Nn(e,vt,t):(xu&&!ti(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(xu=!1,yu("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function Ii(e,t){return vt?Lo(e,t,vt):e}function At(e,t){return vt?Lo(e,vt,t):e}function Eu(e,t){if(!vt)return e;const i=X(t).getMetersPerUnit(),n=vt.getMetersPerUnit();return i&&n?e*i/n:e}function pm(e,t){if(!vt)return e;const i=X(t).getMetersPerUnit(),n=vt.getMetersPerUnit();return i&&n?e*n/i:e}function Tu(e,t,i){return function(n){let r,s;if(e.canWrapX()){const o=e.getExtent(),a=ne(o);s=mu(n=n.slice(0),e,a),s&&(n[0]=n[0]-s*a),n[0]=H(n[0],o[0],o[2]),n[1]=H(n[1],o[1],o[3]),r=i(n)}else r=i(n);return s&&t.canWrapX()&&(r[0]+=s*ne(t.getExtent())),r}}function mm(){Cl(hu),Cl(uu),dm(uu,hu,Jp,Qp)}function _i(e,t,i,n,r,s){s=s||[];let o=0;for(let a=t;a<i;a+=n){const l=e[a],h=e[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function Rl(e,t,i,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let g=t;g<i;g+=n){const f=e[g]-h,p=e[g+1]-c;o[u++]=h+f*a-p*l,o[u++]=c+f*l+p*a;for(let m=g+2;m<g+n;++m)o[u++]=e[m]}return o&&o.length!=u&&(o.length=u),o}function _m(e,t,i,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<i;u+=n){const g=e[u]-l,f=e[u+1]-h;a[c++]=l+r*g,a[c++]=h+s*f;for(let p=u+2;p<u+n;++p)a[c++]=e[p]}return a&&a.length!=c&&(a.length=c),a}function ym(e,t,i,n,r,s,o){o=o||[];let a=0;for(let l=t;l<i;l+=n){o[a++]=e[l]+r,o[a++]=e[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=e[h]}return o&&o.length!=a&&(o.length=a),o}mm();const xm=[1,0,0,1,0,0];var Pl=class extends zt{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Yc((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return q()}closestPointXY(e,t,i,n){return q()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return q()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Hi(t),this.extentRevision_=this.getRevision()}return $p(this.extent_,e)}rotate(e,t){q()}scale(e,t,i){q()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return q()}getType(){return q()}applyTransform(e){q()}intersectsExtent(e){return q()}translate(e,t){q()}transform(e,t){const i=X(e),n=i.getUnits()=="tile-pixels"?function(r,s,o){const a=i.getExtent(),l=i.getWorldExtent(),h=Le(l)/Le(a);return pt(xm,l[0],l[3],h,-h,0,0,0),_i(r,0,r.length,o,xm,s),ii(i,t)(r,s,o)}:ii(i,t);return this.applyTransform(n),this}};function Dn(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function ms(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function vm(e,t,i){const n=e.getFlatCoordinates();if(!n)return null;const r=e.getStride();return _i(n,0,n.length,r,t,i)}var yi=class extends Pl{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return q()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=ms(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){q()}setLayout(e,t,i){let n;if(e)n=ms(e);else{for(let r=0;r<i;++r){if(t.length===0)return this.layout="XY",void(this.stride=2);t=t[0]}n=t.length,e=Dn(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Rl(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=rt(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();_m(n,0,n.length,r,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();ym(i,0,i.length,n,e,t,i),this.changed()}}};function wm(e,t,i,n,r,s,o){const a=e[t],l=e[t+1],h=e[i]-a,c=e[i+1]-l;let u;if(h===0&&c===0)u=t;else{const g=((r-a)*h+(s-l)*c)/(h*h+c*c);if(g>1)u=i;else{if(g>0){for(let f=0;f<n;++f)o[f]=Lt(e[t+f],e[i+f],g);return void(o.length=n)}u=t}}for(let g=0;g<n;++g)o[g]=e[u+g];o.length=n}function Fl(e,t,i,n,r){let s=e[t],o=e[t+1];for(t+=n;t<i;t+=n){const a=e[t],l=e[t+1],h=mi(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function Il(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){const a=i[s];r=Fl(e,t,a,n,r),t=a}return r}function Sm(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){const a=i[s];r=Il(e,t,a,n,r),t=a[a.length-1]}return r}function Ll(e,t,i,n,r,s,o,a,l,h,c){if(t==i)return h;let u,g;if(r===0){if(g=mi(o,a,e[t],e[t+1]),g<h){for(u=0;u<n;++u)l[u]=e[t+u];return l.length=n,g}return h}c=c||[NaN,NaN];let f=t+n;for(;f<i;)if(wm(e,f-n,f,n,o,a,c),g=mi(o,a,c[0],c[1]),g<h){for(h=g,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(g)-Math.sqrt(h))/r|0,1);if(s&&(wm(e,i-n,t,n,o,a,c),g=mi(o,a,c[0],c[1]),g<h)){for(h=g,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Ml(e,t,i,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,g=i.length;u<g;++u){const f=i[u];h=Ll(e,t,f,n,r,s,o,a,l,h,c),t=f}return h}function Em(e,t,i,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,g=i.length;u<g;++u){const f=i[u];h=Ml(e,t,f,n,r,s,o,a,l,h,c),t=f[f.length-1]}return h}function Cu(e,t,i,n){for(let r=0,s=i.length;r<s;++r)e[t++]=i[r];return t}function _s(e,t,i,n){for(let r=0,s=i.length;r<s;++r){const o=i[r];for(let a=0;a<n;++a)e[t++]=o[a]}return t}function ys(e,t,i,n,r){r=r||[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=_s(e,t,i[o],n);r[s++]=l,t=l}return r.length=s,r}function bu(e,t,i,n,r){r=r||[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=ys(e,t,i[o],n,r[s]);l.length===0&&(l[0]=t),r[s++]=l,t=l[l.length-1]}return r.length=s,r}function xs(e,t,i,n,r,s,o){const a=(i-t)/n;if(a<3){for(;t<i;t+=n)s[o++]=e[t],s[o++]=e[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,i-n];let c=0;for(;h.length>0;){const u=h.pop(),g=h.pop();let f=0;const p=e[g],m=e[g+1],_=e[u],x=e[u+1];for(let y=g+n;y<u;y+=n){const v=gu(e[y],e[y+1],p,m,_,x);v>f&&(c=y,f=v)}f>r&&(l[(c-t)/n]=1,g+n<c&&h.push(g,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=e[t+u*n],s[o++]=e[t+u*n+1]);return o}function Al(e,t,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const c=i[l];o=xs(e,t,c,n,r,s,o),a.push(o),t=c}return o}function Tm(e,t,i,n,r,s,o){if(i<=t+n){for(;t<i;t+=n)s[o++]=e[t],s[o++]=e[t+1];return o}let a=e[t],l=e[t+1];s[o++]=a,s[o++]=l;let h=a,c=l;for(t+=n;t<i;t+=n)h=e[t],c=e[t+1],mi(a,l,h,c)>r&&(s[o++]=h,s[o++]=c,a=h,l=c);return h==a&&c==l||(s[o++]=h,s[o++]=c),o}function kn(e,t){return t*Math.round(e/t)}function Cm(e,t,i,n,r,s,o){if(t==i)return o;let a,l,h=kn(e[t],r),c=kn(e[t+1],r);t+=n,s[o++]=h,s[o++]=c;do if(a=kn(e[t],r),l=kn(e[t+1],r),(t+=n)==i)return s[o++]=a,s[o++]=l,o;while(a==h&&l==c);for(;t<i;){const u=kn(e[t],r),g=kn(e[t+1],r);if(t+=n,u==a&&g==l)continue;const f=a-h,p=l-c,m=u-h,_=g-c;f*_==p*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(p<0&&_<p||p==_||p>0&&_>p)?(a=u,l=g):(s[o++]=a,s[o++]=l,h=a,c=l,a=u,l=g)}return s[o++]=a,s[o++]=l,o}function Ol(e,t,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const c=i[l];o=Cm(e,t,c,n,r,s,o),a.push(o),t=c}return o}function bm(e,t,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const c=i[l],u=[];o=Ol(e,t,c,n,r,s,o,u),a.push(u),t=c[c.length-1]}return o}function Li(e,t,i,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<i;o+=n)r[s++]=e.slice(o,o+n);return r.length=s,r}function vs(e,t,i,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o];r[s++]=Li(e,t,l,n,r[s]),t=l}return r.length=s,r}function Nl(e,t,i,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o];r[s++]=l.length===1&&l[0]===t?[]:vs(e,t,l,n,r[s]),t=l[l.length-1]}return r.length=s,r}function Dl(e,t,i,n){let r=0,s=e[i-n],o=e[i-n+1];for(;t<i;t+=n){const a=e[t],l=e[t+1];r+=o*a-s*l,s=a,o=l}return r/2}function Ru(e,t,i,n){let r=0;for(let s=0,o=i.length;s<o;++s){const a=i[s];r+=Dl(e,t,a,n),t=a}return r}function Rm(e,t,i,n){let r=0;for(let s=0,o=i.length;s<o;++s){const a=i[s];r+=Ru(e,t,a,n),t=a[a.length-1]}return r}class kl extends yi{constructor(t,i){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,i===void 0||Array.isArray(t[0])?this.setCoordinates(t,i):this.setFlatCoordinates(i,t)}clone(){return new kl(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,i,n,r){return r<Ln(this.getExtent(),t,i)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ll(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,i,n,r))}getArea(){return Dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const i=[];return i.length=xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new kl(i,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_s(this.flatCoordinates,0,t,this.stride),this.changed()}}var ws=kl;class Pu extends yi{constructor(t,i){super(),this.setCoordinates(t,i)}clone(){const t=new Pu(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,r){const s=this.flatCoordinates,o=mi(t,i,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return gr(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return cl(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Cu(this.flatCoordinates,0,t,this.stride),this.changed()}}var Ae=Pu;function Pm(e,t,i,n,r){return!gl(r,function(s){return!Gn(e,t,i,n,s[0],s[1])})}function Gn(e,t,i,n,r,s){let o=0,a=e[i-n],l=e[i-n+1];for(;t<i;t+=n){const h=e[t],c=e[t+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Gl(e,t,i,n,r,s){if(i.length===0||!Gn(e,t,i[0],n,r,s))return!1;for(let o=1,a=i.length;o<a;++o)if(Gn(e,i[o-1],i[o],n,r,s))return!1;return!0}function Fm(e,t,i,n,r,s){if(i.length===0)return!1;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(Gl(e,t,l,n,r,s))return!0;t=l[l.length-1]}return!1}function jl(e,t,i,n,r,s,o){let a,l,h,c,u,g,f;const p=r[s+1],m=[];for(let y=0,v=i.length;y<v;++y){const w=i[y];for(c=e[w-n],g=e[w-n+1],a=t;a<w;a+=n)u=e[a],f=e[a+1],(p<=g&&f<=p||g<=p&&p<=f)&&(h=(p-g)/(f-g)*(u-c)+c,m.push(h)),c=u,g=f}let _=NaN,x=-1/0;for(m.sort(qi),c=m[0],a=1,l=m.length;a<l;++a){u=m[a];const y=Math.abs(u-c);y>x&&(h=(c+u)/2,Gl(e,t,i,n,h,p)&&(_=h,x=y)),c=u}return isNaN(_)&&(_=r[s]),o?(o.push(_,p,x),o):[_,p,x]}function Fu(e,t,i,n,r){let s=[];for(let o=0,a=i.length;o<a;++o){const l=i[o];s=jl(e,t,l,n,r,2*o,s),t=l[l.length-1]}return s}function Iu(e,t,i,n,r){let s;for(t+=n;t<i;t+=n)if(s=r(e.slice(t-n,t),e.slice(t,t+n)),s)return s;return!1}function Mo(e,t,i,n,r){const s=au([1/0,1/0,-1/0,-1/0],e,t,i,n);return!!Ie(r,s)&&(!!ht(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]||Iu(e,t,i,n,function(o,a){return Yp(r,o,a)}))}function Im(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){if(Mo(e,t,i[s],n,r))return!0;t=i[s]}return!1}function Lu(e,t,i,n,r){return!!Mo(e,t,i,n,r)||!!Gn(e,t,i,n,r[0],r[1])||!!Gn(e,t,i,n,r[0],r[3])||!!Gn(e,t,i,n,r[2],r[1])||!!Gn(e,t,i,n,r[2],r[3])}function Mu(e,t,i,n,r){if(!Lu(e,t,i[0],n,r))return!1;if(i.length===1)return!0;for(let s=1,o=i.length;s<o;++s)if(Pm(e,i[s-1],i[s],n,r)&&!Mo(e,i[s-1],i[s],n,r))return!1;return!0}function Lm(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){const a=i[s];if(Mu(e,t,a,n,r))return!0;t=a[a.length-1]}return!1}function Mm(e,t,i,n){for(;t<i-n;){for(let r=0;r<n;++r){const s=e[t+r];e[t+r]=e[i-n+r],e[i-n+r]=s}t+=n,i-=n}}function Ao(e,t,i,n){let r=0,s=e[i-n],o=e[i-n+1];for(;t<i;t+=n){const a=e[t],l=e[t+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function Bl(e,t,i,n,r){r=r!==void 0&&r;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=Ao(e,t,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function Au(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!Bl(e,t,a,n,r))return!1;a.length&&(t=a[a.length-1])}return!0}function Oo(e,t,i,n,r){r=r!==void 0&&r;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=Ao(e,t,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&Mm(e,t,a,n),t=a}return t}function Ul(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s)t=Oo(e,t,i[s],n,r);return t}function No(e,t){const i=[];let n,r=0,s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=Ao(e,r,l,2);if(n===void 0&&(n=h),h===n)i.push(t.slice(s,o+1));else{if(i.length===0)continue;i[i.length-1].push(t[s])}s=o+1,r=l}return i}class Tr extends yi{constructor(t,i,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,i!==void 0&&n?(this.setFlatCoordinates(i,t),this.ends_=n):this.setCoordinates(t,i)}appendLinearRing(t){this.flatCoordinates?ge(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Tr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,n,r){return r<Ln(this.getExtent(),t,i)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Il(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,i,n,r))}containsXY(t,i){return Gl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,i)}getArea(){return Ru(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),Oo(i,0,this.ends_,this.stride,t)):i=this.flatCoordinates,vs(i,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=rt(this.getExtent());this.flatInteriorPoint_=jl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ae(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ws(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,i=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ws(i.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Bl(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Oo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=Ol(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new Tr(i,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Mu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ys(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}var ot=Tr;function Am(e,t,i,n){i=i||32;const r=[];for(let s=0;s<i;++s)ge(r,cm(e,t,2*Math.PI*s/i,n));return r.push(r[0],r[1]),new Tr(r,"XY",[r.length])}function Cr(e){if(fi(e))throw new Error("Cannot create polygon from empty extent");const t=e[0],i=e[1],n=e[2],r=e[3],s=[t,i,t,r,n,r,n,i,t,i];return new Tr(s,"XY",[s.length])}function Do(e,t,i){t=t||32;const n=e.getStride(),r=e.getLayout(),s=e.getCenter(),o=n*(t+1),a=new Array(o);for(let c=0;c<o;c+=n){a[c]=0,a[c+1]=0;for(let u=2;u<n;u++)a[c+u]=s[u]}const l=[a.length],h=new Tr(a,r,l);return Ou(h,s,e.getRadius(),i),h}function Ou(e,t,i,n){const r=e.getFlatCoordinates(),s=e.getStride(),o=r.length/s-1,a=n||0;for(let l=0;l<=o;++l){const h=l*s,c=a+2*ei(l,o)*Math.PI/o;r[h]=t[0]+i*Math.cos(c),r[h+1]=t[1]+i*Math.sin(c)}e.changed()}const Om="accuracy",Nm="accuracyGeometry",Dm="altitude",km="altitudeAccuracy",Gm="heading",Nu="position",Du="projection",jm="speed",ku="tracking",Bm="trackingOptions",gw="error";class Um extends He{constructor(t){super(gw),this.code=t.code,this.message=t.message}}var fw=class extends zt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Fo,this.watchId_=void 0,this.addChangeListener(Du,this.handleProjectionChanged_),this.addChangeListener(ku,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0&&e.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Mt(X("EPSG:4326"),e),this.position_&&this.set(Nu,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):e||this.watchId_===void 0||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(Om,t.accuracy),this.set(Dm,t.altitude===null?void 0:t.altitude),this.set(km,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(Gm,t.heading===null?void 0:st(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(Nu,i.slice()),this.set(jm,t.speed===null?void 0:t.speed);const n=Am(this.position_,t.accuracy);n.applyTransform(this.transform_),this.set(Nm,n),this.changed()}positionError_(e){this.dispatchEvent(new Um(e))}getAccuracy(){return this.get(Om)}getAccuracyGeometry(){return this.get(Nm)||null}getAltitude(){return this.get(Dm)}getAltitudeAccuracy(){return this.get(km)}getHeading(){return this.get(Gm)}getPosition(){return this.get(Nu)}getProjection(){return this.get(Du)}getSpeed(){return this.get(jm)}getTracking(){return this.get(ku)}getTrackingOptions(){return this.get(Bm)}setProjection(e){this.set(Du,X(e))}setTracking(e){this.set(ku,e)}setTrackingOptions(e){this.set(Bm,e)}},wt=0,en=1,Ze=2,tn=3,zm=4;function Xm(e,t,i){const n=e;let r=!0,s=!1,o=!1;const a=[hr(n,Ep,function(){o=!0,s||t()})];return n.src&&sl?(s=!0,n.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():i())})):a.push(hr(n,sw,i)),function(){r=!1,a.forEach(fe)}}function Vm(e,t){return new Promise((i,n)=>{function r(){o(),i(e)}function s(){o(),n(new Error("Image load error"))}function o(){e.removeEventListener("load",r),e.removeEventListener("error",s)}e.addEventListener("load",r),e.addEventListener("error",s),t&&(e.src=t)})}function Gu(e,t){return t&&(e.src=t),e.src&&sl?new Promise((i,n)=>e.decode().then(()=>i(e)).catch(r=>e.complete&&e.width?i(e):n(r))):Vm(e)}function nn(e,t){return t&&(e.src=t),e.src&&sl&&Mp?e.decode().then(()=>createImageBitmap(e)).catch(i=>{if(e.complete&&e.width)return e;throw i}):Gu(e)}var ko=class extends lr{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof n=="function"?wt:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent(he)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==wt&&this.loader){this.state=en,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;qc(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=Ze}).catch(i=>{this.state=tn,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}},zl=class extends ko{constructor(e,t,i,n,r){super(e,t,i,r!==void 0?wt:Ze),this.loader_=r!==void 0?r:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=tn):this.state=Ze,this.changed()}load(){this.state==wt&&(this.state=en,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}},Ss=class extends cr{constructor(e,t,i,n,r,s){super(e,t,s),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=we,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Ne,this.unlistenImage_(),this.image_=function(){const e=ke(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=we:this.state=De,this.unlistenImage_(),this.changed()}load(){this.state==Ne&&(this.state=Be,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Be&&(this.state=Kt,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Xm(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}},Wm=class{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[t]-this.points_[i],s=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(s,r),this.initialVelocity_=Math.sqrt(r*r+s*s)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Go={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},Es={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};Es.max=Es.whitepoint[2].D65,Es.rgb=function(e,t){t=t||Es.whitepoint[2].E;var i,n,r,s=e[0]/t[0],o=e[1]/t[1],a=e[2]/t[2];return n=-.96924363628087*s+1.87596750150772*o+.041555057407175*a,r=.055630079696993*s+-.20397695888897*o+1.056971514242878*a,i=(i=3.240969941904521*s+-1.537383177570093*o+-.498610760293*a)>.0031308?1.055*Math.pow(i,.4166666666666667)-.055:i*=12.92,n=n>.0031308?1.055*Math.pow(n,.4166666666666667)-.055:n*=12.92,r=r>.0031308?1.055*Math.pow(r,.4166666666666667)-.055:r*=12.92,[255*(i=Math.min(Math.max(0,i),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},Go.xyz=function(e,t){var i=e[0]/255,n=e[1]/255,r=e[2]/255,s=.21263900587151*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.71516867876775*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.072192315360733*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92),o=.019330818715591*i+.11919477979462*n+.95053215224966*r;return[(.41239079926595*i+.35758433938387*n+.18048078840183*r)*(t=t||Es.whitepoint[2].E)[0],s*t[1],o*t[2]]};var xi=Es,ju={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(e,t,i){var n,r,s,o,a,l,h,c,u;return s=e[0],o=e[1],a=e[2],s===0?[0,0,0]:(t=t||"D65",i=i||2,n=o/(13*s)+4*(h=xi.whitepoint[i][t][0])/(h+15*(c=xi.whitepoint[i][t][1])+3*(u=xi.whitepoint[i][t][2]))||0,r=a/(13*s)+9*c/(h+15*c+3*u)||0,[9*(l=s>8?c*Math.pow((s+16)/116,3):c*s*.0011070564598794539)*n/(4*r)||0,l,l*(12-3*n-20*r)/(4*r)||0])}};xi.luv=function(e,t,i){var n,r,s,o,a,l,h,c,u,g,f;t=t||"D65",i=i||2,g=4*(h=xi.whitepoint[i][t][0])/(h+15*(c=xi.whitepoint[i][t][1])+3*(u=xi.whitepoint[i][t][2])),f=9*c/(h+15*c+3*u),n=4*(o=e[0])/(o+15*(a=e[1])+3*(l=e[2]))||0,r=9*a/(o+15*a+3*l)||0;var p=a/c;return[s=p<=.008856451679035631?903.2962962962961*p:116*Math.pow(p,.3333333333333333)-16,13*s*(n-g),13*s*(r-f)]};var Zm={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(e){var t,i=e[0],n=e[1];return t=e[2]/360*2*Math.PI,[i,n*Math.cos(t),n*Math.sin(t)]},xyz:function(e){return ju.xyz(Zm.luv(e))}};function Bu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}ju.lchuv=function(e){var t=e[0],i=e[1],n=e[2],r=Math.sqrt(i*i+n*n),s=360*Math.atan2(n,i)/2/Math.PI;return s<0&&(s+=360),[t,r,s]},xi.lchuv=function(e){return ju.lchuv(xi.luv(e))};var $m=Bu({aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Ym={red:0,orange:60,yellow:120,green:180,blue:240,purple:300},Uu={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(e){var t,i,n,r,s,o=e[0]/360,a=e[1]/100,l=e[2]/100,h=0;if(a===0)return[s=255*l,s,s];for(t=2*l-(i=l<.5?l*(1+a):l+a-l*a),r=[0,0,0];h<3;)(n=o+1/3*-(h-1))<0?n++:n>1&&n--,s=6*n<1?t+6*(i-t)*n:2*n<1?i:3*n<2?t+(i-t)*(2/3-n)*6:t,r[h++]=255*s;return r}};function pw(e){var t;Array.isArray(e)&&e.raw&&(e=String.raw(...arguments)),e instanceof Number&&(e=+e);var i=function(s){var o,a,l=[],h=1;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(65280&s)>>>8,255&s],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(65280&s)>>>8,255&s],alpha:1};if(s=String(s).toLowerCase(),$m[s])l=$m[s].slice(),a="rgb";else if(s==="transparent")h=0,a="rgb",l=[0,0,0];else if(s[0]==="#"){var c=s.slice(1),u=c.length;h=1,u<=4?(l=[parseInt(c[0]+c[0],16),parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16)],u===4&&(h=parseInt(c[3]+c[3],16)/255)):(l=[parseInt(c[0]+c[1],16),parseInt(c[2]+c[3],16),parseInt(c[4]+c[5],16)],u===8&&(h=parseInt(c[6]+c[7],16)/255)),l[0]||(l[0]=0),l[1]||(l[1]=0),l[2]||(l[2]=0),a="rgb"}else if(o=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var g=o[1],f=(a=g.replace(/a$/,""))==="cmyk"?4:a==="gray"?1:3;l=o[2].trim().split(/\s*[,\/]\s*|\s+/),a==="color"&&(a=l.shift()),h=(l=l.map(function(p,m){if(p[p.length-1]==="%")return p=parseFloat(p)/100,m===3?p:a==="rgb"?255*p:a[0]==="h"?100*p:a[0]!=="l"||m?a==="lab"?125*p:a==="lch"?m<2?150*p:360*p:a[0]!=="o"||m?a==="oklab"?.4*p:a==="oklch"?m<2?.4*p:360*p:p:p:100*p;if(a[m]==="h"||m===2&&a[a.length-1]==="h"){if(Ym[p]!==void 0)return Ym[p];if(p.endsWith("deg"))return parseFloat(p);if(p.endsWith("turn"))return 360*parseFloat(p);if(p.endsWith("grad"))return 360*parseFloat(p)/400;if(p.endsWith("rad"))return 180*parseFloat(p)/Math.PI}return p==="none"?0:parseFloat(p)})).length>f?l.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(l=s.match(/([0-9]+)/g).map(function(p){return parseFloat(p)}),a=s.match(/([a-z])/gi)?.join("")?.toLowerCase()||"rgb");return{space:a,values:l,alpha:h}}(e);if(!i.space)return[];const n=i.space[0]==="h"?Uu.min:Go.min,r=i.space[0]==="h"?Uu.max:Go.max;return(t=Array(3))[0]=Math.min(Math.max(i.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(i.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(i.values[2],n[2]),r[2]),i.space[0]==="h"&&(t=Uu.rgb(t)),t.push(Math.min(Math.max(i.alpha,0),1)),t}function zu(e){return typeof e=="string"?e:Zu(e)}Go.hsl=function(e){var t,i,n=e[0]/255,r=e[1]/255,s=e[2]/255,o=Math.min(n,r,s),a=Math.max(n,r,s),l=a-o;return a===o?t=0:n===a?t=(r-s)/l:r===a?t=2+(s-n)/l:s===a&&(t=4+(n-r)/l),(t=Math.min(60*t,360))<0&&(t+=360),i=(o+a)/2,[t,100*(a===o?0:i<=.5?l/(a+o):l/(2-a-o)),100*i]};const mw=1024,jo={};let Xu=0;function qm(e){if(e.length===4)return e;const t=e.slice();return t[3]=1,t}function Vu(e){const t=xi.lchuv(Go.xyz(e));return t[3]=e[3],t}function Km(e){const t=xi.rgb(Zm.xyz(e));return t[3]=e[3],t}function Xl(e){if(jo.hasOwnProperty(e))return jo[e];if(Xu>=mw){let i=0;for(const n in jo)!(3&i++)&&(delete jo[n],--Xu)}const t=pw(e);if(t.length!==4)throw new Error('Failed to parse "'+e+'" as color');for(const i of t)if(isNaN(i))throw new Error('Failed to parse "'+e+'" as color');return Wu(t),jo[e]=t,++Xu,t}function vi(e){return Array.isArray(e)?e:Xl(e)}function Wu(e){return e[0]=H(e[0]+.5|0,0,255),e[1]=H(e[1]+.5|0,0,255),e[2]=H(e[2]+.5|0,0,255),e[3]=H(e[3],0,1),e}function Zu(e){let t=e[0];t!=(0|t)&&(t=t+.5|0);let i=e[1];i!=(0|i)&&(i=i+.5|0);let n=e[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+i+","+n+","+(e[3]===void 0?1:Math.round(100*e[3])/100)+")"}function Hm(e){try{return Xl(e),!0}catch{return!1}}class Jm{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const i in this.cache_){const n=this.cache_[i];3&t++||n.hasListener()||(delete this.cache_[i],--this.cacheSize_)}}}get(t,i,n){const r=Qm(t,i,n);return r in this.cache_?this.cache_[r]:null}set(t,i,n,r){const s=Qm(t,i,n);this.cache_[s]=r,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Qm(e,t,i){return t+":"+e+":"+(i?zu(i):"null")}var _w=Jm;const Bo=new Jm;var Vl="opacity",$u="visible",e_="extent",Yu="zIndex",qu="maxResolution",Ku="minResolution",Hu="maxZoom",Ju="minZoom",Wl="source",Qu="map",ed=class extends zt{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Vl]=e.opacity!==void 0?e.opacity:1,ie(typeof t[Vl]=="number","Layer opacity must be a number"),t[$u]=e.visible===void 0||e.visible,t[Yu]=e.zIndex,t[qu]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Ku]=e.minResolution!==void 0?e.minResolution:0,t[Ju]=e.minZoom!==void 0?e.minZoom:-1/0,t[Hu]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0||e},i=this.getZIndex();return t.opacity=H(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i!==void 0||t.managed?i:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return q()}getLayerStatesArray(e){return q()}getExtent(){return this.get(e_)}getMaxResolution(){return this.get(qu)}getMinResolution(){return this.get(Ku)}getMinZoom(){return this.get(Ju)}getMaxZoom(){return this.get(Hu)}getOpacity(){return this.get(Vl)}getSourceState(){return q()}getVisible(){return this.get($u)}getZIndex(){return this.get(Yu)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(e_,e)}setMaxResolution(e){this.set(qu,e)}setMinResolution(e){this.set(Ku,e)}setMaxZoom(e){this.set(Hu,e)}setMinZoom(e){this.set(Ju,e)}setOpacity(e){ie(typeof e=="number","Layer opacity must be a number"),this.set(Vl,e)}setVisible(e){this.set($u,e)}setZIndex(e){this.set(Yu,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},td="prerender",Zl="postrender",$l="precompose",id="postcompose",nd="rendercomplete",_t=0,Ot=1,Wt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};const rd=42,br=256;function sd(e,t,i){return function(n,r,s,o,a){if(!n)return;if(!r&&!t)return n;const l=t?0:s[0]*r,h=t?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let g=e[0]+l/2+c,f=e[2]-l/2+c,p=e[1]+h/2+u,m=e[3]-h/2+u;g>f&&(g=(f+g)/2,f=g),p>m&&(p=(m+p)/2,m=p);let _=H(n[0],g,f),x=H(n[1],p,m);if(o&&i&&r){const y=30*r;_+=-y*Math.log(1+Math.max(0,g-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-f)/y),x+=-y*Math.log(1+Math.max(0,p-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-m)/y)}return[_,x]}}function t_(e){return e}function od(e,t,i,n){const r=ne(t)/i[0],s=Le(t)/i[1];return n?Math.min(e,Math.max(r,s)):Math.min(e,Math.min(r,s))}function ad(e,t,i){let n=Math.min(e,t);return n*=Math.log(1+50*Math.max(0,e/t-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/e-1))/50+1),H(n,i/2,2*t)}function i_(e,t,i,n){return t=t===void 0||t,function(r,s,o,a){if(r!==void 0){const l=e[0],h=e[e.length-1],c=i?od(l,i,o,n):l;if(a)return t?ad(r,c,h):H(r,h,c);const u=Math.min(c,r),g=Math.floor(go(e,u,s));return e[g]>c&&g<e.length-1?e[g+1]:e[g]}}}function n_(e,t,i,n,r,s){return n=n===void 0||n,i=i!==void 0?i:0,function(o,a,l,h){if(o!==void 0){const c=r?od(t,r,l,s):t;if(h)return n?ad(o,c,i):H(o,i,c);const u=1e-9,g=Math.ceil(Math.log(t/c)/Math.log(e)-u),f=-a*(.5-u)+.5,p=Math.min(c,o),m=Math.floor(Math.log(t/p)/Math.log(e)+f),_=Math.max(g,m);return H(t/Math.pow(e,_),i,c)}}}function ld(e,t,i,n,r){return i=i===void 0||i,function(s,o,a,l){if(s!==void 0){const h=n?od(e,n,a,r):e;return i&&l?ad(s,h,t):H(s,t,h)}}}function Yl(e){if(e!==void 0)return 0}function hd(e){if(e!==void 0)return e}function r_(e){const t=2*Math.PI/e;return function(i,n){return n?i:i!==void 0?i=Math.floor(i/t+.5)*t:void 0}}function s_(e){const t=e===void 0?st(5):e;return function(i,n){return n||i===void 0?i:Math.abs(i)<=t?0:i}}function ql(e,t){setTimeout(function(){e(t)},0)}function o_(e){if(e.extent!==void 0){const i=e.smoothExtentConstraint===void 0||e.smoothExtentConstraint;return sd(e.extent,e.constrainOnlyCenter,i)}const t=bl(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){const i=t.getExtent().slice();return i[0]=-1/0,i[2]=1/0,sd(i,!1,!1)}return t_}function a_(e){let t,i,n,r=e.minZoom!==void 0?e.minZoom:0,s=e.maxZoom!==void 0?e.maxZoom:28;const o=e.zoomFactor!==void 0?e.zoomFactor:2,a=e.multiWorld!==void 0&&e.multiWorld,l=e.smoothResolutionConstraint===void 0||e.smoothResolutionConstraint,h=e.showFullExtent!==void 0&&e.showFullExtent,c=bl(e.projection,"EPSG:3857"),u=c.getExtent();let g=e.constrainOnlyCenter,f=e.extent;if(a||f||!c.isGlobal()||(g=!1,f=u),e.resolutions!==void 0){const p=e.resolutions;i=p[r],n=p[s]!==void 0?p[s]:p[p.length-1],t=e.constrainResolution?i_(p,l,!g&&f,h):ld(i,n,l,!g&&f,h)}else{const p=(u?Math.max(ne(u),Le(u)):360*yr.degrees/c.getMetersPerUnit())/br/Math.pow(2,0),m=p/Math.pow(2,28);i=e.maxResolution,i!==void 0?r=0:i=p/Math.pow(o,r),n=e.minResolution,n===void 0&&(n=e.maxZoom!==void 0?e.maxResolution!==void 0?i/Math.pow(o,s):p/Math.pow(o,s):m),s=r+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,s-r),t=e.constrainResolution?n_(o,i,n,l,!g&&f,h):ld(i,n,l,!g&&f,h)}return{constraint:t,maxResolution:i,minResolution:n,minZoom:r,zoomFactor:o}}function l_(e){if(e.enableRotation===void 0||e.enableRotation){const t=e.constrainRotation;return t===void 0||t===!0?s_():t===!1?hd:typeof t=="number"?r_(t):hd}return Yl}function h_(e){return!(e.sourceCenter&&e.targetCenter&&!ti(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function cd(e,t,i,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=e[0]*s-e[1]*o,l=e[1]*s+e[0]*o;return a+=(t[0]/2-i[0])*n,l+=(i[1]-t[1]/2)*n,o=-o,[a*s-l*o,l*s+a*o]}var wi=class extends zt{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=bl(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&vu(),e.center&&(e.center=Ee(e.center,this.projection_)),e.extent&&(e.extent=At(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const o in Wt)delete t[o];this.setProperties(t,!0);const i=a_(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=o_(e),r=i.constraint,s=l_(e);this.constraints_={center:n,resolution:r,rotation:s},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),s=r/2*(n[3]-t[3]+t[1]-n[1]),o=r/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+s,i[1]-o])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=Ee(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ee(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t,i=arguments.length;i>1&&typeof arguments[i-1]=="function"&&(t=arguments[i-1],--i);let n=0;for(;n<i&&!this.isDef();++n){const h=arguments[n];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(n===i)return void(t&&ql(t,!0));let r=Date.now(),s=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;n<i;++n){const h=arguments[n],c={start:r,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||tl,callback:t};if(h.center&&(c.sourceCenter=s,c.targetCenter=h.center.slice(),s=c.targetCenter),h.zoom!==void 0?(c.sourceResolution=o,c.targetResolution=this.getResolutionForZoom(h.zoom),o=c.targetResolution):h.resolution&&(c.sourceResolution=o,c.targetResolution=h.resolution,o=c.targetResolution),h.rotation!==void 0){c.sourceRotation=a;const u=ei(h.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+u,a=c.targetRotation}h_(c)?c.complete=!0:r+=c.duration,l.push(c)}this.animations_.push(l),this.setHint(_t,1),this.updateAnimations_()}getAnimating(){return this.hints_[_t]>0}getInteracting(){return this.hints_[Ot]>0}cancelAnimations(){let e;this.setHint(_t,-this.hints_[_t]);for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&ql(n[0].callback,!1),!e)for(let r=0,s=n.length;r<s;++r){const o=n[r];if(!o.complete){e=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let s=0,o=n.length;s<o;++s){const a=n[s];if(a.complete)continue;const l=e-a.start;let h=a.duration>0?l/a.duration:1;h>=1?(a.complete=!0,h=1):r=!1;const c=a.easing(h);if(a.sourceCenter){const u=a.sourceCenter[0],g=a.sourceCenter[1],f=a.targetCenter[0],p=a.targetCenter[1];this.nextCenter_=a.targetCenter;const m=u+c*(f-u),_=g+c*(p-g);this.targetCenter_=[m,_]}if(a.sourceResolution&&a.targetResolution){const u=c===1?a.targetResolution:a.sourceResolution+c*(a.targetResolution-a.sourceResolution);if(a.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(u,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,a.anchor)}this.nextResolution_=a.targetResolution,this.targetResolution_=u,this.applyTargetState_(!0)}if(a.sourceRotation!==void 0&&a.targetRotation!==void 0){const u=c===1?ei(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+c*(a.targetRotation-a.sourceRotation);if(a.anchor){const g=this.constraints_.rotation(u,!0);this.targetCenter_=this.calculateCenterRotate(g,a.anchor)}this.nextRotation_=a.targetRotation,this.targetRotation_=u}if(this.applyTargetState_(!0),t=!0,!a.complete)break}if(r){this.animations_[i]=null,this.setHint(_t,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const s=n[0].callback;s&&ql(s,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],xl(i,e-this.getRotation()),fu(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),r=this.getResolution();return n!==void 0&&r!==void 0&&(i=[t[0]-e*(t[0]-n[0])/r,t[1]-e*(t[1]-n[1])/r]),i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Qi(e,this.getProjection())}getCenterInternal(){return this.get(Wt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){return Ii(this.calculateExtentInternal(e),this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();ie(t,"The view center is not defined");const i=this.getResolution();ie(i!==void 0,"The view resolution is not defined");const n=this.getRotation();return ie(n!==void 0,"The view rotation is not defined"),us(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Wt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(At(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=ne(e)/t[0],n=Le(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(Wt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/t;return function(s){return Math.log(i/s)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const s=this.getViewportSizeMinusPadding_();n=cd(n,this.getViewportSize_(),[s[0]/2+r[3],s[1]/2+r[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t,i,n=this.minZoom_||0;if(this.resolutions_){const r=go(this.resolutions_,e,1);n=r,t=this.resolutions_[r],i=r==this.resolutions_.length-1?2:t/this.resolutions_[r+1]}else t=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(t/e)/Math.log(i)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=H(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,H(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(ie(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e))ie(!fi(e),"Cannot fit empty extent provided as `geometry`"),i=Cr(At(e,this.getProjection()));else if(e.getType()==="Circle"){const n=At(e.getExtent(),this.getProjection());i=Cr(n),i.rotate(this.getRotation(),rt(n))}else{const n=Qe();i=n?e.clone().transform(n,this.getProjection()):e}this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),r=e.getFlatCoordinates(),s=e.getStride();let o=1/0,a=1/0,l=-1/0,h=-1/0;for(let c=0,u=r.length;c<u;c+=s){const g=r[c]*i-r[c+1]*n,f=r[c]*n+r[c+1]*i;o=Math.min(o,g),a=Math.min(a,f),l=Math.max(l,g),h=Math.max(h,f)}return[o,a,l,h]}fitInternal(e,t){let i=(t=t||{}).size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0&&t.nearest;let s;s=t.minResolution!==void 0?t.minResolution:t.maxZoom!==void 0?this.getResolutionForZoom(t.maxZoom):0;const o=this.rotatedExtentForGeometry(e);let a=this.getResolutionForExtentInternal(o,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);a=isNaN(a)?s:Math.max(a,s),a=this.getConstrainedResolution(a,r?0:1);const l=this.getRotation(),h=Math.sin(l),c=Math.cos(l),u=rt(o);u[0]+=(n[1]-n[3])/2*a,u[1]+=(n[0]-n[2])/2*a;const g=u[0]*c-u[1]*h,f=u[1]*c+u[0]*h,p=this.getConstrainedCenter([g,f],a),m=t.callback?t.callback:ar;t.duration!==void 0?this.animateInternal({resolution:a,center:p,duration:t.duration,easing:t.easing},m):(this.targetResolution_=a,this.targetCenter_=p,this.applyTargetState_(!1,!0),ql(m,!0))}centerOn(e,t,i){this.centerOnInternal(Ee(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(cd(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let r;const s=this.padding_;if(s&&e){const o=this.getViewportSizeMinusPadding_(-i),a=cd(e,n,[o[0]/2+s[3],o[1]/2+s[0]],t,i);r=[e[0]-a[0],e[1]-a[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Qi(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Ee(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Ee(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Ee(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,r,i),o=this.constraints_.center(this.targetCenter_,s,r,i,this.calculateCenterShift(this.targetCenter_,s,n,r));this.get(Wt.ROTATION)!==n&&this.set(Wt.ROTATION,n),this.get(Wt.RESOLUTION)!==s&&(this.set(Wt.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),o&&this.get(Wt.CENTER)&&ti(this.get(Wt.CENTER),o)||this.set(Wt.CENTER,o),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,r=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,n,s),a=this.constraints_.center(this.targetCenter_,o,s,!1,this.calculateCenterShift(this.targetCenter_,o,r,s));if(e===0&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=a,void this.applyTargetState_();i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===r&&this.getCenterInternal()&&ti(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:a,resolution:o,duration:e,easing:Pn,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ot,1)}endInteraction(e,t,i){i=i&&Ee(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Ot,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}};function Kl(e,t){if(!e.visible)return!1;const i=t.resolution;if(i<e.minResolution||i>=e.maxResolution)return!1;const n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var Rr=class extends ed{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Wl,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return(e=e||[]).push(this),e}getLayerStatesArray(e){return(e=e||[]).push(this.getLayerState()),e}getSource(){return this.get(Wl)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||this.getSource().getState()!=="ready"||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(fe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=W(e,he,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null}isVisible(e){let t;const i=this.getMapInternal();let n;!e&&i&&(e=i.getView()),t=e instanceof wi?{viewState:e.getState(),extent:e.calculateExtent()}:e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray()),n=t.layerStatesArray?t.layerStatesArray.find(s=>s.layer===this):this.getLayerState();const r=this.getExtent();return Kl(n,t.viewState)&&(!r||Ie(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];let n=t(e instanceof wi?e.getViewStateAndExtent():e);return Array.isArray(n)||(n=[n]),n}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(Qu,e)}getMapInternal(){return this.get(Qu)}setMap(e){this.mapPrecomposeKey_&&(fe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(fe(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=W(e,$l,function(t){const i=t.frameState.layerStatesArray,n=this.getLayerState(!1);ie(!i.some(function(r){return r.layer===n.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(n)},this),this.mapRenderKey_=W(this,he,e.render,e),this.changed())}setSource(e){this.set(Wl,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function yw(e,t){Bo.expire()}var c_=class extends as{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){q()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;pt(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Ht(n,i)}forEachFeatureAtCoordinate(e,t,i,n,r,s,o,a){let l;const h=t.viewState;function c(v,w,S,C){return r.call(s,w,v?S:null,C)}const u=h.projection,g=Co(e.slice(),u),f=[[0,0]];if(u.canWrapX()&&n){const v=ne(u.getExtent());f.push([-v,0],[v,0])}const p=t.layerStatesArray,m=p.length,_=[],x=[];for(let v=0;v<f.length;v++)for(let w=m-1;w>=0;--w){const S=p[w],C=S.layer;if(C.hasRenderer()&&Kl(S,h)&&o.call(a,C)){const E=C.getRenderer(),R=C.getSource();if(E&&R){const P=R.getWrapX()?g:e,I=c.bind(null,S.managed);x[0]=P[0]+f[v][0],x[1]=P[1]+f[v][1],l=E.forEachFeatureAtCoordinate(x,t,i,I,_)}if(l)return l}}if(_.length===0)return;const y=1/_.length;return _.forEach((v,w)=>v.distanceSq+=w*y),_.sort((v,w)=>v.distanceSq-w.distanceSq),_.some(v=>l=v.callback(v.feature,v.layer,v.geometry)),l}hasFeatureAtCoordinate(e,t,i,n,r,s){return this.forEachFeatureAtCoordinate(e,t,i,n,Ut,this,r,s)!==void 0}getMap(){return this.map_}renderFrame(e){q()}flushDeclutterItems(e){}scheduleExpireIconCache(e){Bo.canExpireCache()&&e.postRenderFunctions.push(yw)}},Ts=class extends He{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}};const Uo="ol-hidden",u_="ol-selectable",Si="ol-unselectable",ud="ol-unsupported",jn="ol-control",zo="ol-collapsed",xw=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),d_=["style","variant","weight","size","lineHeight","family"],dd=function(e){const t=e.match(xw);if(!t)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,r=d_.length;n<r;++n){const s=t[n+1];s!==void 0&&(i[d_[n]]=s)}return i.families=i.family.split(/,\s?/),i},gd="10px sans-serif",St="#000",Pr="round",Mi=[],Fr="round",Cs=10,bs="#000",Rs="center",Xo="middle",Bn=[0,0,0,0],Ai=new zt;let fd,Ps=null;const Hl={},g_=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013";let r,s;function o(l,h,c){let u=!0;for(let g=0;g<i;++g){const f=t[g];if(s=Vo(l+" "+h+" "+e+f,n),c!=f){const p=Vo(l+" "+h+" "+e+c+","+f,n);u=u&&p!=s}}return!!u}function a(){let l=!0;const h=Ai.getKeys();for(let c=0,u=h.length;c<u;++c){const g=h[c];Ai.get(g)<100&&(o.apply(this,g.split(`
`))?(Rn(Hl),Ps=null,fd=void 0,Ai.set(g,100)):(Ai.set(g,Ai.get(g)+1,!0),l=!1))}l&&(clearInterval(r),r=void 0)}return function(l){const h=dd(l);if(!h)return;const c=h.families;for(let u=0,g=c.length;u<g;++u){const f=c[u],p=h.style+`
`+h.weight+`
`+f;Ai.get(p)===void 0&&(Ai.set(p,100,!0),o(h.style,h.weight,f)||(Ai.set(p,0,!0),r===void 0&&(r=setInterval(a,32))))}}}(),f_=function(){let e;return function(t){let i=Hl[t];if(i==null){if(rl){const n=dd(t),r=p_(t,"\u017Dg");i=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),i=e.offsetHeight,document.body.removeChild(e);Hl[t]=i}return i}}();function p_(e,t){return Ps||(Ps=ke(1,1)),e!=fd&&(Ps.font=e,fd=Ps.font),Ps.measureText(t)}function Vo(e,t){return p_(e,t).width}function pd(e,t,i){if(t in i)return i[t];const n=t.split(`
`).reduce((r,s)=>Math.max(r,Vo(e,s)),0);return i[t]=n,n}function m_(e,t){const i=[],n=[],r=[];let s=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){s=Math.max(s,o),r.push(o),o=0,a+=l;continue}const g=t[h+1]||e.font,f=Vo(g,u);i.push(f),o+=f;const p=f_(g);n.push(p),l=Math.max(l,p)}return{width:s,height:a,widths:i,heights:n,lineWidths:r}}function __(e,t,i,n,r,s,o,a,l,h,c){e.save(),i!==1&&(e.globalAlpha*=i),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(l,h),e.scale(c[0],c[1]),function(u,g){const f=u.contextInstructions;for(let p=0,m=f.length;p<m;p+=2)Array.isArray(f[p+1])?g[f[p]].apply(g,f[p+1]):g[f[p]]=f[p+1]}(n,e)):c[0]<0||c[1]<0?(e.translate(l,h),e.scale(c[0],c[1]),e.drawImage(n,r,s,o,a,0,0,o,a)):e.drawImage(n,r,s,o,a,l,h,o*c[0],a*c[1]),e.restore()}var y_=class extends c_{constructor(e){super(e),this.fontChangeListenerKey_=W(Ai,or,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Si+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new Ts(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){fe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent($l,e);const t=e.layerStatesArray.sort(function(s,o){return s.zIndex-o.zIndex}),i=e.viewState;this.children_.length=0;const n=this.declutterLayers_;n.length=0;let r=null;for(let s=0,o=t.length;s<o;++s){const a=t[s];e.layerIndex=s;const l=a.layer,h=l.getSourceState();if(!Kl(a,i)||h!="ready"&&h!="undefined"){l.unrender();continue}const c=l.render(e,r);c&&(c!==r&&(this.children_.push(c),r=c),"getDeclutter"in l&&n.push(l))}this.flushDeclutterItems(e),Np(this.element_,this.children_),this.dispatchRenderEvent(id,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let i=t.length-1;i>=0;--i)t[i].renderDeclutter(e);t.length=0}};class rn extends He{constructor(t,i){super(t),this.layer=i}}const md="layers";class _d extends ed{constructor(t){t=t||{};const i=Object.assign({},t);delete i.layers;let n=t.layers;super(i),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(md,this.handleLayersChanged_),n?Array.isArray(n)?n=new Je(n.slice(),{unique:!0}):ie(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Je(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(fe),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(W(t,di,this.handleLayersAdd_,this),W(t,gi,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(fe);Rn(this.listenerKeys_);const i=t.getArray();for(let n=0,r=i.length;n<r;n++){const s=i[n];this.registerLayerListeners_(s),this.dispatchEvent(new rn("addlayer",s))}this.changed()}registerLayerListeners_(t){const i=[W(t,or,this.handleLayerChange_,this),W(t,he,this.handleLayerChange_,this)];t instanceof _d&&i.push(W(t,"addlayer",this.handleLayerGroupAdd_,this),W(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[k(t)]=i}handleLayerGroupAdd_(t){this.dispatchEvent(new rn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new rn("removelayer",t.layer))}handleLayersAdd_(t){const i=t.element;this.registerLayerListeners_(i),this.dispatchEvent(new rn("addlayer",i)),this.changed()}handleLayersRemove_(t){const i=t.element,n=k(i);this.listenerKeys_[n].forEach(fe),delete this.listenerKeys_[n],this.dispatchEvent(new rn("removelayer",i)),this.changed()}getLayers(){return this.get(md)}setLayers(t){const i=this.getLayers();if(i){const n=i.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new rn("removelayer",n[r]))}this.set(md,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(i){i.getLayersArray(t)}),t}getLayerStatesArray(t){const i=t!==void 0?t:[],n=i.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(i)});const r=this.getLayerState();let s=r.zIndex;t||r.zIndex!==void 0||(s=0);for(let o=n,a=i.length;o<a;o++){const l=i[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=We(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return i}getSourceState(){return"ready"}}var Wo=_d,Ir=class extends He{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}},Oi=class extends Ir{constructor(e,t,i,n,r,s){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0&&n,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},re={SINGLECLICK:"singleclick",CLICK:Fi,DBLCLICK:ow,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Jl="pointermove",yd="pointerdown",x_="pointerup",vw="pointerout",v_=class extends lr{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=W(i,yd,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=W(i,Jl,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Tp,this.boundHandleTouchMove_,!!eu&&{passive:!1})}emulateClick_(e){let t=new Oi(re.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Oi(re.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Oi(re.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==re.POINTERUP||t.type==re.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else t.type!=re.POINTERDOWN&&t.type!=re.POINTERMOVE||(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Oi(re.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Oi(re.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(W(i,re.POINTERMOVE,this.handlePointerMove_,this),W(i,re.POINTERUP,this.handlePointerUp_,this),W(this.element_,re.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(W(this.element_.getRootNode(),re.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Oi(re.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new Oi(re.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||typeof e.cancelable=="boolean"&&e.cancelable!==!0||e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(fe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Tp,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(fe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},Ql="postrender",ww="movestart",w_="moveend",S_="loadstart",E_="loadend",eh="layergroup",th="size",Lr="target",Fs="view";const Zo=1/0;var T_=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Rn(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){ie(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Zo&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,r=t[e],s=i[e],o=e;for(;e<n>>1;){const a=this.getLeftChildIndex_(e),l=this.getRightChildIndex_(e),h=l<n&&i[l]<i[a]?l:a;t[e]=t[h],i[e]=i[h],e=h}t[e]=r,i[e]=s,this.siftDown_(o,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,r=i[t],s=n[t];for(;t>e;){const o=this.getParentIndex_(t);if(!(n[o]>s))break;i[t]=i[o],n[t]=n[o],t=o}i[t]=r,n[t]=s}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const r=t.length;let s,o,a;for(o=0;o<r;++o)s=t[o],a=e(s),a==Zo?delete this.queuedElements_[this.keyFunction_(s)]:(i[n]=a,t[n++]=s);t.length=n,i.length=n,this.heapify_()}},xd=class extends T_{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(he,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===we||i===Ne||i===De){i!==Ne&&t.removeEventListener(he,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i,n,r,s=0;for(;this.tilesLoading_<e&&s<t&&this.getCount()>0;)n=this.dequeue()[0],r=n.getKey(),i=n.getState(),i!==Be||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++s,n.load())}};function C_(e,t,i,n,r){if(!e||!(i in e.wantedTiles)||!e.wantedTiles[i][t.getKey()])return Zo;const s=e.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}var Ni=class extends zt{constructor(e){super();const t=e.element;!t||e.target||t.style.pointerEvents||(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){mo(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&mo(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)fe(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ar&&this.listenerKeys.push(W(e,Ql,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}},b_=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed===void 0||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible===void 0||e.collapsible,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"\u203A",s=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=s):this.collapseLabel_=r;const o=e.label!==void 0?e.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=n):this.label_=o;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(Fi,this.handleClick_.bind(this),!1);const l=t+" "+Si+" "+jn+(this.collapsed_&&this.collapsible_?" "+zo:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=l,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(n=>n.getAttributions(e)))),i=!this.getMap().getAllLayers().some(n=>n.getSource()&&n.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ui(t,this.renderedAttributions_)){tu(this.ulElement_);for(let n=0,r=t.length;n<r;++n){const s=document.createElement("li");s.innerHTML=t[n],this.ulElement_.appendChild(s)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(zo),this.collapsed_?ur(this.collapseLabel_,this.label_):ur(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},R_=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"\u21E7",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=e.tipLabel?e.tipLabel:"Reset rotation",s=document.createElement("button");s.className=t+"-reset",s.setAttribute("type","button"),s.title=r,s.appendChild(this.label_),s.addEventListener(Fi,this.handleClick_.bind(this),!1);const o=t+" "+Si+" "+jn,a=this.element;a.className=o,a.appendChild(s),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide===void 0||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Uo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Pn}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Uo);r||i!==0?r&&i!==0&&this.element.classList.remove(Uo):this.element.classList.add(Uo)}this.label_.style.transform=n}this.rotation_=i}},P_=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",s=e.zoomInLabel!==void 0?e.zoomInLabel:"+",o=e.zoomOutLabel!==void 0?e.zoomOutLabel:"\u2013",a=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",l=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=n,h.setAttribute("type","button"),h.title=a,h.appendChild(typeof s=="string"?document.createTextNode(s):s),h.addEventListener(Fi,this.handleClick_.bind(this,i),!1);const c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(Fi,this.handleClick_.bind(this,-i),!1);const u=t+" "+Si+" "+jn,g=this.element;g.className=u,g.appendChild(h),g.appendChild(c),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const i=t.getZoom();if(i!==void 0){const n=t.getConstrainedZoom(i+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:n,duration:this.duration_,easing:Pn})):t.setZoom(n)}}};function F_(e){e=e||{};const t=new Je;return(e.zoom===void 0||e.zoom)&&t.push(new P_(e.zoomOptions)),(e.rotate===void 0||e.rotate)&&t.push(new R_(e.rotateOptions)),(e.attribution===void 0||e.attribution)&&t.push(new b_(e.attributionOptions)),t}var ih="active";function I_(e,t,i){const n=e.getCenterInternal();if(n){const r=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:i!==void 0?i:250,easing:Rp,center:e.getConstrainedCenter(r)})}}function nh(e,t,i,n){const r=e.getZoom();if(r===void 0)return;const s=e.getConstrainedZoom(r+t),o=e.getResolutionForZoom(s);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:o,anchor:i,duration:n!==void 0?n:250,easing:Pn})}var Di=class extends zt{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ih)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(ih,e)}setMap(e){this.map_=e}},L_=class extends Di{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==re.DBLCLICK){const i=e.originalEvent,n=e.map,r=e.coordinate,s=i.shiftKey?-this.delta_:this.delta_;nh(n.getView(),s,r,this.duration_),i.preventDefault(),t=!0}return!t}};function rh(e){const t=e.length;let i=0,n=0;for(let r=0;r<t;r++)i+=e[r].clientX,n+=e[r].clientY;return{clientX:i/t,clientY:n/t}}var ni=class extends Di{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==re.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==re.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==re.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==re.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function sh(e){const t=arguments;return function(i){let n=!0;for(let r=0,s=t.length;r<s&&(n=n&&t[r](i),n);++r);return n}}const M_=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},A_=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},O_=function(e){const t=e.map.getTargetElement(),i=e.map.getOwnerDocument().activeElement;return t.contains(i)},vd=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||O_(e)},Mr=Ut,wd=function(e){const t=e.originalEvent;return t.button==0&&!(Lp&&il&&t.ctrlKey)},oh=bn,Sd=function(e){return e.type==re.SINGLECLICK},ah=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},N_=function(e){const t=e.originalEvent;return il?t.metaKey:t.ctrlKey},$o=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ed=function(e){const t=e.originalEvent,i=t.target.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"&&!t.target.isContentEditable},Ar=function(e){const t=e.originalEvent;return ie(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},Td=function(e){const t=e.originalEvent;return ie(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};var D_=class extends ni{constructor(e){super({stopDown:bn}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:sh(ah,Td);this.condition_=e.onFocusOnly?sh(vd,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(rh(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],s=e.map.getView();pu(r,s.getResolution()),xl(r,s.getRotation()),s.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),s=i.getCenterInternal(),o=t.getPixelFromCoordinateInternal(s),a=t.getCoordinateFromPixelInternal([o[0]-n*Math.cos(r),o[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(a),duration:500,easing:Pn})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},k_=class extends ni{constructor(e){e=e||{},super({stopDown:bn}),this.condition_=e.condition?e.condition:A_,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Ar(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===Yl)return;const n=t.getSize(),r=e.pixel,s=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const o=s-this.lastAngle_;i.adjustRotationInternal(-o)}this.lastAngle_=s}handleUpEvent(e){return Ar(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Ar(e)&&wd(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},G_=class extends as{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,i=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new ot([i])}getGeometry(){return this.geometry_}};const Sw="boxstart",Ew="boxdrag",Tw="boxend",Cw="boxcancel";class lh extends He{constructor(t,i,n){super(t),this.coordinate=i,this.mapBrowserEvent=n}}var j_=class extends ni{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new G_(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:wd,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],r=i[1]-t[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new lh(Ew,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new lh(t?Tw:Cw,e.coordinate,e)),!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new lh(Sw,e.coordinate,e)),!0)}onBoxEnd(e){}},B_=class extends j_{constructor(e){super({condition:(e=e||{}).condition?e.condition:$o,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0&&e.out}onBoxEnd(e){const t=this.getMap().getView();let i=this.getGeometry();if(this.out_){const n=t.rotatedExtentForGeometry(i),r=t.getResolutionForExtentInternal(n),s=t.getResolution()/r;i=i.clone(),i.scale(s*s)}t.fitInternal(i,{duration:this.duration_,easing:Pn})}},U_="ArrowLeft",bw="ArrowUp",z_="ArrowRight",X_="ArrowDown",V_=class extends Di{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return ah(t)&&Ed(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Qa){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==X_||n==U_||n==z_||n==bw)){const r=e.map.getView(),s=r.getResolution()*this.pixelDelta_;let o=0,a=0;n==X_?a=-s:n==U_?o=-s:n==z_?o=s:a=s;const l=[o,a];xl(l,r.getRotation()),I_(r,l,this.duration_),i.preventDefault(),t=!0}}return!t}},W_=class extends Di{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!N_(t)&&Ed(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Qa||e.type==Sp){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const r=e.map,s=n==="+"?this.delta_:-this.delta_;nh(r.getView(),s,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}},Z_=class extends Di{constructor(e){super(e=e||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor===void 0||e.useAnchor,this.constrainResolution_=e.constrainResolution!==void 0&&e.constrainResolution;const t=e.condition?e.condition:Mr;this.condition_=e.onFocusOnly?sh(vd,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==fo)return!0;const t=e.map,i=e.originalEvent;let n;if(i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==fo&&(n=i.deltaY,Pp&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(n/=nl),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),n===0)return!1;this.lastDelta_=n;const r=Date.now();this.startTime_===void 0&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?"trackpad":"wheel");const s=t.getView();if(this.mode_==="trackpad"&&!s.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(s.getAnimating()&&s.cancelAnimations(),s.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),s.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=n;const o=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),o),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-H(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),nh(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},$_=class extends ni{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=bn),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const a=r-this.lastAngle_;this.rotationDelta_+=a,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=a}this.lastAngle_=r;const s=e.map,o=s.getView();o.getConstraints().rotation!==Yl&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(rh(this.targetPointers))),this.rotating_&&(s.render(),o.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},Y_=class extends ni{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=bn),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,s=i.clientY-n.clientY,o=Math.sqrt(r*r+s*s);this.lastDistance_!==void 0&&(t=this.lastDistance_/o),this.lastDistance_=o;const a=e.map,l=a.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(rh(this.targetPointers))),a.render(),l.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}};function q_(e){e=e||{};const t=new Je,i=new Wm(-.005,.05,100);return(e.altShiftDragRotate===void 0||e.altShiftDragRotate)&&t.push(new k_),(e.doubleClickZoom===void 0||e.doubleClickZoom)&&t.push(new L_({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan===void 0||e.dragPan)&&t.push(new D_({onFocusOnly:e.onFocusOnly,kinetic:i})),(e.pinchRotate===void 0||e.pinchRotate)&&t.push(new $_),(e.pinchZoom===void 0||e.pinchZoom)&&t.push(new Y_({duration:e.zoomDuration})),(e.keyboard===void 0||e.keyboard)&&(t.push(new V_),t.push(new W_({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom===void 0||e.mouseWheelZoom)&&t.push(new Z_({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom===void 0||e.shiftDragZoom)&&t.push(new B_({duration:e.zoomDuration})),t}function Cd(e){return e[0]>0&&e[1]>0}function bd(e,t,i){return i===void 0&&(i=[0,0]),i[0]=e[0]*t+.5|0,i[1]=e[1]*t+.5|0,i}function Ge(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}function K_(e){e instanceof Rr?e.setMapInternal(null):e instanceof Wo&&e.getLayers().forEach(K_)}function H_(e,t){if(e instanceof Rr)e.setMapInternal(t);else if(e instanceof Wo){const i=e.getLayers().getArray();for(let n=0,r=i.length;n<r;++n)H_(i[n],t)}}var J_=class extends zt{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=function(n){let r=null;n.keyboardEventTarget!==void 0&&(r=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const s={},o=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Wo({layers:n.layers});let a,l,h;return s[eh]=o,s[Lr]=n.target,s[Fs]=n.view instanceof wi?n.view:new wi,n.controls!==void 0&&(Array.isArray(n.controls)?a=new Je(n.controls.slice()):(ie(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),a=n.controls)),n.interactions!==void 0&&(Array.isArray(n.interactions)?l=new Je(n.interactions.slice()):(ie(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),l=n.interactions)),n.overlays!==void 0?Array.isArray(n.overlays)?h=new Je(n.overlays.slice()):(ie(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),h=n.overlays):h=new Je,{controls:a,interactions:l,keyboardEventTarget:r,overlays:h,values:s}}(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:nl,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||F_(),this.interactions=t.interactions||q_({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new xd(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(eh,this.handleLayerGroupChanged_),this.addChangeListener(Fs,this.handleViewChanged_),this.addChangeListener(th,this.handleSizeChanged_),this.addChangeListener(Lr,this.handleTargetChanged_),this.setProperties(t.values);const i=this;!e.view||e.view instanceof wi||e.view.then(function(n){i.setView(new wi(n))}),this.controls.addEventListener(di,n=>{n.element.setMap(this)}),this.controls.addEventListener(gi,n=>{n.element.setMap(null)}),this.interactions.addEventListener(di,n=>{n.element.setMap(this)}),this.interactions.addEventListener(gi,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(di,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(gi,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){H_(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e),r=(i=i!==void 0?i:{}).hitTolerance!==void 0?i.hitTolerance:0,s=i.layerFilter!==void 0?i.layerFilter:Ut,o=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,o,t,null,s,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];return function t(i){i.forEach(function(n){n instanceof Wo?t(n.getLayers()):e.push(n)})}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e),n=(t=t!==void 0?t:{}).layerFilter!==void 0?t.layerFilter:Ut,r=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,s,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),i=this.getSize(),n=t.width/i[0],r=t.height/i[1],s="changedTouches"in e?e.changedTouches[0]:e;return[(s.clientX-t.left)/n,(s.clientY-t.top)/r]}getTarget(){return this.get(Lr)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Qi(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?ye(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(eh)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Je)return void t.setLayers(e);const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const s=n.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(e){const t=Ee(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?ye(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(th)}getView(){return this.get(Fs)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return C_(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new Oi(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===yd||i===fo||i===Qa){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,s=t.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===n?n.documentElement:r).contains(s))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const s=n[r];if(!(s.getMap()!==this||!s.getActive()||!this.getTargetElement())&&(!s.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const s=e.viewHints;if(s[_t]||s[Ot]){const o=Date.now()-e.time>8;n=o?0:8,r=o?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(nd)&&this.renderer_.dispatchRenderEvent(nd,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ir(E_,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ir(S_,this,e))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)fe(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Kc,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(fo,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,mo(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new y_(this)),this.mapBrowserEventHandler_=new v_(this,this.moveTolerance_);for(const r in re)this.mapBrowserEventHandler_.addEventListener(re[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Kc,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(fo,this.boundHandleBrowserEvent_,!!eu&&{passive:!1});const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[W(i,Qa,this.handleBrowserEvent,this),W(i,Sp,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(fe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(fe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=W(e,or,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=W(e,he,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(fe),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new rn("addlayer",e)),this.layerGroupPropertyListenerKeys_=[W(e,or,this.render,this),W(e,he,this.render,this),W(e,"addlayer",this.handleLayerAdd_,this),W(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){K_(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&Cd(t)&&i&&i.isDef()){const s=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:us(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:s,wantedTiles:{},mapId:k(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=us(o.nextCenter,o.nextResolution,a,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!fi(this.previousExtent_)&&!It(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ir(ww,this,n)),this.previousExtent_=Hi(this.previousExtent_)),this.previousExtent_&&!r.viewHints[_t]&&!r.viewHints[Ot]&&!It(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ir(w_,this,r)),ru(r.extent,this.previousExtent_))),this.dispatchEvent(new Ir(Ql,this,r)),this.renderComplete_=this.hasListener(S_)||this.hasListener(E_)||this.hasListener(nd)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new rn("removelayer",t)),this.set(eh,e)}setSize(e){this.set(th,e)}setTarget(e){this.set(Lr,e)}setView(e){if(!e||e instanceof wi)return void this.set(Fs,e);this.set(Fs,new wi);const t=this;e.then(function(i){t.setView(new wi(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(r)||isNaN(s)||(t=[r,s],!Cd(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&yu("No map visible because the map container's width or height are 0."))}const i=this.getSize();!t||i&&ui(t,i)||(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};const Rd="element",Pd="map",Fd="offset",hh="position",Id="positioning";var Q_=class extends zt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst===void 0||e.insertFirst,this.stopEvent=e.stopEvent===void 0||e.stopEvent,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+u_,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Rd,this.handleElementChanged),this.addChangeListener(Pd,this.handleMapChanged),this.addChangeListener(Fd,this.handleOffsetChanged),this.addChangeListener(hh,this.handlePositionChanged),this.addChangeListener(Id,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Rd)}getId(){return this.id}getMap(){return this.get(Pd)||null}getOffset(){return this.get(Fd)}getPosition(){return this.get(hh)}getPositioning(){return this.get(Id)}handleElementChanged(){tu(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(mo(this.element),fe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=W(e,Ql,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Rd,e)}setMap(e){this.set(Pd,e)}setOffset(e){this.set(Fd,e)}setPosition(e){this.set(hh,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(hh))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[Ap(n),Op(n)]),s=(e=e||{}).margin===void 0?20:e.margin;if(!ht(i,r)){const o=r[0]-i[0],a=i[2]-r[2],l=r[1]-i[1],h=i[3]-r[3],c=[0,0];if(o<0?c[0]=o-s:a<0&&(c[0]=Math.abs(a)+s),l<0?c[1]=l-s:h<0&&(c[1]=Math.abs(h)+s),c[0]!==0||c[1]!==0){const u=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(u);if(!g)return;const f=[g[0]+c[0],g[1]+c[1]],p=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:p.duration,easing:p.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(Id,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);let s="0%",o="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?s="-100%":r!="bottom-center"&&r!="center-center"&&r!="top-center"||(s="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?o="-100%":r!="center-left"&&r!="center-center"&&r!="center-right"||(o="-50%");const a=`translate(${s}, ${o}) translate(${Math.round(e[0]+n[0])+"px"}, ${Math.round(e[1]+n[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a)}getOptions(){return this.options}},ch=class{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return ie(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return ie(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){ie(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}};function Is(e,t,i,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=i,n):[e,t,i]}function Ei(e,t,i){return e+"/"+t+"/"+i}function sn(e){return Ei(e[0],e[1],e[2])}function e0(e){const[t,i,n]=e.substring(e.lastIndexOf("/")+1,e.length).split(",").map(Number);return Ei(t,i,n)}function Ld(e){return e.split("/").map(Number)}function uh(e){return(e[1]<<e[0])+e[2]}function t0(e,t){const i=e[0],n=e[1],r=e[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const s=t.getFullTileRange(i);return!s||s.containsXY(n,r)}var Yo=class extends ch{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=Ld(this.peekFirstKey())[0];this.forEach(t=>{t.tileCoord[0]!==e&&(this.remove(sn(t.tileCoord)),t.release())})}};class i0{constructor(t,i,n,r){this.minX=t,this.maxX=i,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Or(e,t,i,n,r){return r!==void 0?(r.minX=e,r.maxX=t,r.minY=i,r.maxY=n,r):new i0(e,t,i,n)}var dh=i0;const n0=[];var r0=class extends cr{constructor(e,t,i,n){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=k(e);return t in this.context_||(this.context_[t]=ke(1,1,n0)),this.context_[t]}hasContext(e){return k(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=k(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];In(t),n0.push(t.canvas),delete this.context_[e]}super.release()}},s0=class extends cr{constructor(e,t,i,n,r,s){super(e,t,s),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==Be&&(this.setState(Kt),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(Ne)}setFeatures(e){this.features_=e,this.setState(we)}setLoader(e){this.loader_=e}};function Ti(e){return Array.isArray(e)?Zu(e):e}let o0,a0=!1;function Md(e,t,i,n,r,s,o){const a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(i,n,r):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=a0,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?s(t.readFeatures(c,{extent:i,featureProjection:r}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Ad(e,t){return function(i,n,r,s,o){const a=this;Md(e,t,i,n,r,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||ar)}}function l0(e,t){return[[-1/0,-1/0,1/0,1/0]]}function gh(e,t,i,n){const r=document.createElement("script"),s="olc_"+k(t);function o(){delete window[s],r.parentNode.removeChild(r)}r.async=!0,r.src=e+(e.includes("?")?"&":"?")+(n||"callback")+"="+s;const a=setTimeout(function(){o(),i&&i()},1e4);window[s]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(r)}class h0 extends Error{constructor(t){super("Unexpected response status: "+t.status),this.name="ResponseError",this.response=t}}class c0 extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function Od(e){return new Promise(function(t,i){const n=new XMLHttpRequest;n.addEventListener("load",function(r){const s=r.target;if(!s.status||s.status>=200&&s.status<300){let o;try{o=JSON.parse(s.responseText)}catch(a){const l="Error parsing response text as JSON: "+a.message;return void i(new Error(l))}t(o)}else i(new h0(s))}),n.addEventListener("error",function(r){i(new c0(r.target))}),n.open("GET",e),n.setRequestHeader("Accept","application/json"),n.send()})}function Nd(e,t){return t.includes("://")?t:new URL(t,e).href}var Dd=class{drawCustom(e,t,i,n){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}},fh=class extends Dd{constructor(e,t,i,n,r,s,o){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.transformRotation_=n?An(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=s,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(e,t,i,n){if(!this.image_)return;const r=_i(e,t,i,n,this.transform_,this.pixelCoordinates_),s=this.context_,o=this.tmpLocalTransform_,a=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;this.transformRotation_===0&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let h=0,c=r.length;h<c;h+=2){const u=r[h]-this.imageAnchorX_,g=r[h+1]-this.imageAnchorY_;if(l!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const f=u+this.imageAnchorX_,p=g+this.imageAnchorY_;pt(o,f,p,1,1,l,-f,-p),s.save(),s.transform.apply(s,o),s.translate(f,p),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=a)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=_i(e,t,i,n,this.transform_,this.pixelCoordinates_),s=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);t<i;t+=n){const a=r[t]+this.textOffsetX_,l=r[t+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(a-this.textOffsetX_,l-this.textOffsetY_),s.rotate(o),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,a,l),this.textFillState_&&s.fillText(this.text_,a,l))}}moveToLineTo_(e,t,i,n,r){const s=this.context_,o=_i(e,t,i,n,this.transform_,this.pixelCoordinates_);s.moveTo(o[0],o[1]);let a=o.length;r&&(a-=2);for(let l=2;l<a;l+=2)s.lineTo(o[l],o[l+1]);return r&&s.closePath(),i}drawRings_(e,t,i,n){for(let r=0,s=i.length;r<s;++r)t=this.moveToLineTo_(e,t,i[r],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ie(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=vm(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],r=Math.sqrt(i*i+n*n),s=this.context_;s.beginPath(),s.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e)}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ie(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Ie(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let r=0;const s=e.getEnds(),o=e.getStride();i.beginPath();for(let a=0,l=s.length;a<l;++a)r=this.moveToLineTo_(n,r,s[a],o,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ie(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ie(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const r=e.getEndss(),s=e.getStride();t.beginPath();for(let o=0,a=r.length;o<a;++o){const l=r[o];n=this.drawRings_(i,n,l,s)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),ui(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:Rs;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(e){const i=e.getColor();this.fillState_={fillStyle:Ti(i||St)}}else this.fillState_=null;if(t){const i=t.getColor(),n=t.getLineCap(),r=t.getLineDash(),s=t.getLineDashOffset(),o=t.getLineJoin(),a=t.getWidth(),l=t.getMiterLimit(),h=r||Mi;this.strokeState_={lineCap:n!==void 0?n:Pr,lineDash:this.pixelRatio_===1?h:h.map(c=>c*this.pixelRatio_),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:o!==void 0?o:Fr,lineWidth:(a!==void 0?a:1)*this.pixelRatio_,miterLimit:l!==void 0?l:Cs,strokeStyle:Ti(i||bs)}}else this.strokeState_=null}setImageStyle(e){let t;if(!e||!(t=e.getSize()))return void(this.image_=null);const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const s=e.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/i,s[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(e){const t=e.getFill();if(t){const g=t.getColor();this.textFillState_={fillStyle:Ti(g||St)}}else this.textFillState_=null;const i=e.getStroke();if(i){const g=i.getColor(),f=i.getLineCap(),p=i.getLineDash(),m=i.getLineDashOffset(),_=i.getLineJoin(),x=i.getWidth(),y=i.getMiterLimit();this.textStrokeState_={lineCap:f!==void 0?f:Pr,lineDash:p||Mi,lineDashOffset:m||0,lineJoin:_!==void 0?_:Fr,lineWidth:x!==void 0?x:1,miterLimit:y!==void 0?y:Cs,strokeStyle:Ti(g||bs)}}else this.textStrokeState_=null;const n=e.getFont(),r=e.getOffsetX(),s=e.getOffsetY(),o=e.getRotateWithView(),a=e.getRotation(),l=e.getScaleArray(),h=e.getText(),c=e.getTextAlign(),u=e.getTextBaseline();this.textState_={font:n!==void 0?n:gd,textAlign:c!==void 0?c:Rs,textBaseline:u!==void 0?u:Xo},this.text_=h!==void 0?Array.isArray(h)?h.reduce((g,f,p)=>g+(p%2?" ":f),""):h:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=o!==void 0&&o,this.textRotation_=a!==void 0?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}};const Rw=.5,u0={Point:function(e,t,i,n,r){const s=i.getImage(),o=i.getText();let a;if(s){if(s.getImageState()!=Ze)return;let l=e;if(r){const c=s.getDeclutterMode();if(c!=="none")if(l=r,c==="obstacle"){const u=e.getBuilder(i.getZIndex(),"Image");u.setImageStyle(s,a),u.drawPoint(t,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(i.getZIndex(),"Image");h.setImageStyle(s,a),h.drawPoint(t,n)}if(o&&o.getText()){let l=e;r&&(l=r);const h=l.getBuilder(i.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,n)}},LineString:function(e,t,i,n,r){const s=i.getStroke();if(s){const a=e.getBuilder(i.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,n)}const o=i.getText();if(o&&o.getText()){const a=(r||e).getBuilder(i.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}},Polygon:function(e,t,i,n,r){const s=i.getFill(),o=i.getStroke();if(s||o){const l=e.getBuilder(i.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,n)}const a=i.getText();if(a&&a.getText()){const l=(r||e).getBuilder(i.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}},MultiPoint:function(e,t,i,n,r){const s=i.getImage(),o=i.getText();let a;if(s){if(s.getImageState()!=Ze)return;let l=e;if(r){const c=s.getDeclutterMode();if(c!=="none")if(l=r,c==="obstacle"){const u=e.getBuilder(i.getZIndex(),"Image");u.setImageStyle(s,a),u.drawMultiPoint(t,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(i.getZIndex(),"Image");h.setImageStyle(s,a),h.drawMultiPoint(t,n)}if(o&&o.getText()){let l=e;r&&(l=r);const h=l.getBuilder(i.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,n)}},MultiLineString:function(e,t,i,n,r){const s=i.getStroke();if(s){const a=e.getBuilder(i.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,n)}const o=i.getText();if(o&&o.getText()){const a=(r||e).getBuilder(i.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}},MultiPolygon:function(e,t,i,n,r){const s=i.getFill(),o=i.getStroke();if(o||s){const l=e.getBuilder(i.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,n)}const a=i.getText();if(a&&a.getText()){const l=(r||e).getBuilder(i.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}},GeometryCollection:function(e,t,i,n,r){const s=t.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o)(0,u0[s[o].getType()])(e,s[o],i,n,r)},Circle:function(e,t,i,n,r){const s=i.getFill(),o=i.getStroke();if(s||o){const l=e.getBuilder(i.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,n)}const a=i.getText();if(a&&a.getText()){const l=(r||e).getBuilder(i.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}};function d0(e,t){return parseInt(k(e),10)-parseInt(k(t),10)}function ph(e,t){const i=mh(e,t);return i*i}function mh(e,t){return Rw*e/t}function qo(e,t,i,n,r,s,o){let a=!1;const l=i.getImage();if(l){const h=l.getImageState();h==Ze||h==tn?l.unlistenImageChange(r):(h==wt&&l.load(),l.listenImageChange(r),a=!0)}return function(h,c,u,g,f,p){const m=u.getGeometryFunction()(c);if(!m)return;const _=m.simplifyTransformed(g,f);u.getRenderer()?g0(h,_,u,c):(0,u0[_.getType()])(h,_,u,c,p)}(e,t,i,n,s,o),a}function g0(e,t,i,n){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let s=0,o=r.length;s<o;++s)g0(e,r[s],i,n);return}e.getBuilder(i.getZIndex(),"Default").drawCustom(t,n,i.getRenderer(),i.getHitDetectionRenderer())}function f0(e){if(!(e.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=e.inversePixelTransform[0],i=e.inversePixelTransform[1],n=Math.sqrt(t*t+i*i),r=e.frameState,s=Ki(e.inversePixelTransform.slice(),r.coordinateToPixelTransform),o=ph(r.viewState.resolution,n);let a;const l=Qe();return l&&(a=Mt(l,r.viewState.projection)),new fh(e.context,n,r.extent,s,r.viewState.rotation,o,a)}let kd;const ki=[];function p0(e,t,i,n,r){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(n,r),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(i,r)),e.restore()}function Gd(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function Ls(e,t,i,n){const r=Nn(i,t,e);let s=Io(t,n,i);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=e.getMetersPerUnit();a!==void 0&&(s/=a);const l=e.getExtent();if(!l||Jt(l,r)){const h=Io(e,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function jd(e,t,i,n){const r=rt(i);let s=Ls(e,t,r,n);return(!isFinite(s)||s<=0)&&gl(i,function(o){return s=Ls(e,t,o,n),isFinite(s)&&s>0}),s}function _h(e,t,i,n,r,s,o,a,l,h,c,u,g){const f=ke(Math.round(i*e),Math.round(i*t),ki);if(u||(f.imageSmoothingEnabled=!1),l.length===0)return f.canvas;function p(y){return Math.round(y*i)/i}f.scale(i,i),f.globalCompositeOperation="lighter";const m=[1/0,1/0,-1/0,-1/0];let _;if(l.forEach(function(y,v,w){su(m,y.extent)}),!g||l.length!==1||h!==0){const y=ne(m),v=Le(m);_=ke(Math.round(i*y/n),Math.round(i*v/n),ki),u||(_.imageSmoothingEnabled=!1);const w=i/n;l.forEach(function(S,C,E){const R=S.extent[0]-m[0],P=-(S.extent[3]-m[3]),I=ne(S.extent),A=Le(S.extent);S.image.width>0&&S.image.height>0&&_.drawImage(S.image,h,h,S.image.width-2*h,S.image.height-2*h,R*w,P*w,I*w,A*w)})}const x=Qt(o);return a.getTriangles().forEach(function(y,v,w){const S=y.source,C=y.target;let E=S[0][0],R=S[0][1],P=S[1][0],I=S[1][1],A=S[2][0],G=S[2][1];const B=p((C[0][0]-x[0])/s),z=p(-(C[0][1]-x[1])/s),N=p((C[1][0]-x[0])/s),M=p(-(C[1][1]-x[1])/s),V=p((C[2][0]-x[0])/s),se=p(-(C[2][1]-x[1])/s),oe=E,xe=R;E=0,R=0,P-=oe,I-=xe,A-=oe,G-=xe;const U=om([[P,I,0,0,N-B],[A,G,0,0,V-B],[0,0,P,I,M-z],[0,0,A,G,se-z]]);if(!U)return;if(f.save(),f.beginPath(),function(){if(kd===void 0){const me=ke(6,6,ki);me.globalCompositeOperation="lighter",me.fillStyle="rgba(210, 0, 0, 0.75)",p0(me,4,5,4,0),p0(me,4,5,0,5);const ve=me.getImageData(0,0,3,3).data;kd=Gd(ve,0)||Gd(ve,4)||Gd(ve,8),In(me),ki.push(me.canvas)}return kd}()||!u){f.moveTo(N,M);const me=4,ve=B-N,Pi=z-M;for(let xt=0;xt<me;xt++)f.lineTo(N+p((xt+1)*ve/me),M+p(xt*Pi/(me-1))),xt!=me-1&&f.lineTo(N+p((xt+1)*ve/me),M+p((xt+1)*Pi/(me-1)));f.lineTo(V,se)}else f.moveTo(N,M),f.lineTo(B,z),f.lineTo(V,se);let nt;if(f.clip(),f.transform(U[0],U[2],U[1],U[3],B,z),f.translate(m[0]-oe,m[3]-xe),_)nt=_.canvas,f.scale(n/i,-n/i);else{const me=l[0],ve=me.extent;nt=me.image,f.scale(ne(ve)/nt.width,-Le(ve)/nt.height)}f.drawImage(nt,0,0),f.restore()}),_&&(In(_),ki.push(_.canvas)),c&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,a.getTriangles().forEach(function(y,v,w){const S=y.target,C=(S[0][0]-x[0])/s,E=-(S[0][1]-x[1])/s,R=(S[1][0]-x[0])/s,P=-(S[1][1]-x[1])/s,I=(S[2][0]-x[0])/s,A=-(S[2][1]-x[1])/s;f.beginPath(),f.moveTo(R,P),f.lineTo(C,E),f.lineTo(I,A),f.closePath(),f.stroke()}),f.restore()),f.canvas}function Ko(e){return Array.isArray(e)?Math.min(...e):e}const Bd=.5;var yh=class{constructor(e,t,i,n,r,s){this.sourceProj_=e,this.targetProj_=t;let o={};const a=ii(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const y=x[0]+"/"+x[1];return o[y]||(o[y]=a(x)),o[y]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&ne(n)>=ne(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ne(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ne(this.targetProj_.getExtent()):null;const l=Qt(i),h=ds(i),c=mr(i),u=pr(i),g=this.transformInv_(l),f=this.transformInv_(h),p=this.transformInv_(c),m=this.transformInv_(u),_=10+(s?Math.max(0,Math.ceil(Math.log2(Mn(i)/(s*s*256*256)))):0);if(this.addQuad_(l,h,c,u,g,f,p,m,_),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(y,v,w){x=Math.min(x,y.source[0][0],y.source[1][0],y.source[2][0])}),this.triangles_.forEach(y=>{if(Math.max(y.source[0][0],y.source[1][0],y.source[2][0])-x>this.sourceWorldWidth_/2){const v=[[y.source[0][0],y.source[0][1]],[y.source[1][0],y.source[1][1]],[y.source[2][0],y.source[2][1]]];v[0][0]-x>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-x>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-x>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);const w=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-w<this.sourceWorldWidth_/2&&(y.source=v)}})}o={}}addTriangle_(e,t,i,n,r,s){this.triangles_.push({source:[n,r,s],target:[e,t,i]})}addQuad_(e,t,i,n,r,s,o,a,l){const h=Xe([r,s,o,a]),c=this.sourceWorldWidth_?ne(h)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&c>.5&&c<1;let f=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(f=ne(Xe([e,t,i,n]))/this.targetWorldWidth_>.25||f),!g&&this.sourceProj_.isGlobal()&&c&&(f=c>.25||f)),!f&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!Ie(h,this.maxSourceExtent_))return;let p=0;if(!(f||isFinite(r[0])&&isFinite(r[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1]))){if(l>0)f=!0;else if(p=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(s[0])&&isFinite(s[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),p!=1&&p!=2&&p!=4&&p!=8)return}if(l>0){if(!f){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],_=this.transformInv_(m);let x;g?x=(ei(r[0],u)+ei(o[0],u))/2-ei(_[0],u):x=(r[0]+o[0])/2-_[0];const y=(r[1]+o[1])/2-_[1];f=x*x+y*y>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],_=this.transformInv_(m),x=[(n[0]+e[0])/2,(n[1]+e[1])/2],y=this.transformInv_(x);this.addQuad_(e,t,m,x,r,s,_,y,l-1),this.addQuad_(x,m,i,n,y,_,o,a,l-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],_=this.transformInv_(m),x=[(i[0]+n[0])/2,(i[1]+n[1])/2],y=this.transformInv_(x);this.addQuad_(e,m,x,n,r,_,y,a,l-1),this.addQuad_(m,t,i,x,_,s,o,y,l-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}!(11&p)&&this.addTriangle_(e,i,n,r,o,a),!(14&p)&&this.addTriangle_(e,i,t,r,o,s),p&&(!(13&p)&&this.addTriangle_(t,n,e,s,a,r),!(7&p)&&this.addTriangle_(t,n,i,s,a,o))}calculateSourceExtent(){const e=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(t,i,n){const r=t.source;fr(e,r[0]),fr(e,r[1]),fr(e,r[2])}),e}getTriangles(){return this.triangles_}},Nr=class extends cr{constructor(e,t,i,n,r,s,o,a,l,h,c,u){super(r,Be,u),this.renderEdges_=c!==void 0&&c,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=s||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const m=f?We(g,f):g;if(Mn(m)===0)return void(this.state=De);const _=e.getExtent();_&&(p=p?We(p,_):_);const x=n.getResolution(this.wrappedTileCoord_[0]),y=jd(e,i,m,x);if(!isFinite(y)||y<=0)return void(this.state=De);const v=h!==void 0?h:Bd;if(this.triangulation_=new yh(e,i,m,p,y*v,x),this.triangulation_.getTriangles().length===0)return void(this.state=De);this.sourceZ_=t.getZForResolution(y);let w=this.triangulation_.calculateSourceExtent();if(p&&(e.canWrapX()?(w[1]=H(w[1],p[1],p[3]),w[3]=H(w[3],p[1],p[3])):w=We(w,p)),Mn(w)){const S=t.getTileRangeForExtentAndZ(w,this.sourceZ_);for(let C=S.minX;C<=S.maxX;C++)for(let E=S.minY;E<=S.maxY;E++){const R=l(this.sourceZ_,C,E,o);R&&this.sourceTiles_.push(R)}this.sourceTiles_.length===0&&(this.state=De)}else this.state=De}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==we&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=Ne;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],s=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=_h(n,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),s,a,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=we}this.changed()}load(){if(this.state==Be){this.state=Kt,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==Be||i==Kt){e++;const n=W(t,he,function(r){const s=t.getState();s!=we&&s!=Ne&&s!=De||(fe(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==Be&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(fe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(In(this.canvas_.getContext("2d")),ki.push(this.canvas_),this.canvas_=null),super.release()}},m0="tileloadstart",_0="tileloadend",y0="tileloaderror";function x0(e){return e?Array.isArray(e)?function(t){return e}:typeof e=="function"?e:function(t){return[e]}:null}var Ms=class extends zt{constructor(e){super(),this.projection=X(e.projection),this.attributions_=x0(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible===void 0||e.attributionsCollapsible,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0&&e.wrapX,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=x0(e),this.changed()}setState(e){this.state_=e,this.changed()}};const As=[0,0,0];var on=class{constructor(e){let t;if(this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,ie(vp(this.resolutions_,(n,r)=>r-n,!0),"`resolutions` must be sorted in descending order"),!e.origins)for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(t){if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}else t=this.resolutions_[n]/this.resolutions_[n+1];this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,ie(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i===void 0||this.origin_||this.origins_||(this.origin_=Qt(i)),ie(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,ie(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:br,ie(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,r)=>{const s=new dh(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,r);s.minX=Math.max(o.minX,s.minX),s.maxX=Math.min(o.maxX,s.maxX),s.minY=Math.max(o.minY,s.minY),s.maxY=Math.min(o.maxY,s.maxY)}return s}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,s=n.maxX;r<=s;++r)for(let o=n.minY,a=n.maxY;o<=a;++o)i([t,r,o])}forEachTileCoordParentTileRange(e,t,i,n){let r,s,o,a=null,l=e[0]-1;for(this.zoomFactor_===2?(s=e[1],o=e[2]):a=this.getTileCoordExtent(e,n);l>=this.minZoom;){if(s!==void 0&&o!==void 0?(s=Math.floor(s/2),o=Math.floor(o/2),r=Or(s,s,o,o,i)):r=this.getTileRangeForExtentAndZ(a,l,i),t(l,r))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=2*e[1],s=2*e[2];return Or(r,r+1,s,s+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],s=e[2];if(t===n)return Or(r,s,r,s,i);if(this.zoomFactor_){const a=Math.pow(this.zoomFactor_,t-n),l=Math.floor(r*a),h=Math.floor(s*a);return t<n?Or(l,l,h,h,i):Or(l,Math.floor(a*(r+1))-1,h,Math.floor(a*(s+1))-1,i)}const o=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,As);const n=As[1],r=As[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,As),Or(n,As[1],r,As[2],i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=Ge(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=Ge(this.getTileSize(e[0]),this.tmpSize_),s=i[0]+e[1]*r[0]*n,o=i[1]-(e[2]+1)*r[1]*n;return Xt(s,o,s+r[0]*n,o+r[1]*n,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const s=this.getZForResolution(i),o=i/this.getResolution(s),a=this.getOrigin(s),l=Ge(this.getTileSize(s),this.tmpSize_);let h=o*(e-a[0])/i/l[0],c=o*(a[1]-t)/i/l[1];return n?(h=Ji(h,5)-1,c=Ji(c,5)-1):(h=Er(h,5),c=Er(c,5)),Is(s,h,c,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const s=this.getOrigin(i),o=this.getResolution(i),a=Ge(this.getTileSize(i),this.tmpSize_);let l=(e-s[0])/o/a[0],h=(s[1]-t)/o/a[1];return n?(l=Ji(l,5)-1,h=Ji(h,5)-1):(l=Er(l,5),h=Er(h,5)),Is(i,l,h,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){return H(go(this.resolutions_,e,t||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Lu(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}};class v0 extends on{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}var Pw=v0;function w0(e,t,i){const n=[],r=[],s=[],o=[],a=[];i=i!==void 0?i:[];const l="TileMatrix",h="Identifier",c="ScaleDenominator",u="TopLeftCorner",g=X(e.SupportedCRS),f=g.getMetersPerUnit(),p=g.getAxisOrientation().substr(0,2)=="ne";return e[l].sort(function(m,_){return _[c]-m[c]}),e[l].forEach(function(m){let _;if(_=!(i.length>0)||i.find(function(x){return m[h]==x[l]||!m[h].includes(":")&&e[h]+":"+m[h]===x[l]}),_){r.push(m[h]);const x=28e-5*m[c]/f,y=m.TileWidth,v=m.TileHeight;p?s.push([m[u][1],m[u][0]]):s.push(m[u]),n.push(x),o.push(y==v?y:[y,v]),a.push([m.MatrixWidth,m.MatrixHeight])}}),new v0({extent:t,origins:s,resolutions:n,matrixIds:r,tileSizes:o,sizes:a})}function xh(e){let t=e.getDefaultTileGrid();return t||(t=C0(e),e.setDefaultTileGrid(t)),t}function S0(e,t,i){const n=t[0],r=e.getTileCoordCenter(t),s=an(i);if(!Jt(s,r)){const o=ne(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,e.getTileCoordForCoordAndZ(r,n)}return t}function E0(e,t,i,n){n=n!==void 0?n:"top-left";const r=T0(e,t,i);return new on({extent:e,origin:Zp(e,n),resolutions:r,tileSize:i})}function Dr(e){const t=e||{},i=t.extent||X("EPSG:3857").getExtent(),n={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:T0(i,t.maxZoom,t.tileSize,t.maxResolution)};return new on(n)}function T0(e,t,i,n){t=t!==void 0?t:rd,i=Ge(i!==void 0?i:br);const r=Le(e),s=ne(e);n=n>0?n:Math.max(s/i[0],r/i[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function C0(e,t,i,n){return E0(an(e),t,i,n)}function an(e){let t=(e=X(e)).getExtent();if(!t){const i=180*yr.degrees/e.getMetersPerUnit();t=Xt(-i,-i,i,i)}return t}class Ud extends He{constructor(t,i){super(t),this.tile=i}}var Ho=class extends Ms{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0&&e.opaque,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Ge(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Yo(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const r=this.getTileCacheForProjection(e);if(!r)return!1;let s,o,a,l=!0;for(let h=i.minX;h<=i.maxX;++h)for(let c=i.minY;c<=i.maxY;++c)o=Ei(t,h,c),a=!1,r.containsKey(o)&&(s=r.get(o),a=s.getState()===we,a&&(a=n(s)!==!1)),a||(l=!1);return l}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r){return q()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:xh(e)}getTileCacheForProjection(e){const t=this.getProjection();return ie(t===null||ct(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),s=Ge(n.getTileSize(e),this.tmpSize);return r==1?s:bd(s,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=S0(i,e,t)),t0(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}};function b0(e,t){const i=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return e.replace(i,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function vh(e,t){const i=e.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=b0(e[r],t);return Os(n)}function Os(e){return e.length===1?e[0]:function(t,i,n){if(!t)return;const r=ei(uh(t),e.length);return e[r](t,i,n)}}function R0(e,t,i){}function wh(e){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(e);if(i){const n=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let s;for(s=n;s<=r;++s)t.push(e.replace(i[0],String.fromCharCode(s)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(e),i){const n=parseInt(i[2],10);for(let r=parseInt(i[1],10);r<=n;r++)t.push(e.replace(i[0],r.toString()));return t}return t.push(e),t}class zd extends Ho{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===zd.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const i=t.target,n=k(i),r=i.getState();let s;r==Kt?(this.tileLoadingKeys_[n]=!0,s=m0):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==Ne?y0:r==we?_0:void 0),s!=null&&this.dispatchEvent(new Ud(s,i))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,i){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),i!==void 0?this.setKey(i):this.changed()}setUrl(t){const i=wh(t);this.urls=i,this.setUrls(i)}setUrls(t){this.urls=t;const i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(vh(t,this.tileGrid),i):this.setKey(i)}tileUrlFunction(t,i,n){}useTile(t,i,n){const r=Ei(t,i,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}var Xd=zd;function Fw(e,t){e.getImage().src=t}var Gi=class extends Xd{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Fw,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate===void 0||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Ss,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const r=this.tileCacheForProjection[n];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ct(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return!(this.getProjection()&&e&&!ct(this.getProjection(),e))&&super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ct(t,e)))return this.tileGrid;const i=k(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=xh(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ct(t,e))return this.tileCache;const i=k(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Yo(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,r,s){const o=[e,t,i],a=this.getTileCoordForTileUrlFunction(o,r),l=a?this.tileUrlFunction(a,n,r):void 0,h=new this.tileClass(o,l!==void 0?Be:De,l!==void 0?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=s,h.addEventListener(he,this.handleTileChange.bind(this)),h}getTile(e,t,i,n,r){const s=this.getProjection();if(!s||!r||ct(s,r))return this.getTileInternal(e,t,i,n,s||r);const o=this.getTileCacheForProjection(r),a=[e,t,i];let l;const h=sn(a);o.containsKey(h)&&(l=o.get(h));const c=this.getKey();if(l&&l.key==c)return l;const u=this.getTileGridForProjection(s),g=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(a,r),p=new Nr(s,u,r,g,a,f,this.getTilePixelRatio(n),this.getGutter(),(m,_,x,y)=>this.getTileInternal(m,_,x,y,s),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return p.key=c,l?(p.interimTile=l,p.refreshInterimChain(),o.replace(h,p)):o.set(h,p),p}getTileInternal(e,t,i,n,r){let s=null;const o=Ei(e,t,i),a=this.getKey();if(this.tileCache.containsKey(o)){if(s=this.tileCache.get(o),s.key!=a){const l=s;s=this.createTile_(e,t,i,n,r,a),l.getState()==Be?s.interimTile=l.interimTile:s.interimTile=l,s.refreshInterimChain(),this.tileCache.replace(o,s)}}else s=this.createTile_(e,t,i,n,r,a),this.tileCache.set(o,s);return s}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=X(e);if(i){const n=k(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}};function P0(e){const t=e[0],i=new Array(t);let n,r,s=1<<t-1;for(n=0;n<t;++n)r=48,e[1]&s&&(r+=1),e[2]&s&&(r+=2),i[n]=String.fromCharCode(r),s>>=1;return i.join("")}var Iw=class extends Gi{constructor(e){const t=e.hidpi!==void 0&&e.hidpi;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:X("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then(n=>n.json()).then(n=>this.handleImageryMetadataResponse(n))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1)return void this.setState("error");const t=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,n=an(this.getProjection()),r=this.hidpi_?2:1,s=t.imageWidth==t.imageHeight?t.imageWidth/r:[t.imageWidth/r,t.imageHeight/r],o=Dr({extent:n,minZoom:t.zoomMin,maxZoom:i,tileSize:s});this.tileGrid=o;const a=this.culture_,l=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=Os(t.imageUrlSubdomains.map(function(c){const u=[0,0,0],g=t.imageUrl.replace("{subdomain}",c).replace("{culture}",a);return function(f,p,m){if(!f)return;Is(f[0],f[1],f[2],u);const _=new URL(g.replace("{quadkey}",P0(u))),x=_.searchParams;return l&&(x.set("dpi","d1"),x.set("device","mobile")),h===!0?x.delete("n"):h===!1&&x.set("n","z"),_.toString()}})),t.imageryProviders){const c=Mt(X("EPSG:4326"),this.getProjection());this.setAttributions(u=>{const g=[],f=u.viewState,p=this.getTileGrid(),m=p.getZForResolution(f.resolution,this.zDirection),_=p.getTileCoordForCoordAndZ(f.center,m)[0];return t.imageryProviders.map(function(x){let y=!1;const v=x.coverageAreas;for(let w=0,S=v.length;w<S;++w){const C=v[w];if(_>=C.zoomMin&&_<=C.zoomMax){const E=C.bbox;if(Ie(_r([E[1],E[0],E[3],E[2]],c),u.extent)){y=!0;break}}}y&&g.push(x.attribution)}),g.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>'),g})}this.setState("ready")}},Jo=class extends Gi{constructor(e){const t=(e=e||{}).projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:Dr({extent:an(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}},Lw=class extends Jo{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e])return void this.applyTemplate_(this.templateCache_[e]);let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,e)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",t),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const i=t.target;if(!i.status||i.status>=200&&i.status<300){let n;try{n=JSON.parse(i.responseText)}catch{return void this.setState("error")}this.applyTemplate_(n),this.templateCache_[e]=n,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}};function Mw(e,t,i,n,r){F0(e,t,i||0,n||e.length-1,r||Aw)}function F0(e,t,i,n,r){for(;n>i;){if(n-i>600){var s=n-i+1,o=t-i+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);F0(e,t,Math.max(i,Math.floor(t-o*l/s+h)),Math.min(n,Math.floor(t+(s-o)*l/s+h)),r)}var c=e[t],u=i,g=n;for(Qo(e,i,t),r(e[n],c)>0&&Qo(e,i,n);u<g;){for(Qo(e,u,g),u++,g--;r(e[u],c)<0;)u++;for(;r(e[g],c)>0;)g--}r(e[i],c)===0?Qo(e,i,g):Qo(e,++g,n),g<=t&&(i=g+1),t<=g&&(n=g-1)}}function Qo(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function Aw(e,t){return e<t?-1:e>t?1:0}let Vd=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Eh(e,t))return i;const n=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],a=t.leaf?n(o):o;Eh(e,a)&&(t.leaf?i.push(o):Zd(e,a)?this._all(o,i):r.push(o))}t=r.pop()}return i}collides(e){let t=this.data;if(!Eh(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],s=t.leaf?this.toBBox(r):r;if(Eh(e,s)){if(t.leaf||Zd(e,s))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Ds([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],s=[];let o,a,l;for(;i||r.length;){if(i||(i=r.pop(),a=r[r.length-1],o=s.pop(),l=!0),i.leaf){const h=Ow(e,i.children,t);if(h!==-1)return i.children.splice(h,1),r.push(i),this._condense(r),this}l||i.leaf||!Zd(i,n)?a?(o++,i=a.children[o],l=!1):i=null:(r.push(i),s.push(o),o=0,a=i,i=i.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const r=i-t+1;let s,o=this._maxEntries;if(r<=o)return s=Ds(e.slice(t,i+1)),Ns(s,this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),s=Ds([]),s.leaf=!1,s.height=n;const a=Math.ceil(r/o),l=a*Math.ceil(Math.sqrt(o));I0(e,t,i,l,this.compareMinX);for(let h=t;h<=i;h+=l){const c=Math.min(h+l-1,i);I0(e,h,c,a,this.compareMinY);for(let u=h;u<=c;u+=a){const g=Math.min(u+a-1,c);s.children.push(this._build(e,u,g,n-1))}}return Ns(s,this.toBBox),s}_chooseSubtree(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){let o,a=1/0,l=1/0;for(let h=0;h<t.children.length;h++){const c=t.children[h],u=Wd(c),g=(r=e,s=c,(Math.max(s.maxX,r.maxX)-Math.min(s.minX,r.minX))*(Math.max(s.maxY,r.maxY)-Math.min(s.minY,r.minY))-u);g<l?(l=g,a=u<a?u:a,o=c):g===l&&u<a&&(a=u,o=c)}t=o||t.children[0]}var r,s;return t}_insert(e,t,i){const n=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),ta(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const s=this._chooseSplitIndex(i,r,n),o=Ds(i.children.splice(s,i.children.length-s));o.height=i.height,o.leaf=i.leaf,Ns(i,this.toBBox),Ns(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=Ds([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ns(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,r=1/0,s=1/0;for(let o=t;o<=i-t;o++){const a=ea(e,0,o,this.toBBox),l=ea(e,o,i,this.toBBox),h=kw(a,l),c=Wd(a)+Wd(l);h<r?(r=h,n=o,s=c<s?c:s):h===r&&c<s&&(s=c,n=o)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Nw,r=e.leaf?this.compareMinY:Dw;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this.toBBox,s=ea(e,0,t,r),o=ea(e,i-t,i,r);let a=Sh(s)+Sh(o);for(let l=t;l<i-t;l++){const h=e.children[l];ta(s,e.leaf?r(h):h),a+=Sh(s)}for(let l=i-t-1;l>=t;l--){const h=e.children[l];ta(o,e.leaf?r(h):h),a+=Sh(o)}return a}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)ta(t[n],e)}_condense(e){for(let t,i=e.length-1;i>=0;i--)e[i].children.length===0?i>0?(t=e[i-1].children,t.splice(t.indexOf(e[i]),1)):this.clear():Ns(e[i],this.toBBox)}};function Ow(e,t,i){if(!i)return t.indexOf(e);for(let n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function Ns(e,t){ea(e,0,e.children.length,t,e)}function ea(e,t,i,n,r){r||(r=Ds(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<i;s++){const o=e.children[s];ta(r,e.leaf?n(o):o)}return r}function ta(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Nw(e,t){return e.minX-t.minX}function Dw(e,t){return e.minY-t.minY}function Wd(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Sh(e){return e.maxX-e.minX+(e.maxY-e.minY)}function kw(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,s-n)}function Zd(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Eh(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ds(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function I0(e,t,i,n,r){const s=[t,i];for(;s.length;){if((i=s.pop())-(t=s.pop())<=n)continue;const o=t+Math.ceil((i-t)/n/2)*n;Mw(e,o,t,i,r),s.push(t,o,o,i)}}var ia=class{constructor(e){this.rbush_=new Vd(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[k(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,r=t.length;n<r;n++){const s=e[n],o=t[n],a={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:o};i[n]=a,this.items_[k(o)]=a}this.rbush_.load(i)}remove(e){const t=k(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[k(t)];It([i.minX,i.minY,i.maxX,i.maxY],e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,r=e.length;n<r;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return qt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Xt(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}};class Th extends yi{constructor(t,i,n){super(),n!==void 0&&i===void 0?this.setFlatCoordinates(n,t):(i=i||0,this.setCenterAndRadius(t,i,n))}clone(){const t=new Th(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,r){const s=this.flatCoordinates,o=t-s[0],a=i-s[1],l=o*o+a*a;if(l<r){if(l===0)for(let h=0;h<this.stride;++h)n[h]=s[h];else{const h=this.getRadius()/Math.sqrt(l);n[0]=s[0]+h*o,n[1]=s[1]+h*a;for(let c=2;c<this.stride;++c)n[c]=s[c]}return n.length=this.stride,l}return r}containsXY(t,i){const n=this.flatCoordinates,r=t-n[0],s=i-n[1];return r*r+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const i=this.flatCoordinates,n=i[this.stride]-i[0];return Xt(i[0]-n,i[1]-n,i[0]+n,i[1]+n,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],i=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+i*i}getType(){return"Circle"}intersectsExtent(t){if(Ie(t,this.getExtent())){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]||gl(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const i=this.stride,n=this.flatCoordinates[i]-this.flatCoordinates[0],r=t.slice();r[i]=r[0]+n;for(let s=1;s<i;++s)r[i+s]=t[s];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(t,i,n){this.setLayout(n,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let s=Cu(r,0,t,this.stride);r[s++]=r[0]+i;for(let o=1,a=this.stride;o<a;++o)r[s++]=r[o];r.length=s,this.changed()}getCoordinates(){return null}setCoordinates(t,i){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,i){const n=this.getCenter(),r=this.getStride();this.setCenter(Rl(n,0,n.length,r,t,i,n)),this.changed()}}Th.prototype.transform;var $d=Th;class Ch extends Pl{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(fe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,i=this.geometries_.length;t<i;++t)this.changeEventsKeys_.push(W(this.geometries_[t],he,this.changed,this))}clone(){const t=new Ch(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,i,n,r){if(r<Ln(this.getExtent(),t,i))return r;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)r=s[o].closestPointXY(t,i,n,r);return r}containsXY(t,i){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)if(n[r].containsXY(t,i))return!0;return!1}computeExtent(t){Hi(t);const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)su(t,i[n].getExtent());return t}getGeometries(){return L0(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].getType()===this.getType()?t=t.concat(i[n].getGeometriesArrayRecursive()):t.push(i[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=[],n=this.geometries_;let r=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);i.push(l),l!==a&&(r=!0)}if(r){const s=new Ch(null);return s.setGeometriesArray(i),s}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,i){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].rotate(t,i);this.changed()}scale(t,i,n){n||(n=rt(this.getExtent()));const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)r[s].scale(t,i,n);this.changed()}setGeometries(t){this.setGeometriesArray(L0(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].applyTransform(t);this.changed()}translate(t,i){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].translate(t,i);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function L0(e){const t=[];for(let i=0,n=e.length;i<n;++i)t.push(e[i].clone());return t}var ut=Ch;function na(e,t,i,n,r,s,o){let a,l;const h=(i-t)/n;if(h===1)a=t;else if(h===2)a=t,l=r;else if(h!==0){let c=e[t],u=e[t+1],g=0;const f=[0];for(let _=t+n;_<i;_+=n){const x=e[_],y=e[_+1];g+=Math.sqrt((x-c)*(x-c)+(y-u)*(y-u)),f.push(g),c=x,u=y}const p=r*g,m=_p(f,p);m<0?(l=(p-f[-m-2])/(f[-m-1]-f[-m-2]),a=t+(-m-2)*n):a=t+m*n}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?e[a+c]:Lt(e[a+c],e[a+n+c],l);return s}function bh(e,t,i,n,r,s){if(i==t)return null;let o;if(r<e[t+n-1])return s?(o=e.slice(t,t+n),o[n-1]=r,o):null;if(e[i-1]<r)return s?(o=e.slice(i-n,i),o[n-1]=r,o):null;if(r==e[t+n-1])return e.slice(t,t+n);let a=t/n,l=i/n;for(;a<l;){const u=a+l>>1;r<e[(u+1)*n-1]?l=u:a=u+1}const h=e[a*n-1];if(r==h)return e.slice((a-1)*n,(a-1)*n+n);const c=(r-h)/(e[(a+1)*n-1]-h);o=[];for(let u=0;u<n-1;++u)o.push(Lt(e[(a-1)*n+u],e[a*n+u],c));return o.push(r),o}function M0(e,t,i,n,r,s,o){if(o)return bh(e,t,i[i.length-1],n,r,s);let a;if(r<e[n-1])return s?(a=e.slice(0,n),a[n-1]=r,a):null;if(e[e.length-1]<r)return s?(a=e.slice(e.length-n),a[n-1]=r,a):null;for(let l=0,h=i.length;l<h;++l){const c=i[l];if(t!=c){if(r<e[t+n-1])return null;if(r<=e[c-1])return bh(e,t,c,n,r,!1);t=c}}return null}function Rh(e,t,i,n){let r=e[t],s=e[t+1],o=0;for(let a=t+n;a<i;a+=n){const l=e[a],h=e[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return o}class Ph extends yi{constructor(t,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i===void 0||Array.isArray(t[0])?this.setCoordinates(t,i):this.setFlatCoordinates(i,t)}appendCoordinate(t){ge(this.flatCoordinates,t),this.changed()}clone(){const t=new Ph(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,r){return r<Ln(this.getExtent(),t,i)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ll(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,i,n,r))}forEachSegment(t){return Iu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0&&i,bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i))}getCoordinates(){return Li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,i){return na(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,this.stride)}getLength(){return Rh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const i=[];return i.length=xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new Ph(i,"XY")}getType(){return"LineString"}intersectsExtent(t){return Mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_s(this.flatCoordinates,0,t,this.stride),this.changed()}}var Ue=Ph;class Fh extends yi{constructor(t,i,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,i);else if(i!==void 0&&n)this.setFlatCoordinates(i,t),this.ends_=n;else{const r=t,s=[],o=[];for(let l=0,h=r.length;l<h;++l)ge(s,r[l].getFlatCoordinates()),o.push(s.length);const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){ge(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Fh(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,n,r){return r<Ln(this.getExtent(),t,i)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Il(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,i,n,r))}getCoordinateAtM(t,i,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(i=i!==void 0&&i,n=n!==void 0&&n,M0(this.flatCoordinates,0,this.ends_,this.stride,t,i,n))}getCoordinates(){return vs(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Ue(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,i=this.ends_,n=this.layout,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Ue(t.slice(s,l),n);r.push(h),s=l}return r}getFlatMidpoints(){const t=[],i=this.flatCoordinates;let n=0;const r=this.ends_,s=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o];ge(t,na(i,n,l,s,.5)),n=l}return t}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=Al(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,n),new Fh(i,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Im(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ys(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}var Et=Fh;class Yd extends yi{constructor(t,i){super(),i&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendPoint(t){ge(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Yd(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,r){if(r<Ln(this.getExtent(),t,i))return r;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=mi(t,i,s[a],s[a+1]);if(h<r){r=h;for(let c=0;c<o;++c)n[c]=s[a+c];n.length=o}}return r}getCoordinates(){return Li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const i=this.flatCoordinates.length/this.stride;return t<0||i<=t?null:new Ae(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,i=this.layout,n=this.stride,r=[];for(let s=0,o=t.length;s<o;s+=n){const a=new Ae(t.slice(s,s+n),i);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const i=this.flatCoordinates,n=this.stride;for(let r=0,s=i.length;r<s;r+=n)if(cl(t,i[r],i[r+1]))return!0;return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_s(this.flatCoordinates,0,t,this.stride),this.changed()}}var ri=Yd;function qd(e,t,i,n){const r=[];let s=[1/0,1/0,-1/0,-1/0];for(let o=0,a=i.length;o<a;++o){const l=i[o];s=dl(e,t,l[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return r}class Ih extends yi{constructor(t,i,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const r=t,s=[],o=[];for(let a=0,l=r.length;a<l;++a){const h=r[a],c=s.length,u=h.getEnds();for(let g=0,f=u.length;g<f;++g)u[g]+=c;ge(s,h.getFlatCoordinates()),o.push(u)}i=r.length===0?this.getLayout():r[0].getLayout(),t=s,n=o}i!==void 0&&n?(this.setFlatCoordinates(i,t),this.endss_=n):this.setCoordinates(t,i)}appendPolygon(t){let i;if(this.flatCoordinates){const n=this.flatCoordinates.length;ge(this.flatCoordinates,t.getFlatCoordinates()),i=t.getEnds().slice();for(let r=0,s=i.length;r<s;++r)i[r]+=n}else this.flatCoordinates=t.getFlatCoordinates().slice(),i=t.getEnds().slice(),this.endss_.push();this.endss_.push(i),this.changed()}clone(){const t=this.endss_.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=this.endss_[r].slice();const n=new Ih(this.flatCoordinates.slice(),this.layout,i);return n.applyProperties(this),n}closestPointXY(t,i,n,r){return r<Ln(this.getExtent(),t,i)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sm(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Em(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,i,n,r))}containsXY(t,i){return Fm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,i)}getArea(){return Rm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),Ul(i,0,this.endss_,this.stride,t)):i=this.flatCoordinates,Nl(i,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=qd(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Fu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ri(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Au(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ul(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=bm(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new Ih(i,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let i;if(t===0)i=0;else{const s=this.endss_[t-1];i=s[s.length-1]}const n=this.endss_[t].slice(),r=n[n.length-1];if(i!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=i;return new ot(this.flatCoordinates.slice(i,r),this.layout,n)}getPolygons(){const t=this.layout,i=this.flatCoordinates,n=this.endss_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(s!==0)for(let u=0,g=l.length;u<g;++u)l[u]-=s;const c=new ot(i.slice(s,h),t,l);r.push(c),s=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return Lm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=bu(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const r=n[n.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}var Zt=Ih;const A0=[1,0,0,1,0,0];class ks{constructor(t,i,n,r,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?gr(this.flatCoordinates_):dl(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=rt(this.getExtent());this.flatInteriorPoints_=jl(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=No(this.flatCoordinates_,this.ends_),i=qd(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Fu(this.flatCoordinates_,0,t,2,i)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=na(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let i=0;const n=this.ends_;for(let r=0,s=n.length;r<s;++r){const o=n[r],a=na(t,i,o,2,.5);ge(this.flatMidpoints_,a),i=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,i){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){const i=(t=X(t)).getExtent(),n=t.getWorldExtent();if(i&&n){const r=Le(n)/Le(i);pt(A0,n[0],n[3],r,-r,0,0,0),_i(this.flatCoordinates_,0,this.flatCoordinates_.length,2,A0,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new ks(this.type_,this.flatCoordinates_.slice(),this.ends_.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Yc((t,i)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),i&&this.simplifiedGeometry_.applyTransform(i);const n=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":n.length=xs(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),r=[n.length];break;case"MultiLineString":r=[],n.length=Al(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,r);break;case"Polygon":r=[],n.length=Ol(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,r)}return r&&(this.simplifiedGeometry_=new ks(this.type_,n,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}function O0(e){const t=e.getType();switch(t){case"Point":return new Ae(e.getFlatCoordinates());case"MultiPoint":return new ri(e.getFlatCoordinates(),"XY");case"LineString":return new Ue(e.getFlatCoordinates(),"XY");case"MultiLineString":return new Et(e.getFlatCoordinates(),"XY",e.getEnds());case"Polygon":const i=e.getFlatCoordinates(),n=e.getEnds(),r=No(i,n);return r.length>1?new Zt(i,"XY",r):new ot(i,"XY",n);default:throw new Error("Invalid geometry type:"+t)}}ks.prototype.getFlatCoordinates=ks.prototype.getOrientedFlatCoordinates;var $t=ks,Un="addfeature",Kd="changefeature",Hd="clear",Gs="removefeature",Gw="featuresloadstart",jw="featuresloadend",Bw="featuresloaderror";class ln extends He{constructor(t,i,n){super(t),this.feature=i,this.features=n}}var kr=class extends Ms{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX===void 0||e.wrapX}),this.on,this.once,this.un,this.loader_=ar,this.format_=e.format,this.overlaps_=e.overlaps===void 0||e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(ie(this.format_,"`format` must be set when `url` is set"),this.loader_=Ad(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:l0;const t=e.useSpatialIndex===void 0||e.useSpatialIndex;let i,n;this.featuresRtree_=t?new ia:null,this.loadedExtentsRtree_=new ia,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),t||i!==void 0||(i=new Je(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=k(e);if(!this.addToIndex_(t,e))return void(this.featuresCollection_&&this.featuresCollection_.remove(e));this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ln(Un,e))}setupChangeEvents_(e,t){t instanceof $t||(this.featureChangeKeys_[e]=[W(t,he,this.handleFeatureChange_,this),W(t,or,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const n=String(t.getId());if(n in this.idIndex_)if(t instanceof $t){const r=this.idIndex_[n];r instanceof $t?Array.isArray(r)?r.push(t):this.idIndex_[n]=[r,t]:i=!1}else i=!1;else this.idIndex_[n]=t}return i&&(ie(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r],a=k(o);this.addToIndex_(a,o)&&i.push(o)}for(let r=0,s=i.length;r<s;r++){const o=i[r],a=k(o);this.setupChangeEvents_(a,o);const l=o.getGeometry();if(l){const h=l.getExtent();t.push(h),n.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(Un))for(let r=0,s=i.length;r<s;r++)this.dispatchEvent(new ln(Un,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Un,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Gs,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(di,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(gi,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(fe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=n=>{this.removeFeatureInternal(n)};this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new ln(Hd);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){const r=n.getGeometry();if(r instanceof $t||r.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const n=i.getGeometry();if(n instanceof $t||n.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),qt(this.nullGeometryFeatures_)||ge(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=qp(e,t);return[].concat(...i.map(n=>this.featuresRtree_.getInExtent(n)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let r=null;const s=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return t=t||Ut,this.featuresRtree_.forEachInExtent(a,function(l){if(t(l)){const h=l.getGeometry(),c=o;if(o=h instanceof $t?0:h.closestPointXY(i,n,s,o),o<c){r=l;const u=Math.sqrt(o);a[0]=i-u,a[1]=n-u,a[2]=i+u,a[3]=n+u}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=k(t),n=t.getGeometry();if(n){const s=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(s,t)):this.featuresRtree_&&this.featuresRtree_.update(s,t)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);const r=t.getId();if(r!==void 0){const s=r.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new ln(Kd,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:k(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&qt(this.nullGeometryFeatures_):!this.featuresCollection_||this.featuresCollection_.getLength()===0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let s=0,o=r.length;s<o;++s){const a=r[s];n.forEachInExtent(a,function(l){return ht(l.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ln(Gw)),this.loader_.call(this,a,t,i,l=>{--this.loadingExtentsCount_,this.dispatchEvent(new ln(jw,void 0,l))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ln(Bw))}),n.insert(a,{extent:a.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(n){if(It(n.extent,e))return i=n,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=k(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=k(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(fe),delete this.featureChangeKeys_[t];const n=e.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new ln(Gs,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_){const n=this.idIndex_[i];if(e instanceof $t&&Array.isArray(n)&&n.includes(e))n.splice(n.indexOf(e),1);else if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){ie(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(Ad(e,this.format_))}},Uw=class extends kr{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return ie(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(he,this.boundRefresh_),this.source=e,e&&e.addEventListener(he,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=[1/0,1/0,-1/0,-1/0],t=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let r=0,s=i.length;r<s;r++){const o=i[r];if(!(k(o)in n)){const a=this.geometryFunction(o);if(a){gr(a.getCoordinates(),e),mt(e,t,e);const l=this.source.getFeaturesInExtent(e).filter(function(h){const c=k(h);return!(c in n)&&(n[c]=!0,!0)});this.features.push(this.createCluster(l,e))}}}}createCluster(e,t){const i=[0,0];for(let o=e.length-1;o>=0;--o){const a=this.geometryFunction(e[o]);a?fu(i,a.getCoordinates()):e.splice(o,1)}pu(i,1/e.length);const n=rt(t),r=this.interpolationRatio,s=new Ae([i[0]*(1-r)+n[0]*r,i[1]*(1-r)+n[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(s,e):new Se({geometry:s,features:e})}},Lh=class extends ll{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let n=this.sourceTileGrid_.getExtent();const r=i?We(t,i):t;if(Mn(r)===0)return void(this.state=De);const s=e.sourceProj,o=s.getExtent();o&&(n=n?We(n,o):o);const a=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),l=e.targetProj,h=jd(s,l,r,a);if(!isFinite(h)||h<=0)return void(this.state=De);const c=e.errorThreshold!==void 0?e.errorThreshold:Bd;if(this.triangulation_=new yh(s,l,r,n,h*c,a),this.triangulation_.getTriangles().length===0)return void(this.state=De);this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let u=this.triangulation_.calculateSourceExtent();if(n&&(s.canWrapX()?(u[1]=H(u[1],n[1],n[3]),u[3]=H(u[3],n[1],n[3])):u=We(u,n)),Mn(u)){const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(u,this.sourceZ_),f=e.getTileFunction;for(let p=g.minX;p<=g.maxX;p++)for(let m=g.minY;m<=g.maxY;m++){const _=f(this.sourceZ_,p,m,this.pixelRatio_);_&&this.sourceTiles_.push(_)}this.sourceTiles_.length===0&&(this.state=De)}else this.state=De}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==we)return;const i=t.getSize(),n=this.gutter_;let r;r=al(t.getData())||Dp(_o(t.getData()));const o=[i[0]+2*n,i[1]+2*n],a=r instanceof Float32Array,l=o[0]*o[1],h=a?Float32Array:Uint8Array,c=new h(r.buffer),u=h.BYTES_PER_ELEMENT,g=u*c.length/l,f=c.byteLength/o[1],p=Math.floor(f/u/o[0]),m=l*p;let _=c;if(c.length!==m){_=new h(m);let x=0,y=0;const v=o[0]*p;for(let w=0;w<o[1];++w){for(let S=0;S<v;++S)_[x++]=c[y+S];y+=f/u}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(_.buffer),dataType:h,bytesPerPixel:g,pixelSize:o})}),this.sourceTiles_.length=0,e.length===0)this.state=Ne;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],s=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let l,h;const c=e[0].bytesPerPixel;for(let u=Math.ceil(c/3)-1;u>=0;--u){const g=[];for(let y=0,v=e.length;y<v;++y){const w=e[y],S=w.data,C=w.pixelSize,E=C[0],R=C[1],P=ke(E,R,ki),I=P.createImageData(E,R),A=I.data;let G=3*u;for(let B=0,z=A.length;B<z;B+=4)A[B]=S[G],A[B+1]=S[G+1],A[B+2]=S[G+2],A[B+3]=255,G+=c;P.putImageData(I,0,0),g.push({extent:w.extent,image:P.canvas})}const f=_h(n,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),s,a,this.triangulation_,g,this.gutter_,!1,!1);for(let y=0,v=g.length;y<v;++y){const w=g[y].image.getContext("2d");In(w),ki.push(w.canvas)}const p=f.getContext("2d"),m=p.getImageData(0,0,f.width,f.height);In(p),ki.push(f),l||(h=new Uint8Array(c*m.width*m.height),l=new e[0].dataType(h.buffer));const _=m.data;let x=3*u;for(let y=0,v=_.length;y<v;y+=4)_[y+3]===255?(h[x]=_[y],h[x+1]=_[y+1],h[x+2]=_[y+2]):(h[x]=0,h[x+1]=0,h[x+2]=0),x+=c}this.reprojData_=l,this.reprojSize_=[Math.round(n*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=we}this.changed()}load(){if(this.state!==Be&&this.state!==Ne)return;this.state=Kt,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i!==Be&&i!==Kt)return;e++;const n=W(t,he,function(){const r=t.getState();r!=we&&r!=Ne&&r!=De||(fe(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==Be&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(fe),this.sourcesListenerKeys_=null}},N0=class extends Ho{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=Dr({extent:an(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ge(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Ge(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||ct(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,n,r){const s=this.getTileCacheForProjection(n),o=Ei(e,t,i);if(s.containsKey(o)){const m=s.get(o);if(m&&m.key==this.getKey())return m}const a=this.getTileGrid(),l=Math.max.apply(null,a.getResolutions().map((m,_)=>{const x=Ge(a.getTileSize(_)),y=this.getTileSize(_);return Math.max(y[0]/x[0],y[1]/x[1])})),h=this.getTileGridForProjection(r),c=this.getTileGridForProjection(n),u=[e,t,i],g=this.getTileCoordForTileUrlFunction(u,n),f=Object.assign({sourceProj:r,sourceTileGrid:h,targetProj:n,targetTileGrid:c,tileCoord:u,wrappedTileCoord:g,pixelRatio:l,gutter:this.getGutterForProjection(r),getTileFunction:(m,_,x,y)=>this.getTile(m,_,x,y,r)},this.tileOptions),p=new Lh(f);return p.key=this.getKey(),p}getTile(e,t,i,n,r){const s=this.getProjection();if(s&&r&&!ct(s,r))return this.getReprojTile_(e,t,i,r,s);const o=this.getTileSize(e),a=Ei(e,t,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const l=this.loader_,h=Object.assign({tileCoord:[e,t,i],loader:function(){return qc(function(){return l(e,t,i)})},size:o},this.tileOptions),c=new ll(h);return c.key=this.getKey(),c.addEventListener(he,this.handleTileChange_),this.tileCache.set(a,c),c}handleTileChange_(e){const t=e.target,i=k(t),n=t.getState();let r;n==Kt?(this.tileLoadingKeys_[i]=!0,r=m0):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==Ne?y0:n==we?_0:void 0),r&&this.dispatchEvent(new Ud(r,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ct(t,e)))return this.tileGrid;const i=k(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=xh(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=X(e);if(i){const n=k(i);n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ct(t,e))return this.tileCache;const i=k(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new Yo(.1)),this.tileCacheForProjection_[i]}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection_){const r=this.tileCacheForProjection_[n];r.expireCache(r==i?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}};function zw(e,t){if(!e)return!1;if(e===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const i=t.fileDirectory.PhotometricInterpretation,n=GeoTIFF.globals.photometricInterpretations;return i===n.CMYK||i===n.YCbCr||i===n.CIELab||i===n.ICCLab}const D0="STATISTICS_MAXIMUM",k0="STATISTICS_MINIMUM";let Jd;function Xw(e){try{return e.getBoundingBox()}catch{return[0,0,e.getWidth(),e.getHeight()]}}function Vw(e){try{return e.getOrigin().slice(0,2)}catch{return[0,e.getHeight()]}}function Ww(e,t){try{return e.getResolution(t)}catch{return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}function Zw(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const i="EPSG:"+t.ProjectedCSTypeGeoKey;let n=X(i);if(!n){const r=lu(t.ProjLinearUnitsGeoKey);r&&(n=new xr({code:i,units:r}))}return n}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const i="EPSG:"+t.GeographicTypeGeoKey;let n=X(i);if(!n){const r=lu(t.GeogAngularUnitsGeoKey);r&&(n=new xr({code:i,units:r}))}return n}return null}function $w(e){return e.getImageCount().then(function(t){const i=new Array(t);for(let n=0;n<t;++n)i[n]=e.getImage(n);return Promise.all(i)})}function Yw(e,t){let i;return i=e.blob?GeoTIFF.fromBlob(e.blob):e.overviews?GeoTIFF.fromUrls(e.url,e.overviews,t):GeoTIFF.fromUrl(e.url,t),i.then($w)}function ra(e,t,i,n,r){if(Array.isArray(e)){const s=e.length;if(!Array.isArray(t)||s!=t.length){const o=new Error(n);throw r(o),o}for(let o=0;o<s;++o)ra(e[o],t[o],i,n,r)}else if(Math.abs(e-t)>i*e)throw new Error(n)}function qw(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class G0 extends N0{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const i=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(i),this.sourceMasks_=new Array(i),this.resolutionFactors_=new Array(i),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,r=new Array(i);for(let s=0;s<i;++s)r[s]=Yw(this.sourceInfo_[s],this.sourceOptions_);Promise.all(r).then(function(s){n.configure_(s)}).catch(function(s){Po(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(t){const i=t[0];for(let n=i.length-1;n>=0;--n){const r=Zw(i[n]);if(r){this.projection=r;break}}}configure_(t){let i,n,r,s,o;const a=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let c=0;const u=t.length;for(let p=0;p<u;++p){const m=[],_=[];t[p].forEach(E=>{(4&(E.fileDirectory.NewSubfileType||0))==4?_.push(E):m.push(E)});const x=m.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let y,v;const w=new Array(x),S=new Array(x),C=new Array(x);l[p]=new Array(x),h[p]=new Array(x);for(let E=0;E<x;++E){const R=m[E],P=R.getGDALNoData();h[p][E]=R.getGDALMetadata(0),l[p][E]=P;const I=this.sourceInfo_[p].bands;a[p]=I?I.length:R.getSamplesPerPixel();const A=x-(E+1);y||(y=Xw(R)),v||(v=Vw(R));const G=Ww(R,m[0]);C[A]=G[0];const B=[R.getTileWidth(),R.getTileHeight()];B[0]!==B[1]&&B[1]<256&&(B[0]=256,B[1]=256),w[A]=B;const z=G[0]/Math.abs(G[1]);S[A]=[B[0],B[1]/z]}if(i?We(i,y,i):i=y,n?ra(n,v,0,`Origin mismatch for source ${p}, got [${v}] but expected [${n}]`,this.viewRejector):n=v,o){o.length-c>C.length&&(c=o.length-C.length);const E=o[o.length-1]/C[C.length-1];this.resolutionFactors_[p]=E;const R=C.map(I=>I*E),P=`Resolution mismatch for source ${p}, got [${R}] but expected [${o}]`;ra(o.slice(c,o.length),R,.02,P,this.viewRejector)}else o=C,this.resolutionFactors_[p]=1;r?ra(r.slice(c,r.length),S,.01,`Tile size mismatch for source ${p}`,this.viewRejector):r=S,s?ra(s.slice(c,s.length),w,0,`Tile size mismatch for source ${p}`,this.viewRejector):s=w,this.sourceImagery_[p]=m.reverse(),this.sourceMasks_[p]=_.reverse()}for(let p=0,m=this.sourceImagery_.length;p<m;++p){const _=this.sourceImagery_[p];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;e:for(let p=0;p<u;++p){if(this.sourceInfo_[p].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[p].length){this.addAlpha_=!0;break}const m=l[p],_=this.sourceInfo_[p].bands;if(_){for(let x=0;x<_.length;++x)if(m[_[x]-1]!==null){this.addAlpha_=!0;break e}}else for(let x=0;x<m.length;++x)if(m[x]!==null){this.addAlpha_=!0;break e}}let g=this.addAlpha_?1:0;for(let p=0;p<u;++p)g+=a[p];this.bandCount=g;const f=new on({extent:i,minZoom:c,origin:n,resolutions:o,tileSizes:r});this.tileGrid=f,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[2*o[0],o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:Qi(rt(i),this.projection),extent:Ii(i,this.projection),zoom:1})}loadTile_(t,i,n){const r=this.getTileSize(t),s=this.sourceImagery_.length,o=new Array(2*s),a=this.nodataValues_,l=this.sourceInfo_,h=(Jd||(Jd=new GeoTIFF.Pool),Jd);for(let c=0;c<s;++c){const u=l[c],g=this.resolutionFactors_[c],f=[Math.round(i*(r[0]*g)),Math.round(n*(r[1]*g)),Math.round((i+1)*(r[0]*g)),Math.round((n+1)*(r[1]*g))],p=this.sourceImagery_[c][t];let m,_;u.bands&&(m=u.bands.map(function(w){return w-1})),_="nodata"in u&&u.nodata!==null?u.nodata:m?m.map(function(w){return a[c][w]}):a[c];const x={window:f,width:r[0],height:r[1],samples:m,fillValue:_,pool:h,interleave:!1};zw(this.convertToRGB_,p)?o[c]=p.readRGB(x):o[c]=p.readRasters(x);const y=s+c,v=this.sourceMasks_[c][t];v?o[y]=v.readRasters({window:f,width:r[0],height:r[1],samples:[0],pool:h,interleave:!1}):o[y]=Promise.resolve(null)}return Promise.all(o).then(this.composeTile_.bind(this,r)).catch(function(c){throw Po(c),c})}composeTile_(t,i){const n=this.metadata_,r=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],g=u*o;let f;f=h?new Uint8Array(g):new Float32Array(g);let p=0;for(let _=0;_<u;++_){let x=c;for(let y=0;y<s;++y){const v=r[y];let w,S,C=v.min,E=v.max;if(h){const R=n[y][0];C===void 0&&(C=R&&k0 in R?parseFloat(R[k0]):(m=i[y][0])instanceof Int8Array?-128:m instanceof Int16Array?-32768:m instanceof Int32Array?-2147483648:m instanceof Float32Array?12e-39:0),E===void 0&&(E=R&&D0 in R?parseFloat(R[D0]):qw(i[y][0])),w=255/(E-C),S=-C*w}for(let R=0;R<a[y];++R){const P=i[y][R][_];let I;if(I=h?H(w*P+S,0,255):P,c){let A=v.nodata;if(A===void 0){let B;B=v.bands?v.bands[R]-1:R,A=l[y][B]}const G=isNaN(A);(!G&&P!==A||G&&!isNaN(P))&&(x=!1,f[p]=I)}else f[p]=I;p++}if(!x){const R=i[s+y];R&&!R[0][_]&&(x=!0)}}c&&(x||(f[p]=255),p++)}var m;return f}}G0.prototype.getView;var Kw=G0;let Qd=class extends Ss{constructor(e,t,i,n,r,s,o){super(t,i,n,r,s,o),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==we){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const i=ke(t[0],t[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}};var Hw=class extends Gi{constructor(e){const t=e.size,i=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",n=e.tilePixelRatio||1,r=t[0],s=t[1],o=[],a=e.tileSize||br;let l=a*n;switch(i){case"default":for(;r>l||s>l;)o.push([Math.ceil(r/l),Math.ceil(s/l)]),l+=l;break;case"truncated":let v=r,w=s;for(;v>l||w>l;)o.push([Math.ceil(v/l),Math.ceil(w/l)]),v>>=1,w>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}o.push([1,1]),o.reverse();const h=[n],c=[0];for(let v=1,w=o.length;v<w;v++)h.push(n<<v),c.push(o[v-1][0]*o[v-1][1]+c[v-1]);h.reverse();const u=new on({tileSize:a,extent:e.extent||[0,-s,r,0],resolutions:h});let g=e.url;!g||g.includes("{TileGroup}")||g.includes("{tileIndex}")||(g+="{TileGroup}/{z}-{x}-{y}.jpg");const f=wh(g);let p=a*n;const m=Os(f.map(function(v){return function(w,S,C){if(!w)return;const E=w[0],R=w[1],P=w[2],I=R+P*o[E][0],A={z:E,x:R,y:P,tileIndex:I,TileGroup:"TileGroup"+((I+c[E])/p|0)};return v.replace(/\{(\w+?)\}/g,function(G,B){return A[B]})}})),_=Qd.bind(null,Ge(a*n));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:n,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:u,tileUrlFunction:m,transition:e.transition}),this.zDirection=e.zDirection;const x=m(u.getTileCoordForCoordAndResolution(rt(u.getExtent()),h[h.length-1]),1,null),y=new Image;y.addEventListener("error",()=>{p=a,this.changed()}),y.src=x}};const zn="version1",sa="version2",Gr="version3",jr={};jr[zn]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},jr[sa]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},jr[Gr]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},jr.none={none:{supports:[],formats:[],qualities:[]}};const Jw=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,j0=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Qw=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/,Mh={};Mh[zn]=function(e){let t=e.getComplianceLevelSupportedFeatures();return t===void 0&&(t=jr[zn].level0),{url:e.imageInfo["@id"]===void 0?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,e.imageInfo.formats===void 0?[]:e.imageInfo.formats],qualities:[...t.qualities,e.imageInfo.qualities===void 0?[]:e.imageInfo.qualities],resolutions:e.imageInfo.scale_factors,tileSize:e.imageInfo.tile_width!==void 0?e.imageInfo.tile_height!==void 0?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:e.imageInfo.tile_height!=null?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}},Mh[sa]=function(e){const t=e.getComplianceLevelSupportedFeatures(),i=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,n=i&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],r=i&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],s=i&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:e.imageInfo.sizes===void 0?void 0:e.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:e.imageInfo.tiles===void 0?void 0:[e.imageInfo.tiles.map(function(o){return o.width})[0],e.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:e.imageInfo.tiles===void 0?void 0:e.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...t.supports,...n],formats:[...t.formats,...r],qualities:[...t.qualities,...s]}},Mh[Gr]=function(e){const t=e.getComplianceLevelSupportedFeatures(),i=e.imageInfo.extraFormats===void 0?t.formats:[...t.formats,...e.imageInfo.extraFormats],n=e.imageInfo.preferredFormats!==void 0&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter(function(r){return["jpg","png","gif"].includes(r)}).reduce(function(r,s){return r===void 0&&i.includes(s)?s:r},void 0):void 0;return{url:e.imageInfo.id,sizes:e.imageInfo.sizes===void 0?void 0:e.imageInfo.sizes.map(function(r){return[r.width,r.height]}),tileSize:e.imageInfo.tiles===void 0?void 0:[e.imageInfo.tiles.map(function(r){return r.width})[0],e.imageInfo.tiles.map(function(r){return r.height})[0]],resolutions:e.imageInfo.tiles===void 0?void 0:e.imageInfo.tiles.map(function(r){return r.scaleFactors})[0],supports:e.imageInfo.extraFeatures===void 0?t.supports:[...t.supports,...e.imageInfo.extraFeatures],formats:i,qualities:e.imageInfo.extraQualities===void 0?t.qualities:[...t.qualities,...e.imageInfo.extraQualities],preferredFormat:n}};var eS=class{constructor(e){this.setImageInfo(e)}setImageInfo(e){this.imageInfo=typeof e=="string"?JSON.parse(e):e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return zn;case"http://iiif.io/api/image/2/context.json":return sa;case"http://iiif.io/api/image/3/context.json":return Gr;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(zn)&&this.imageInfo.identifier)return zn}ie(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(this.imageInfo!==void 0&&this.imageInfo.profile!==void 0)switch(e===void 0&&(e=this.getImageApiVersion()),e){case zn:if(Jw.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Gr:if(Qw.test(this.imageInfo.profile))return this.imageInfo.profile;break;case sa:if(typeof this.imageInfo.profile=="string"&&j0.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&j0.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const i=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?jr.none.none:jr[e][t]}getTileSourceOptions(e){const t=e||{},i=this.getImageApiVersion();if(i===void 0)return;const n=i===void 0?void 0:Mh[i](this);return n!==void 0?{url:n.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:n.sizes,format:t.format!==void 0&&n.formats.includes(t.format)?t.format:n.preferredFormat!==void 0?n.preferredFormat:"jpg",supports:n.supports,quality:t.quality&&n.qualities.includes(t.quality)?t.quality:n.qualities.includes("native")?"native":"default",resolutions:Array.isArray(n.resolutions)?n.resolutions.sort(function(r,s){return s-r}):void 0,tileSize:n.tileSize}:void 0}};function oa(e){return e.toLocaleString("en",{maximumFractionDigits:10})}var tS=class extends Gi{constructor(e){const t=e||{};let i=t.url||"";i+=i.lastIndexOf("/")===i.length-1||i===""?"":"/";const n=t.version||sa,r=t.sizes||[],s=t.size;ie(s!=null&&Array.isArray(s)&&s.length==2&&!isNaN(s[0])&&s[0]>0&&!isNaN(s[1])&&s[1]>0,"Missing or invalid `size`");const o=s[0],a=s[1],l=t.tileSize,h=t.tilePixelRatio||1,c=t.format||"jpg",u=t.quality||(t.version==zn?"native":"default");let g=t.resolutions||[];const f=t.supports||[],p=t.extent||[0,-a,o,0],m=r!=null&&Array.isArray(r)&&r.length>0,_=l!==void 0&&(typeof l=="number"&&Number.isInteger(l)&&l>0||Array.isArray(l)&&l.length>0),x=f!=null&&Array.isArray(f)&&(f.includes("regionByPx")||f.includes("regionByPct"))&&(f.includes("sizeByWh")||f.includes("sizeByH")||f.includes("sizeByW")||f.includes("sizeByPct"));let y,v,w;if(g.sort(function(E,R){return R-E}),_||x)if(l!=null&&(typeof l=="number"&&Number.isInteger(l)&&l>0?(y=l,v=l):Array.isArray(l)&&l.length>0&&((l.length==1||l[1]==null&&Number.isInteger(l[0]))&&(y=l[0],v=l[0]),l.length==2&&(Number.isInteger(l[0])&&Number.isInteger(l[1])?(y=l[0],v=l[1]):l[0]==null&&Number.isInteger(l[1])&&(y=l[1],v=l[1])))),y!==void 0&&v!==void 0||(y=br,v=br),g.length==0){w=Math.max(Math.ceil(Math.log(o/y)/Math.LN2),Math.ceil(Math.log(a/v)/Math.LN2));for(let E=w;E>=0;E--)g.push(Math.pow(2,E))}else{const E=Math.max(...g);w=Math.round(Math.log(E)/Math.LN2)}else if(y=o,v=a,g=[],m){r.sort(function(R,P){return R[0]-P[0]}),w=-1;const E=[];for(let R=0;R<r.length;R++){const P=o/r[R][0];g.length>0&&g[g.length-1]==P?E.push(R):(g.push(P),w++)}if(E.length>0)for(let R=0;R<E.length;R++)r.splice(E[R]-R,1)}else g.push(1),r.push([o,a]),w=0;const S=new on({tileSize:[y,v],extent:p,origin:Qt(p),resolutions:g}),C=Qd.bind(null,Ge(l||256).map(function(E){return E*h}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:C,tileGrid:S,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:function(E,R,P){let I,A;const G=E[0];if(G>w)return;const B=E[1],z=E[2],N=g[G];if(!(B===void 0||z===void 0||N===void 0||B<0||Math.ceil(o/N/y)<=B||z<0||Math.ceil(a/N/v)<=z)){if(x||_){const M=B*y*N,V=z*v*N;let se=y*N,oe=v*N,xe=y,U=v;M+se>o&&(se=o-M),V+oe>a&&(oe=a-V),M+y*N>o&&(xe=Math.floor((o-M+N-1)/N)),V+v*N>a&&(U=Math.floor((a-V+N-1)/N)),M==0&&se==o&&V==0&&oe==a?I="full":!x||f.includes("regionByPx")?I=M+","+V+","+se+","+oe:f.includes("regionByPct")&&(I="pct:"+oa(M/o*100)+","+oa(V/a*100)+","+oa(se/o*100)+","+oa(oe/a*100)),n!=Gr||x&&!f.includes("sizeByWh")?!x||f.includes("sizeByW")?A=xe+",":f.includes("sizeByH")?A=","+U:f.includes("sizeByWh")?A=xe+","+U:f.includes("sizeByPct")&&(A="pct:"+oa(100/N)):A=xe+","+U}else if(I="full",m){const M=r[G][0],V=r[G][1];A=n==Gr?M==o&&V==a?"max":M+","+V:M==o?"full":M+","}else A=n==Gr?"max":"full";return i+I+"/"+A+"/0/"+u+"."+c}},transition:t.transition}),this.zDirection=t.zDirection}},B0=class extends ko{constructor(e,t,i,n,r,s,o){let a=e.getExtent();a&&e.canWrapX()&&(a=a.slice(),a[0]=-1/0,a[2]=1/0);let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);const h=l?We(i,l):i,c=Ls(e,t,rt(h),n),u=new yh(e,t,h,a,.5*c,n),g=u.calculateSourceExtent(),f=fi(g)?null:s(g,c,r),p=f?wt:zm,m=f?f.getPixelRatio():1;super(i,n,m,p),this.targetProj_=t,this.maxSourceExtent_=a,this.triangulation_=u,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=f,this.sourcePixelRatio_=m,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==en&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==Ze){const t=ne(this.targetExtent_)/this.targetResolution_,i=Le(this.targetExtent_)/this.targetResolution_;this.canvas_=_h(t,i,this.sourcePixelRatio_,Ko(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==wt){this.state=en,this.changed();const e=this.sourceImage_.getState();e==Ze||e==tn?this.reproject_():(this.sourceListenerKey_=W(this.sourceImage_,he,function(t){const i=this.sourceImage_.getState();i!=Ze&&i!=tn||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){fe(this.sourceListenerKey_),this.sourceListenerKey_=null}};const Ci=4,iS="imageloadstart",nS="imageloadend",rS="imageloaderror";class U0 extends He{constructor(t,i){super(t),this.image=i}}function aa(e,t){e.getImage().src=t}function la(e,t,i,n){const r=t/i,s=rt(e),o=Ji(ne(e)/r,Ci),a=Ji(Le(e)/r,Ci);return us(s,r,0,[o+2*Ji((n-1)*o/2,Ci),a+2*Ji((n-1)*a/2,Ci)])}var Xn=class extends Ms{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate===void 0||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&e.loader.length===0,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();return t&&(e=t[go(t,e,0)]),e}getImage(e,t,i,n){const r=this.getProjection();if(!r||!n||ct(r,n))return r&&(n=r),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ct(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&It(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new B0(r,n,e,t,i,(s,o,a)=>this.getImageInternal(s,o,a,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const r=la(e,t,i,1),s=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&ht(this.wantedExtent_,r)||ht(this.image.getExtent(),r))&&(this.wantedResolution_&&Ko(this.wantedResolution_)===s||Ko(this.image.getResolution())===s)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=s,this.image=new ko(r,s,i,this.loader),this.image.addEventListener(he,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case en:this.loading=!0,i=iS;break;case Ze:this.loading=!1,i=nS;break;case tn:this.loading=!1,i=rS;break;default:return}this.hasListener(i)&&this.dispatchEvent(new U0(i,t))}};function Vn(e,t){const i=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&i.push(r+"="+encodeURIComponent(t[r]))});const n=i.join("&");return e=e.replace(/[?&]$/,""),(e+=e.includes("?")?"&":"?")+n}function eg(e,t,i,n,r,s){const o=r.getCode().split(/:(?=\d+$)/).pop(),a=i/n,l=[So(ne(t)/a,Ci),So(Le(t)/a,Ci)];s.SIZE=l[0]+","+l[1],s.BBOX=t.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const h=e.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");if(h==e)throw new Error("`options.featureTypes` should be an Array");return Vn(h,s)}function z0(e){const t=e.load?e.load:nn,i=X(e.projection||"EPSG:3857");return function(n,r,s){s=e.hidpi?s:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,e.params),n=la(n,r,s,e.ratio);const a=eg(e.url,n,r,s,i,o),l=new Image;return e.crossOrigin!==null&&(l.crossOrigin=e.crossOrigin),t(l,a).then(h=>{const c=ne(n)/h.width*s;return{image:h,extent:n,resolution:c,pixelRatio:s}})}}var sS=class extends Xn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi===void 0||e.hidpi,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:aa,this.params_=e.params||{},this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:(this.loader&&this.loaderProjection_===n||(this.loaderProjection_=n,this.loader=z0({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,s)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,s),nn(r))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.image_=null,this.changed()}},oS=class extends Xn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,i,n){t=this.findNearestResolution(t);let r=this.canvas_;if(r&&this.renderedRevision_==this.getRevision()&&r.getResolution()==t&&r.getPixelRatio()==i&&ht(r.getExtent(),e))return r;pl(e=e.slice(),this.ratio_);const s=[ne(e)/t*i,Le(e)/t*i],o=this.canvasFunction_.call(this,e,t,i,s,n);return o&&(r=new zl(e,t,i,o)),this.canvas_=r,this.renderedRevision_=this.getRevision(),r}};function aS(e,t,i,n,r,s,o){const a=function(c,u,g,f){const p=ne(c),m=Le(c),_=u[0],x=u[1],y=.0254/f;return x*p>_*m?p*g/(_*y):m*g/(x*y)}(i,n,s,o),l=rt(i),h={OPERATION:r?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,t),Vn(e,h)}function X0(e){const t=e.load||nn;return function(i,n,r){const s=new Image;e.crossOrigin!==null&&(s.crossOrigin=e.crossOrigin);const o=ne(i=la(i,n,r,e.ratio))/n,a=Le(i)/n,l=[o*r,a*r],h=aS(e.url,e.params,i,l,e.useOverlay,e.metersPerUnit||1,e.displayDpi||96);return t(s,h).then(c=>({image:c,extent:i,pixelRatio:r}))}}var lS=class extends Xn{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=e.params||{},this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:aa,this.hidpi_=e.hidpi===void 0||e.hidpi,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0&&e.useOverlay,this.image_=null,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:(this.loader&&this.loaderProjection_===n||(this.loaderProjection_=n,this.loader=X0({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(r,s)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,s),nn(r))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}};function V0(e){const t=e.load||nn,i=e.imageExtent,n=new Image;return e.crossOrigin!==null&&(n.crossOrigin=e.crossOrigin),()=>t(n,e.url).then(r=>{const s=ne(i)/r.width,o=Le(i)/r.height;return{image:r,extent:i,resolution:s!==o?[s,o]:o,pixelRatio:1}})}var hS=class extends Xn{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:aa;super({attributions:e.attributions,interpolate:e.interpolate,projection:X(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new ko(this.imageExtent_,void 0,1,V0({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(n,r)=>(this.image.setImage(n),i(this.image,r),nn(n))})),this.image.addEventListener(he,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return Ie(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}};const ha="1.3.0",W0=[101,101];function tg(e,t,i,n,r){r.WIDTH=i[0],r.HEIGHT=i[1];const s=n.getAxisOrientation();let o;const a=yl(r.VERSION,"1.3")>=0;return r[a?"CRS":"SRS"]=n.getCode(),o=a&&s.substr(0,2)=="ne"?[t[1],t[0],t[3],t[2]]:t,r.BBOX=o.join(","),Vn(e,r)}function ig(e,t,i,n,r,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=t/i,l=[So(ne(e)/a,Ci),So(Le(e)/a,Ci)];if(i!=1)switch(o){case"geoserver":const h=90*i+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+h:s.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":s.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":s.DPI=90*i;break;default:throw new Error("Unknown `serverType` configured")}return tg(r,e,l,n,s)}function ca(e,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:ha,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},e)}function Z0(e){const t=e.hidpi===void 0||e.hidpi,i=X(e.projection||"EPSG:3857"),n=e.ratio||1.5,r=e.load||nn;return(s,o,a)=>{s=la(s,o,a,n),a==1||t&&e.serverType!==void 0||(a=1);const l=ig(s,o,a,i,e.url,ca(e.params,"GetMap"),e.serverType),h=new Image;return e.crossOrigin!==null&&(h.crossOrigin=e.crossOrigin),r(h,l).then(c=>({image:c,extent:s,pixelRatio:a}))}}function $0(e,t,i){if(e.url===void 0)return;const n=X(e.projection||"EPSG:3857"),r=us(t,i,0,W0),s={QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,ca(e.params,"GetFeatureInfo"),e.params);const o=Er((t[0]-r[0])/i,Ci),a=Er((r[3]-t[1])/i,Ci),l=yl(s.VERSION,"1.3")>=0;return s[l?"I":"X"]=o,s[l?"J":"Y"]=a,tg(e.url,r,W0,n,s)}function Y0(e,t){if(e.url===void 0)return;const i={SERVICE:"WMS",VERSION:ha,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e.params===void 0||e.params.LAYER===void 0){const n=e.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;i.LAYER=n}if(t!==void 0){const n=X(e.projection||"EPSG:3857").getMetersPerUnit()||1,r=28e-5;i.SCALE=t*n/r}return Object.assign(i,e.params),Vn(e.url,i)}var cS=class extends Xn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:aa,this.params_=e.params,this.serverType_=e.serverType,this.hidpi_=e.hidpi===void 0||e.hidpi,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,n){const r=X(i),s=this.getProjection();return s&&s!==r&&(t=Ls(s,r,e,t),e=Nn(e,r,s)),$0({url:this.url_,params:{...this.params_,...n},projection:s||r},e,t)}getLegendUrl(e,t){return Y0({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:(this.loader&&this.loaderProjection_===n||(this.loaderProjection_=n,this.loader=Z0({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,s)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,s),nn(r))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}};const uS={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},dS={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function q0(e,t){let i,n;for(let r=0;r<e.length;++r){const s=e[r];if(s.rel==="item"){if(s.type===t){i=s.href;break}(uS[s.type]||!n&&s.type.startsWith("image/"))&&(n=s.href)}}if(!i){if(!n)throw new Error('Could not find "item" link');i=n}return i}function K0(e,t,i){let n,r;const s={};for(let o=0;o<e.length;++o){const a=e[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===t){n=a.href;break}dS[a.type]&&(r=a.href)}}if(!n&&i)for(let o=0;o<i.length;++o){const a=i[o];if(s[a]){n=s[a];break}}if(!n){if(!r)throw new Error('Could not find "item" link');n=r}return n}function H0(e,t,i,n){let r=e.projection;if(!r&&(r=X(t.crs),!r))throw new Error(`Unsupported CRS: ${t.crs}`);const s=r.getAxisOrientation().substr(0,2)!=="en",o=t.tileMatrices,a={};for(let v=0;v<o.length;++v){const w=o[v];a[w.id]=w}const l={},h=[];if(n)for(let v=0;v<n.length;++v){const w=n[v],S=w.tileMatrix;h.push(S),l[S]=w}else for(let v=0;v<o.length;++v){const w=o[v].id;h.push(w)}const c=h.length,u=new Array(c),g=new Array(c),f=new Array(c),p=new Array(c),m=[-1/0,-1/0,1/0,1/0];for(let v=0;v<c;++v){const w=h[v],S=a[w],C=S.pointOfOrigin;u[v]=s?[C[1],C[0]]:C,g[v]=S.cellSize,f[v]=[S.matrixWidth,S.matrixHeight],p[v]=[S.tileWidth,S.tileHeight];const E=l[w];if(E){const R=S.cellSize*S.tileWidth,P=u[v][0]+E.minTileCol*R,I=u[v][0]+(E.maxTileCol+1)*R,A=S.cellSize*S.tileHeight;let G,B;S.cornerOfOrigin==="bottomLeft"?(G=u[v][1]+E.minTileRow*A,B=u[v][1]+(E.maxTileRow+1)*A):(G=u[v][1]-(E.maxTileRow+1)*A,B=u[v][1]-E.minTileRow*A),We(m,[P,G,I,B],m)}}const _=new on({origins:u,resolutions:g,sizes:f,tileSizes:p,extent:n?m:void 0}),x=e.context,y=e.url;return{grid:_,urlTemplate:i,urlFunction:function(v,w,S){if(!v)return;const C=h[v[0]],E=a[C],R=E.cornerOfOrigin==="bottomLeft",P={tileMatrix:C,tileCol:v[1],tileRow:R?-v[2]-1:v[2]};if(n){const A=l[E.id];if(P.tileCol<A.minTileCol||P.tileCol>A.maxTileCol||P.tileRow<A.minTileRow||P.tileRow>A.maxTileRow)return}Object.assign(P,x);const I=i.replace(/\{(\w+?)\}/g,function(A,G){return P[G]});return Nd(y,I)}}}function ng(e){return Od(e.url).then(function(t){return function(i,n){const r=n.tileMatrixSetLimits;let s;if(n.dataType==="map")s=q0(n.links,i.mediaType);else{if(n.dataType!=="vector")throw new Error('Expected tileset data type to be "map" or "vector"');s=K0(n.links,i.mediaType,i.supportedMediaTypes)}if(n.tileMatrixSet)return H0(i,n.tileMatrixSet,s,r);const o=n.links.find(l=>l.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!o)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const a=o.href;return Od(Nd(i.url,a)).then(function(l){return H0(i,l,s,r)})}(e,t)})}var gS=class extends Gi{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition}),ng({url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Po(e),this.setState("error")}},J0=class extends Xd{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||an(t),n=e.tileGrid||Dr({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Q0,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new Yo(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null||e.overlaps,this.tileClass=e.tileClass?e.tileClass:s0,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(i.getCount()===0)return t;const n=Ld(i.peekFirstKey())[0],r=this.tileGrid;return i.forEach(function(s){if(s.tileCoord[0]!==n||s.getState()!==we)return;const o=s.getSourceTiles();for(let a=0,l=o.length;a<l;++a){const h=o[a],c=h.tileCoord;if(Ie(e,r.getTileCoordExtent(c))){const u=h.getFeatures();if(u)for(let g=0,f=u.length;g<f;++g){const p=u[g],m=p.getGeometry();Ie(e,m.getExtent())&&t.push(p)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),n=Object.keys(t).reduce((r,s)=>{const o=e0(s),a=i.peek(o);if(a){const l=a.sourceTiles;for(let h=0,c=l.length;h<c;++h)r[l[h].getKey()]=!0}return r},{});super.expireCache(e,t),this.sourceTileCache.expireCache(n)}getSourceTiles(e,t,i){if(i.getState()===Be){i.setState(Kt);const n=i.wrappedTileCoord,r=this.getTileGridForProjection(t),s=r.getTileCoordExtent(n),o=n[0],a=r.getResolution(o);mt(s,-a,s);const l=this.tileGrid,h=l.getExtent();h&&We(s,h,s);const c=l.getZForResolution(a,this.zDirection);l.forEachTileCoord(s,c,u=>{const g=this.tileUrlFunction(u,e,t),f=this.sourceTileCache.containsKey(g)?this.sourceTileCache.get(g):new this.tileClass(u,g?Be:De,g,this.format_,this.tileLoadFunction);i.sourceTiles.push(f);const p=f.getState();if(p<we){const m=_=>{this.handleTileChange(_);const x=f.getState();if(x===we||x===Ne){const y=f.getKey();y in i.errorTileKeys?f.getState()===we&&delete i.errorTileKeys[y]:i.loadingSourceTiles--,x===Ne?i.errorTileKeys[y]=!0:f.removeEventListener(he,m),i.loadingSourceTiles===0&&i.setState(qt(i.errorTileKeys)?we:Ne)}};f.addEventListener(he,m),i.loadingSourceTiles++}p===Be&&(f.extent=l.getTileCoordExtent(u),f.projection=t,f.resolution=l.getResolution(u[0]),this.sourceTileCache.set(g,f),f.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(u=>u.getState()===Ne)?Ne:we)}return i.sourceTiles}getTile(e,t,i,n,r){const s=Ei(e,t,i),o=this.getKey();let a;if(this.tileCache.containsKey(s)&&(a=this.tileCache.get(s),a.key===o))return a;const l=[e,t,i];let h=this.getTileCoordForTileUrlFunction(l,r);const c=this.getTileGrid().getExtent(),u=this.getTileGridForProjection(r);if(h&&c){const p=u.getTileCoordExtent(h);mt(p,-u.getResolution(e),p),Ie(c,p)||(h=null)}let g=!0;if(h!==null){const p=this.tileGrid,m=u.getResolution(e),_=p.getZForResolution(m,1),x=u.getTileCoordExtent(h);mt(x,-m,x),p.forEachTileCoord(x,_,y=>{g=g&&!this.tileUrlFunction(y,n,r)})}const f=new r0(l,g?De:Be,h,this.getSourceTiles.bind(this,n,r));return f.key=o,a?(f.interimTile=a,f.refreshInterimChain(),this.tileCache.replace(s,f)):this.tileCache.set(s,f),f}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const n=this.tileGrid,r=n.getResolutions().slice(),s=r.map(function(l,h){return n.getOrigin(h)}),o=r.map(function(l,h){return n.getTileSize(h)}),a=rd+1;for(let l=r.length;l<a;++l)r.push(r[l-1]/2),s.push(s[l-1]),o.push(o[l-1]);i=new on({extent:n.getExtent(),origins:s,resolutions:r,tileSizes:o}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const n=Ge(this.getTileGridForProjection(i).getTileSize(e),this.tmpSize);return[Math.round(n[0]*t),Math.round(n[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(2*e,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}};function Q0(e,t){e.setLoader(function(i,n,r){Md(t,e.getFormat(),i,n,r,e.onLoad.bind(e),e.onError.bind(e))})}var fS=class extends J0{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"}),ng({url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Po(e),this.setState("error")}};const rg='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';var pS=class extends Jo{constructor(e){let t;t=(e=e||{}).attributions!==void 0?e.attributions:[rg];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque===void 0||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}},ey=class extends Rr{constructor(e){super(e=e||{})}},sg=class extends Hc{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return q()}getData(e){return null}prepareFrame(e){return q()}renderFrame(e,t){return q()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(n,r)=>{const s=this.loadedTileCallback.bind(this,i,n);return e.forEachLoadedTile(t,n,r,s)}}forEachFeatureAtCoordinate(e,t,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;t.getState()!==Ze&&t.getState()!==tn||this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Ze&&t!=tn&&e.addEventListener(he,this.boundHandleImageChange_),t==wt&&(e.load(),t=e.getState()),t==Ze}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}};const og=[];let js=null;var Ah=class extends sg{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){let n;js||(js=ke(1,1,void 0,{willReadFrequently:!0})),js.clearRect(0,0,1,1);try{js.drawImage(e,t,i,1,1,0,0,1,1),n=js.getImageData(0,0,1,1).data}catch{return js=null,null}return n}getBackground(e){let t=this.getLayer().getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let r,s;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&ui(vi(e.style.backgroundColor),vi(i)))){const o=e.firstElementChild;o instanceof HTMLCanvasElement&&(s=o.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=n;let o=r.style;o.position="absolute",o.width="100%",o.height="100%",s=ke();const a=s.canvas;r.appendChild(a),o=a.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=r,this.context=s}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=Qt(i),r=ds(i),s=mr(i),o=pr(i);ye(t.coordinateToPixelTransform,n),ye(t.coordinateToPixelTransform,r),ye(t.coordinateToPixelTransform,s),ye(t.coordinateToPixelTransform,o);const a=this.inversePixelTransform;ye(a,n),ye(a,r),ye(a,s),ye(a,o),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.clip()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const r=new Ts(e,this.inversePixelTransform,i,t);n.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(td,e,t)}postRender(e,t){this.dispatchRenderEvent_(Zl,e,t)}getRenderTransform(e,t,i,n,r,s,o){const a=r/2,l=s/2,h=n/t,c=-h,u=-e[0]+o,g=-e[1];return pt(this.tempTransform,a,l,h,c,-i,u,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}},ag=class extends Ah{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,r=n.resolution,s=this.getLayer().getSource(),o=e.viewHints;let a=e.extent;if(t.extent!==void 0&&(a=We(a,At(t.extent,n.projection))),!o[_t]&&!o[Ot]&&!fi(a))if(s){const l=n.projection,h=s.getImage(a,r,i,l);h&&(this.loadImage(h)?this.image_=h:h.getState()===zm&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=ye(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!Jt(r,n))return null;const s=this.image_.getExtent(),o=this.image_.getImage(),a=ne(s),l=Math.floor(o.width*((n[0]-s[0])/a));if(l<0||l>=o.width)return null;const h=Le(s),c=Math.floor(o.height*((s[3]-n[1])/h));return c<0||c>=o.height?null:this.getImageData(o,l,c)}renderFrame(e,t){const i=this.image_,n=i.getExtent(),r=i.getResolution(),[s,o]=Array.isArray(r)?r:[r,r],a=i.getPixelRatio(),l=e.layerStatesArray[e.layerIndex],h=e.pixelRatio,c=e.viewState,u=c.center,g=c.resolution,f=h*s/(g*a),p=h*o/(g*a),m=e.extent,_=c.resolution,x=c.rotation,y=Math.round(ne(m)/_*h),v=Math.round(Le(m)/_*h);pt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,x,-y/2,-v/2),Ht(this.inversePixelTransform,this.pixelTransform);const w=xo(this.pixelTransform);this.useContainer(t,w,this.getBackground(e));const S=this.context,C=S.canvas;C.width!=y||C.height!=v?(C.width=y,C.height=v):this.containerReused||S.clearRect(0,0,y,v);let E=!1,R=!0;if(l.extent){const B=At(l.extent,c.projection);R=Ie(B,e.extent),E=R&&!ht(B,e.extent),E&&this.clipUnrotated(S,e,B)}const P=i.getImage(),I=pt(this.tempTransform,y/2,v/2,f,p,0,a*(n[0]-u[0])/s,a*(u[1]-n[3])/o);this.renderedResolution=o*h/a;const A=P.width*I[0],G=P.height*I[3];if(this.getLayer().getSource().getInterpolate()||(S.imageSmoothingEnabled=!1),this.preRender(S,e),R&&A>=.5&&G>=.5){const B=I[4],z=I[5],N=l.opacity;let M;N!==1&&(M=S.globalAlpha,S.globalAlpha=N),S.drawImage(P,0,0,+P.width,+P.height,B,z,A,G),N!==1&&(S.globalAlpha=M)}return this.postRender(S,e),E&&S.restore(),S.imageSmoothingEnabled=!0,w!==C.style.transform&&(C.style.transform=w),this.container}},ty=class extends ey{constructor(e){super(e)}createRenderer(){return new ag(this)}getData(e){return super.getData(e)}},Oh="preload",Nh="useInterimTilesOnError",lg=class extends Rr{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError===void 0||e.useInterimTilesOnError)}getPreload(){return this.get(Oh)}setPreload(e){this.set(Oh,e)}getUseInterimTilesOnError(){return this.get(Nh)}setUseInterimTilesOnError(e){this.set(Nh,e)}getData(e){return super.getData(e)}},hg=class extends Ah{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new dh(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==we||i==De||i==Ne&&!n}getTile(e,t,i,n){const r=n.pixelRatio,s=n.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(e,t,i,r,s);return a.getState()==Ne&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=ye(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!Jt(r,n))return null;const s=t.pixelRatio,o=t.viewState.projection,a=t.viewState,l=i.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=l.getTilePixelRatio(t.pixelRatio);for(let u=h.getZForResolution(a.resolution);u>=h.getMinZoom();--u){const g=h.getTileCoordForCoordAndZ(n,u),f=l.getTile(u,g[1],g[2],s,o);if(!(f instanceof Ss||f instanceof Nr)||f instanceof Nr&&f.getState()===De)return null;if(f.getState()!==we)continue;const p=h.getOrigin(u),m=Ge(h.getTileSize(u)),_=h.getResolution(u),x=Math.floor(c*((n[0]-p[0])/_-g[1]*m[0])),y=Math.floor(c*((p[1]-n[1])/_-g[2]*m[1])),v=Math.round(c*l.getGutterForProjection(a.projection));return this.getImageData(f.getImage(),x+v,y+v)}return null}loadedTileCallback(e,t,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(e,t,i)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,r=n.projection,s=n.resolution,o=n.center,a=n.rotation,l=e.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getRevision(),g=c.getTileGridForProjection(r),f=g.getZForResolution(s,c.zDirection),p=g.getResolution(f);let m=e.extent;const _=e.viewState.resolution,x=c.getTilePixelRatio(l),y=Math.round(ne(m)/_*l),v=Math.round(Le(m)/_*l),w=i.extent&&At(i.extent,r);w&&(m=We(m,At(i.extent,r)));const S=p*y/2/x,C=p*v/2/x,E=[o[0]-S,o[1]-C,o[0]+S,o[1]+C],R=g.getTileRangeForExtentAndZ(m,f),P={};P[f]={};const I=this.createLoadedTileFinder(c,r,P),A=this.tmpExtent,G=this.tmpTileRange_;this.newTiles_=!1;const B=a?fl(n.center,_,a,e.size):void 0;for(let nt=R.minX;nt<=R.maxX;++nt)for(let me=R.minY;me<=R.maxY;++me){if(a&&!g.tileCoordIntersectsViewport([f,nt,me],B))continue;const ve=this.getTile(f,nt,me,e);if(this.isDrawableTile(ve)){const nr=k(this);if(ve.getState()==we){P[f][ve.tileCoord.toString()]=ve;let Sn=ve.inTransition(nr);Sn&&i.opacity!==1&&(ve.endTransition(nr),Sn=!1),this.newTiles_||!Sn&&this.renderedTiles.includes(ve)||(this.newTiles_=!0)}if(ve.getAlpha(nr,e.time)===1)continue}const Pi=g.getTileCoordChildTileRange(ve.tileCoord,G,A);let xt=!1;Pi&&(xt=I(f+1,Pi)),xt||g.forEachTileCoordParentTileRange(ve.tileCoord,I,G,A)}const z=p/s*l/x;pt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/l,1/l,a,-y/2,-v/2);const N=xo(this.pixelTransform);this.useContainer(t,N,this.getBackground(e));const M=this.context,V=M.canvas;Ht(this.inversePixelTransform,this.pixelTransform),pt(this.tempTransform,y/2,v/2,z,z,0,-y/2,-v/2),V.width!=y||V.height!=v?(V.width=y,V.height=v):this.containerReused||M.clearRect(0,0,y,v),w&&this.clipUnrotated(M,e,w),c.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,e),this.renderedTiles.length=0;let se,oe,xe,U=Object.keys(P).map(Number);U.sort(qi),i.opacity!==1||this.containerReused&&!c.getOpaque(e.viewState.projection)?(se=[],oe=[]):U=U.reverse();for(let nt=U.length-1;nt>=0;--nt){const me=U[nt],ve=c.getTilePixelSize(me,l,r),Pi=g.getResolution(me)/p,xt=ve[0]*Pi*z,nr=ve[1]*Pi*z,Sn=g.getTileCoordForCoordAndZ(Qt(E),me),Za=g.getTileCoordExtent(Sn),Zi=ye(this.tempTransform,[x*(Za[0]-E[0])/p,x*(E[3]-Za[3])/p]),$a=x*c.getGutterForProjection(r),Wc=P[me];for(const dp in Wc){const rr=Wc[dp],Ya=rr.tileCoord,co=Sn[1]-Ya[1],gp=Math.round(Zi[0]-(co-1)*xt),rs=Sn[2]-Ya[2],Zc=Math.round(Zi[1]-(rs-1)*nr),Pt=Math.round(Zi[0]-co*xt),Yt=Math.round(Zi[1]-rs*nr),En=gp-Pt,$i=Zc-Yt,ss=f===me,$c=ss&&rr.getAlpha(k(this),e.time)!==1;let uo=!1;if(!$c)if(se){xe=[Pt,Yt,Pt+En,Yt,Pt+En,Yt+$i,Pt,Yt+$i];for(let os=0,qa=se.length;os<qa;++os)if(f!==me&&me<oe[os]){const jt=se[os];Ie([Pt,Yt,Pt+En,Yt+$i],[jt[0],jt[3],jt[4],jt[7]])&&(uo||(M.save(),uo=!0),M.beginPath(),M.moveTo(xe[0],xe[1]),M.lineTo(xe[2],xe[3]),M.lineTo(xe[4],xe[5]),M.lineTo(xe[6],xe[7]),M.moveTo(jt[6],jt[7]),M.lineTo(jt[4],jt[5]),M.lineTo(jt[2],jt[3]),M.lineTo(jt[0],jt[1]),M.clip())}se.push(xe),oe.push(me)}else M.clearRect(Pt,Yt,En,$i);this.drawTileImage(rr,e,Pt,Yt,En,$i,$a,ss),se&&!$c?(uo&&M.restore(),this.renderedTiles.unshift(rr)):this.renderedTiles.push(rr),this.updateUsedTiles(e.usedTiles,c,rr)}}return this.renderedRevision=u,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!It(this.renderedExtent_,E),this.renderedExtent_=E,this.renderedPixelRatio=l,this.renderedProjection=r,this.manageTilePyramid(e,c,g,l,r,m,f,h.getPreload()),this.scheduleExpireCache(e,c),this.postRender(M,e),i.extent&&M.restore(),M.imageSmoothingEnabled=!0,N!==V.style.transform&&(V.style.transform=N),this.container}drawTileImage(e,t,i,n,r,s,o,a){const l=this.getTileImage(e);if(!l)return;const h=k(this),c=t.layerStatesArray[t.layerIndex],u=c.opacity*(a?e.getAlpha(h,t.time):1),g=u!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,i,n,r,s),g&&this.context.restore(),u!==c.opacity?t.animate=!0:a&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(n,r,s){const o=k(n);o in s.usedTiles&&n.expireCache(s.viewState.projection,s.usedTiles[o])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=k(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,r,s,o,a,l){const h=k(t);h in e.wantedTiles||(e.wantedTiles[h]={});const c=e.wantedTiles[h],u=e.tileQueue,g=i.getMinZoom(),f=e.viewState.rotation,p=f?fl(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let m,_,x,y,v,w,S=0;for(w=g;w<=o;++w)for(_=i.getTileRangeForExtentAndZ(s,w,_),x=i.getResolution(w),y=_.minX;y<=_.maxX;++y)for(v=_.minY;v<=_.maxY;++v)f&&!i.tileCoordIntersectsViewport([w,y,v],p)||(o-w<=a?(++S,m=t.getTile(w,y,v,n,r),m.getState()==Be&&(c[m.getKey()]=!0,u.isKeyQueued(m.getKey())||u.enqueue([m,h,i.getTileCoordCenter(m.tileCoord),x])),l!==void 0&&l(m)):t.useTile(w,y,v,r));t.updateCacheSize(S,r)}},iy=class extends lg{constructor(e){super(e)}createRenderer(){return new hg(this)}};let cg,ny=!0;try{new ImageData(10,10)}catch{ny=!1}function ry(e,t,i){if(ny)return new ImageData(e,t,i);cg||(cg=document.createElement("canvas").getContext("2d"));const n=cg.createImageData(t,i);return n.data.set(e),n}function sy(e){let t=!0;try{new ImageData(10,10)}catch{t=!1}function i(n,r,s){return t?new ImageData(n,r,s):{data:n,width:r,height:s}}return function(n){const r=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,h=r.length,c=r[0].byteLength;if(o){const p=new Array(h);for(let m=0;m<h;++m)p[m]=i(new Uint8ClampedArray(r[m]),a,l);return e(p,s).data.buffer}const u=new Uint8ClampedArray(c),g=new Array(h),f=new Array(h);for(let p=0;p<h;++p)g[p]=new Uint8ClampedArray(r[p]),f[p]=[0,0,0,0];for(let p=0;p<c;p+=4){for(let _=0;_<h;++_){const x=g[_];f[_][0]=x[p],f[_][1]=x[p+1],f[_][2]=x[p+2],f[_][3]=x[p+3]}const m=e(f,s);u[p]=m[0],u[p+1]=m[1],u[p+2]=m[2],u[p+3]=m[3]}return u.buffer}}function mS(e,t){const i=Object.keys(e.lib||{}).map(function(r){return"const "+r+" = "+e.lib[r].toString()+";"}).concat(["const __minion__ = ("+sy.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return n.addEventListener("message",t),n}class oy extends as{constructor(t){let i;super(),this._imageOps=!!t.imageOps,i=t.threads===0?0:this._imageOps?1:t.threads||1;const n=new Array(i);if(i)for(let r=0;r<i;++r)n[r]=mS(t,this._onWorkerMessage.bind(this,r));else n[0]=function(r,s){const o=sy(r.operation);let a=!1;return{postMessage:function(l){setTimeout(function(){a||s({data:{buffer:o(l),meta:l.meta}})},0)},terminate:function(){a=!0}}}(t,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,i,n){this._enqueue({inputs:t,meta:i,callback:n}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const i=t.inputs[0].width,n=t.inputs[0].height,r=t.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1)return void this._workers[0].postMessage({buffers:r,meta:t.meta,imageOps:this._imageOps,width:i,height:n},r);const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const h=l*a,c=[];for(let u=0,g=r.length;u<g;++u)c.push(r[u].slice(h,h+a));this._workers[l].postMessage({buffers:c,meta:t.meta,imageOps:this._imageOps,width:i,height:n},c)}}_onWorkerMessage(t,i){this.disposed||(this._dataLookup[t]=i.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,i=this._workers.length;let n,r;if(i===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{const s=t.inputs[0].data.length;n=new Uint8ClampedArray(s),r=new Array(i);const o=4*Math.ceil(s/4/i);for(let a=0;a<i;++a){const l=this._dataLookup[a].buffer,h=a*o;n.set(new Uint8ClampedArray(l),h),r[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,ry(n,t.inputs[0].width,t.inputs[0].height),r),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const _S="beforeoperations",yS="afteroperations";class ug extends He{constructor(t,i,n){super(t),this.extent=i.extent,this.resolution=i.viewState.resolution/i.pixelRatio,this.data=n}}class ay extends Xn{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=function(r){const s=r.length,o=new Array(s);for(let a=0;a<s;++a)o[a]=vS(r[a]);return o}(t.sources);const i=this.changed.bind(this);for(let r=0,s=this.layers_.length;r<s;++r)this.layers_[r].addEventListener(he,i);var n;this.useResolutions_=t.resolutions!==null,this.tileQueue_=new xd(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],declutterTree:null,extent:null,index:0,layerIndex:0,layerStatesArray:(n=this.layers_,n.map(function(r){return r.getLayerState()})),pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:k(this),renderTargets:{}},this.setAttributions(function(r){const s=[];for(let o=0,a=t.sources.length;o<a;++o){const l=t.sources[o],h=l instanceof Ms?l:l.getSource();if(!h)continue;const c=h.getAttributions();if(typeof c=="function"){const u=c(r);s.push.apply(s,u)}}return s.length!==0?s:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,i){this.processor_&&this.processor_.dispose(),this.processor_=new oy({operation:t,imageOps:this.operationType_==="image",queue:1,lib:i,threads:this.threads_}),this.changed()}updateFrameState_(t,i,n){const r=Object.assign({},this.frameState_);r.viewState=Object.assign({},r.viewState);const s=rt(t);r.size[0]=Math.ceil(ne(t)/i),r.size[1]=Math.ceil(Le(t)/i),r.extent=[s[0]-r.size[0]*i/2,s[1]-r.size[1]*i/2,s[0]+r.size[0]*i/2,s[1]+r.size[1]*i/2],r.time=Date.now();const o=r.viewState;return o.center=s,o.projection=n,o.resolution=i,r}allSourcesReady_(){let t,i=!0;for(let n=0,r=this.layers_.length;n<r;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){i=!1;break}return i}getImage(t,i,n,r){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),i=this.findNearestResolution(i);const s=this.updateFrameState_(t,i,r);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();i===o&&It(s.extent,a)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,i=this.layers_.length,n=new Array(i);for(let s=0;s<i;++s){t.layerIndex=s,t.renderTargets={};const o=xS(this.layers_[s],t);if(!o)return;n[s]=o}const r={};this.dispatchEvent(new ug(_S,t,r)),this.processor_.process(n,r,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,i,n,r){if(i||!n)return;const s=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!It(s,this.requestedFrameState_.extent))return;let a;this.renderedImageCanvas_?a=this.renderedImageCanvas_.getImage().getContext("2d"):(a=ke(Math.round(ne(s)/o),Math.round(Le(s)/o)),this.renderedImageCanvas_=new zl(s,o,1,a.canvas)),a.putImageData(n,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new ug(yS,t,r))}getResolutions(t){if(!this.useResolutions_)return null;let i=super.getResolutions();if(!i)for(let n=0,r=this.layers_.length;n<r&&(i=this.layers_[n].getSource().getResolutions(t),!i);++n);return i}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}ay.prototype.dispose;let Br=null;function xS(e,t){const i=e.getRenderer();if(!i)throw new Error("Unsupported layer type: "+e);if(!i.prepareFrame(t))return null;const n=t.size[0],r=t.size[1];if(n===0||r===0)return null;const s=i.renderFrame(t,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===r)return o.getContext("2d").getImageData(0,0,n,r)}if(Br){const a=Br.canvas;a.width!==n||a.height!==r?Br=ke(n,r,void 0,{willReadFrequently:!0}):Br.clearRect(0,0,n,r)}else Br=ke(n,r,void 0,{willReadFrequently:!0});return Br.drawImage(o,0,0,n,r),Br.getImageData(0,0,n,r)}function vS(e){let t;return e instanceof Ms?e instanceof Ho?t=new iy({source:e}):e instanceof Xn&&(t=new ty({source:e})):t=e,t}var wS=ay;const SS={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},ES={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};var TS=class extends Jo{constructor(e){const t=e.layer.indexOf("-"),i=t==-1?e.layer:e.layer.slice(0,t),n=ES[i]||{minZoom:0,maxZoom:20,retina:!0},r=SS[e.layer],s=e.apiKey?"?api_key="+e.apiKey:"",o=n.retina&&e.retina?"@2x":"",a=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+o+"."+r.extension+s,l=['&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>','&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',rg];e.layer.startsWith("stamen_")&&l.splice(1,0,'&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>'),super({attributions:l,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:n.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:n.minZoom,opaque:r.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:a,tilePixelRatio:o?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}},CS=class extends Gi{constructor(e){super({attributions:(e=e||{}).attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=e.hidpi===void 0||e.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,i,n,r,s){const o=this.urls;if(!o)return;let a;return o.length==1?a=o[0]:a=o[ei(uh(e),o.length)],eg(a,i,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(e[0]),n,r,s)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;t==1||this.hidpi_||(t=1);const r=n.getTileCoordExtent(e,this.tmpExtent_);let s=Ge(n.getTileSize(e[0]),this.tmpSize);t!=1&&(s=bd(s,t,this.tmpSize));const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(e,s,r,t,i,o)}},bS=class extends Jo{constructor(e){super({opaque:!1,projection:(e=e||{}).projection,tileGrid:e.tileGrid,wrapX:e.wrapX===void 0||e.wrapX,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(t,i)=>{const n=t.getTileCoord()[0],r=Ge(this.tileGrid.getTileSize(n)),s=ke(r[0],r[1]);s.strokeStyle="grey",s.strokeRect(.5,.5,r[0]+.5,r[1]+.5),s.fillStyle="grey",s.strokeStyle="white",s.textAlign="center",s.textBaseline="middle",s.font="24px sans-serif",s.lineWidth=4,s.strokeText(i,r[0]/2,r[1]/2,r[0]),s.fillText(i,r[0]/2,r[1]/2,r[0]),t.setImage(s.canvas)}})}},RS=class extends Gi{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:X("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)gh(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else{if(!e.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(e.tileJSON)}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{return void this.handleTileJSONError()}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=X("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const a=Mt(t,i);n=_r(e.bounds,a)}const r=an(i),s=e.minzoom||0,o=Dr({extent:r,maxZoom:e.maxzoom||22,minZoom:s,tileSize:this.tileSize_});if(this.tileGrid=o,this.tileUrlFunction=vh(e.tiles,o),e.attribution&&!this.getAttributions()){const a=n!==void 0?n:r;this.setAttributions(function(l){return Ie(a,l.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}},PS=class extends Gi{constructor(e){e=e||{};const t=Object.assign({},e.params),i=!("TRANSPARENT"in t)||t.TRANSPARENT;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi===void 0||e.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,n){const r=X(i),s=this.getProjection()||r;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(s));const a=Nn(e,r,s),l=Ls(s,r,e,t),h=o.getZForResolution(l,this.zDirection),c=o.getResolution(h),u=o.getTileCoordForCoordAndZ(a,h);if(o.getResolutions().length<=u[0])return;let g=o.getTileCoordExtent(u,this.tmpExtent_);const f=this.gutter_;f!==0&&(g=mt(g,c*f,g));const p={QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,ca(this.params_,"GetFeatureInfo"),n);const m=Math.floor((a[0]-g[0])/c),_=Math.floor((g[3]-a[1])/c);return p[this.v13_?"I":"X"]=m,p[this.v13_?"J":"Y"]=_,this.getRequestUrl_(u,g,1,s||r,p)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:ha,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;i.LAYER=n}if(e!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*n/r}return Object.assign(i,t),Vn(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,n,r){const s=this.urls;if(!s)return;let o;return s.length==1?o=s[0]:o=s[ei(uh(e),s.length)],ig(t,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(e[0]),i,n,o,r,this.serverType_)}getTilePixelRatio(e){return this.hidpi_&&this.serverType_!==void 0?e:1}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||ha;this.v13_=yl(e,"1.3")>=0}tileUrlFunction(e,t,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;t==1||this.hidpi_&&this.serverType_!==void 0||(t=1);const r=n.getResolution(e[0]);let s=n.getTileCoordExtent(e,this.tmpExtent_);const o=this.gutter_;o!==0&&(s=mt(s,r*o,s));const a=Object.assign({},ca(this.params_,"GetMap"));return this.getRequestUrl_(e,s,t,i,a)}};class ly extends cr{constructor(t,i,n,r,s,o){super(t,i),this.src_=n,this.extent_=r,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const i=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof r!="string")return null;let s=r.charCodeAt(Math.floor(i*r.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];o=this.data_&&a in this.data_?this.data_[a]:a}return o}forDataAtCoordinate(t,i,n){this.state==De&&n===!0?(this.state=Be,hr(this,he,function(r){i(this.getData(t))},this),this.loadInternal_()):n===!0?setTimeout(()=>{i(this.getData(t))},0):i(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=Ne,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=we,this.changed()}loadInternal_(){if(this.state==Be)if(this.state=Kt,this.jsonp_)gh(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const i=t.target;if(!i.status||i.status>=200&&i.status<300){let n;try{n=JSON.parse(i.responseText)}catch{return void this.handleError_()}this.handleLoad_(n)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(De)}}var FS=class extends Ho{constructor(e){if(super({projection:X("EPSG:3857"),state:"loading",zDirection:e.zDirection}),this.preemptive_=e.preemptive===void 0||e.preemptive,this.tileUrlFunction_=R0,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)gh(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else{if(!e.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(e.tileJSON)}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{return void this.handleTileJSONError()}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,i,n){if(this.tileGrid){const r=this.tileGrid.getZForResolution(t,this.zDirection),s=this.tileGrid.getTileCoordForCoordAndZ(e,r);this.getTile(s[0],s[1],s[2],1,this.getProjection()).forDataAtCoordinate(e,i,n)}else n===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=X("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const l=Mt(t,i);n=_r(e.bounds,l)}const r=an(i),s=e.minzoom||0,o=Dr({extent:r,maxZoom:e.maxzoom||22,minZoom:s});this.tileGrid=o,this.template_=e.template;const a=e.grids;if(a){if(this.tileUrlFunction_=vh(a,o),e.attribution!==void 0){const l=n!==void 0?n:r;this.setAttributions(function(h){return Ie(l,h.extent)?[e.attribution]:null})}this.setState("ready")}else this.setState("error")}getTile(e,t,i,n,r){const s=Ei(e,t,i);if(this.tileCache.containsKey(s))return this.tileCache.get(s);const o=[e,t,i],a=this.getTileCoordForTileUrlFunction(o,r),l=this.tileUrlFunction_(a,n,r),h=new ly(o,l!==void 0?Be:De,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache.set(s,h),h}useTile(e,t,i){const n=Ei(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}},IS=class extends Gi{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let n=e.urls;n===void 0&&e.url!==void 0&&(n=wh(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:n,wrapX:e.wrapX!==void 0&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=Os(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(Os(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?Vn(e,i):e.replace(/\{(\w+?)\}/g,function(s,o){return o.toLowerCase()in i?i[o.toLowerCase()]:s});const n=this.tileGrid,r=this.dimensions_;return function(s,o,a){if(!s)return;const l={TileMatrix:n.getMatrixId(s[0]),TileCol:s[1],TileRow:s[2]};Object.assign(l,r);let h=e;return h=t=="KVP"?Vn(h,l):h.replace(/\{(\w+?)\}/g,function(c,u){return l[u]}),h}}};const Ur=34962,zr=34963,Bs=35044,ua=35048,dg=5126,hy=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function gg(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Ip},t);const i=hy.length;for(let n=0;n<i;++n)try{const r=e.getContext(hy[n],t);if(r)return r}catch{}return null}let fg=null;const Wn="http://www.w3.org/2001/XMLSchema-instance";function Q(e,t){return Xr().createElementNS(e,t)}function yt(e,t){return pg(e,t,[]).join("")}function pg(e,t,i){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?i.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(e.nodeValue);else{let n;for(n=e.firstChild;n;n=n.nextSibling)pg(n,t,i)}return i}function si(e){return"documentElement"in e}function cy(e,t,i){return e.getAttributeNS(t,i)||""}function oi(e){return new DOMParser().parseFromString(e,"application/xml")}function da(e,t){return function(i,n){const r=e.call(t!==void 0?t:this,i,n);r!==void 0&&ge(n[n.length-1],r)}}function Z(e,t){return function(i,n){const r=e.call(t!==void 0?t:this,i,n);r!==void 0&&n[n.length-1].push(r)}}function K(e,t){return function(i,n){const r=e.call(t!==void 0?t:this,i,n);r!==void 0&&(n[n.length-1]=r)}}function Oe(e,t,i){return function(n,r){const s=e.call(i!==void 0?i:this,n,r);if(s!==void 0){const o=r[r.length-1],a=t!==void 0?t:n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function T(e,t,i){return function(n,r){const s=e.call(i!==void 0?i:this,n,r);s!==void 0&&(r[r.length-1][t!==void 0?t:n.localName]=s)}}function b(e,t){return function(i,n,r){e.call(t!==void 0?t:this,i,n,r),r[r.length-1].node.appendChild(i)}}function mg(e,t){let i,n;return function(r,s,o){if(i===void 0){i={};const a={};a[r.localName]=e,i[r.namespaceURI]=a,n=ze(r.localName)}_g(i,n,s,o)}}function ze(e,t){return function(i,n,r){const s=n[n.length-1].node;let o=e;return o===void 0&&(o=r),Q(t!==void 0?t:s.namespaceURI,o)}}const at=ze();function Tt(e,t){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=e[t[r]];return n}function L(e,t,i){let n,r;for(i=i!==void 0?i:{},n=0,r=e.length;n<r;++n)i[e[n]]=t;return i}function Ct(e,t,i,n){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const s=e[r.namespaceURI];if(s!==void 0){const o=s[r.localName];o!==void 0&&o.call(n,r,i)}}}function O(e,t,i,n,r){return n.push(e),Ct(t,i,n,r),n.pop()}function _g(e,t,i,n,r,s){const o=(r!==void 0?r:i).length;let a,l;for(let h=0;h<o;++h)a=i[h],a!==void 0&&(l=t.call(s!==void 0?s:this,a,n,r!==void 0?r[h]:void 0),l!==void 0&&e[l.namespaceURI][l.localName].call(s,l,a,n))}function ee(e,t,i,n,r,s,o){return r.push(e),_g(t,i,n,r,s,o),r.pop()}let Dh,kh;function uy(){return Dh===void 0&&typeof XMLSerializer<"u"&&(Dh=new XMLSerializer),Dh}function Xr(){return kh===void 0&&typeof document<"u"&&(kh=document.implementation.createDocument("","",null)),kh}var yg=class extends lr{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(he,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===we,this.loaded)this.uploadTile();else{if(e instanceof Ss){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(he,this.handleTileChange_)}}uploadTile(){q()}setReady(){this.ready=!0,this.dispatchEvent(he)}handleTileChange_(){this.tile.getState()===we&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(he,this.handleTileChange_)}};const LS=Bs;function Gh(e){switch(e){case Ur:return Float32Array;case zr:return Uint32Array;default:return Float32Array}}var hn=class{constructor(e,t){this.array_=null,this.type_=e,ie(e===Ur||e===zr,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:LS}ofSize(e){return this.array_=new(Gh(this.type_))(e),this}fromArray(e){return this.array_=Gh(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Gh(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}},dy="webglcontextlost",gy="webglcontextrestored",xg=class{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vertexShader||`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`),t.compileShader(i);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,i),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(r=>{this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),i=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const n=0,r=t.RGBA,s=0,o=t.RGBA,a=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,r,i[0],i[1],s,o,a,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i[0],i[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,i,n){const r=this.getGL(),s=e.size;if(r.bindFramebuffer(r.FRAMEBUFFER,t?t.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!t){const a=k(r.canvas);if(!e.renderTargets[a]){const l=r.getContextAttributes();l&&l.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),e.renderTargets[a]=!0}}r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const o=e.layerStatesArray[e.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(e),i&&i(r,e),r.drawArrays(r.TRIANGLES,0,6),n&&n(r,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let i,n=1;this.uniforms_.forEach(function(r){if(i=typeof r.value=="function"?r.value(e):r.value,i instanceof HTMLCanvasElement||i instanceof ImageData)r.texture||(r.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,r.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,i.width,i.height,0,t.UNSIGNED_BYTE,new Uint8Array(i.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(r.location,n++);else if(Array.isArray(i))switch(i.length){case 2:return void t.uniform2f(r.location,i[0],i[1]);case 3:return void t.uniform3f(r.location,i[0],i[1],i[2]);case 4:return void t.uniform4f(r.location,i[0],i[1],i[2],i[3]);default:return}else typeof i=="number"&&t.uniform1f(r.location,i)})}};function MS(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cn(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}const ji={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},et={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:dg},jh={};function fy(e){return"shared/"+e}let py=0;function my(e){let t=0;for(let i=0;i<e.length;i++){const n=e[i];t+=n.size*_y(n.type)}return t}function _y(e){switch(e){case et.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case et.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case et.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case et.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var yy=class extends as{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?fy(e.canvasCacheKey):function(){const i="unique/"+py;return py+=1,i}(),this.gl_=function(i){let n=jh[i];if(!n){const r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",n={users:0,context:gg(r)},jh[i]=n}return n.users+=1,n.context}(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(dy,this.boundHandleWebGLContextLost_),t.addEventListener(gy,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=[1,0,0,1,0,0],this.offsetScaleMatrix_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(i=>new xg({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new xg({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===fy(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,i=k(e);let n=this.bufferCache_[i];n||(n={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[i]=n),t.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,i=k(e),n=this.bufferCache_[i];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(dy,this.boundHandleWebGLContextLost_),e.removeEventListener(gy,this.boundHandleWebGLContextRestored_),function(t){const i=jh[t];if(!i||(i.users-=1,i.users>0))return;const n=i.context,r=n.getExtension("WEBGL_lose_context");r&&r.loseContext();const s=n.canvas;s.width=1,s.height=1,delete jh[t]}(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,i){const n=this.gl_,r=this.getCanvas(),s=e.size,o=e.pixelRatio;r.width===s[0]*o&&r.height===s[1]*o||(r.width=s[0]*o,r.height=s[1]*o,r.style.width=s[0]+"px",r.style.height=s[1]+"px");for(let a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA),i?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindTexture(e,t,i){const n=this.gl_;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(i),t)}prepareDrawToRenderTarget(e,t,i,n){const r=this.gl_,s=t.getSize();r.bindFramebuffer(r.FRAMEBUFFER,t.getFramebuffer()),r.bindRenderbuffer(r.RENDERBUFFER,t.getDepthbuffer()),r.viewport(0,0,s[0],s[1]),r.bindTexture(r.TEXTURE_2D,t.getTexture()),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,i?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}drawElements(e,t){const i=this.gl_;this.getExtension("OES_element_index_uint");const n=i.UNSIGNED_INT,r=t-e,s=4*e;i.drawElements(i.TRIANGLES,r,n,s)}finalizeDraw(e,t,i){for(let n=0,r=this.postProcessPasses_.length;n<r;n++)n===r-1?this.postProcessPasses_[n].apply(e,null,t,i):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,i=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(ji.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(ji.ZOOM,e.viewState.zoom),this.setUniformFloatValue(ji.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(ji.PIXEL_RATIO,n),this.setUniformFloatVec2(ji.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(ji.ROTATION,i)}applyHitDetectionUniform(e){const t=this.getUniformLocation(ji.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(ji.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let i,n=0;this.uniforms_.forEach(r=>{if(i=typeof r.value=="function"?r.value(e):r.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)r.texture||(r.prevValue=void 0,r.texture=t.createTexture()),this.bindTexture(r.texture,n,r.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&r.prevValue!==i&&(r.prevValue=i,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)),n++;else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(r.name,cn(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:return void t.uniform2f(this.getUniformLocation(r.name),i[0],i[1]);case 3:return void t.uniform3f(this.getUniformLocation(r.name),i[0],i[1],i[2]);case 4:return void t.uniform4f(this.getUniformLocation(r.name),i[0],i[1],i[2],i[3]);default:return}else typeof i=="number"&&t.uniform1f(this.getUniformLocation(r.name),i)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const i=this.gl_,n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}getProgram(e,t){const i=this.gl_,n=this.compileShader(e,i.FRAGMENT_SHADER),r=this.compileShader(t,i.VERTEX_SHADER),s=i.createProgram();if(i.attachShader(s,n),i.attachShader(s,r),i.linkProgram(s),!i.getShaderParameter(n,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(o)}if(i.deleteShader(n),!i.getShaderParameter(r,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(o)}if(i.deleteShader(r),!i.getProgramParameter(s,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(s)}`;throw new Error(o)}return s}getUniformLocation(e){const t=k(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=k(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const i=e.size,n=e.viewState.rotation,r=e.viewState.resolution,s=e.viewState.center;return pt(t,0,0,2/(r*i[0]),2/(r*i[1]),-n,-s[0],-s[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,i,n,r){const s=this.getAttributeLocation(e);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,t,i,!1,n,r))}enableAttributes(e){const t=my(e);let i=0;for(let n=0;n<e.length;n++){const r=e[n];this.enableAttributeArray_(r.name,r.size,r.type||dg,t,i),i+=r.size*_y(r.type)}}handleWebGLContextLost(e){Rn(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,i){const n=this.gl_;i=i||n.createTexture();const r=n.RGBA,s=n.RGBA,o=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),t?n.texImage2D(n.TEXTURE_2D,0,r,s,o,t):n.texImage2D(n.TEXTURE_2D,0,r,e[0],e[1],0,s,o,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i}},xy=class{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}};const Bi=new Uint8Array(4);var Bh=class{constructor(e,t){this.helper_=e;const i=e.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){ui(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Bi[0]=0,Bi[1]=0,Bi[2]=0,Bi[3]=0,Bi;this.readAll();const i=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Bi[0]=this.data_[4*i],Bi[1]=this.data_[4*i+1],Bi[2]=this.data_[4*i+2],Bi[3]=this.data_[4*i+3],Bi}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}},vg={exports:{}};function Uh(e,t,i){i=i||2;var n,r,s,o,a,l,h,c=t&&t.length,u=c?t[0]*i:e.length,g=vy(e,0,u,i,!0),f=[];if(!g||g.next===g.prev)return f;if(c&&(g=function(m,_,x,y){var v,w,S,C=[];for(v=0,w=_.length;v<w;v++)(S=vy(m,_[v]*y,v<w-1?_[v+1]*y:m.length,y,!1))===S.next&&(S.steiner=!0),C.push(BS(S));for(C.sort(kS),v=0;v<C.length;v++)x=GS(C[v],x);return x}(e,t,g,i)),e.length>80*i){n=s=e[0],r=o=e[1];for(var p=i;p<u;p+=i)(a=e[p])<n&&(n=a),(l=e[p+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);h=(h=Math.max(s-n,o-r))!==0?32767/h:0}return ga(g,f,i,n,r,h,0),f}function vy(e,t,i,n,r){var s,o;if(r===Eg(e,t,i,n)>0)for(s=t;s<i;s+=n)o=Ey(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=Ey(s,e[s],e[s+1],o);return o&&zh(o,o.next)&&(pa(o),o=o.next),o}function Vr(e,t){if(!e)return e;t||(t=e);var i,n=e;do if(i=!1,n.steiner||!zh(n,n.next)&&Ve(n.prev,n,n.next)!==0)n=n.next;else{if(pa(n),(n=t=n.prev)===n.next)break;i=!0}while(i||n!==t);return t}function ga(e,t,i,n,r,s,o){if(e){!o&&s&&function(c,u,g,f){var p=c;do p.z===0&&(p.z=wg(p.x,p.y,u,g,f)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==c);p.prevZ.nextZ=null,p.prevZ=null,function(m){var _,x,y,v,w,S,C,E,R=1;do{for(x=m,m=null,w=null,S=0;x;){for(S++,y=x,C=0,_=0;_<R&&(C++,y=y.nextZ);_++);for(E=R;C>0||E>0&&y;)C!==0&&(E===0||!y||x.z<=y.z)?(v=x,x=x.nextZ,C--):(v=y,y=y.nextZ,E--),w?w.nextZ=v:m=v,v.prevZ=w,w=v;x=y}w.nextZ=null,R*=2}while(S>1)}(p)}(e,n,r,s);for(var a,l,h=e;e.prev!==e.next;)if(a=e.prev,l=e.next,s?OS(e,n,r,s):AS(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),pa(e),e=l.next,h=l.next;else if((e=l)===h){o?o===1?ga(e=NS(Vr(e),t,i),t,i,n,r,s,2):o===2&&DS(e,t,i,n,r,s):ga(Vr(e),t,i,n,r,s,1);break}}}function AS(e){var t=e.prev,i=e,n=e.next;if(Ve(t,i,n)>=0)return!1;for(var r=t.x,s=i.x,o=n.x,a=t.y,l=i.y,h=n.y,c=r<s?r<o?r:o:s<o?s:o,u=a<l?a<h?a:h:l<h?l:h,g=r>s?r>o?r:o:s>o?s:o,f=a>l?a>h?a:h:l>h?l:h,p=n.next;p!==t;){if(p.x>=c&&p.x<=g&&p.y>=u&&p.y<=f&&Us(r,a,s,l,o,h,p.x,p.y)&&Ve(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function OS(e,t,i,n){var r=e.prev,s=e,o=e.next;if(Ve(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,h=o.x,c=r.y,u=s.y,g=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<g?c:g:u<g?u:g,m=a>l?a>h?a:h:l>h?l:h,_=c>u?c>g?c:g:u>g?u:g,x=wg(f,p,t,i,n),y=wg(m,_,t,i,n),v=e.prevZ,w=e.nextZ;v&&v.z>=x&&w&&w.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&Us(a,c,l,u,h,g,v.x,v.y)&&Ve(v.prev,v,v.next)>=0||(v=v.prevZ,w.x>=f&&w.x<=m&&w.y>=p&&w.y<=_&&w!==r&&w!==o&&Us(a,c,l,u,h,g,w.x,w.y)&&Ve(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=x;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&Us(a,c,l,u,h,g,v.x,v.y)&&Ve(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=y;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=_&&w!==r&&w!==o&&Us(a,c,l,u,h,g,w.x,w.y)&&Ve(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function NS(e,t,i){var n=e;do{var r=n.prev,s=n.next.next;!zh(r,s)&&wy(r,n,n.next,s)&&fa(r,s)&&fa(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),pa(n),pa(n.next),n=e=s),n=n.next}while(n!==e);return Vr(n)}function DS(e,t,i,n,r,s){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&US(o,a)){var l=Sy(o,a);return o=Vr(o,o.next),l=Vr(l,l.next),ga(o,t,i,n,r,s,0),void ga(l,t,i,n,r,s,0)}a=a.next}o=o.next}while(o!==e)}function kS(e,t){return e.x-t.x}function GS(e,t){var i=function(r,s){var o,a=s,l=r.x,h=r.y,c=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){var u=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(u<=l&&u>c&&(c=u,o=a.x<a.next.x?a:a.next,u===l))return o}a=a.next}while(a!==s);if(!o)return null;var g,f=o,p=o.x,m=o.y,_=1/0;a=o;do l>=a.x&&a.x>=p&&l!==a.x&&Us(h<m?l:c,h,p,m,h<m?c:l,h,a.x,a.y)&&(g=Math.abs(h-a.y)/(l-a.x),fa(a,r)&&(g<_||g===_&&(a.x>o.x||a.x===o.x&&jS(o,a)))&&(o=a,_=g)),a=a.next;while(a!==f);return o}(e,t);if(!i)return t;var n=Sy(i,e);return Vr(n,n.next),Vr(i,i.next)}function jS(e,t){return Ve(e.prev,e,t.prev)<0&&Ve(t.next,e,e.next)<0}function wg(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function BS(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Us(e,t,i,n,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function US(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,n){var r=i;do{if(r.i!==i.i&&r.next.i!==i.i&&r.i!==n.i&&r.next.i!==n.i&&wy(r,r.next,i,n))return!0;r=r.next}while(r!==i);return!1}(e,t)&&(fa(e,t)&&fa(t,e)&&function(i,n){var r=i,s=!1,o=(i.x+n.x)/2,a=(i.y+n.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&o<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next;while(r!==i);return s}(e,t)&&(Ve(e.prev,e,t.prev)||Ve(e,t.prev,t))||zh(e,t)&&Ve(e.prev,e,e.next)>0&&Ve(t.prev,t,t.next)>0)}function Ve(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function zh(e,t){return e.x===t.x&&e.y===t.y}function wy(e,t,i,n){var r=Vh(Ve(e,t,i)),s=Vh(Ve(e,t,n)),o=Vh(Ve(i,n,e)),a=Vh(Ve(i,n,t));return r!==s&&o!==a||!(r!==0||!Xh(e,i,t))||!(s!==0||!Xh(e,n,t))||!(o!==0||!Xh(i,e,n))||!(a!==0||!Xh(i,t,n))}function Xh(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Vh(e){return e>0?1:e<0?-1:0}function fa(e,t){return Ve(e.prev,e,e.next)<0?Ve(e,t,e.next)>=0&&Ve(e,e.prev,t)>=0:Ve(e,t,e.prev)<0||Ve(e,e.next,t)<0}function Sy(e,t){var i=new Sg(e.i,e.x,e.y),n=new Sg(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Ey(e,t,i,n){var r=new Sg(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function pa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Sg(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Eg(e,t,i,n){for(var r=0,s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}vg.exports=Uh,vg.exports.default=Uh,Uh.deviation=function(e,t,i,n){var r=t&&t.length,s=r?t[0]*i:e.length,o=Math.abs(Eg(e,0,s,i));if(r)for(var a=0,l=t.length;a<l;a++){var h=t[a]*i,c=a<l-1?t[a+1]*i:e.length;o-=Math.abs(Eg(e,h,c,i))}var u=0;for(a=0;a<n.length;a+=3){var g=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((e[g]-e[p])*(e[f+1]-e[g+1])-(e[g]-e[f])*(e[p+1]-e[g+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)},Uh.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[r][s][o]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i};var zS=Bu(vg.exports);const Tg=.985,XS=[],Cg={vertexPosition:0,indexPosition:0};function Wh(e,t,i,n,r){e[t+0]=i,e[t+1]=n,e[t+2]=r}function bg(e,t){return(t=t||[])[0]=Math.floor(e/256/256/256)/255,t[1]=Math.floor(e/256/256)%256/255,t[2]=Math.floor(e/256)%256/255,t[3]=e%256/255,t}function Rg(e){let t=0;const i=256,n=255;return t+=Math.round(e[0]*i*i*i*n),t+=Math.round(e[1]*i*i*n),t+=Math.round(e[2]*i*n),t+=Math.round(e[3]*n),t}let ma=0;const Zn=0,je=1<<ma++,j=1<<ma++,dt=1<<ma++,Fe=1<<ma++,qe=1<<ma++,bt=Math.pow(2,5)-1,Ty={[je]:"boolean",[j]:"number",[dt]:"string",[Fe]:"color",[qe]:"number[]"},VS=Object.keys(Ty).map(Number).sort(qi);function tt(e){const t=[];for(const i of VS)Cy(e,i)&&t.push(Ty[i]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Cy(e,t){return(e&t)===t}function ai(e,t){return!!(e&t)}function zs(e,t){return e===t}class un{constructor(t,i){this.type=t,this.value=i}}class Pg{constructor(t,i,...n){this.type=t,this.operator=i,this.args=n}}function Zh(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function Te(e,t,i){switch(typeof e){case"boolean":return new un(je,e);case"number":return new un(j,e);case"string":{let r=dt;return Hm(e)&&(r|=Fe),zs(r&i,Zn)||(r&=i),new un(r,e)}}if(!Array.isArray(e))throw new Error("Expression must be an array or a primitive value");if(e.length===0)throw new Error("Empty expression");if(typeof e[0]=="string")return function(r,s,o){const a=r[0],l=WS[a];if(!l)throw new Error(`Unknown operator: ${a}`);return l(r,s,o)}(e,t,i);for(const r of e)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=qe;return e.length!==3&&e.length!==4||(n|=Fe),i&&(n&=i),new un(n,e)}const F={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},WS={[F.Get]:le(([e,t])=>t!==void 0?function(i){switch(i){case"string":return dt;case"color":return Fe;case"number":return j;case"boolean":return je;case"number[]":return qe;default:throw new Error(`Unrecognized type hint: ${i}`)}}(t.value):bt,pe(1,2),function(e,t){const i=Te(e[1],t);if(!(i instanceof un))throw new Error("Expected a literal argument for get operation");if(typeof i.value!="string")throw new Error("Expected a string argument for get operation");return t.properties.add(i.value),e.length===3?[i,Te(e[2],t)]:[i]}),[F.Var]:le(([e])=>e.type,pe(1,1),function(e,t,i,n){const r=e[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new un(bt,r)];const s=t.style.variables[r],o=Te(s,t);if(o.value=r,n&&!ai(n,o.type))throw new Error(`The variable ${r} has type ${tt(o.type)} but the following type was expected: ${tt(n)}`);return[o]}),[F.Id]:le(j|dt,_a,function(e,t){t.featureId=!0}),[F.Concat]:le(dt,pe(2,1/0),Re(bt)),[F.GeometryType]:le(dt,_a),[F.Resolution]:le(j,_a),[F.Zoom]:le(j,_a),[F.Time]:le(j,_a),[F.Any]:le(je,pe(2,1/0),Re(je)),[F.All]:le(je,pe(2,1/0),Re(je)),[F.Not]:le(je,pe(1,1),Re(je)),[F.Equal]:le(je,pe(2,2),Re(bt),Wr),[F.NotEqual]:le(je,pe(2,2),Re(bt),Wr),[F.GreaterThan]:le(je,pe(2,2),Re(bt),Wr),[F.GreaterThanOrEqualTo]:le(je,pe(2,2),Re(bt),Wr),[F.LessThan]:le(je,pe(2,2),Re(bt),Wr),[F.LessThanOrEqualTo]:le(je,pe(2,2),Re(bt),Wr),[F.Multiply]:le(e=>{let t=j|Fe;for(let i=0;i<e.length;i++)t&=e[i].type;return t},pe(2,1/0),Re(j|Fe),Wr),[F.Divide]:le(j,pe(2,2),Re(j)),[F.Add]:le(j,pe(2,1/0),Re(j)),[F.Subtract]:le(j,pe(2,2),Re(j)),[F.Clamp]:le(j,pe(3,3),Re(j)),[F.Mod]:le(j,pe(2,2),Re(j)),[F.Pow]:le(j,pe(2,2),Re(j)),[F.Abs]:le(j,pe(1,1),Re(j)),[F.Floor]:le(j,pe(1,1),Re(j)),[F.Ceil]:le(j,pe(1,1),Re(j)),[F.Round]:le(j,pe(1,1),Re(j)),[F.Sin]:le(j,pe(1,1),Re(j)),[F.Cos]:le(j,pe(1,1),Re(j)),[F.Atan]:le(j,pe(1,2),Re(j)),[F.Sqrt]:le(j,pe(1,1),Re(j)),[F.Match]:le(e=>{let t=bt;for(let i=2;i<e.length;i+=2)t&=e[i].type;return t&=e[e.length-1].type,t},pe(4,1/0),by,function(e,t,i,n){const r=e.length-1;let o=Te(e[1],t).type;const a=Te(e[e.length-1],t);let l=n!==void 0?n&a.type:a.type;const h=new Array(r-2);for(let u=0;u<r-2;u+=2){const g=Te(e[u+2],t),f=Te(e[u+3],t);o&=g.type,l&=f.type,h[u]=g,h[u+1]=f}const c=dt|j|je;if(!ai(c,o))throw new Error(`Expected an input of type ${tt(c)} for the interpolate operation, got ${tt(o)} instead`);if(zs(l,Zn))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(e));for(let u=0;u<r-2;u+=2){const g=Te(e[u+2],t,o),f=Te(e[u+3],t,l);h[u]=g,h[u+1]=f}return[Te(e[1],t,o),...h,Te(e[e.length-1],t,l)]}),[F.Between]:le(je,pe(3,3),Re(j)),[F.Interpolate]:le(e=>{let t=Fe|j;for(let i=3;i<e.length;i+=2)t&=e[i].type;return t},pe(6,1/0),by,function(e,t,i,n){const r=e[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=Te(s,t);let o=Te(e[2],t);if(!ai(j,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${tt(o.type)} instead`);o=Te(e[2],t,j);const a=new Array(e.length-3);for(let l=0;l<a.length;l+=2){let h=Te(e[l+3],t);if(!ai(j,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${tt(h.type)} at position ${l+2} instead`);let c=Te(e[l+4],t);if(!ai(j|Fe,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${tt(c.type)} at position ${l+3} instead`);h=Te(e[l+3],t,j),c=Te(e[l+4],t,j|Fe),a[l]=h,a[l+1]=c}return[s,o,...a]}),[F.Case]:le(e=>{let t=bt;for(let i=1;i<e.length;i+=2)t&=e[i].type;return t&=e[e.length-1].type,t},pe(3,1/0),function(e,t){const i=e[0],n=e.length-1;if(n%2==0)throw new Error(`An odd amount of arguments was expected for operation ${i}, got ${JSON.stringify(n)} instead`)},function(e,t,i,n){const r=Te(e[e.length-1],t);let s=n!==void 0?n&r.type:r.type;const o=new Array(e.length-1);for(let a=0;a<o.length-1;a+=2){const l=Te(e[a+1],t),h=Te(e[a+2],t);if(!ai(je,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${tt(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(zs(s,Zn))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(e));for(let a=0;a<o.length-1;a+=2)o[a+1]=Te(e[a+2],t,s);return o[o.length-1]=Te(e[e.length-1],t,s),o}),[F.In]:le(je,pe(2,2),function(e,t){let i=e[2];if(!Array.isArray(i))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(i[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');i=i[1]}let n=dt|j;const r=new Array(i.length);for(let o=0;o<r.length;o++){const a=Te(i[o],t);n&=a.type,r[o]=a}if(zs(n,Zn))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(e));return[Te(e[1],t,n),...r]}),[F.Number]:le(j,pe(1,1/0),Re(bt)),[F.String]:le(dt,pe(1,1/0),Re(bt)),[F.Array]:le(e=>e.length===3||e.length===4?qe|Fe:qe,pe(1,1/0),Re(j)),[F.Color]:le(Fe,pe(3,4),Re(j)),[F.Band]:le(j,pe(1,3),Re(j)),[F.Palette]:le(Fe,pe(2,2),function(e,t){const i=Te(e[1],t,j);if(i.type!==j)throw new Error(`The first argument of palette must be an number, got ${tt(i.type)} instead`);const n=e[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=Te(n[s],t,Fe);if(!(o instanceof un))throw new Error(`The palette color at index ${s} must be a literal value`);if(!ai(o.type,Fe))throw new Error(`The palette color at index ${s} should be of type color, got ${tt(o.type)} instead`);r[s]=o}return[i,...r]})};function _a(e,t){const i=e[0];if(e.length!==1)throw new Error(`Expected no arguments for ${i} operation`);return[]}function pe(e,t){return function(i,n){const r=i[0],s=i.length-1;if(e===t){if(s!==e)throw new Error(`Expected ${e} argument${e===1?"":"s"} for ${r}, got ${s}`)}else if(s<e||s>t)throw new Error(`Expected ${t===1/0?`${e} or more`:`${e} to ${t}`} arguments for ${r}, got ${s}`)}}function Re(e){return function(t,i){const n=t[0],r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=Te(t[o+1],i);if(!ai(e,a.type)){const l=tt(e),h=tt(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=e,s[o]=a}return s}}function Wr(e,t,i){const n=e[0],r=e.length-1;let s=bt;for(let a=0;a<i.length;++a)s&=i[a].type;if(s===Zn)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=Te(e[a+1],t,s);return o}function by(e,t){const i=e[0],n=e.length-1;if(n%2==1)throw new Error(`An even amount of arguments was expected for operation ${i}, got ${JSON.stringify(n)} instead`)}function le(e,...t){return function(i,n,r){const s=i[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](i,n,o,r)||o;let a=typeof e=="function"?e(o):e;if(r!==void 0){if(!ai(a,r))throw new Error(`The following expression was expected to return ${tt(r)}, but returns ${tt(a)} instead: ${JSON.stringify(i)}`);a&=r}if(a===Zn)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(i)}`);return new Pg(a,s,...o)}}function Ry(e,t,i){const n=i?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n)}function Py(e,t,i,n,r,s){const o=e.getGL();let a,l;i instanceof Float32Array?(a=o.FLOAT,e.getExtension("OES_texture_float"),l=e.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),Ry(o,t,s&&l);const h=i.byteLength/n[1];let c,u=1;switch(h%8==0?u=8:h%4==0?u=4:h%2==0&&(u=2),r){case 1:c=o.LUMINANCE;break;case 2:c=o.LUMINANCE_ALPHA;break;case 3:c=o.RGB;break;case 4:c=o.RGBA;break;default:throw new Error(`Unsupported number of bands: ${r}`)}const g=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,c,n[0],n[1],0,c,a,i),o.pixelStorei(o.UNPACK_ALIGNMENT,g)}let Xs=null;var Fy=class extends yg{constructor(e){super(e),this.textures=[],this.renderSize_=Ge(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new hn(Ur,Bs);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),i=this.tile;let n;this.textures.length=0,n=i instanceof Ss||i instanceof Nr?i.getImage():i.getData();const r=_o(n);if(r){const x=t.createTexture();return this.textures.push(x),this.bandCount=4,function(y,v,w,S){Ry(y,v,S),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,w)}(t,x,r,i.interpolate),void this.setReady()}n=al(n);const s=i.getSize(),o=[s[0]+2*this.gutter_,s[1]+2*this.gutter_],a=n instanceof Float32Array,l=o[0]*o[1],h=a?Float32Array:Uint8Array,c=h.BYTES_PER_ELEMENT,u=n.byteLength/o[1];this.bandCount=Math.floor(u/c/o[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const x=t.createTexture();return this.textures.push(x),Py(e,x,n,o,this.bandCount,i.interpolate),void this.setReady()}const f=new Array(g);for(let x=0;x<g;++x){const y=t.createTexture();this.textures.push(y);const v=x<g-1?4:(this.bandCount-1)%4+1;f[x]=new h(l*v)}let p=0,m=0;const _=o[0]*this.bandCount;for(let x=0;x<o[1];++x){for(let y=0;y<_;++y){const v=n[m+y],w=Math.floor(p/this.bandCount),S=y%this.bandCount,C=f[Math.floor(S/4)];C[w*(C.length/l)+S%4]=v,++p}m+=u/c}for(let x=0;x<g;++x){const y=this.textures[x],v=f[x];Py(e,y,v,o,v.length/l,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(he,this.handleTileChange_)}getImagePixelData_(e,t,i){const n=this.gutter_,r=this.renderSize_[0],s=this.renderSize_[1];Xs||(Xs=ke(1,1,void 0,{willReadFrequently:!0})),Xs.clearRect(0,0,1,1);const o=e.width-2*n,a=e.height-2*n,l=n+Math.floor(o*(t/r)),h=n+Math.floor(a*(i/s));let c;try{Xs.drawImage(e,l,h,1,1,0,0,1,1),c=Xs.getImageData(0,0,1,1).data}catch{return Xs=null,null}return c}getArrayPixelData_(e,t,i,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1],a=t[0],l=t[1],h=a+2*r,c=l+2*r,u=r+Math.floor(a*(i/s)),g=r+Math.floor(l*(n/o));if(e instanceof DataView){const p=e.byteLength/(h*c),m=p*(g*h+u),_=e.buffer.slice(m,m+p);return new DataView(_)}const f=this.bandCount*(g*h+u);return e.slice(f,f+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof ll){const i=this.tile.getData(),n=al(i);if(n){const r=this.tile.getSize();return this.getArrayPixelData_(n,r,e,t)}return this.getImagePixelData_(_o(i),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}};class Fg extends sg{constructor(t,i){super(t),i=i||{},this.inversePixelTransform_=[1,0,0,1,0,0],this.pixelContext_=null,this.postProcesses_=i.postProcesses,this.uniforms_=i.uniforms,this.helper,t.addChangeListener(Qu,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,i){const n=this.getLayer();if(n.hasListener($l)){const r=new Ts($l,void 0,i,t);n.dispatchEvent(r)}}dispatchPostComposeEvent(t,i){const n=this.getLayer();if(n.hasListener(id)){const r=new Ts(id,void 0,i,t);n.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let i,n=!0,r=-1;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Fg)){n=!0;continue}const c=l.getClassName();if((n||c!==i)&&(r+=1,n=!1),i=c,h===this)break}const s="map/"+t.mapId+"/group/"+r;this.helper&&this.helper.canvasCacheKeyMatches(s)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new yy({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,i,n){const r=this.getLayer();if(r.hasListener(t)){pt(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new Ts(t,this.inversePixelTransform_,n,i);r.dispatchEvent(s)}}preRender(t,i){this.dispatchRenderEvent_(td,t,i)}postRender(t,i){this.dispatchRenderEvent_(Zl,t,i)}}var $h=Fg;const Ig={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},ZS={};function Iy(e){return 1/(e+2)}function Ly(){return{tileIds:new Set,representationsByZ:{}}}function My(e,t){return e.tileIds.has(k(t))}function Ay(e,t,i){const n=e.representationsByZ;i in n||(n[i]=new Set),n[i].add(t),e.tileIds.add(k(t.tile))}function Lg(e,t){const i=e.layerStatesArray[e.layerIndex];i.extent&&(t=We(t,At(i.extent,e.viewState.projection)));const n=i.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=We(t,r))}return t}function Yh(e,t){return`${e.getKey()},${sn(t)}`}var Mg=class extends $h{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=[1,0,0,1,0,0],this.tempMat4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tempTileRange_=new dh(0,0,0,0),this.tempTileCoord_=Is(0,0,0),this.tempSize_=[0,0];const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new ch(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==we||i==De||i==Ne&&!n}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer().getRenderSource();return!!t&&!fi(Lg(e,e.extent))&&t.getState()==="ready"}createTileRepresentation(e){return q()}enqueueTiles(e,t,i,n,r){const s=e.viewState,o=this.getLayer(),a=o.getRenderSource(),l=a.getTileGridForProjection(s.projection),h=a.getGutterForProjection(s.projection),c=k(a);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],g=this.tileRepresentationCache,f=o.getMapInternal(),p=Math.max(i-r,l.getMinZoom(),l.getZForResolution(Math.min(o.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):l.getResolution(0)),a.zDirection));for(let m=i;m>=p;--m){const _=l.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),x=l.getResolution(m);for(let y=_.minX;y<=_.maxX;++y)for(let v=_.minY;v<=_.maxY;++v){const w=Is(m,y,v,this.tempTileCoord_),S=Yh(a,w);let C,E;if(g.containsKey(S)&&(C=g.get(S),E=C.tile),C&&C.tile.key===a.getKey()||(E=a.getTile(m,y,v,e.pixelRatio,s.projection)),My(n,E))continue;if(C)if(this.isDrawableTile_(E))C.setTile(E);else{const P=E.getInterimTile();C.setTile(P)}else C=this.createTileRepresentation({tile:E,grid:l,helper:this.helper,gutter:h}),g.set(S,C);Ay(n,C,m);const R=E.getKey();u[R]=!0,E.getState()===Be&&(e.tileQueue.isKeyQueued(R)||e.tileQueue.enqueue([E,c,l.getTileCoordCenter(w),x]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,i,n,r,s,o,a,l,h,c){}renderTileMask(e,t,i,n){}drawTile_(e,t,i,n,r,s,o){if(!t.ready)return;const a=t.tile.tileCoord,l=sn(a),h=l in s?s[l]:1,c=o.getResolution(i),u=Ge(o.getTileSize(i),this.tempSize_),g=o.getOrigin(i),f=o.getTileCoordExtent(a),p=h<1?-1:Iy(i);h<1&&(e.animate=!0);const m=e.viewState,_=m.center[0],x=m.center[1],y=u[0]+2*n,v=u[1]+2*n,w=y/v,S=(_-g[0])/(u[0]*c),C=(g[1]-x)/(u[1]*c),E=m.resolution/c,R=a[1],P=a[2];hl(this.tileTransform_),dr(this.tileTransform_,2/(e.size[0]*E/y),-2/(e.size[1]*E/y)),Gp(this.tileTransform_,m.rotation),dr(this.tileTransform_,1,1/w),cs(this.tileTransform_,(u[0]*(R-S)-n)/y,(u[1]*(P-C)-n)/v),this.renderTile(t,this.tileTransform_,e,r,c,u,g,f,p,n,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const i=e.viewState,n=this.getLayer(),r=n.getRenderSource(),s=r.getTileGridForProjection(i.projection),o=r.getGutterForProjection(i.projection),a=Lg(e,e.extent),l=s.getZForResolution(i.resolution,r.zDirection),h=Ly(),c=n.getPreload();if(e.nextExtent){const v=s.getZForResolution(i.nextResolution,r.zDirection),w=Lg(e,e.nextExtent);this.enqueueTiles(e,w,v,h,c)}this.enqueueTiles(e,a,l,h,0),c>0&&setTimeout(()=>{this.enqueueTiles(e,a,l-1,h,c-1)},0);const u={},g=k(this),f=e.time;let p=!1;for(const v of h.representationsByZ[l]){const w=v.tile;if((w instanceof Nr||w instanceof Lh)&&w.getState()===De)continue;const S=w.tileCoord;if(v.ready){const E=w.getAlpha(g,f);if(E===1){w.endTransition(g);continue}p=!0,u[sn(S)]=E}if(this.renderComplete=!1,this.findAltTiles_(s,S,l+1,h))continue;const C=s.getMinZoom();for(let E=l-1;E>=C&&!this.findAltTiles_(s,S,E,h);--E);}const m=h.representationsByZ,_=Object.keys(m).map(Number).sort(yp);if(this.beforeTilesMaskRender(e))for(let v=0,w=_.length;v<w;++v){const S=_[v];for(const C of m[S]){const E=C.tile.tileCoord;if(sn(E)in u)continue;const R=s.getTileCoordExtent(E);this.renderTileMask(C,S,R,Iy(S))}}this.beforeTilesRender(e,p);for(let v=0,w=_.length;v<w;++v){const S=_[v];for(const C of m[S])sn(C.tile.tileCoord)in u||this.drawTile_(e,C,S,o,a,u,s)}for(const v of m[l])sn(v.tile.tileCoord)in u&&this.drawTile_(e,v,l,o,a,u,s);this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const x=this.helper.getCanvas(),y=this.tileRepresentationCache;for(;y.canExpireCache();)y.pop().dispose();return e.postRenderFunctions.push(function(v,w){r.updateCacheSize(.1,w.viewState.projection),r.expireCache(w.viewState.projection,ZS)}),this.postRender(t,e),x}findAltTiles_(e,t,i,n){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let s=!0;const o=this.tileRepresentationCache,a=this.getLayer().getRenderSource();for(let l=r.minX;l<=r.maxX;++l)for(let h=r.minY;h<=r.maxY;++h){const c=Yh(a,[i,l,h]);let u=!1;if(o.containsKey(c)){const g=o.get(c);g.ready&&!My(n,g.tile)&&(Ay(n,g,i),u=!0)}u||(s=!1)}return s}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}};const ae={...Ig,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},ya={TEXTURE_COORD:"a_textureCoord"},$S=[{name:ya.TEXTURE_COORD,size:2,type:et.FLOAT}];var Oy=class extends Mg{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new hn(zr,Bs),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new Fy(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,i,n,r,s,o,a,l,h,c){const u=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes($S);let g=0;for(;g<e.textures.length;){const w=`${ae.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,w),++g}for(let w=0;w<this.paletteTextures_.length;++w){const S=this.paletteTextures_[w],C=S.getTexture(u);this.helper.bindTexture(C,g,S.name),++g}const f=i.viewState,p=s[0]+2*h,m=s[1]+2*h,_=e.tile.tileCoord,x=_[1],y=_[2];this.helper.setUniformMatrixValue(ae.TILE_TRANSFORM,cn(this.tempMat4,t)),this.helper.setUniformFloatValue(ae.TRANSITION_ALPHA,c),this.helper.setUniformFloatValue(ae.DEPTH,l);let v=n;h>0&&(v=a,We(v,n,v)),this.helper.setUniformFloatVec4(ae.RENDER_EXTENT,v),this.helper.setUniformFloatValue(ae.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(ae.ZOOM,f.zoom),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_WIDTH,p),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(ae.TEXTURE_RESOLUTION,r),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_X,o[0]+x*s[0]*r-h*r),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_Y,o[1]-y*s[1]*r+h*r),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=ye(t.pixelToCoordinateTransform,e.slice()),r=t.viewState,s=i.getExtent();if(s&&!Jt(At(s,r.projection),n))return null;const o=i.getSources(Xe([n]),r.resolution);let a,l,h;for(a=o.length-1;a>=0;--a)if(l=o[a],l.getState()==="ready"){if(h=l.getTileGridForProjection(r.projection),l.getWrapX())break;const u=h.getExtent();if(!u||Jt(u,n))break}if(a<0)return null;const c=this.tileRepresentationCache;for(let u=h.getZForResolution(r.resolution);u>=h.getMinZoom();--u){const g=h.getTileCoordForCoordAndZ(n,u),f=Yh(l,g);if(!c.containsKey(f))continue;const p=c.get(f),m=p.tile;if((m instanceof Nr||m instanceof Lh)&&m.getState()===De)return null;if(!p.loaded)continue;const _=h.getOrigin(u),x=Ge(h.getTileSize(u)),y=h.getResolution(u),v=(n[0]-_[0])/y-g[1]*x[0],w=(_[1]-n[1])/y-g[2]*x[1];return p.getPixelData(v,w)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}};function $n(e){const t=e.toString();return t.includes(".")?t:t+".0"}function qh(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map($n).join(", ")})`}function xa(e){const t=vi(e),i=t.length>3?t[3]:1;return qh([t[0]/255*i,t[1]/255*i,t[2]/255*i,i])}const Ag={};let YS=0;function va(e){return e in Ag||(Ag[e]=YS++),Ag[e]}function Ui(e){return $n(va(e))}function Kh(e){return"u_var_"+e}function qS(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Og="getBandValue",Ng="u_paletteTextures";function Ny(e,t,i,n){const r=Te(e,i,t);if(zs(r.type,Zn))throw new Error("No matching type was found");if(!ai(t,r.type)){const s=tt(t),o=tt(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Dg(r,t,n)}function Ce(e){return(t,i,n)=>{const r=i.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=Dg(i.args[o],n,t);return e(s,t)}}const KS={[F.Get]:(e,t)=>{const i=t.args[0].value;return i in e.properties||(e.properties[i]={name:i,type:t.type}),(e.inFragmentShader?"v_prop_":"a_prop_")+i},[F.GeometryType]:(e,t,i)=>{const n="geometryType",r=s=>{const o=s.getType();switch(o){case"Point":case"LineString":case"Polygon":return o;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return o.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(s.getGeometries()[0])}};return n in e.properties||(e.properties[n]={name:n,type:dt,evaluator:s=>r(s.getGeometry())}),(e.inFragmentShader?"v_prop_":"a_prop_")+n},[F.Var]:(e,t)=>{const i=t.args[0].value;return i in e.variables||(e.variables[i]={name:i,type:t.type}),Kh(i)},[F.Resolution]:()=>"u_resolution",[F.Zoom]:()=>"u_zoom",[F.Time]:()=>"u_time",[F.Any]:Ce(e=>`(${e.join(" || ")})`),[F.All]:Ce(e=>`(${e.join(" && ")})`),[F.Not]:Ce(([e])=>`(!${e})`),[F.Equal]:Ce(([e,t])=>`(${e} == ${t})`),[F.NotEqual]:Ce(([e,t])=>`(${e} != ${t})`),[F.GreaterThan]:Ce(([e,t])=>`(${e} > ${t})`),[F.GreaterThanOrEqualTo]:Ce(([e,t])=>`(${e} >= ${t})`),[F.LessThan]:Ce(([e,t])=>`(${e} < ${t})`),[F.LessThanOrEqualTo]:Ce(([e,t])=>`(${e} <= ${t})`),[F.Multiply]:Ce(e=>`(${e.join(" * ")})`),[F.Divide]:Ce(([e,t])=>`(${e} / ${t})`),[F.Add]:Ce(e=>`(${e.join(" + ")})`),[F.Subtract]:Ce(([e,t])=>`(${e} - ${t})`),[F.Clamp]:Ce(([e,t,i])=>`clamp(${e}, ${t}, ${i})`),[F.Mod]:Ce(([e,t])=>`mod(${e}, ${t})`),[F.Pow]:Ce(([e,t])=>`pow(${e}, ${t})`),[F.Abs]:Ce(([e])=>`abs(${e})`),[F.Floor]:Ce(([e])=>`floor(${e})`),[F.Ceil]:Ce(([e])=>`ceil(${e})`),[F.Round]:Ce(([e])=>`floor(${e} + 0.5)`),[F.Sin]:Ce(([e])=>`sin(${e})`),[F.Cos]:Ce(([e])=>`cos(${e})`),[F.Atan]:Ce(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[F.Sqrt]:Ce(([e])=>`sqrt(${e})`),[F.Match]:Ce(e=>{const t=e[0],i=e[e.length-1];let n=null;for(let r=e.length-3;r>=1;r-=2)n=`(${t} == ${e[r]} ? ${e[r+1]} : ${n||i})`;return n}),[F.Between]:Ce(([e,t,i])=>`(${e} >= ${t} && ${e} <= ${i})`),[F.Interpolate]:Ce(([e,t,...i])=>{let n="";for(let r=0;r<i.length-2;r+=2){const s=i[r],o=n||i[r+1],a=i[r+2],l=i[r+3];let h;h=e===$n(1)?`(${t} - ${s}) / (${a} - ${s})`:`(pow(${e}, (${t} - ${s})) - 1.0) / (pow(${e}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[F.Case]:Ce(e=>{const t=e[e.length-1];let i=null;for(let n=e.length-3;n>=0;n-=2)i=`(${e[n]} ? ${e[n+1]} : ${i||t})`;return i}),[F.In]:Ce(([e,...t],i)=>{const n=function(s,o){return`operator_${s}_${Object.keys(o.functions).length}`}("in",i),r=[];for(let s=0;s<t.length;s+=1)r.push(`  if (inputValue == ${t[s]}) { return true; }`);return i.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${e})`}),[F.Array]:Ce(e=>`vec${e.length}(${e.join(", ")})`),[F.Color]:Ce(e=>{const t=e.slice(0,3).map(i=>`${i} / 255.0`);return e.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${e[3]} * vec4(${t.join(", ")}, 1.0))`}),[F.Band]:Ce(([e,t,i],n)=>{if(!(Og in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3),r+=`  if (band == ${o+1}.0) {
    return texture2D(${`${ae.TILE_TEXTURE_ARRAY}[${a}]`}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Og]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${ae.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${ae.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${Og}(${e}, ${t??"0.0"}, ${i??"0.0"})`}),[F.Palette]:(e,t)=>{const[i,...n]=t.args,r=n.length,s=new Uint8Array(4*r);for(let l=0;l<n.length;l++){const h=vi(n[l].value),c=4*l;s[c]=h[0],s[c+1]=h[1],s[c+2]=h[2],s[c+3]=255*h[3]}e.paletteTextures||(e.paletteTextures=[]);const o=`${Ng}[${e.paletteTextures.length}]`,a=new xy(o,s);return e.paletteTextures.push(a),`texture2D(${o}, vec2((${Dg(i,j,e)} + 0.5) / ${r}.0, 0.5))`}};function Dg(e,t,i){if(e instanceof Pg){const n=KS[e.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(i,e,t)}if((e.type&j)>0)return $n(e.value);if((e.type&je)>0)return e.value.toString();if((e.type&dt)>0)return Ui(e.value.toString());if((e.type&Fe)>0)return xa(e.value);if((e.type&qe)>0)return qh(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${tt(t)})`)}function HS(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Zr=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,Vs={"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"};class Hh{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${$n(Vs["circle-radius"])} + ${$n(.5*Vs["circle-stroke-width"])})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=xa(Vs["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=$n(Vs["stroke-width"]),this.strokeColorExpression_=xa(Vs["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Ui("round"),this.strokeJoinExpression_=Ui("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=xa(Vs["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,i,n){return this.varyings_.push({name:t,type:i,expression:n}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > 0.985 || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * lineWidth * 0.5;
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > 0.985) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Ui("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Ui("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Ui("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Ui("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0., -1., distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Zr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}function Dy(e,t){return t===2?e:e.filter((i,n)=>n%t<2)}var kg=class{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let i=0;i<e.length;i++)this.addFeature(e[i],t)}addFeature(e,t){let i=e.getGeometry();i&&(t&&(i=i.clone(),i.applyTransform(t)),this.addGeometry_(i,e))}clearFeatureEntryInPointBatch_(e){const t=this.pointBatch.entries[k(e)];if(t)return this.pointBatch.geometriesCount-=t.flatCoordss.length,delete this.pointBatch.entries[k(e)],t}clearFeatureEntryInLineStringBatch_(e){const t=this.lineStringBatch.entries[k(e)];if(t)return this.lineStringBatch.verticesCount-=t.verticesCount,this.lineStringBatch.geometriesCount-=t.flatCoordss.length,delete this.lineStringBatch.entries[k(e)],t}clearFeatureEntryInPolygonBatch_(e){const t=this.polygonBatch.entries[k(e)];if(t)return this.polygonBatch.verticesCount-=t.verticesCount,this.polygonBatch.ringsCount-=t.ringsCount,this.polygonBatch.geometriesCount-=t.flatCoordss.length,delete this.polygonBatch.entries[k(e)],t}addGeometry_(e,t){const i=e.getType();switch(i){case"GeometryCollection":{const n=e.getGeometriesArray();for(const r of n)this.addGeometry_(r,t);break}case"MultiPolygon":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),n.getEndss(),t,k(t),n.getStride());break}case"MultiLineString":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),n.getEnds(),t,k(t),n.getStride());break}case"MultiPoint":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),null,t,k(t),n.getStride());break}case"Polygon":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),n.getEnds(),t,k(t),n.getStride());break}case"Point":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),null,t,k(t),n.getStride());break}case"LineString":case"LinearRing":{const n=e;this.addCoordinates_(i,n.getFlatCoordinates(),null,t,k(t),n.getStride());break}}}addCoordinates_(e,t,i,n,r,s){let o;switch(e){case"MultiPolygon":{const a=i;for(let l=0,h=a.length;l<h;l++){let c=a[l];const u=l>0?a[l-1]:null,g=u?u[u.length-1]:0,f=c[c.length-1];c=g>0?c.map(p=>p-g):c,this.addCoordinates_("Polygon",t.slice(g,f),c,n,r,s)}break}case"MultiLineString":{const a=i;for(let l=0,h=a.length;l<h;l++){const c=l>0?a[l-1]:0;this.addCoordinates_("LineString",t.slice(c,a[l]),null,n,r,s)}break}case"MultiPoint":for(let a=0,l=t.length;a<l;a+=s)this.addCoordinates_("Point",t.slice(a,a+2),null,n,r,null);break;case"Polygon":{const a=i;if(n instanceof $t){const c=No(t,a);if(c.length>1)return void this.addCoordinates_("MultiPolygon",t,c,n,r,s)}this.polygonBatch.entries[r]||(this.polygonBatch.entries[r]=this.addRefToEntry_(r,{feature:n,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),o=t.length/s;const l=i.length,h=i.map((c,u,g)=>u>0?(c-g[u-1])/s:c/s);this.polygonBatch.verticesCount+=o,this.polygonBatch.ringsCount+=l,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[r].flatCoordss.push(Dy(t,s)),this.polygonBatch.entries[r].ringsVerticesCounts.push(h),this.polygonBatch.entries[r].verticesCount+=o,this.polygonBatch.entries[r].ringsCount+=l;for(let c=0,u=a.length;c<u;c++){const g=c>0?a[c-1]:0;this.addCoordinates_("LinearRing",t.slice(g,a[c]),null,n,r,s)}break}case"Point":this.pointBatch.entries[r]||(this.pointBatch.entries[r]=this.addRefToEntry_(r,{feature:n,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[r].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[r]||(this.lineStringBatch.entries[r]=this.addRefToEntry_(r,{feature:n,flatCoordss:[],verticesCount:0})),o=t.length/s,this.lineStringBatch.verticesCount+=o,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[r].flatCoordss.push(Dy(t,s)),this.lineStringBatch.entries[r].verticesCount+=o}}addRefToEntry_(e,t){const i=this.uidToRef_.get(e),n=i||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=n,i||(this.refToFeature_.set(n,t.feature),this.uidToRef_.set(e,n)),t}returnRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e){this.removeFeature(e);const t=e.getGeometry();t&&this.addGeometry_(t,e)}removeFeature(e){let t;t=this.clearFeatureEntryInPointBatch_(e)||t,t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.returnRef_(t.ref,k(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}},ky=class extends yg{constructor(e,t){super(e),this.batch_=new kg,this.styleRenderers_=t,this.buffers=[],this.maskVertices=new hn(Ur,Bs),this.setTile(e.tile)}generateMaskBuffer_(){const e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper_.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();const e=this.tile.getSourceTiles(),t=e.reduce((r,s)=>r.concat(s.getFeatures()),[]);this.batch_.addFeatures(t);const i=cs([1,0,0,1,0,0],-e[0].extent[0],-e[0].extent[1]),n=this.styleRenderers_.map((r,s)=>r.generateBuffers(this.batch_,i).then(o=>{this.buffers[s]=o}));Promise.all(n).then(()=>{this.setReady()})}};function te(e,t,i){const n=Zh();return n.style=e.style,Ny(t,i,n,e)}function Gg(e){const t=vi(e);return[256*t[0]+t[1],256*t[2]+Math.round(255*t[3])]}function Gy(e){return e===Fe?2:e===qe?4:1}function jg(e){const t=Gy(e);return t>1?`vec${t}`:"float"}function wa(e){return(JSON.stringify(e).split("").reduce((t,i)=>(t<<5)-t+i.charCodeAt(0),0)>>>0).toString()}function Bg(e,t,i,n){let r;if(`${n}radius`in e&&n!=="icon-"?r=te(i,e[`${n}radius`],j):`${n}radius1`in e&&n==="shape-"&&(r=te(i,e[`${n}radius1`],j)),r!==void 0&&(`${n}stroke-width`in e&&(r=`(${r} + ${te(i,e[`${n}stroke-width`],j)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${r} * 2. + 0.5)`)),`${n}scale`in e){const s=te(i,e[`${n}scale`],j|qe);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${s}`)}`${n}displacement`in e&&t.setSymbolOffsetExpression(te(i,e[`${n}displacement`],qe)),`${n}rotation`in e&&t.setSymbolRotationExpression(te(i,e[`${n}rotation`],j)),`${n}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${n}rotate-with-view`])}function jy(e,t,i,n,r){let s="vec4(0.)";t!==null&&(s=t),i!==null&&n!==null&&(s=`mix(${i}, ${s}, ${`smoothstep(-${n} + 0.63, -${n} - 0.58, ${e})`})`);let o=`${s} * ${`(1.0 - smoothstep(-0.63, 0.58, ${e}))`}`;return r!==null&&(o=`${o} * ${r}`),o}function Ug(e,t,i,n,r){const s=new Image;let o;return s.crossOrigin=e[`${n}cross-origin`]===void 0?"anonymous":e[`${n}cross-origin`],s.src=e[`${n}src`],s.complete&&s.width&&s.height?o=qh([s.width,s.height]):(i[`u_texture${r}_size`]=()=>s.complete?[s.width,s.height]:[0,0],t.addUniform(`vec2 u_texture${r}_size`),o=`u_texture${r}_size`),i[`u_texture${r}`]=s,t.addUniform(`sampler2D u_texture${r}`),o}function zg(e,t,i,n,r){let s=te(i,e[`${t}offset`],qe);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${r} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${r} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${r} - ${s}`}return s}function Jh(e){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:e},i={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:e},n=new Hh,r={};if("icon-src"in e?function(o,a,l,h,c){let u="vec4(1.0)";"icon-color"in o&&(u=te(c,o["icon-color"],Fe)),"icon-opacity"in o&&(u=`${u} * ${te(c,o["icon-opacity"],j)}`);const g=wa(o["icon-src"]),f=Ug(o,a,l,"icon-",g);if(a.setSymbolColorExpression(`${u} * samplePremultiplied(u_texture${g}, v_texCoord)`).setSymbolSizeExpression(f),"icon-width"in o&&"icon-height"in o&&a.setSymbolSizeExpression(`vec2(${te(h,o["icon-width"],j)}, ${te(h,o["icon-height"],j)})`),"icon-offset"in o&&"icon-size"in o){const p=te(h,o["icon-size"],qe),m=a.getSymbolSizeExpression();a.setSymbolSizeExpression(p);const _=zg(o,"icon-",h,"v_quadSizePx",p);a.setTextureCoordinateExpression(`(vec4((${_}).xyxy) + vec4(0., 0., ${p})) / (${m}).xyxy`)}if(Bg(o,a,h,"icon-"),"icon-anchor"in o){const p=te(h,o["icon-anchor"],qe);let m,_="1.0";"icon-scale"in o&&(_=te(h,o["icon-scale"],j|qe)),m=o["icon-anchor-x-units"]==="pixels"&&o["icon-anchor-y-units"]==="pixels"?`${p} * ${_}`:o["icon-anchor-x-units"]==="pixels"?`${p} * vec2(vec2(${_}).x, v_quadSizePx.y)`:o["icon-anchor-y-units"]==="pixels"?`${p} * vec2(v_quadSizePx.x, vec2(${_}).x)`:`${p} * v_quadSizePx`;let x=`v_quadSizePx * vec2(0.5, -0.5) + ${m} * vec2(-1., 1.)`;if("icon-anchor-origin"in o)switch(o["icon-anchor-origin"]){case"top-right":x=`v_quadSizePx * -0.5 + ${m}`;break;case"bottom-left":x=`v_quadSizePx * 0.5 - ${m}`;break;case"bottom-right":x=`v_quadSizePx * vec2(-0.5, 0.5) + ${m} * vec2(1., -1.)`}a.setSymbolOffsetExpression(`${a.getSymbolOffsetExpression()} + ${x}`)}}(e,n,r,t,i):"shape-points"in e?function(o,a,l,h,c){c.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,c.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radiusIn, float radiusOut, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radiusOut, 0.);
  vec2 edgeNormal = vec2(radiusIn * sin(alpha * 0.5), -radiusIn * cos(alpha * 0.5) + radiusOut);
  return dot(normalize(edgeNormal), tipToPoint);
}`,c.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Bg(o,a,h,"shape-");let u=null;"shape-opacity"in o&&(u=te(c,o["shape-opacity"],j));let g="coordsPx";"shape-scale"in o&&(g=`coordsPx / ${te(c,o["shape-scale"],j|qe)}`);let f=null;"shape-fill-color"in o&&(f=te(c,o["shape-fill-color"],Fe));let p=null;"shape-stroke-color"in o&&(p=te(c,o["shape-stroke-color"],Fe));let m=null;"shape-stroke-width"in o&&(m=te(c,o["shape-stroke-width"],j));const _=te(c,o["shape-points"],j);let x,y="0.";if("shape-angle"in o&&(y=te(c,o["shape-angle"],j)),"shape-radius"in o){let w=te(c,o["shape-radius"],j);m!==null&&(w=`${w} + ${m} * 0.5`),x=`regularDistanceField(${g}, ${_}, ${w}, ${y})`}else{let w=te(c,o["shape-radius1"],j),S=te(c,o["shape-radius2"],j);m!==null&&(w=`${w} + ${m} * 0.5`,S=`${S} + ${m} * 0.5`),x=`starDistanceField(${g}, ${_}, ${S}, ${w}, ${y})`}const v=jy(x,f,p,m,u);a.setSymbolColorExpression(v)}(e,n,0,t,i):"circle-radius"in e&&function(o,a,l,h,c){c.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Bg(o,a,h,"circle-");let u=null;"circle-opacity"in o&&(u=te(c,o["circle-opacity"],j));let g="coordsPx";"circle-scale"in o&&(g=`coordsPx / ${te(c,o["circle-scale"],j|qe)}`);let f=null;"circle-fill-color"in o&&(f=te(c,o["circle-fill-color"],Fe));let p=null;"circle-stroke-color"in o&&(p=te(c,o["circle-stroke-color"],Fe));let m=te(c,o["circle-radius"],j),_=null;"circle-stroke-width"in o&&(_=te(c,o["circle-stroke-width"],j),m=`(${m} + ${_} * 0.5)`);const x=jy(`circleDistanceField(${g}, ${m})`,f,p,_,u);a.setSymbolColorExpression(x)}(e,n,0,t,i),function(o,a,l,h,c){if("stroke-color"in o&&a.setStrokeColorExpression(te(c,o["stroke-color"],Fe)),"stroke-pattern-src"in o){const u=wa(o["stroke-pattern-src"]),g=Ug(o,a,l,"stroke-pattern-",u);let f=g,p="vec2(0.)";"stroke-pattern-offset"in o&&"stroke-pattern-size"in o&&(f=te(c,o["stroke-pattern-size"],qe),p=zg(o,"stroke-pattern-",c,g,f));let m="0.";"stroke-pattern-spacing"in o&&(m=te(c,o["stroke-pattern-spacing"],j)),c.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio) {
      float currentLengthScaled = currentLengthPx * sampleSize.y / v_width;
      float spacingScaled = spacingPx * sampleSize.y / v_width;
      float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
      float vCoordPx = (currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
      vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
      return uCoordPx > sampleSize.x ? vec4(0.) : samplePremultiplied(texture, texCoord);
    }`;const _=`u_texture${u}`;let x="1.";"stroke-color"in o&&(x=a.getStrokeColorExpression()),a.setStrokeColorExpression(`${x} * sampleStrokePattern(${_}, ${g}, ${p}, ${f}, ${m}, currentLengthPx, currentRadiusRatio)`)}if("stroke-width"in o&&a.setStrokeWidthExpression(te(h,o["stroke-width"],j)),"stroke-offset"in o&&a.setStrokeOffsetExpression(te(h,o["stroke-offset"],j)),"stroke-line-cap"in o&&a.setStrokeCapExpression(te(h,o["stroke-line-cap"],dt)),"stroke-line-join"in o&&a.setStrokeJoinExpression(te(h,o["stroke-line-join"],dt)),"stroke-miter-limit"in o&&a.setStrokeMiterLimitExpression(te(h,o["stroke-miter-limit"],j)),"stroke-line-dash"in o){c.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Ui("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Ui("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let u=o["stroke-line-dash"].map(y=>te(c,y,j));u.length%2==1&&(u=[...u,...u]);let g="0.";"stroke-line-dash-offset"in o&&(g=te(h,o["stroke-line-dash-offset"],j));const f=`dashDistanceField_${wa(o["stroke-line-dash"])}`,p=u.map((y,v)=>`float dashLength${v} = ${y};`),m=u.map((y,v)=>`dashLength${v}`).join(" + ");let _="0.",x=`getSingleDashDistance(distance, radius, ${_}, dashLength0, totalDashLength, capType)`;for(let y=2;y<u.length;y+=2)_=`${_} + dashLength${y-2} + dashLength${y-1}`,x=`min(${x}, getSingleDashDistance(distance, radius, ${_}, dashLength${y}, totalDashLength, capType))`;c.functions[f]=`float ${f}(float distance, float radius, float capType) {
  ${p.join(`
  `)}
  float totalDashLength = ${m};
  return ${x};
}`,a.setStrokeDistanceFieldExpression(`${f}(currentLengthPx + ${g}, currentRadiusPx, capType)`)}}(e,n,r,t,i),function(o,a,l,h,c){if("fill-color"in o&&a.setFillColorExpression(te(c,o["fill-color"],Fe)),"fill-pattern-src"in o){const u=wa(o["fill-pattern-src"]),g=Ug(o,a,l,"fill-pattern-",u);let f=g,p="vec2(0.)";"fill-pattern-offset"in o&&"fill-pattern-size"in o&&(f=te(c,o["fill-pattern-size"],qe),p=zg(o,"fill-pattern-",c,g,f)),c.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 samplePos = mod((pxPosition - pxOrigin) / scaleRatio, sampleSize);
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const m=`u_texture${u}`;let _="1.";"fill-color"in o&&(_=a.getFillColorExpression()),a.setFillColorExpression(`${_} * sampleFillPattern(${m}, ${g}, ${p}, ${f}, pxOrigin, pxPos)`)}}(e,n,r,0,i),e.filter){const o=te(i,e.filter,je);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(i.variables).forEach(function(o){const a=i.variables[o],l=Kh(a.name);let h;n.addUniform(`${jg(a.type)} ${l}`),h=a.type===dt?()=>va(e.variables[a.name]):a.type===Fe?()=>Gg([...vi(e.variables[a.name]||"#eee")]):a.type===je?()=>e.variables[a.name]?1:0:()=>e.variables[a.name],r[l]=h}),Object.keys(i.properties).forEach(function(o){const a=i.properties[o];t.properties[o]||(t.properties[o]=a);let l=jg(a.type),h=`a_prop_${a.name}`;a.type===Fe&&(l="vec4",h=`unpackColor(${h})`,n.addVertexShaderFunction(`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`)),n.addVarying(`v_prop_${a.name}`,l,h)}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];n.addAttribute(`${jg(a.type)} a_prop_${a.name}`)});const s=Object.keys(t.properties).map(function(o){const a=t.properties[o];let l;return l=a.evaluator?a.evaluator:a.type===dt?h=>va(h.get(a.name)):a.type===Fe?h=>Gg([...vi(h.get(a.name)||"#eee")]):a.type===je?h=>h.get(a.name)?1:0:h=>h.get(a.name),{name:a.name,size:Gy(a.type),callback:l}});for(const o in t.functions)n.addVertexShaderFunction(t.functions[o]);for(const o in i.functions)n.addFragmentShaderFunction(i.functions[o]);return{builder:n,attributes:s.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:r}}class Xg{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Ge(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Xg({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return q()}getImage(t){return q()}getHitDetectionImage(){return q()}getPixelRatio(t){return 1}getImageState(){return q()}getImageSize(){return q()}getOrigin(){return q()}getSize(){return q()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ge(t)}listenImageChange(t){q()}load(){q()}unlistenImageChange(t){q()}}var Vg=Xg;class Wg extends Vg{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0&&t.rotateWithView,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.render()}clone(){const t=this.getScale(),i=new Wg({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}getAnchor(){const t=this.size_,i=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-i[0]/n[0],t[1]/2+i[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let i=this.canvases_[t];if(!i){const n=this.renderOptions_,r=ke(n.size*t,n.size*t);this.draw_(n,r,t),i=r.canvas,this.canvases_[t]=i}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return Ze}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,i,n){if(i===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return i;let r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const y=r;r=s,s=y}const o=this.radius2_===void 0?this.points_:2*this.points_,a=2*Math.PI/o,l=s*Math.sin(a),h=r-Math.sqrt(s*s-l*l),c=Math.sqrt(l*l+h*h),u=c/l;if(t==="miter"&&u<=n)return u*i;const g=i/2/u,f=i/2*(h/c),p=Math.sqrt((r+g)*(r+g)+f*f)-r;if(this.radius2_===void 0||t==="bevel")return 2*p;const m=r*Math.sin(a),_=s-Math.sqrt(r*r-m*m),x=Math.sqrt(m*m+_*_)/m;if(x<=n){const y=x*i/2-s-r;return 2*Math.max(p,y)}return 2*p}createRenderOptions(){let t,i=Pr,n=Fr,r=0,s=null,o=0,a=0;this.stroke_&&(t=Ti(this.stroke_.getColor()??bs),a=this.stroke_.getWidth()??1,s=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,n=this.stroke_.getLineJoin()??Fr,i=this.stroke_.getLineCap()??Pr,r=this.stroke_.getMiterLimit()??Cs);const l=this.calculateLineJoinSize_(n,a,r),h=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:a,size:Math.ceil(2*h+l),lineCap:i,lineDash:s,lineDashOffset:o,lineJoin:n,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,i,n){if(i.scale(n,n),i.translate(t.size/2,t.size/2),this.createPath_(i),this.fill_){let r=this.fill_.getColor();r===null&&(r=St),i.fillStyle=Ti(r),i.fill()}t.strokeStyle&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineCap=t.lineCap,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}createHitDetectionCanvas_(t){let i;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=vi(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(i=ke(t.size,t.size),this.drawHitDetectionCanvas_(t,i))}return i?i.canvas:this.getImage(1)}createPath_(t){let i=this.points_;const n=this.radius_;if(i===1/0)t.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(i*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/i;for(let a=0;a<i;a++){const l=s+a*o,h=a%2==0?n:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,i){i.translate(t.size/2,t.size/2),this.createPath_(i),i.fillStyle=St,i.fill(),t.strokeStyle&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}}var Zg=Wg;class $g extends Zg{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0&&t.rotateWithView,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),i=new $g({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}setRadius(t){this.radius_=t,this.render()}}var Qh=$g;class Yg{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new Yg({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var bi=Yg;let Sa=null;class By extends lr{constructor(t,i,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?wt:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=i,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ze){Sa||(Sa=ke(1,1,void 0,{willReadFrequently:!0})),Sa.drawImage(this.image_,0,0);try{Sa.getImageData(0,0,1,1),this.tainted_=!1}catch{Sa=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(he)}handleImageError_(){this.imageState_=tn,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ze,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],i=this.size_[1],n=ke(t,i);n.fillRect(0,0,t,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===wt){this.image_||this.initializeImage_(),this.imageState_=en;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Gu(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Ze)return;const i=this.image_,n=document.createElement("canvas");n.width=Math.ceil(i.width*t),n.height=Math.ceil(i.height*t);const r=n.getContext("2d");r.scale(t,t),r.drawImage(i,0,0),r.globalCompositeOperation="multiply",r.fillStyle=zu(this.color_),r.fillRect(0,0,n.width/t,n.height/t),r.globalCompositeOperation="destination-in",r.drawImage(i,0,0),this.canvas_[t]=n}}function Uy(e,t,i,n,r){let s=t===void 0?void 0:Bo.get(t,i,r);return s||(s=new By(e,e instanceof HTMLImageElement?e.src||void 0:t,i,n,r),Bo.set(t,i,r,s)),s}var JS=By;function zy(e,t,i,n){return i!==void 0&&n!==void 0?[i/e,n/t]:i!==void 0?i/e:n!==void 0?n/t:1}class qg extends Vg{constructor(t){const i=(t=t||{}).opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0&&t.rotateWithView;super({opacity:i,rotation:n,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a,l=t.src;if(ie(!(l!==void 0&&o),"`image` and `src` cannot be provided at the same time"),l!==void 0&&l.length!==0||!o||(l=o.src||k(o)),ie(l!==void 0&&l.length>0,"A defined and non-empty `src` or `image` must be provided"),ie(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`"),t.src!==void 0?a=wt:o!==void 0&&(a=o instanceof HTMLImageElement?o.complete?o.src?Ze:wt:en:Ze),this.color_=t.color!==void 0?vi(t.color):null,this.iconImage_=Uy(o,l,this.crossOrigin_,a,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(zy(f[0],f[1],t.width,t.height))};return void this.listenImageChange(g)}}h!==void 0&&this.setScale(zy(h,c,t.width,t.height))}}clone(){let t,i,n;return this.initialOptions_?(i=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new qg({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:i,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!="top-right"&&this.anchorOrigin_!="bottom-right"||(t[0]=-t[0]+r[0]),this.anchorOrigin_!="bottom-left"&&this.anchorOrigin_!="bottom-right"||(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const i=this.getDisplacement(),n=this.getScaleArray();return[t[0]-i[0]/n[0],t[1]+i[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),n=this.iconImage_.getSize();if(!i||!n)return null;t=t.slice(),this.offsetOrigin_!="top-right"&&this.offsetOrigin_!="bottom-right"||(t[0]=n[0]-i[0]-t[0]),this.offsetOrigin_!="bottom-left"&&this.offsetOrigin_!="bottom-right"||(t[1]=n[1]-i[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==Ze?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==Ze?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(he,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(he,t)}}var Ea=qg;class Kg{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Kg({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var li=Kg;class Yn{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Wy,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Yn({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(i){return i.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Wy,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Xy(e){let t;if(typeof e=="function")t=e;else{let i;Array.isArray(e)?i=e:(ie(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),i=[e]),t=function(){return i}}return t}let Hg=null;function Vy(e,t){if(!Hg){const i=new bi({color:"rgba(255,255,255,0.4)"}),n=new li({color:"#3399CC",width:1.25});Hg=[new Yn({image:new Qh({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return Hg}function Ws(){const e={},t=[255,255,255,1],i=[0,153,255,1];return e.Polygon=[new Yn({fill:new bi({color:[255,255,255,.5]})})],e.MultiPolygon=e.Polygon,e.LineString=[new Yn({stroke:new li({color:t,width:5})}),new Yn({stroke:new li({color:i,width:3})})],e.MultiLineString=e.LineString,e.Circle=e.Polygon.concat(e.LineString),e.Point=[new Yn({image:new Qh({radius:6,fill:new bi({color:i}),stroke:new li({color:t,width:1.5})}),zIndex:1/0})],e.MultiPoint=e.Point,e.GeometryCollection=e.Polygon.concat(e.LineString,e.Point),e}function Wy(e){return e.getGeometry()}var Nt=Yn;class Jg{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Ge(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new bi({color:"#333"}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new Jg({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ge(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}var Zs=Jg,QS=class{constructor(e){this.first_,this.last_,this.head_,this.circular_=e===void 0||e,this.length_=0}insertItem(e){const t={prev:void 0,next:void 0,data:e},i=this.head_;if(i){const n=i.next;t.prev=i,t.next=n,i.next=t,n&&(n.prev=t),i===this.last_&&(this.last_=t)}else this.first_=t,this.last_=t,this.circular_&&(t.next=t,t.prev=t);this.head_=t,this.length_++}removeItem(){const e=this.head_;if(e){const t=e.next,i=e.prev;t&&(t.prev=i),i&&(i.next=t),this.head_=t||i,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=i?this.head_.prev:this.head_),this.length_--}}firstItem(){if(this.head_=this.first_,this.head_)return this.head_.data}lastItem(){if(this.head_=this.last_,this.head_)return this.head_.data}nextItem(){if(this.head_&&this.head_.next)return this.head_=this.head_.next,this.head_.data}getNextItem(){if(this.head_&&this.head_.next)return this.head_.next.data}prevItem(){if(this.head_&&this.head_.prev)return this.head_=this.head_.prev,this.head_.data}getPrevItem(){if(this.head_&&this.head_.prev)return this.head_.prev.data}getCurrItem(){if(this.head_)return this.head_.data}setFirstItem(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)}concat(e){if(e.head_){if(this.head_){const t=this.head_.next;this.head_.next=e.first_,e.first_.prev=this.head_,t.prev=e.last_,e.last_.next=t,this.length_+=e.length_}else this.head_=e.head_,this.first_=e.first_,this.last_=e.last_,this.length_=e.length_;e.head_=void 0,e.first_=void 0,e.last_=void 0,e.length_=0}}getLength(){return this.length_}};function eE(){return{variables:{},properties:{},resolution:NaN,featureId:null}}function dn(e,t,i){const n=Te(e,i);if(!ai(t,n.type)){const r=tt(t),s=tt(n.type);throw new Error(`Expected expression to be of type ${r}, got ${s}`)}return gn(n)}function gn(e,t){if(e instanceof un){if(e.type===Fe&&typeof e.value=="string"){const n=Xl(e.value);return function(){return n}}return function(){return e.value}}const i=e.operator;switch(i){case F.Number:case F.String:return function(n,r){const s=n.operator,o=n.args.length,a=new Array(o);for(let l=0;l<o;++l)a[l]=gn(n.args[l]);switch(s){case F.Number:case F.String:return l=>{for(let h=0;h<o;++h){const c=a[h](l);if(typeof c===s)return c}throw new Error(`Expected one of the values to be a ${s}`)};default:throw new Error(`Unsupported assertion operator ${s}`)}}(e);case F.Get:case F.Var:return function(n,r){const s=n.args[0],o=s.value;switch(n.operator){case F.Get:return a=>a.properties[o];case F.Var:return a=>a.variables[o];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}(e);case F.Id:return n=>n.featureId;case F.Concat:{const n=e.args.map(r=>gn(r));return r=>"".concat(...n.map(s=>s(r).toString()))}case F.Resolution:return n=>n.resolution;case F.Any:case F.All:case F.Not:return function(n,r){const s=n.operator,o=n.args.length,a=new Array(o);for(let l=0;l<o;++l)a[l]=gn(n.args[l]);switch(s){case F.Any:return l=>{for(let h=0;h<o;++h)if(a[h](l))return!0;return!1};case F.All:return l=>{for(let h=0;h<o;++h)if(!a[h](l))return!1;return!0};case F.Not:return l=>!a[0](l);default:throw new Error(`Unsupported logical operator ${s}`)}}(e);case F.Equal:case F.NotEqual:case F.LessThan:case F.LessThanOrEqualTo:case F.GreaterThan:case F.GreaterThanOrEqualTo:return function(n,r){const s=n.operator,o=gn(n.args[0]),a=gn(n.args[1]);switch(s){case F.Equal:return l=>o(l)===a(l);case F.NotEqual:return l=>o(l)!==a(l);case F.LessThan:return l=>o(l)<a(l);case F.LessThanOrEqualTo:return l=>o(l)<=a(l);case F.GreaterThan:return l=>o(l)>a(l);case F.GreaterThanOrEqualTo:return l=>o(l)>=a(l);default:throw new Error(`Unsupported comparison operator ${s}`)}}(e);case F.Multiply:case F.Divide:case F.Add:case F.Subtract:case F.Clamp:case F.Mod:case F.Pow:case F.Abs:case F.Floor:case F.Ceil:case F.Round:case F.Sin:case F.Cos:case F.Atan:case F.Sqrt:return function(n,r){const s=n.operator,o=n.args.length,a=new Array(o);for(let l=0;l<o;++l)a[l]=gn(n.args[l]);switch(s){case F.Multiply:return l=>{let h=1;for(let c=0;c<o;++c)h*=a[c](l);return h};case F.Divide:return l=>a[0](l)/a[1](l);case F.Add:return l=>{let h=0;for(let c=0;c<o;++c)h+=a[c](l);return h};case F.Subtract:return l=>a[0](l)-a[1](l);case F.Clamp:return l=>{const h=a[0](l),c=a[1](l);if(h<c)return c;const u=a[2](l);return h>u?u:h};case F.Mod:return l=>a[0](l)%a[1](l);case F.Pow:return l=>Math.pow(a[0](l),a[1](l));case F.Abs:return l=>Math.abs(a[0](l));case F.Floor:return l=>Math.floor(a[0](l));case F.Ceil:return l=>Math.ceil(a[0](l));case F.Round:return l=>Math.round(a[0](l));case F.Sin:return l=>Math.sin(a[0](l));case F.Cos:return l=>Math.cos(a[0](l));case F.Atan:return o===2?l=>Math.atan2(a[0](l),a[1](l)):l=>Math.atan(a[0](l));case F.Sqrt:return l=>Math.sqrt(a[0](l));default:throw new Error(`Unsupported numeric operator ${s}`)}}(e);case F.Match:return function(n,r){const s=n.args.length,o=new Array(s);for(let a=0;a<s;++a)o[a]=gn(n.args[a]);return a=>{const l=o[0](a);for(let h=1;h<s;h+=2)if(l===o[h](a))return o[h+1](a);return o[s-1](a)}}(e);case F.Interpolate:return function(n,r){const s=n.args.length,o=new Array(s);for(let a=0;a<s;++a)o[a]=gn(n.args[a]);return a=>{const l=o[0](a),h=o[1](a);let c,u;for(let g=2;g<s;g+=2){const f=o[g](a);let p=o[g+1](a);const m=Array.isArray(p);if(m&&(p=qm(p)),f>=h)return g===2?p:m?tE(l,h,c,u,f,p):Ta(l,h,c,u,f,p);c=f,u=p}return u}}(e);default:throw new Error(`Unsupported operator ${i}`)}}function Ta(e,t,i,n,r,s){const o=r-i;if(o===0)return n;const a=t-i;return n+(e===1?a/o:(Math.pow(e,a)-1)/(Math.pow(e,o)-1))*(s-n)}function tE(e,t,i,n,r,s){if(r-i===0)return n;const o=Vu(n),a=Vu(s);let l=a[2]-o[2];return l>180?l-=360:l<-180&&(l+=360),Wu(Km([Ta(e,t,i,o[0],r,a[0]),Ta(e,t,i,o[1],r,a[1]),o[2]+Ta(e,t,i,0,r,l),Ta(e,t,i,n[3],r,s[3])]))}function iE(e){return!0}function Zy(e){const t=Zh(),i=$y(e,t),n={variables:{},properties:{},resolution:NaN,featureId:null};return function(r,s){if(n.properties=r.getPropertiesInternal(),n.resolution=s,t.featureId){const o=r.getId();n.featureId=o!==void 0?o:null}return i(n)}}function Qg(e){const t=Zh(),i=e.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=ec(e[o],t);const r={variables:{},properties:{},resolution:NaN,featureId:null},s=new Array(i);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,t.featureId){const h=o.getId();r.featureId=h!==void 0?h:null}let l=0;for(let h=0;h<i;++h){const c=n[h](r);c&&(s[l]=c,l+=1)}return s.length=l,s}}function $y(e,t){const i=e.length,n=new Array(i);for(let r=0;r<i;++r){const s=e[r],o="filter"in s?dn(s.filter,je,t):iE;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=ec(s.style[h],t)}else a=[ec(s.style,t)];n[r]={filter:o,styles:a}}return function(r){const s=[];let o=!1;for(let a=0;a<i;++a)if((0,n[a].filter)(r)&&(!e[a].else||!o)){o=!0;for(const l of n[a].styles){const h=l(r);h&&s.push(h)}}return s}}function ec(e,t){const i=Ca(e,"",t),n=ba(e,"",t),r=function(l,h){const c="text-",u=qn(l,c+"value",h);if(!u)return null;const g=Ca(l,c,h),f=Ca(l,c+"background-",h),p=ba(l,c,h),m=ba(l,c+"background-",h),_=qn(l,c+"font",h),x=Dt(l,c+"max-angle",h),y=Dt(l,c+"offset-x",h),v=Dt(l,c+"offset-y",h),w=Ra(l,c+"overflow",h),S=qn(l,c+"placement",h),C=Dt(l,c+"repeat",h),E=ic(l,c+"scale",h),R=Ra(l,c+"rotate-with-view",h),P=Dt(l,c+"rotation",h),I=qn(l,c+"align",h),A=qn(l,c+"justify",h),G=qn(l,c+"baseline",h),B=qy(l,c+"padding",h),z=new Zs({});return function(N){if(z.setText(u(N)),g&&z.setFill(g(N)),f&&z.setBackgroundFill(f(N)),p&&z.setStroke(p(N)),m&&z.setBackgroundStroke(m(N)),_&&z.setFont(_(N)),x&&z.setMaxAngle(x(N)),y&&z.setOffsetX(y(N)),v&&z.setOffsetY(v(N)),w&&z.setOverflow(w(N)),S){const M=S(N);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");z.setPlacement(M)}if(C&&z.setRepeat(C(N)),E&&z.setScale(E(N)),R&&z.setRotateWithView(R(N)),P&&z.setRotation(P(N)),I){const M=I(N);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");z.setTextAlign(M)}if(A){const M=A(N);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");z.setJustify(M)}if(G){const M=G(N);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");z.setTextBaseline(M)}return B&&z.setPadding(B(N)),z}}(e,t),s=function(l,h){return"icon-src"in l?function(c,u){const g="icon-",f=g+"src",p=Jy(c[f],f),m=tc(c,g+"anchor",u),_=ic(c,g+"scale",u),x=Dt(c,g+"opacity",u),y=tc(c,g+"displacement",u),v=Dt(c,g+"rotation",u),w=Ra(c,g+"rotate-with-view",u),S=Ky(c,g+"anchor-origin"),C=Hy(c,g+"anchor-x-units"),E=Hy(c,g+"anchor-y-units"),R=function(V,se){const oe=V[se];if(oe!==void 0)return ex(oe,se)}(c,g+"color"),P=function(V,se){const oe=V[se];if(oe!==void 0){if(typeof oe!="string")throw new Error(`Expected a string for ${se}`);return oe}}(c,g+"cross-origin"),I=function(V,se){const oe=V[se];if(oe!==void 0)return Pa(oe,se)}(c,g+"offset"),A=Ky(c,g+"offset-origin"),G=$s(c,g+"width"),B=$s(c,g+"height"),z=function(V,se){const oe=V[se];if(oe!==void 0){if(typeof oe=="number")return Ge(oe);if(!Array.isArray(oe))throw new Error(`Expected a number or size array for ${se}`);if(oe.length!==2||typeof oe[0]!="number"||typeof oe[1]!="number")throw new Error(`Expected a number or size array for ${se}`);return oe}}(c,g+"size"),N=ef(c,g+"declutter"),M=new Ea({src:p,anchorOrigin:S,anchorXUnits:C,anchorYUnits:E,color:R,crossOrigin:P,offset:I,offsetOrigin:A,height:B,width:G,size:z,declutterMode:N});return function(V){return x&&M.setOpacity(x(V)),y&&M.setDisplacement(y(V)),v&&M.setRotation(v(V)),w&&M.setRotateWithView(w(V)),_&&M.setScale(_(V)),m&&M.setAnchor(m(V)),M}}(l,h):"shape-points"in l?function(c,u){const g="shape-",f=g+"points",p=Qy(c[f],f),m=Ca(c,g,u),_=ba(c,g,u),x=ic(c,g+"scale",u),y=tc(c,g+"displacement",u),v=Dt(c,g+"rotation",u),w=Ra(c,g+"rotate-with-view",u),S=$s(c,g+"radius"),C=$s(c,g+"radius1"),E=$s(c,g+"radius2"),R=$s(c,g+"angle"),P=ef(c,g+"declutter-mode"),I=new Zg({points:p,radius:S,radius1:C,radius2:E,angle:R,declutterMode:P});return function(A){return m&&I.setFill(m(A)),_&&I.setStroke(_(A)),y&&I.setDisplacement(y(A)),v&&I.setRotation(v(A)),w&&I.setRotateWithView(w(A)),x&&I.setScale(x(A)),I}}(l,h):"circle-radius"in l?function(c,u){const g="circle-",f=Ca(c,g,u),p=ba(c,g,u),m=Dt(c,g+"radius",u),_=ic(c,g+"scale",u),x=tc(c,g+"displacement",u),y=Dt(c,g+"rotation",u),v=Ra(c,g+"rotate-with-view",u),w=ef(c,g+"declutter-mode"),S=new Qh({radius:5,declutterMode:w});return function(C){return m&&S.setRadius(m(C)),f&&S.setFill(f(C)),p&&S.setStroke(p(C)),x&&S.setDisplacement(x(C)),y&&S.setRotation(y(C)),v&&S.setRotateWithView(v(C)),_&&S.setScale(_(C)),S}}(l,h):null}(e,t),o=Dt(e,"z-index",t);if(!(i||n||r||s||qt(e)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));const a=new Nt;return function(l){let h=!0;if(i){const c=i(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(r){const c=r(l);c&&(h=!1),a.setText(c)}if(s){const c=s(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Ca(e,t,i){const n=Yy(e,t+"fill-color",i);if(!n)return null;const r=new bi;return function(s){const o=n(s);return o==="none"?null:(r.setColor(o),r)}}function ba(e,t,i){const n=Dt(e,t+"stroke-width",i),r=Yy(e,t+"stroke-color",i);if(!n&&!r)return null;const s=qn(e,t+"stroke-line-cap",i),o=qn(e,t+"stroke-line-join",i),a=qy(e,t+"stroke-line-dash",i),l=Dt(e,t+"stroke-line-dash-offset",i),h=Dt(e,t+"stroke-miter-limit",i),c=new li;return function(u){if(r){const g=r(u);if(g==="none")return null;c.setColor(g)}if(n&&c.setWidth(n(u)),s){const g=s(u);if(g!=="butt"&&g!=="round"&&g!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(g)}if(o){const g=o(u);if(g!=="bevel"&&g!=="round"&&g!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(g)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function Dt(e,t,i){if(!(t in e))return;const n=dn(e[t],j,i);return function(r){return Qy(n(r),t)}}function qn(e,t,i){if(!(t in e))return null;const n=dn(e[t],dt,i);return function(r){return Jy(n(r),t)}}function Ra(e,t,i){if(!(t in e))return null;const n=dn(e[t],je,i);return function(r){const s=n(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function Yy(e,t,i){if(!(t in e))return null;const n=dn(e[t],Fe|dt,i);return function(r){return ex(n(r),t)}}function qy(e,t,i){if(!(t in e))return null;const n=dn(e[t],qe,i);return function(r){return Pa(n(r),t)}}function tc(e,t,i){if(!(t in e))return null;const n=dn(e[t],qe,i);return function(r){const s=Pa(n(r),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function ic(e,t,i){if(!(t in e))return null;const n=dn(e[t],qe|j,i);return function(r){return function(s,o){if(typeof s=="number")return s;const a=Pa(s,o);if(a.length!==2)throw new Error(`Expected an array of two numbers for ${o}`);return a}(n(r),t)}}function $s(e,t){const i=e[t];if(i!==void 0){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}}function Ky(e,t){const i=e[t];if(i!==void 0){if(i!=="bottom-left"&&i!=="bottom-right"&&i!=="top-left"&&i!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return i}}function Hy(e,t){const i=e[t];if(i!==void 0){if(i!=="pixels"&&i!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return i}}function ef(e,t){const i=e[t];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);if(i!=="declutter"&&i!=="obstacle"&&i!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return i}}function Pa(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);const i=e.length;for(let n=0;n<i;++n)if(typeof e[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function Jy(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function Qy(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function ex(e,t){if(typeof e=="string")return e;const i=Pa(e,t),n=i.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return i}const tx="renderOrder";var $r=class extends Rr{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0&&e.declutter,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0&&e.updateWhileAnimating,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(tx)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new Vd(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(tx,e)}setStyle(e){this.style_=function(t){if(t===void 0)return Vy;if(!t)return null;if(typeof t=="function"||t instanceof Nt)return t;if(!Array.isArray(t))return Qg([t]);if(t.length===0)return[];const i=t.length,n=t[0];if(n instanceof Nt){const s=new Array(i);for(let o=0;o<i;++o){const a=t[o];if(!(a instanceof Nt))throw new Error("Expected a list of style instances");s[o]=a}return s}if("style"in n){const s=new Array(i);for(let o=0;o<i;++o){const a=t[o];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[o]=a}return Zy(s)}return Qg(t)}(e),this.styleFunction_=e===null?void 0:Xy(this.style_),this.changed()}};const nE="GENERATE_POLYGON_BUFFERS",tf="GENERATE_POINT_BUFFERS",rE="GENERATE_LINE_STRING_BUFFERS";function ix(){const e='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}function nx(e,t){const i=e.viewState.projection,n=t.getSource().getWrapX()&&i.canWrapX(),r=i.getExtent(),s=e.extent,o=n?ne(r):null,a=n?Math.ceil((s[2]-r[2])/o)+1:1;return[n?Math.floor((s[0]-r[0])/o):0,a,o]}var nf=class extends $h{constructor(e,t){const i=t.uniforms||{},n=[1,0,0,1,0,0];i[ji.PROJECTION_MATRIX]=n,super(e,{uniforms:i,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new hn(Ur,ua),this.indicesBuffer_=new hn(zr,ua),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const r=t.attributes?t.attributes.map(function(o){return{name:"a_prop_"+o.name,size:1,type:et.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:et.FLOAT},{name:"a_index",size:1,type:et.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:et.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:et.FLOAT})),this.attributes.push(...r),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=[1/0,1/0,-1/0,-1/0],this.currentTransform_=n,this.renderTransform_=[1,0,0,1,0,0],this.invertRenderTransform_=[1,0,0,1,0,0],this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=ix(),this.worker_.addEventListener("message",o=>{const a=o.data;if(a.type===tf){const l=a.projectionTransform;this.verticesBuffer_.fromArrayBuffer(a.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(a.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=l,Ht(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(o.data.renderInstructions),a.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const s=this.getLayer().getSource();this.sourceListenKeys_=[W(s,Un,this.handleSourceFeatureAdded_,this),W(s,Kd,this.handleSourceFeatureChanged_,this),W(s,Gs,this.handleSourceFeatureDelete_,this),W(s,Hd,this.handleSourceFeatureClear_,this)],s.forEachFeature(o=>{this.featureCache_[k(o)]={feature:o,properties:o.getProperties(),geometry:o.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Bh(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[k(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[k(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[k(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[i,n,r]=nx(e,this.getLayer());return this.renderWorlds(e,!1,i,n,r),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,i,n,r),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),i=t.getSource(),n=e.viewState,r=!e.viewHints[_t]&&!e.viewHints[Ot],s=!It(this.previousExtent_,e.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),r&&(s||o)){const a=n.projection,l=n.resolution,h=t instanceof $r?t.getRenderBuffer():0,c=mt(e.extent,h*l);i.loadFeatures(c,l,a),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=[1,0,0,1,0,0];this.helper.makeProjectionTransform(e,t);const i=Qe(),n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,r=n*this.featureCount_;let s,o;this.renderInstructions_&&this.renderInstructions_.length===r||(this.renderInstructions_=new Float32Array(r));const a=[],l=[];let h=-1;for(const u in this.featureCache_)if(s=this.featureCache_[u],o=s.geometry,o&&o.getType()==="Point"){if(i){const g=Ee(o.getFlatCoordinates(),e.viewState.projection);a[0]=g[0],a[1]=g[1]}else a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1];if(ye(t,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const g=bg(h+5,l);this.renderInstructions_[++h]=g[0],this.renderInstructions_[++h]=g[1],this.renderInstructions_[++h]=g[2],this.renderInstructions_[++h]=g[3],this.renderInstructions_[++h]=Number(u)}for(let g=0;g<this.customAttributes.length;g++){const f=this.customAttributes[g].callback(s.feature,s.properties);this.renderInstructions_[++h]=f}}const c={id:++this.lastSentId,type:tf,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};c.projectionTransform=t,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,i,n,r){if(ie(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const s=ye(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=Rg([o[0]/255,o[1]/255,o[2]/255,o[3]/255]),l=this.renderInstructions_[a],h=Math.floor(l).toString(),c=this.getLayer().getSource().getFeatureByUid(h);return c?n(c,this.getLayer(),null):void 0}renderWorlds(e,t,i,n,r){let s=i;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),cs(this.currentTransform_,s*r,0),Ki(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++s<n)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){fe(e)}),this.sourceListenKeys_=null,super.disposeInternal()}};function rf(e,t,i,n){let r=0;for(const s in t){const o=t[s],a=o.callback.call(i,i.feature);e[n+r++]=a[0]??a,o.size&&o.size!==1&&(e[n+r++]=a[1],o.size<3||(e[n+r++]=a[2],o.size<4||(e[n+r++]=a[3])))}return r}function Fa(e){return Object.keys(e).reduce((t,i)=>t+(e[i].size||1),0)}function rx(e,t,i,n){const r=(2+Fa(i))*e.geometriesCount;t&&t.length===r||(t=new Float32Array(r));const s=[];let o=0;for(const a in e.entries){const l=e.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++)s[0]=l.flatCoordss[h][0],s[1]=l.flatCoordss[h][1],ye(n,s),t[o++]=s[0],t[o++]=s[1],o+=rf(t,i,l,o)}return t}function sx(e,t,i,n){const r=2*e.verticesCount+(1+Fa(i))*e.geometriesCount;t&&t.length===r||(t=new Float32Array(r));const s=[];let o=0;for(const a in e.entries){const l=e.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,_i(l.flatCoordss[h],0,s.length,2,n,s),o+=rf(t,i,l,o),t[o++]=s.length/2;for(let u=0,g=s.length;u<g;u+=2)t[o++]=s[u],t[o++]=s[u+1]}}return t}function ox(e,t,i,n){const r=2*e.verticesCount+(1+Fa(i))*e.geometriesCount+e.ringsCount;t&&t.length===r||(t=new Float32Array(r));const s=[];let o=0;for(const a in e.entries){const l=e.entries[a];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,_i(l.flatCoordss[h],0,s.length,2,n,s),o+=rf(t,i,l,o),t[o++]=l.ringsVerticesCounts[h].length;for(let u=0,g=l.ringsVerticesCounts[h].length;u<g;u++)t[o++]=l.ringsVerticesCounts[h][u];for(let u=0,g=s.length;u<g;u+=2)t[o++]=s[u],t[o++]=s[u+1]}}return t}const sE=[],sf=ix();let oE=0;const ax="a_position",aE="a_index",lE="a_segmentStart",hE="a_segmentEnd",cE="a_parameters",uE="a_joinAngles",dE="a_distance";var of=class{constructor(e,t,i){this.helper_=t,this.hitDetectionEnabled_=i;let n=e;if(!("builder"in e)){const o=Jh(e);n={builder:o.builder,attributes:o.attributes,uniforms:o.uniforms}}this.hasFill_=!!n.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=n.builder.getFillVertexShader(),this.fillFragmentShader_=n.builder.getFillFragmentShader(),this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_=!!n.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=n.builder.getStrokeVertexShader(),this.strokeFragmentShader_=n.builder.getStrokeFragmentShader(),this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_=!!n.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=n.builder.getSymbolVertexShader(),this.symbolFragmentShader_=n.builder.getSymbolFragmentShader(),this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_));const r=this.hitDetectionEnabled_?{hitColor:{callback(){return bg(this.ref,sE)},size:4}}:{};this.customAttributes_=Object.assign({},r,n.attributes),this.uniforms_=n.uniforms;const s=Object.entries(this.customAttributes_).map(([o,a])=>({name:`a_prop_${o}`,size:a.size||1,type:et.FLOAT}));this.polygonAttributesDesc_=[{name:ax,size:2,type:et.FLOAT},...s],this.lineStringAttributesDesc_=[{name:lE,size:2,type:et.FLOAT},{name:hE,size:2,type:et.FLOAT},{name:uE,size:2,type:et.FLOAT},{name:dE,size:1,type:et.FLOAT},{name:cE,size:1,type:et.FLOAT},...s],this.pointAttributesDesc_=[{name:ax,size:2,type:et.FLOAT},{name:aE,size:1,type:et.FLOAT},...s],n.uniforms&&this.helper_.addUniforms(n.uniforms)}async generateBuffers(e,t){const i=this.generateRenderInstructions_(e,t),[n,r,s]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",t),this.generateBuffersForType_(i.lineStringInstructions,"LineString",t),this.generateBuffersForType_(i.pointInstructions,"Point",t)]);return{polygonBuffers:n,lineStringBuffers:r,pointBuffers:s,invertVerticesTransform:Ht([1,0,0,1,0,0],t)}}generateRenderInstructions_(e,t){return{polygonInstructions:this.hasFill_?ox(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,lineStringInstructions:this.hasStroke_?sx(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,pointInstructions:this.hasSymbol_?rx(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null}}generateBuffersForType_(e,t,i){if(e===null)return null;const n=oE++;let r;switch(t){case"Polygon":r=nE;break;case"LineString":r=rE;break;case"Point":r=tf}const s={id:n,type:r,renderInstructions:e.buffer,renderInstructionsTransform:i,customAttributesSize:Fa(this.customAttributes_)};return sf.postMessage(s,[e.buffer]),e=null,new Promise(o=>{const a=l=>{const h=l.data;if(h.id!==n||(sf.removeEventListener("message",a),!this.helper_.getGL()))return;const c=new hn(Ur,ua).fromArrayBuffer(h.vertexBuffer),u=new hn(zr,ua).fromArrayBuffer(h.indexBuffer);this.helper_.flushBufferData(c),this.helper_.flushBufferData(u),o([u,c])};sf.addEventListener("message",a)})}render(e,t,i){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,i),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,i),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,i)}renderInternal_(e,t,i,n,r,s){const o=e.getSize();o!==0&&(this.helper_.useProgram(i,r),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(n),s(),this.helper_.drawElements(0,o))}};const Yr={...ji,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};var gE=class extends $h{constructor(e,t){super(e,{uniforms:{[Yr.RENDER_EXTENT]:[0,0,0,0],[Yr.PATTERN_ORIGIN]:[0,0],[Yr.GLOBAL_ALPHA]:1},postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=[1/0,1/0,-1/0,-1/0],this.currentTransform_=[1,0,0,1,0,0],this.tmpCoords_=[0,0],this.tmpTransform_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.currentFrameStateTransform_=[1,0,0,1,0,0],this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new kg,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),i=Qe();let n;i&&(n=Mt(i,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),n),this.sourceListenKeys_=[W(t,Un,this.handleSourceFeatureAdded_.bind(this,n),this),W(t,Kd,this.handleSourceFeatureChanged_,this),W(t,Gs,this.handleSourceFeatureDelete_,this),W(t,Hd,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new of(e,this.helper,this.hitDetectionEnabled_))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Bh(this.helper))}handleSourceFeatureAdded_(e,t){const i=t.feature;this.batch_.addFeature(i,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){yo(this.tmpTransform_,this.currentFrameStateTransform_),Ki(this.tmpTransform_,e),this.helper.setUniformMatrixValue(Yr.PROJECTION_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),Ht(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Yr.SCREEN_TO_WORLD_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Ht(this.tmpTransform_,e),ye(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Yr.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[i,n,r]=nx(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,i,n,r),this.helper.finalizeDraw(e);const s=this.helper.getCanvas(),o=e.layerStatesArray[e.layerIndex].opacity;return o!==parseFloat(s.style.opacity)&&(s.style.opacity=String(o)),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,i,n,r),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),s}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),i=t.getSource(),n=e.viewState,r=!e.viewHints[_t]&&!e.viewHints[Ot],s=!It(this.previousExtent_,e.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),r&&(s||o)){const a=n.projection,l=n.resolution,h=t instanceof $r?t.getRenderBuffer():0,c=mt(e.extent,h*l),u=Qe();u?i.loadFeatures(Ii(c,u),Eu(l,a),u):i.loadFeatures(c,l,a),this.ready=!1;const g=this.helper.makeProjectionTransform(e,[1,0,0,1,0,0]),f=this.styleRenderers_.map((p,m)=>p.generateBuffers(this.batch_,g).then(_=>{this.buffers_[m]=_}));Promise.all(f).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,i,n,r){let s=i;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.currentFrameStateTransform_=this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);do{for(let o=0,a=this.styleRenderers_.length;o<a;o++){const l=this.styleRenderers_[o],h=this.buffers_[o];h&&l.render(h,e,()=>{this.applyUniforms_(h.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}cs(this.currentFrameStateTransform_,r,0)}while(++s<n)}forEachFeatureAtCoordinate(e,t,i,n,r){if(ie(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const s=ye(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=Rg([o[0]/255,o[1]/255,o[2]/255,o[3]/255]),l=this.batch_.getFeatureFromRef(a);return l?n(l,this.getLayer(),null):void 0}disposeInternal(){this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){fe(e)}),this.sourceListenKeys_=null),super.disposeInternal()}};const Ke={...Ig,TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"},lx={POSITION:"a_position"};var fE=class extends Mg{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[Ke.PATTERN_ORIGIN]:[0,0]}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.styles_=[],this.styleRenderers_=[],this.currentFrameStateTransform_=[1,0,0,1,0,0],this.tmpTransform_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tileMaskTarget_=null,this.tileMaskIndices_=new hn(zr,Bs),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:lx.POSITION,size:2,type:et.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){function e(t){const i=t.getFragmentDiscardExpression(),n=`texture2D(${Ke.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${Ke.TILE_ZOOM_LEVEL} + 0.5`;t.setFragmentDiscardExpression(i!=="false"?`(${i}) || (${n})`:n),t.addUniform(`sampler2D ${Ke.TILE_MASK_TEXTURE}`),t.addUniform(`float ${Ke.TILE_ZOOM_LEVEL}`)}this.styleRenderers_=this.styles_.map(t=>{let i;if("builder"in t)e(t.builder),i=t;else{const n=Jh(t);e(n.builder),i={builder:n.builder,attributes:n.attributes,uniforms:n.uniforms}}return new of(i,this.helper,this.hitDetectionEnabled_)})}initTileMask_(){this.tileMaskTarget_=new Bh(this.helper);const e=new Hh().setFillColorExpression(`vec4(${Ke.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(`float ${Ke.TILE_ZOOM_LEVEL}`);this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){const t=new ky(e,this.styleRenderers_),i=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(he,i))};return t.addEventListener(he,i),t}beforeTilesRender(e,t){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),this.helper.bindTexture(this.tileMaskTarget_.getTexture(),0,Ke.TILE_MASK_TEXTURE)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const t=e.pixelRatio,i=e.size;return this.tileMaskTarget_.setSize([i[0]*t,i[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),yo(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(Ke.PROJECTION_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),Ht(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(Ke.SCREEN_TO_WORLD_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,i,n){if(!e.ready)return;this.helper.setUniformFloatValue(Ke.DEPTH,n),this.helper.setUniformFloatValue(Ke.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(Ke.RENDER_EXTENT,i),this.helper.setUniformFloatValue(Ke.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);const r=this.tileMaskIndices_.getSize();this.helper.drawElements(0,r)}applyUniforms_(e,t,i,n,r){yo(this.tmpTransform_,this.currentFrameStateTransform_),Ki(this.tmpTransform_,i),this.helper.setUniformMatrixValue(Ke.PROJECTION_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),Ht(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(Ke.SCREEN_TO_WORLD_MATRIX,cn(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(Ke.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(Ke.DEPTH,r),this.helper.setUniformFloatValue(Ke.TILE_ZOOM_LEVEL,n),this.helper.setUniformFloatVec4(Ke.RENDER_EXTENT,t)}renderTile(e,t,i,n,r,s,o,a,l,h,c){const u=We(a,n,a),g=e.tile.getTileCoord()[0];for(let f=0,p=this.styleRenderers_.length;f<p;f++){const m=this.styleRenderers_[f],_=e.buffers[f];m.render(_,i,()=>{this.applyUniforms_(c,u,_.invertVerticesTransform,g,l)})}}renderDeclutter(e){}disposeInternal(){super.disposeInternal()}};const nc=0,hx=1,cx=2,ux=3,Ri=4,af=5,qr=6,lf=7,dx=8,hf=9,Ia=10,Kr=11,gx=12,La=[dx],fn=[gx],Kn=[hx],cf=[ux];var Ys=class extends Dd{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let s=r.length;for(let o=0,a=e.length;o<a;o+=t)n[0]=e[o],n[1]=e[o+1],Jt(i,n)&&(r[s++]=n[0],r[s++]=n[1]);return s}appendFlatLineCoordinates(e,t,i,n,r,s){const o=this.coordinates;let a=o.length;const l=this.getBufferedMaxExtent();s&&(t+=n);let h=e[t],c=e[t+1];const u=this.tmpCoordinate_;let g,f,p,m=!0;for(g=t+n;g<i;g+=n)u[0]=e[g],u[1]=e[g+1],p=ul(l,u),p!==f?(m&&(o[a++]=h,o[a++]=c,m=!1),o[a++]=u[0],o[a++]=u[1]):p===lt.INTERSECTING?(o[a++]=u[0],o[a++]=u[1],m=!1):m=!0,h=u[0],c=u[1],f=p;return(r&&m||g===t+n)&&(o[a++]=h,o[a++]=c),a}drawCustomCoordinates_(e,t,i,n,r){for(let s=0,o=i.length;s<o;++s){const a=i[s],l=this.appendFlatLineCoordinates(e,t,a,n,!1,!1);r.push(l),t=a}return t}drawCustom(e,t,i,n){this.beginGeometry(e,t);const r=e.getType(),s=e.getStride(),o=this.coordinates.length;let a,l,h,c,u;switch(r){case"MultiPolygon":a=e.getOrientedFlatCoordinates(),c=[];const g=e.getEndss();u=0;for(let f=0,p=g.length;f<p;++f){const m=[];u=this.drawCustomCoordinates_(a,u,g[f],s,m),c.push(m)}this.instructions.push([Ri,o,c,e,i,Nl]),this.hitDetectionInstructions.push([Ri,o,c,e,n||i,Nl]);break;case"Polygon":case"MultiLineString":h=[],a=r=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,e.getEnds(),s,h),this.instructions.push([Ri,o,h,e,i,vs]),this.hitDetectionInstructions.push([Ri,o,h,e,n||i,vs]);break;case"LineString":case"Circle":a=e.getFlatCoordinates(),l=this.appendFlatLineCoordinates(a,0,a.length,s,!1,!1),this.instructions.push([Ri,o,l,e,i,Li]),this.hitDetectionInstructions.push([Ri,o,l,e,n||i,Li]);break;case"MultiPoint":a=e.getFlatCoordinates(),l=this.appendFlatPointCoordinates(a,s),l>o&&(this.instructions.push([Ri,o,l,e,i,Li]),this.hitDetectionInstructions.push([Ri,o,l,e,n||i,Li]));break;case"Point":a=e.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),l=this.coordinates.length,this.instructions.push([Ri,o,l,e,i]),this.hitDetectionInstructions.push([Ri,o,l,e,n||i])}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[nc,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[nc,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;let t;e.reverse();const i=e.length;let n,r,s=-1;for(t=0;t<i;++t)n=e[t],r=n[0],r==lf?s=t:r==nc&&(n[2]=t,xp(this.hitDetectionInstructions,s,t),s=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const n=e.getColor();i.fillStyle=Ti(n||St)}else i.fillStyle=void 0;if(t){const n=t.getColor();i.strokeStyle=Ti(n||bs);const r=t.getLineCap();i.lineCap=r!==void 0?r:Pr;const s=t.getLineDash();i.lineDash=s?s.slice():Mi;const o=t.getLineDashOffset();i.lineDashOffset=o||0;const a=t.getLineJoin();i.lineJoin=a!==void 0?a:Fr;const l=t.getWidth();i.lineWidth=l!==void 0?l:1;const h=t.getMiterLimit();i.miterLimit=h!==void 0?h:Cs,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[Ia,t];return typeof t!="string"&&i.push(!0),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Kr,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;typeof i=="string"&&e.currentFillStyle==i||(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,r=e.lineDash,s=e.lineDashOffset,o=e.lineJoin,a=e.lineWidth,l=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||r!=e.currentLineDash&&!ui(e.currentLineDash,r)||e.currentLineDashOffset!=s||e.currentLineJoin!=o||e.currentLineWidth!=a||e.currentMiterLimit!=l)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=r,e.currentLineDashOffset=s,e.currentLineJoin=o,e.currentLineWidth=a,e.currentMiterLimit=l)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[lf,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ru(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;mt(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},fx=class extends Ys{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),n=e.getStride(),r=this.coordinates.length,s=this.appendFlatPointCoordinates(i,n);this.instructions.push([qr,r,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([qr,r,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),n=e.getStride(),r=this.coordinates.length,s=this.appendFlatPointCoordinates(i,n);this.instructions.push([qr,r,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([qr,r,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}},px=class extends Ys{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const r=this.coordinates.length,s=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),o=[hf,r,s];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(e,t){const i=this.state,n=i.strokeStyle,r=i.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Kr,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Mi,0],Kn);const s=e.getFlatCoordinates(),o=e.getStride();this.drawFlatCoordinates_(s,0,s.length,o),this.hitDetectionInstructions.push(fn),this.endGeometry(t)}drawMultiLineString(e,t){const i=this.state,n=i.strokeStyle,r=i.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Kr,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Mi,0],Kn);const s=e.getEnds(),o=e.getFlatCoordinates(),a=e.getStride();let l=0;for(let h=0,c=s.length;h<c;++h)l=this.drawFlatCoordinates_(o,l,s[h],a);this.hitDetectionInstructions.push(fn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(fn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(fn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Kn)}},uf=class extends Ys{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const r=this.state,s=r.fillStyle!==void 0,o=r.strokeStyle!==void 0,a=i.length;this.instructions.push(Kn),this.hitDetectionInstructions.push(Kn);for(let l=0;l<a;++l){const h=i[l],c=this.coordinates.length,u=this.appendFlatLineCoordinates(e,t,h,n,!0,!o),g=[hf,c,u];this.instructions.push(g),this.hitDetectionInstructions.push(g),o&&(this.instructions.push(cf),this.hitDetectionInstructions.push(cf)),t=h}return s&&(this.instructions.push(La),this.hitDetectionInstructions.push(La)),o&&(this.instructions.push(fn),this.hitDetectionInstructions.push(fn)),t}drawCircle(e,t){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ia,St]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kr,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Mi,0]);const s=e.getFlatCoordinates(),o=e.getStride(),a=this.coordinates.length;this.appendFlatLineCoordinates(s,0,s.length,o,!1,!1);const l=[cx,a];this.instructions.push(Kn,l),this.hitDetectionInstructions.push(Kn,l),i.fillStyle!==void 0&&(this.instructions.push(La),this.hitDetectionInstructions.push(La)),i.strokeStyle!==void 0&&(this.instructions.push(fn),this.hitDetectionInstructions.push(fn)),this.endGeometry(t)}drawPolygon(e,t){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ia,St]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kr,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Mi,0]);const s=e.getEnds(),o=e.getOrientedFlatCoordinates(),a=e.getStride();this.drawFlatCoordinatess_(o,0,s,a),this.endGeometry(t)}drawMultiPolygon(e,t){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ia,St]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kr,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Mi,0]);const s=e.getEndss(),o=e.getOrientedFlatCoordinates(),a=e.getStride();let l=0;for(let h=0,c=s.length;h<c;++h)l=this.drawFlatCoordinatess_(o,l,s[h],a);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=kn(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}};function pE(e,t,i,n,r){const s=[];let o=i,a=0,l=t.slice(i,2);for(;a<e&&o+r<n;){const[h,c]=l.slice(-2),u=t[o+r],g=t[o+r+1],f=Math.sqrt((u-h)*(u-h)+(g-c)*(g-c));if(a+=f,a>=e){const p=(e-a+f)/f,m=Lt(h,u,p),_=Lt(c,g,p);l.push(m,_),s.push(l),l=[m,_],a==e&&(o+=r),a=0}else if(a<e)l.push(t[o+r],t[o+r+1]),o+=r;else{const p=f-a,m=Lt(h,u,p/f),_=Lt(c,g,p/f);l.push(m,_),s.push(l),l=[m,_],a=0,o+=r}}return a>0&&s.push(l),s}function mx(e,t,i,n,r){let s,o,a,l,h,c,u,g,f,p,m=i,_=i,x=0,y=0,v=i;for(o=i;o<n;o+=r){const w=t[o],S=t[o+1];h!==void 0&&(f=w-h,p=S-c,l=Math.sqrt(f*f+p*p),u!==void 0&&(y+=a,s=Math.acos((u*f+g*p)/(a*l)),s>e&&(y>x&&(x=y,m=v,_=o),y=0,v=o-r)),a=l,u=f,g=p),h=w,c=S}return y+=l,y>x?[v,o]:[m,_]}const Ma={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};var _x=class extends Ys{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[St]={fillStyle:St},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const i=this.textFillState_,n=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!i&&!n)return;const s=this.coordinates;let o=s.length;const a=e.getType();let l=null,h=e.getStride();if(r.placement!=="line"||a!="LineString"&&a!="MultiLineString"&&a!="Polygon"&&a!="MultiPolygon"){let c=r.overflow?null:[];switch(a){case"Point":case"MultiPoint":l=e.getFlatCoordinates();break;case"LineString":l=e.getFlatMidpoint();break;case"Circle":l=e.getCenter();break;case"MultiLineString":l=e.getFlatMidpoints(),h=2;break;case"Polygon":l=e.getFlatInteriorPoint(),r.overflow||c.push(l[2]/this.resolution),h=3;break;case"MultiPolygon":const _=e.getFlatInteriorPoints();l=[];for(let x=0,y=_.length;x<y;x+=3)r.overflow||c.push(_[x+2]/this.resolution),l.push(_[x],_[x+1]);if(l.length===0)return;h=2}const u=this.appendFlatPointCoordinates(l,h);if(u===o)return;if(c&&(u-o)/2!=l.length/h){let _=o/2;c=c.filter((x,y)=>{const v=s[2*(_+y)]===l[y*h]&&s[2*(_+y)+1]===l[y*h+1];return v||--_,v})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&this.updateFillStyle(this.state,this.createFill),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let g=r.padding;if(g!=Bn&&(r.scale[0]<0||r.scale[1]<0)){let _=r.padding[0],x=r.padding[1],y=r.padding[2],v=r.padding[3];r.scale[0]<0&&(x=-x,v=-v),r.scale[1]<0&&(_=-_,y=-y),g=[_,x,y,v]}const f=this.pixelRatio;this.instructions.push([qr,o,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,g==Bn?Bn:g.map(function(_){return _*f}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);const p=1/f,m=this.state.fillStyle;r.backgroundFill&&(this.state.fillStyle=St,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([qr,o,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,g,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?St:this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),r.backgroundFill&&(this.state.fillStyle=m,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}else{if(!Ie(this.getBufferedMaxExtent(),e.getExtent()))return;let c;if(l=e.getFlatCoordinates(),a=="LineString")c=[l.length];else if(a=="MultiLineString")c=e.getEnds();else if(a=="Polygon")c=e.getEnds().slice(0,1);else if(a=="MultiPolygon"){const p=e.getEndss();c=[];for(let m=0,_=p.length;m<_;++m)c.push(p[m][0])}this.beginGeometry(e,t);const u=r.repeat,g=u?void 0:r.textAlign;let f=0;for(let p=0,m=c.length;p<m;++p){let _;_=u?pE(u*this.resolution,l,f,c[p],h):[l.slice(f,c[p])];for(let x=0,y=_.length;x<y;++x){const v=_[x];let w=0,S=v.length;if(g==null){const E=mx(r.maxAngle,v,0,v.length,2);w=E[0],S=E[1]}for(let E=w;E<S;E+=h)s.push(v[E],v[E+1]);const C=s.length;f=c[p],this.drawChars_(o,C),o=C}}this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Rs,justify:t.justify,textBaseline:t.textBaseline||Xo,scale:t.scale});const s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,s=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=Ma[n.textBaseline],h=this.textOffsetY_*a,c=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([af,e,t,l,n.overflow,o,n.maxAngle,a,h,r,u*a,c,s,1]),this.hitDetectionInstructions.push([af,e,t,l,n.overflow,o&&St,n.maxAngle,a,h,r,u*a,c,s,1/a])}setTextStyle(e,t){let i,n,r;if(e){const s=e.getFill();s?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Ti(s.getColor()||St)):(n=null,this.textFillState_=n);const o=e.getStroke();if(o){r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const f=o.getLineDash(),p=o.getLineDashOffset(),m=o.getWidth(),_=o.getMiterLimit();r.lineCap=o.getLineCap()||Pr,r.lineDash=f?f.slice():Mi,r.lineDashOffset=p===void 0?0:p,r.lineJoin=o.getLineJoin()||Fr,r.lineWidth=m===void 0?1:m,r.miterLimit=_===void 0?Cs:_,r.strokeStyle=Ti(o.getColor()||bs)}else r=null,this.textStrokeState_=r;i=this.textState_;const a=e.getFont()||gd;g_(a);const l=e.getScaleArray();i.overflow=e.getOverflow(),i.font=a,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Xo,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Bn,i.scale=l===void 0?[1,1]:l;const h=e.getOffsetX(),c=e.getOffsetY(),u=e.getRotateWithView(),g=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=c===void 0?0:c,this.textRotateWithView_=u!==void 0&&u,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:k(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+k(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=t}};const mE={Circle:uf,Default:Ys,Image:fx,LineString:px,Polygon:uf,Text:_x};var Aa=class{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const r=i[n].finish();e[t][n]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let r=n[t];return r===void 0&&(r=new mE[t](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=r),r}};function yx(e,t,i,n,r,s,o,a,l,h,c,u){let g=e[t],f=e[t+1],p=0,m=0,_=0,x=0;function y(){p=g,m=f,g=e[t+=n],f=e[t+1],x+=_,_=Math.sqrt((g-p)*(g-p)+(f-m)*(f-m))}do y();while(t<i-n&&x+_<s);let v=_===0?0:(s-x)/_;const w=Lt(p,g,v),S=Lt(m,f,v),C=t-n,E=x,R=s+a*l(h,r,c);for(;t<i-n&&x+_<R;)y();v=_===0?0:(R-x)/_;const P=Lt(p,g,v),I=Lt(m,f,v);let A;if(u){const M=[w,S,P,I];Rl(M,0,4,2,u,M,M),A=M[0]>M[2]}else A=w>P;const G=Math.PI,B=[],z=C+n===t;let N;if(_=0,x=E,g=e[t=C],f=e[t+1],z){y(),N=Math.atan2(f-m,g-p),A&&(N+=N>0?-G:G);const M=(P+w)/2,V=(I+S)/2;return B[0]=[M,V,(R-s)/2,N,r],B}for(let M=0,V=(r=r.replace(/\n/g," ")).length;M<V;){y();let se=Math.atan2(f-m,g-p);if(A&&(se+=se>0?-G:G),N!==void 0){let ve=se-N;if(ve+=ve>G?-2*G:ve<-G?2*G:0,Math.abs(ve)>o)return null}N=se;const oe=M;let xe=0;for(;M<V;++M){const ve=a*l(h,r[A?V-M-1:M],c);if(t+n<i&&x+_<s+xe+ve/2)break;xe+=ve}if(M===oe)continue;const U=A?r.substring(V-oe,V-M):r.substring(oe,M);v=_===0?0:(s+xe/2-x)/_;const nt=Lt(p,g,v),me=Lt(m,f,v);B.push([nt,me,xe/2,se,U]),s+=xe}return B}const qs=[1/0,1/0,-1/0,-1/0],Hn=[],pn=[],mn=[],Jn=[];function xx(e){return e[3].declutterBox}const vx=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function df(e,t){return t==="start"?t=vx.test(e)?"right":"left":t==="end"&&(t=vx.test(e)?"left":"right"),Ma[t]}function _E(e,t,i){return i>0&&e.push(`
`,""),e.push(t,""),e}var wx=class{constructor(e,t,i,n){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,i,n){const r=e+t+i+n;if(this.labels_[r])return this.labels_[r];const s=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,a=this.textStates[t],l=this.pixelRatio,h=[a.scale[0]*l,a.scale[1]*l],c=Array.isArray(e),u=a.justify?Ma[a.justify]:df(Array.isArray(e)?e[0]:e,a.textAlign||Rs),g=n&&s.lineWidth?s.lineWidth:0,f=c?e:e.split(`
`).reduce(_E,[]),{width:p,height:m,widths:_,heights:x,lineWidths:y}=m_(a,f),v=p+g,w=[],S=(v+2)*h[0],C=(m+g)*h[1],E={width:S<0?Math.floor(S):Math.ceil(S),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:w};h[0]==1&&h[1]==1||w.push("scale",h),n&&(w.push("strokeStyle",s.strokeStyle),w.push("lineWidth",g),w.push("lineCap",s.lineCap),w.push("lineJoin",s.lineJoin),w.push("miterLimit",s.miterLimit),w.push("setLineDash",[s.lineDash]),w.push("lineDashOffset",s.lineDashOffset)),i&&w.push("fillStyle",o.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const R=.5-u;let P=u*v+R*g;const I=[],A=[];let G,B=0,z=0,N=0,M=0;for(let V=0,se=f.length;V<se;V+=2){const oe=f[V];if(oe===`
`){z+=B,B=0,P=u*v+R*g,++M;continue}const xe=f[V+1]||a.font;xe!==G&&(n&&I.push("font",xe),i&&A.push("font",xe),G=xe),B=Math.max(B,x[N]);const U=[oe,P+R*_[N]+u*(_[N]-y[M]),.5*(g+B)+z];P+=_[N],n&&I.push("strokeText",U),i&&A.push("fillText",U),++N}return Array.prototype.push.apply(w,I),Array.prototype.push.apply(w,A),this.labels_[r]=E,E}replayTextBackground_(e,t,i,n,r,s,o){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,t),s&&(this.alignFill_=s[2],this.fill_(e)),o&&(this.setStrokeStyle_(e,o),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,r,s,o,a,l,h,c,u,g,f,p,m){let _=i-(o*=u[0]),x=n-(a*=u[1]);const y=r+l>e?e-l:r,v=s+h>t?t-h:s,w=f[3]+y*u[0]+f[1],S=f[0]+v*u[1]+f[2],C=_-f[3],E=x-f[0];let R;return(p||c!==0)&&(Hn[0]=C,Jn[0]=C,Hn[1]=E,pn[1]=E,pn[0]=C+w,mn[0]=pn[0],mn[1]=E+S,Jn[1]=mn[1]),c!==0?(R=pt([1,0,0,1,0,0],i,n,1,1,c,-i,-n),ye(R,Hn),ye(R,pn),ye(R,mn),ye(R,Jn),Xt(Math.min(Hn[0],pn[0],mn[0],Jn[0]),Math.min(Hn[1],pn[1],mn[1],Jn[1]),Math.max(Hn[0],pn[0],mn[0],Jn[0]),Math.max(Hn[1],pn[1],mn[1],Jn[1]),qs)):Xt(Math.min(C,C+w),Math.min(E,E+S),Math.max(C,C+w),Math.max(E,E+S),qs),g&&(_=Math.round(_),x=Math.round(x)),{drawImageX:_,drawImageY:x,drawImageW:y,drawImageH:v,originX:l,originY:h,declutterBox:{minX:qs[0],minY:qs[1],maxX:qs[2],maxY:qs[3],value:m},canvasTransform:R,scale:u}}replayImageOrLabel_(e,t,i,n,r,s,o){const a=!(!s&&!o),l=n.declutterBox,h=e.canvas,c=o?o[2]*n.scale[0]/2:0;return l.minX-c<=h.width/t&&l.maxX+c>=0&&l.minY-c<=h.height/t&&l.maxY+c>=0&&(a&&this.replayTextBackground_(e,Hn,pn,mn,Jn,s,o),__(e,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){if(this.alignFill_){const t=ye(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,n){const r=this.textStates[t],s=this.createLabel(e,t,n,i),o=this.strokeStates[i],a=this.pixelRatio,l=df(Array.isArray(e)?e[0]:e,r.textAlign||Rs),h=Ma[r.textBaseline||Xo],c=o&&o.lineWidth?o.lineWidth:0;return{label:s,anchorX:l*(s.width/a-2*r.scale[0])+2*(.5-l)*c,anchorY:h*s.height/a+2*(.5-h)*c}}execute_(e,t,i,n,r,s,o,a){let l;this.pixelCoordinates_&&ui(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=_i(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),yo(this.renderedTransform_,i));let h=0;const c=n.length;let u,g,f,p,m,_,x,y,v,w,S,C,E=0,R=0,P=0,I=null,A=null;const G=this.coordinateCache_,B=this.viewRotation_,z=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,N={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:B},M=this.instructions!=n||this.overlaps?0:200;let V,se,oe,xe;for(;h<c;){const U=n[h];switch(U[0]){case nc:V=U[1],xe=U[3],V.getGeometry()?o===void 0||Ie(o,xe.getExtent())?++h:h=U[2]+1:h=U[2];break;case hx:R>M&&(this.fill_(e),R=0),P>M&&(e.stroke(),P=0),R||P||(e.beginPath(),p=NaN,m=NaN),++h;break;case cx:E=U[1];const nt=l[E],me=l[E+1],ve=l[E+2]-nt,Pi=l[E+3]-me,xt=Math.sqrt(ve*ve+Pi*Pi);e.moveTo(nt+xt,me),e.arc(nt,me,xt,0,2*Math.PI,!0),++h;break;case ux:e.closePath(),++h;break;case Ri:E=U[1],u=U[2];const nr=U[3],Sn=U[4],Za=U.length==6?U[5]:void 0;N.geometry=nr,N.feature=V,h in G||(G[h]=[]);const Zi=G[h];Za?Za(l,E,u,2,Zi):(Zi[0]=l[E],Zi[1]=l[E+1],Zi.length=2),Sn(Zi,N),++h;break;case qr:E=U[1],u=U[2],y=U[3],g=U[4],f=U[5];let $a=U[6];const Wc=U[7],dp=U[8],rr=U[9],Ya=U[10];let co=U[11];const gp=U[12];let rs=U[13];const Zc=U[14],Pt=U[15];if(!y&&U.length>=20){v=U[19],w=U[20],S=U[21],C=U[22];const ft=this.drawLabelWithPointPlacement_(v,w,S,C);y=ft.label,U[3]=y;const Yi=U[23];g=(ft.anchorX-Yi)*this.pixelRatio,U[4]=g;const Ft=U[24];f=(ft.anchorY-Ft)*this.pixelRatio,U[5]=f,$a=y.height,U[6]=$a,rs=y.width,U[13]=rs}let Yt,En,$i,ss;U.length>25&&(Yt=U[25]),U.length>17?(En=U[16],$i=U[17],ss=U[18]):(En=Bn,$i=!1,ss=!1),Ya&&z?co+=B:Ya||z||(co-=B);let $c=0;for(;E<u;E+=2){if(Yt&&Yt[$c++]<rs/this.pixelRatio)continue;const ft=this.calculateImageOrLabelDimensions_(y.width,y.height,l[E],l[E+1],rs,$a,g,f,dp,rr,co,gp,r,En,$i||ss,V),Yi=[e,t,y,ft,Wc,$i?I:null,ss?A:null];if(a){if(Zc==="none")continue;if(Zc==="obstacle"){a.insert(ft.declutterBox);continue}{let Ft,sr;if(Pt){const Tn=u-E;if(!Pt[Tn]){Pt[Tn]=Yi;continue}if(Ft=Pt[Tn],delete Pt[Tn],sr=xx(Ft),a.collides(sr))continue}if(a.collides(ft.declutterBox))continue;Ft&&(a.insert(sr),this.replayImageOrLabel_.apply(this,Ft)),a.insert(ft.declutterBox)}}this.replayImageOrLabel_.apply(this,Yi)}++h;break;case af:const uo=U[1],os=U[2],qa=U[3],jt=U[4];C=U[5];const IR=U[6],ew=U[7],tw=U[8];S=U[9];const fp=U[10];v=U[11],w=U[12];const iw=[U[13],U[13]],pp=this.textStates[w],Ka=pp.font,Ha=[pp.scale[0]*ew,pp.scale[1]*ew];let Ja;Ka in this.widths_?Ja=this.widths_[Ka]:(Ja={},this.widths_[Ka]=Ja);const nw=Rh(l,uo,os,2),rw=Math.abs(Ha[0])*pd(Ka,v,Ja);if(jt||rw<=nw){const ft=yx(l,uo,os,2,v,(nw-rw)*df(v,this.textStates[w].textAlign),IR,Math.abs(Ha[0]),pd,Ka,Ja,z?0:this.viewRotation_);e:if(ft){const Yi=[];let Ft,sr,Tn,Bt,ci;if(S)for(Ft=0,sr=ft.length;Ft<sr;++Ft){ci=ft[Ft],Tn=ci[4],Bt=this.createLabel(Tn,w,"",S),g=ci[2]+(Ha[0]<0?-fp:fp),f=qa*Bt.height+2*(.5-qa)*fp*Ha[1]/Ha[0]-tw;const Cn=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,ci[0],ci[1],Bt.width,Bt.height,g,f,0,0,ci[3],iw,!1,Bn,!1,V);if(a&&a.collides(Cn.declutterBox))break e;Yi.push([e,t,Bt,Cn,1,null,null])}if(C)for(Ft=0,sr=ft.length;Ft<sr;++Ft){ci=ft[Ft],Tn=ci[4],Bt=this.createLabel(Tn,w,C,""),g=ci[2],f=qa*Bt.height-tw;const Cn=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,ci[0],ci[1],Bt.width,Bt.height,g,f,0,0,ci[3],iw,!1,Bn,!1,V);if(a&&a.collides(Cn.declutterBox))break e;Yi.push([e,t,Bt,Cn,1,null,null])}a&&a.load(Yi.map(xx));for(let Cn=0,LR=Yi.length;Cn<LR;++Cn)this.replayImageOrLabel_.apply(this,Yi[Cn])}}++h;break;case lf:if(s!==void 0){V=U[1];const ft=s(V,xe);if(ft)return ft}++h;break;case dx:M?R++:this.fill_(e),++h;break;case hf:for(E=U[1],u=U[2],se=l[E],oe=l[E+1],_=se+.5|0,x=oe+.5|0,_===p&&x===m||(e.moveTo(se,oe),p=_,m=x),E+=2;E<u;E+=2)se=l[E],oe=l[E+1],_=se+.5|0,x=oe+.5|0,E!=u-2&&_===p&&x===m||(e.lineTo(se,oe),p=_,m=x);++h;break;case Ia:I=U,this.alignFill_=U[2],R&&(this.fill_(e),R=0,P&&(e.stroke(),P=0)),e.fillStyle=U[1],++h;break;case Kr:A=U,P&&(e.stroke(),P=0),this.setStrokeStyle_(e,U),++h;break;case gx:M?P++:e.stroke(),++h;break;default:++h}}R&&this.fill_(e),P&&e.stroke()}execute(e,t,i,n,r,s){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,r,void 0,void 0,s)}executeHitDetection(e,t,i,n,r){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,n,r)}};const gf=["Polygon","Circle","LineString","Image","Text","Default"],ff={};function Sx(e){if(ff[e]!==void 0)return ff[e];const t=2*e+1,i=e*e,n=new Array(i+1);for(let s=0;s<=e;++s)for(let o=0;o<=e;++o){const a=s*s+o*o;if(a>i)break;let l=n[a];l||(l=[],n[a]=l),l.push(4*((e+s)*t+(e+o))+3),s>0&&l.push(4*((e-s)*t+(e+o))+3),o>0&&(l.push(4*((e+s)*t+(e-o))+3),s>0&&l.push(4*((e-s)*t+(e-o))+3))}const r=[];for(let s=0,o=n.length;s<o;++s)n[s]&&r.push(...n[s]);return ff[e]=r,r}var Oa=class{constructor(e,t,i,n,r,s){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e){for(const t in e){let i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);const n=e[t];for(const r in n){const s=n[r];i[r]=new wx(this.resolution_,this.pixelRatio_,this.overlaps_,s)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,r=e.length;n<r;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,r,s){const o=2*(n=Math.round(n))+1,a=pt(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=ke(o,o,void 0,{willReadFrequently:!0}));const h=this.hitDetectionContext_;let c;h.canvas.width!==o||h.canvas.height!==o?(h.canvas.width=o,h.canvas.height=o):l||h.clearRect(0,0,o,o),this.renderBuffer_!==void 0&&(c=[1/0,1/0,-1/0,-1/0],fr(c,e),mt(c,t*(this.renderBuffer_+n),c));const u=Sx(n);let g;function f(w,S){const C=h.getImageData(0,0,o,o).data;for(let E=0,R=u.length;E<R;E++)if(C[u[E]]>0){if(!s||g!=="Image"&&g!=="Text"||s.includes(w)){const P=(u[E]-3)/4,I=n-P%o,A=n-(P/o|0),G=r(w,S,I*I+A*A);if(G)return G}h.clearRect(0,0,o,o);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);let m,_,x,y,v;for(p.sort(qi),m=p.length-1;m>=0;--m){const w=p[m].toString();for(x=this.executorsByZIndex_[w],_=gf.length-1;_>=0;--_)if(g=gf[_],y=x[g],y!==void 0&&(v=y.executeHitDetection(h,a,i,f,c),v))return v}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],r=t[2],s=t[3],o=[i,n,i,s,r,s,r,n];return _i(o,0,8,2,e,o),o}isEmpty(){return qt(this.executorsByZIndex_)}execute(e,t,i,n,r,s,o){const a=Object.keys(this.executorsByZIndex_).map(Number);let l,h,c,u,g,f;for(a.sort(qi),this.maxExtent_&&(e.save(),this.clip(e,i)),s=s||gf,o&&a.reverse(),l=0,h=a.length;l<h;++l){const p=a[l].toString();for(g=this.executorsByZIndex_[p],c=0,u=s.length;c<u;++c)f=g[s[c]],f!==void 0&&f.execute(e,t,i,n,r,o)}this.maxExtent_&&e.restore()}};const kt=.5;function pf(e,t,i,n,r,s,o){const a=ke(e[0]*kt,e[1]*kt);a.imageSmoothingEnabled=!1;const l=a.canvas,h=new fh(a,kt,r,null,o),c=i.length,u=Math.floor(16777215/c),g={};for(let p=1;p<=c;++p){const m=i[p-1],_=m.getStyleFunction()||n;if(!_)continue;let x=_(m,s);if(!x)continue;Array.isArray(x)||(x=[x]);const y=(p*u).toString(16).padStart(7,"#00000");for(let v=0,w=x.length;v<w;++v){const S=x[v],C=S.getGeometryFunction()(m);if(!C||!Ie(r,C.getExtent()))continue;const E=S.clone(),R=E.getFill();R&&R.setColor(y);const P=E.getStroke();P&&(P.setColor(y),P.setLineDash(null)),E.setText(void 0);const I=S.getImage();if(I){const z=I.getImageSize();if(!z)continue;const N=ke(z[0],z[1],void 0,{alpha:!1}),M=N.canvas;N.fillStyle=y,N.fillRect(0,0,M.width,M.height),E.setImage(new Ea({img:M,anchor:I.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:I.getOrigin(),opacity:1,size:I.getSize(),scale:I.getScale(),rotation:I.getRotation(),rotateWithView:I.getRotateWithView()}))}const A=E.getZIndex()||0;let G=g[A];G||(G={},g[A]=G,G.Polygon=[],G.Circle=[],G.LineString=[],G.Point=[]);const B=C.getType();if(B==="GeometryCollection"){const z=C.getGeometriesArrayRecursive();for(let N=0,M=z.length;N<M;++N){const V=z[N];G[V.getType().replace("Multi","")].push(V,E)}}else G[B.replace("Multi","")].push(C,E)}}const f=Object.keys(g).map(Number).sort(qi);for(let p=0,m=f.length;p<m;++p){const _=g[f[p]];for(const x in _){const y=_[x];for(let v=0,w=y.length;v<w;v+=2){h.setStyle(y[v+1]);for(let S=0,C=t.length;S<C;++S)h.setTransform(t[S]),h.drawGeometry(y[v])}}}return a.getImageData(0,0,l.width,l.height)}function mf(e,t,i){const n=[];if(i){const r=Math.floor(Math.round(e[0])*kt),s=Math.floor(Math.round(e[1])*kt),o=4*(H(r,0,i.width-1)+H(s,0,i.height-1)*i.width),a=i.data[o],l=i.data[o+1],h=i.data[o+2]+256*(l+256*a),c=Math.floor(16777215/t.length);h&&h%c==0&&n.push(t[h/c-1])}return n}var _f=class extends Ah{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,r=t.viewState,s=r.center,o=r.resolution,a=r.projection,l=r.rotation,h=a.getExtent(),c=this.getLayer().getSource(),u=t.pixelRatio,g=t.viewHints,f=!(g[_t]||g[Ot]),p=this.compositionContext_,m=Math.round(t.size[0]*u),_=Math.round(t.size[1]*u),x=c.getWrapX()&&a.canWrapX(),y=x?ne(h):null,v=x?Math.ceil((n[2]-h[2])/y)+1:1;let w=x?Math.floor((n[0]-h[0])/y):0;do{const S=this.getRenderTransform(s,o,l,u,m,_,w*y);e.execute(p,1,S,l,f,void 0,i)}while(++w<v)}setupCompositionContext_(){if(this.opacity_!==1){const e=ke(this.context.canvas.width,this.context.canvas.height,og);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,In(this.compositionContext_),og.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const i=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];jp(this.pixelTransform,1/i,1/i),Ht(this.inversePixelTransform,this.pixelTransform);const r=xo(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const s=this.context,o=s.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;let h=a&&!a.isEmpty()||l&&!l.isEmpty();if(!h&&!(this.getLayer().hasListener(td)||this.getLayer().hasListener(Zl)))return null;const c=Math.round(e.size[0]*i),u=Math.round(e.size[1]*i);o.width!=c||o.height!=u?(o.width=c,o.height=u,o.style.transform!==r&&(o.style.transform=r)):this.containerReused||s.clearRect(0,0,c,u),this.preRender(s,e);const g=e.viewState,f=g.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let p=!1;if(h&&n.extent&&this.clipping){const m=At(n.extent,f);h=Ie(m,e.extent),p=h&&!ht(m,e.extent),p&&this.clipUnrotated(this.compositionContext_,e,m)}return h&&this.renderWorlds(a,e),p&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(s,e),this.renderedRotation_!==g.rotation&&(this.renderedRotation_=g.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];ye(this.pixelTransform,i);const n=this.renderedCenter_,r=this.renderedResolution_,s=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,l=this.getLayer(),h=[],c=i[0]*kt,u=i[1]*kt;h.push(this.getRenderTransform(n,r,s,kt,c,u,0).slice());const g=l.getSource(),f=o.getExtent();if(g.getWrapX()&&o.canWrapX()&&!ht(f,a)){let p=a[0];const m=ne(f);let _,x=0;for(;p<f[0];)--x,_=m*x,h.push(this.getRenderTransform(n,r,s,kt,c,u,_).slice()),p+=m;for(x=0,p=a[2];p>f[2];)++x,_=m*x,h.push(this.getRenderTransform(n,r,s,kt,c,u,_).slice()),p-=m}this.hitDetectionImageData_=pf(i,h,this.renderedFeatures_,l.getStyleFunction(),a,r,s)}t(mf(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,n,r){if(!this.replayGroup_)return;const s=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},h=function(g,f,p){const m=k(g),_=l[m];if(_){if(_!==!0&&p<_.distanceSq){if(p===0)return l[m]=!0,r.splice(r.lastIndexOf(_),1),n(g,a,f);_.geometry=f,_.distanceSq=p}}else{if(p===0)return l[m]=!0,n(g,a,f);r.push(l[m]={feature:g,layer:a,geometry:f,distanceSq:p,callback:n})}};let c;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(g=>c=g.forEachFeatureAtCoordinate(e,s,o,i,h,g===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(f=>f.value):null)),c}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[_t],r=e.viewHints[Ot],s=t.getUpdateWhileAnimating(),o=t.getUpdateWhileInteracting();if(this.ready&&!s&&n||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=e.extent,l=e.viewState,h=l.projection,c=l.resolution,u=e.pixelRatio,g=t.getRevision(),f=t.getRenderBuffer();let p=t.getRenderOrder();p===void 0&&(p=d0);const m=l.center.slice(),_=mt(a,f*c),x=_.slice(),y=[_.slice()],v=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!ht(v,e.extent)){const N=ne(v),M=Math.max(ne(_)/2,N);_[0]=v[0]-M,_[2]=v[2]+M,Co(m,h);const V=ml(y[0],h);V[0]<v[0]&&V[2]<v[2]?y.push([V[0]+N,V[1],V[2]+N,V[3]]):V[0]>v[0]&&V[2]>v[2]&&y.push([V[0]-N,V[1],V[2]-N,V[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&ht(this.wrappedRenderedExtent_,_))return ui(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new Aa(mh(c,u),_,c,u);let S;this.getLayer().getDeclutter()&&(S=new Aa(mh(c,u),_,c,u));const C=Qe();let E;if(C){for(let N=0,M=y.length;N<M;++N){const V=Ii(y[N],h);i.loadFeatures(V,Eu(c,h),C)}E=Mt(C,h)}else for(let N=0,M=y.length;N<M;++N)i.loadFeatures(y[N],c,h);const R=ph(c,u);let P=!0;const I=N=>{let M;const V=N.getStyleFunction()||t.getStyleFunction();if(V&&(M=V(N,c)),M){const se=this.renderFeature(N,R,M,w,E,S);P=P&&!se}},A=Ii(_,h),G=i.getFeaturesInExtent(A);p&&G.sort(p);for(let N=0,M=G.length;N<M;++N)I(G[N]);this.renderedFeatures_=G,this.ready=P;const B=w.finish(),z=new Oa(_,c,u,i.getOverlaps(),B,t.getRenderBuffer());return S&&(this.declutterExecutorGroup=new Oa(_,c,u,i.getOverlaps(),S.finish(),t.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedExtent_=x,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=h,this.replayGroup_=z,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,r,s){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=qo(n,e,i[a],t,this.boundHandleStyleImageChange_,r,s)||o;else o=qo(n,e,i,t,this.boundHandleStyleImageChange_,r,s);return o}},Ex=class extends ag{constructor(e){super(e),this.vectorRenderer_=new _f(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=[1,0,0,1,0,0],this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=ye(this.coordinateToVectorPixelTransform_,ye(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,i=e.viewState,n=i.resolution,r=e.viewHints,s=this.vectorRenderer_;let o=e.extent;this.layerImageRatio_!==1&&(o=o.slice(0),pl(o,this.layerImageRatio_));const a=ne(o)/n,l=Le(o)/n;if(!r[_t]&&!r[Ot]&&!fi(o)){s.useContainer(null,null);const h=s.context,c=e.layerStatesArray[e.layerIndex],u=Object.assign({},c,{opacity:1}),g=Object.assign({},e,{declutterTree:new Vd(9),extent:o,size:[a,l],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[u],layerIndex:0});let f=!0;const p=new zl(o,n,t,h.canvas,function(m){s.prepareFrame(g)&&s.replayGroupChanged&&(s.clipping=!1,s.renderFrame(g,null)&&(s.renderDeclutter(g),f=!1),m())});p.addEventListener(he,()=>{if(p.getState()!==Ze)return;this.image_=f?null:p;const m=p.getPixelRatio(),_=Ko(p.getResolution())*t/m;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=pt(this.coordinateToVectorPixelTransform_,a/2,l/2,1/_,-1/_,0,-i.center[0],-i.center[1])}),p.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,i,n,r){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,i,n,r):super.forEachFeatureAtCoordinate(e,t,i,n,r)}};const yE={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},xE={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};var Tx=class extends hg{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=[1,0,0,1,0,0]}prepareTile(e,t,i){let n;const r=e.getState();return r!==we&&r!==Ne||(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,t,i,n){const r=n.pixelRatio,s=n.viewState,o=s.resolution,a=s.projection,l=this.getLayer(),h=l.getSource().getTile(e,t,i,r,a),c=n.viewHints,u=!(c[_t]||c[Ot]);return!u&&h.wantedResolution||(h.wantedResolution=o),this.prepareTile(h,r,a)&&(u||Date.now()-n.time<8)&&l.getRenderMode()!=="vector"&&this.renderTileImage_(h,n),super.getTile(e,t,i,n)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?k(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const n=this.getLayer(),r=n.getRevision(),s=n.getRenderOrder()||null,o=e.wantedResolution,a=e.getReplayState(n);if(!a.dirty&&a.renderedResolution===o&&a.renderedRevision==r&&a.renderedRenderOrder==s)return;const l=n.getSource(),h=n.getDeclutter(),c=l.getTileGrid(),u=l.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),g=l.getSourceTiles(t,i,e),f=k(n);delete e.hitDetectionImageData[f],e.executorGroups[f]=[],h&&(e.declutterExecutorGroups[f]=[]),a.dirty=!1;for(let p=0,m=g.length;p<m;++p){const _=g[p];if(_.getState()!=we)continue;const x=_.tileCoord,y=c.getTileCoordExtent(x),v=We(u,y),w=mt(v,n.getRenderBuffer()*o,this.tmpExtent),S=It(y,v)?null:w,C=new Aa(0,w,o,t),E=h?new Aa(0,v,o,t):void 0,R=ph(o,t),P=function(z){let N;const M=z.getStyleFunction()||n.getStyleFunction();if(M&&(N=M(z,o)),N){const V=this.renderFeature(z,R,N,C,E);a.dirty=a.dirty||V}},I=_.getFeatures();s&&s!==a.renderedRenderOrder&&I.sort(s);for(let z=0,N=I.length;z<N;++z){const M=I[z];S&&!Ie(S,M.getGeometry().getExtent())||P.call(this,M)}const A=C.finish(),G=n.getRenderMode()!=="vector"&&h&&g.length===1?null:v,B=new Oa(G,o,t,l.getOverlaps(),A,n.getRenderBuffer());if(e.executorGroups[f].push(B),E){const z=new Oa(null,o,t,l.getOverlaps(),E.finish(),n.getRenderBuffer());e.declutterExecutorGroups[f].push(z)}}a.renderedRevision=r,a.renderedRenderOrder=s,a.renderedResolution=o}forEachFeatureAtCoordinate(e,t,i,n,r){const s=t.viewState.resolution,o=t.viewState.rotation;i=i??0;const a=this.getLayer(),l=a.getSource().getTileGridForProjection(t.viewState.projection),h=Xe([e]);mt(h,s*i,h);const c={},u=function(p,m,_){let x=p.getId();x===void 0&&(x=k(p));const y=c[x];if(y){if(y!==!0&&_<y.distanceSq){if(_===0)return c[x]=!0,r.splice(r.lastIndexOf(y),1),n(p,a,m);y.geometry=m,y.distanceSq=_}}else{if(_===0)return c[x]=!0,n(p,a,m);r.push(c[x]={feature:p,layer:a,geometry:m,distanceSq:_,callback:n})}},g=this.renderedTiles;let f;for(let p=0,m=g.length;!f&&p<m;++p){const _=g[p];if(!Ie(l.getTileCoordExtent(_.wrappedTileCoord),h))continue;const x=k(a),y=[_.executorGroups[x]],v=_.declutterExecutorGroups[x];v&&y.push(v),y.some(w=>{const S=w===v?t.declutterTree.all().map(C=>C.value):null;for(let C=0,E=w.length;C<E;++C)if(f=w[C].forEachFeatureAtCoordinate(e,s,o,i,u,S),f)return!0})}return f}getFeatures(e){return new Promise((t,i)=>{const n=this.getLayer(),r=k(n),s=n.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,h=s.getTileGridForProjection(o),c=ye(this.renderedPixelToCoordinateTransform_,e.slice()),u=h.getTileCoordForCoordAndResolution(c,l);let g;for(let x=0,y=this.renderedTiles.length;x<y;++x)if(u.toString()===this.renderedTiles[x].tileCoord.toString()){if(g=this.renderedTiles[x],g.getState()===we){const v=h.getTileCoordExtent(g.tileCoord);s.getWrapX()&&o.canWrapX()&&!ht(a,v)&&Co(c,o);break}g=void 0}if(!g||g.loadingSourceTiles>0)return void t([]);const f=Qt(h.getTileCoordExtent(g.wrappedTileCoord)),p=[(c[0]-f[0])/l,(f[1]-c[1])/l],m=g.getSourceTiles().reduce(function(x,y){return x.concat(y.getFeatures())},[]);let _=g.hitDetectionImageData[r];if(!_){const x=Ge(h.getTileSize(h.getZForResolution(l,s.zDirection))),y=this.renderedRotation_;_=pf(x,[this.getRenderTransform(h.getTileCoordCenter(g.wrappedTileCoord),l,0,kt,x[0]*kt,x[1]*kt,0)],m,n.getStyleFunction(),h.getTileCoordExtent(g.wrappedTileCoord),g.getReplayState(n).renderedResolution,y),g.hitDetectionImageData[r]=_}t(mf(p,m,_))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,i=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const n=e.viewHints,r=!(n[_t]||n[Ot]),s=this.renderedTiles;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=l.declutterExecutorGroups[k(this.getLayer())];if(h)for(let c=h.length-1;c>=0;--c)h[c].execute(this.context,1,this.getTileRenderTransform(l,e),e.viewState.rotation,r,void 0,e.declutterTree)}t.globalAlpha=i}getTileRenderTransform(e,t){const i=t.pixelRatio,n=t.viewState,r=n.center,s=n.resolution,o=n.rotation,a=t.size,l=Math.round(a[0]*i),h=Math.round(a[1]*i),c=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),u=e.tileCoord,g=c.getTileCoordExtent(e.wrappedTileCoord),f=c.getTileCoordExtent(u,this.tmpExtent)[0]-g[0];return Ki(dr(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(r,s,o,i,l,h,f))}postRender(e,t){const i=t.viewHints,n=!(i[_t]||i[Ot]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const r=this.getLayer(),s=r.getRenderMode(),o=e.globalAlpha;e.globalAlpha=r.getOpacity();const a=xE[s],l=t.viewState,h=l.rotation,c=r.getSource(),u=c.getTileGridForProjection(l.projection).getZForResolution(l.resolution,c.zDirection),g=this.renderedTiles,f=[],p=[];let m=!0;for(let _=g.length-1;_>=0;--_){const x=g[_];m=m&&!x.getReplayState(r).dirty;const y=x.executorGroups[k(r)].filter(E=>E.hasExecutors(a));if(y.length===0)continue;const v=this.getTileRenderTransform(x,t),w=x.tileCoord[0];let S=!1;const C=y[0].getClipCoords(v);if(C){for(let E=0,R=f.length;E<R;++E)if(u!==w&&w<p[E]){const P=f[E];Ie([C[0],C[3],C[4],C[7]],[P[0],P[3],P[4],P[7]])&&(S||(e.save(),S=!0),e.beginPath(),e.moveTo(C[0],C[1]),e.lineTo(C[2],C[3]),e.lineTo(C[4],C[5]),e.lineTo(C[6],C[7]),e.moveTo(P[6],P[7]),e.lineTo(P[4],P[5]),e.lineTo(P[2],P[3]),e.lineTo(P[0],P[1]),e.clip())}f.push(C),p.push(w)}for(let E=0,R=y.length;E<R;++E)y[E].execute(e,1,v,h,n,a);S&&e.restore()}e.globalAlpha=o,this.ready=m,super.postRender(e,t)}renderFeature(e,t,i,n,r){if(!i)return!1;let s=!1;if(Array.isArray(i))for(let o=0,a=i.length;o<a;++o)s=qo(n,e,i[o],t,this.boundHandleStyleImageChange_,void 0,r)||s;else s=qo(n,e,i,t,this.boundHandleStyleImageChange_,void 0,r);return s}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),n=t.getRevision(),r=e.wantedResolution;return i.renderedTileResolution!==r||i.renderedTileRevision!==n}renderTileImage_(e,t){const i=this.getLayer(),n=e.getReplayState(i),r=i.getRevision(),s=e.executorGroups[k(i)];n.renderedTileRevision=r;const o=e.wrappedTileCoord,a=o[0],l=i.getSource();let h=t.pixelRatio;const c=t.viewState.projection,u=l.getTileGridForProjection(c),g=u.getResolution(e.tileCoord[0]),f=t.pixelRatio/e.wantedResolution*g,p=u.getResolution(a),m=e.getContext(i);h=Math.round(Math.max(h,f/h));const _=l.getTilePixelSize(a,h,c);m.canvas.width=_[0],m.canvas.height=_[1];const x=h/f;if(x!==1){const S=hl(this.tmpTransform_);dr(S,x,x),m.setTransform.apply(m,S)}const y=u.getTileCoordExtent(o,this.tmpExtent),v=f/p,w=hl(this.tmpTransform_);dr(w,v,-v),cs(w,-y[0],-y[3]);for(let S=0,C=s.length;S<C;++S)s[S].execute(m,x,w,0,!0,yE[i.getRenderMode()]);n.renderedTileResolution=e.wantedResolution}};let rc=null;function Cx(e){rc=e;const t=Object.keys(e.defs),i=t.length;let n,r;for(n=0;n<i;++n){const s=t[n];if(!X(s)){const o=e.defs(s);let a=o.units;a||o.projName!=="longlat"||(a="degrees"),wu(new xr({code:s,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(n=0;n<i;++n){const s=t[n],o=X(s);for(r=0;r<i;++r){const a=t[r],l=X(a);if(!du(s,a))if(e.defs[s]===e.defs[a])Cl([o,l]);else{const h=e(s,a);gm(o,l,Tu(o,l,h.forward),Tu(l,o,h.inverse))}}}}let yf=async function(e){const t=await fetch(`https://epsg.io/${e}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};var Hr=class extends $r{constructor(e){super(e)}createRenderer(){return new _f(this)}};function xf(e,t,i){const n=[];let r=e(0),s=e(1),o=t(r),a=t(s);const l=[s,r],h=[a,o],c=[1,0],u={};let g,f,p,m,_,x,y=1e5;for(;--y>0&&c.length>0;)p=c.pop(),r=l.pop(),o=h.pop(),x=p.toString(),x in u||(n.push(o[0],o[1]),u[x]=!0),m=c.pop(),s=l.pop(),a=h.pop(),_=(p+m)/2,g=e(_),f=t(g),gu(f[0],f[1],o[0],o[1],a[0],a[1])<i?(n.push(a[0],a[1]),x=m.toString(),u[x]=!0):(c.push(m,_,_,p),h.push(a,f,f,o),l.push(s,g,g,r));return n}function bx(e,t,i,n,r){return xf(function(s){return[e,t+(i-t)*s]},ii(X("EPSG:4326"),n),r)}function Rx(e,t,i,n,r){return xf(function(s){return[t+(i-t)*s,e]},ii(X("EPSG:4326"),n),r)}const vE=new li({color:"rgba(0,0,0,0.2)"}),wE=[90,45,30,20,10,5,2,1,.5,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];var SE=class extends Hr{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:vE,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?To.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?To.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Nt({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new Zs({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new bi({color:"rgba(0,0,0,1)"}),stroke:new li({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=i=>{const n=i.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(n),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Nt({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new Zs({font:"12px Calibri,sans-serif",textAlign:"right",fill:new bi({color:"rgba(0,0,0,1)"}),stroke:new li({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=i=>{const n=i.get("graticule_label");return this.latLabelStyleBase_.getText().setText(n),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Zl,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:wE,this.setSource(new kr({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Je,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Nt({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let i=e.slice();return this.projection_&&this.getSource().getWrapX()&&ml(i,this.projection_),this.loadedExtent_&&(Xp(this.loadedExtent_,i,t)?i=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[i]}loaderFunction(e,t,i){this.loadedExtent_=e;const n=this.getSource(),r=We(this.getExtent()||[-1/0,-1/0,1/0,1/0],e);if(this.renderedExtent_&&It(this.renderedExtent_,r)&&this.renderedResolution_===t||(this.renderedExtent_=r,this.renderedResolution_=t,fi(r)))return;const s=rt(r),o=t*t/4;(!this.projection_||!ct(this.projection_,i))&&this.updateProjectionInfo_(i),this.createGraticule_(r,s,t,o);let a,l=this.meridians_.length+this.parallels_.length;for(this.meridiansLabels_&&(l+=this.meridians_.length),this.parallelsLabels_&&(l+=this.parallels_.length);l>this.featurePool_.length;)a=new Se,this.featurePool_.push(a);const h=n.getFeaturesCollection();h.clear();let c,u,g=0;for(c=0,u=this.meridians_.length;c<u;++c)a=this.featurePool_[g++],a.setGeometry(this.meridians_[c]),a.setStyle(this.lineStyle_),h.push(a);for(c=0,u=this.parallels_.length;c<u;++c)a=this.featurePool_[g++],a.setGeometry(this.parallels_[c]),a.setStyle(this.lineStyle_),h.push(a)}addMeridian_(e,t,i,n,r,s){const o=this.getMeridian_(e,t,i,n,s);if(Ie(o.getExtent(),r)){if(this.meridiansLabels_){const a=this.lonLabelFormatter_(e);s in this.meridiansLabels_?this.meridiansLabels_[s].text=a:this.meridiansLabels_[s]={geom:new Ae([]),text:a}}this.meridians_[s++]=o}return s}addParallel_(e,t,i,n,r,s){const o=this.getParallel_(e,t,i,n,s);if(Ie(o.getExtent(),r)){if(this.parallelsLabels_){const a=this.latLabelFormatter_(e);s in this.parallelsLabels_?this.parallelsLabels_[s].text=a:this.parallelsLabels_[s]={geom:new Ae([]),text:a}}this.parallels_[s++]=o}return s}drawLabels_(e){const t=e.frameState.viewState.rotation,i=e.frameState.viewState.resolution,n=e.frameState.size,r=e.frameState.extent,s=rt(r);let o=r;if(t){const f=n[0]*i,p=n[1]*i;o=[s[0]-f/2,s[1]-p/2,s[0]+f/2,s[1]+p/2]}let a=0,l=0,h=this.latLabelPosition_<.5;const c=this.projection_.getExtent(),u=ne(c);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ht(c,r)&&(a=Math.floor((r[0]-c[0])/u),l=Math.ceil((r[2]-c[2])/u),h=h!==Math.abs(t)>Math.PI/2);const g=f0(e);for(let f=a;f<=l;++f){let p,m,_,x,y=this.meridians_.length+this.parallels_.length;if(this.meridiansLabels_)for(m=0,_=this.meridiansLabels_.length;m<_;++m){const v=this.meridians_[m];if(t||f!==0){const w=v.clone();w.translate(f*u,0),w.rotate(-t,s),x=this.getMeridianPoint_(w,o,m),x.rotate(t,s)}else x=this.getMeridianPoint_(v,r,m);p=this.featurePool_[y++],p.setGeometry(x),p.set("graticule_label",this.meridiansLabels_[m].text),g.drawFeature(p,this.lonLabelStyle_(p))}if(this.parallelsLabels_&&(f===a&&h||f===l&&!h))for(m=0,_=this.parallels_.length;m<_;++m){const v=this.parallels_[m];if(t||f!==0){const w=v.clone();w.translate(f*u,0),w.rotate(-t,s),x=this.getParallelPoint_(w,o,m),x.rotate(t,s)}else x=this.getParallelPoint_(v,r,m);p=this.featurePool_[y++],p.setGeometry(x),p.set("graticule_label",this.parallelsLabels_[m].text),g.drawFeature(p,this.latLabelStyle_(p))}}}createGraticule_(e,t,i,n){const r=this.getInterval_(i);if(r==-1)return this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));let s=!1;const o=this.projection_.getExtent(),a=ne(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ht(o,e)&&(ne(e)>=a?(e[0]=o[0],e[2]=o[2]):s=!0);const l=[H(t[0],this.minX_,this.maxX_),H(t[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(l);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let c=H(h[0],this.minLon_,this.maxLon_),u=H(h[1],this.minLat_,this.maxLat_);const g=this.maxLines_;let f,p,m,_,x=e;s||(x=[H(e[0],this.minX_,this.maxX_),H(e[1],this.minY_,this.maxY_),H(e[2],this.minX_,this.maxX_),H(e[3],this.minY_,this.maxY_)]);const y=_r(x,this.toLonLatTransform_,void 0,8);let v=y[3],w=y[2],S=y[1],C=y[0];if(s||(Jt(x,this.bottomLeft_)&&(C=this.minLon_,S=this.minLat_),Jt(x,this.bottomRight_)&&(w=this.maxLon_,S=this.minLat_),Jt(x,this.topLeft_)&&(C=this.minLon_,v=this.maxLat_),Jt(x,this.topRight_)&&(w=this.maxLon_,v=this.maxLat_),v=H(v,u,this.maxLat_),w=H(w,c,this.maxLon_),S=H(S,this.minLat_,u),C=H(C,this.minLon_,c)),c=Math.floor(c/r)*r,_=H(c,this.minLon_,this.maxLon_),p=this.addMeridian_(_,S,v,n,e,0),f=0,s)for(;(_-=r)>=C&&f++<g;)p=this.addMeridian_(_,S,v,n,e,p);else for(;_!=this.minLon_&&f++<g;)_=Math.max(_-r,this.minLon_),p=this.addMeridian_(_,S,v,n,e,p);if(_=H(c,this.minLon_,this.maxLon_),f=0,s)for(;(_+=r)<=w&&f++<g;)p=this.addMeridian_(_,S,v,n,e,p);else for(;_!=this.maxLon_&&f++<g;)_=Math.min(_+r,this.maxLon_),p=this.addMeridian_(_,S,v,n,e,p);for(this.meridians_.length=p,this.meridiansLabels_&&(this.meridiansLabels_.length=p),u=Math.floor(u/r)*r,m=H(u,this.minLat_,this.maxLat_),p=this.addParallel_(m,C,w,n,e,0),f=0;m!=this.minLat_&&f++<g;)m=Math.max(m-r,this.minLat_),p=this.addParallel_(m,C,w,n,e,p);for(m=H(u,this.minLat_,this.maxLat_),f=0;m!=this.maxLat_&&f++<g;)m=Math.min(m+r,this.maxLat_),p=this.addParallel_(m,C,w,n,e,p);this.parallels_.length=p,this.parallelsLabels_&&(this.parallelsLabels_.length=p)}getInterval_(e){const t=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let n=-1;const r=Math.pow(this.targetSize_*e,2),s=[],o=[];for(let a=0,l=this.intervals_.length;a<l;++a){const h=H(this.intervals_[a]/2,0,90),c=H(i,-90+h,90-h);if(s[0]=t-h,s[1]=c-h,o[0]=t+h,o[1]=c+h,this.fromLonLatTransform_(s,s),this.fromLonLatTransform_(o,o),Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)<=r)break;n=this.intervals_[a]}return n}getMeridian_(e,t,i,n,r){const s=bx(e,t,i,this.projection_,n);let o=this.meridians_[r];return o?(o.setFlatCoordinates("XY",s),o.changed()):(o=new Ue(s,"XY"),this.meridians_[r]=o),o}getMeridianPoint_(e,t,i){const n=e.getFlatCoordinates();let r=1,s=n.length-1;n[r]>n[s]&&(r=s,s=1);const o=Math.max(t[1],n[r]),a=Math.min(t[3],n[s]),l=H(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,o,a),h=[n[r-1]+(n[s-1]-n[r-1])*(l-n[r])/(n[s]-n[r]),l],c=this.meridiansLabels_[i].geom;return c.setCoordinates(h),c}getMeridians(){return this.meridians_}getParallel_(e,t,i,n,r){const s=Rx(e,t,i,this.projection_,n);let o=this.parallels_[r];return o?(o.setFlatCoordinates("XY",s),o.changed()):o=new Ue(s,"XY"),o}getParallelPoint_(e,t,i){const n=e.getFlatCoordinates();let r=0,s=n.length-2;n[r]>n[s]&&(r=s,s=0);const o=Math.max(t[0],n[r]),a=Math.min(t[2],n[s]),l=H(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,o,a),h=[l,n[r+1]+(n[s+1]-n[r+1])*(l-n[r])/(n[s]-n[r])],c=this.parallelsLabels_[i].geom;return c.setCoordinates(h),c}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=X("EPSG:4326"),i=e.getWorldExtent();this.maxLat_=i[3],this.maxLon_=i[2],this.minLat_=i[1],this.minLon_=i[0];const n=ii(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=n;else{const s=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(o,a,l){const h=n(o,a,l=l||2);for(let c=0,u=h.length;c<u;c+=l)h[c]<s&&(h[c]+=360);return h}}this.fromLonLatTransform_=ii(t,e);const r=_r([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=r[0],this.maxX_=r[2],this.minY_=r[1],this.maxY_=r[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(rt(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}};const sc="blur",vf="gradient",oc="radius",EE=["#00f","#0ff","#0f0","#ff0","#f00"];var TE=class extends $r{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(vf,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:EE),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";this.weightFunction_=typeof i=="string"?function(n){return n.get(i)}:i,this.setRenderOrder(null)}getBlur(){return this.get(sc)}getGradient(){return this.get(vf)}getRadius(){return this.get(oc)}handleGradientChanged_(){this.gradient_=function(e){const n=ke(1,256),r=n.createLinearGradient(0,0,1,256),s=1/(e.length-1);for(let o=0,a=e.length;o<a;++o)r.addColorStop(o*s,e[o]);return n.fillStyle=r,n.fillRect(0,0,1,256),n.canvas}(this.getGradient())}setBlur(e){this.set(sc,e)}setGradient(e){this.set(vf,e)}setRadius(e){this.set(oc,e)}createRenderer(){const e=new Hh().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new nf(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const i=this.weightFunction_(t);return i!==void 0?H(i,0,1):1}}],uniforms:{u_size:()=>2*(this.get(oc)+this.get(sc)),u_blurSlope:()=>this.get(oc)/Math.max(1,this.get(sc))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}},CE=class extends $r{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Ex(this)}},bE=class extends $r{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";ie(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError===void 0||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new Tx(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Oh)}getUseInterimTilesOnError(){return this.get(Nh)}setPreload(e){this.set(Oh,e)}setUseInterimTilesOnError(e){this.set(Nh,e)}},RE=class extends Rr{constructor(e){super(Object.assign({},e)),this.parseResult_=Jh(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new nf(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}};function Px(e,t){const i=`
    attribute vec2 ${ya.TEXTURE_COORD};
    uniform mat4 ${ae.TILE_TRANSFORM};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.TEXTURE_RESOLUTION};
    uniform float ${ae.TEXTURE_ORIGIN_X};
    uniform float ${ae.TEXTURE_ORIGIN_Y};
    uniform float ${ae.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${ya.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${ae.TEXTURE_ORIGIN_X} + ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${ae.TEXTURE_ORIGIN_Y} - ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${ae.TILE_TRANSFORM} * vec4(${ya.TEXTURE_COORD}, ${ae.DEPTH}, 1.0);
    }
  `,n={inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{},inFragmentShader:!0,bandCount:t,style:e},r=[];if(e.color!==void 0){const c=te(n,e.color,Fe);r.push(`color = ${c};`)}if(e.contrast!==void 0){const c=te(n,e.contrast,j);r.push(`color.rgb = clamp((${c} + 1.0) * color.rgb - (${c} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.exposure!==void 0){const c=te(n,e.exposure,j);r.push(`color.rgb = clamp((${c} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.saturation!==void 0){const c=te(n,e.saturation,j);r.push(`
      float saturation = ${c} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(e.gamma!==void 0){const c=te(n,e.gamma,j);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${c}));`)}if(e.brightness!==void 0){const c=te(n,e.brightness,j);r.push(`color.rgb = clamp(color.rgb + ${c}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!e.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let c=0;c<o;++c){const u=n.variables[Object.keys(n.variables)[c]];if(!(u.name in e.variables))throw new Error(`Missing '${u.name}' in style variables`);s[Kh(u.name)]=function(){let g=e.variables[u.name];return typeof g=="string"&&(g=va(g)),g!==void 0?g:-9999999}}const a=Object.keys(s).map(function(c){return`uniform float ${c};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${ae.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${Ng}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(c){return n.functions[c]});return{vertexShader:i,fragmentShader:`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${ae.RENDER_EXTENT};
    uniform float ${ae.TRANSITION_ALPHA};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.RESOLUTION};
    uniform float ${ae.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${ae.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${ae.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${ae.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${ae.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${ae.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${ae.TRANSITION_ALPHA};
    }`,uniforms:s,paletteTextures:n.paletteTextures}}class Fx extends lg{constructor(t){const i=(t=t?Object.assign({},t):{}).style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=i,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Wl,this.handleSourceUpdate_)}getSources(t,i){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,i):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,i=this.getSources([-t,-t,t,t],t);return i&&i.length&&"bandCount"in i[0]?i[0].bandCount:4}createRenderer(){const t=Px(this.style_,this.getSourceBandCount_());return new Oy(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,i){const n=this.getRenderer();let r;for(let s=0,o=i.length;s<o;++s)this.renderedSource_=i[s],n.prepareFrame(t)&&(r=n.renderFrame(t));return r}render(t,i){this.rendered=!0;const n=t.viewState,r=this.getSources(t.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(t,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const i=Px(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms,paletteTextures:i.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}Fx.prototype.dispose;var PE=Fx,FE=class extends Di{constructor(e){const t=e||{};super(t),t.stopDown&&(this.stopDown=t.stopDown),this.scaleDeltaByPixel_=t.delta?t.delta:.01,this.duration_=t.duration!==void 0?t.duration:250,this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0,this.trackedPointers_={},this.targetPointers=[]}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence_){if(e.type==re.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==re.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence_=i}}else if(e.type==re.POINTERDOWN)if(this.handlingDoubleDownSequence_){this.handlingDoubleDownSequence_=!1;const i=this.handleDownEvent(e);this.handlingDownUpSequence_=i,t=this.stopDown(i)}else t=this.stopDown(!1),this.waitForDblTap_();return!t}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.down_.originalEvent,r=i.clientY-n.clientY;this.lastDistance_!==void 0&&(t=1-(this.lastDistance_-r)*this.scaleDeltaByPixel_),this.lastDistance_=r,t!=1&&(this.lastScaleDelta_=t);const s=e.map,o=s.getView();s.render(),o.adjustResolutionInternal(t)}handleDownEvent(e){if(this.targetPointers.length==1){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.down_=e,this.handlingDownUpSequence_||t.getView().beginInteraction(),!0}return!1}handleUpEvent(e){if(this.targetPointers.length==0){const t=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,i),this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,!1}return!0}stopDown(e){return e}updateTrackedPointers_(e){if(function(t){const i=t.type;return i===re.POINTERDOWN||i===re.POINTERDRAG||i===re.POINTERUP}(e)){const t=e.originalEvent,i=t.pointerId.toString();e.type==re.POINTERUP?delete this.trackedPointers_[i]:(e.type==re.POINTERDOWN||i in this.trackedPointers_)&&(this.trackedPointers_[i]=t),this.targetPointers=Object.values(this.trackedPointers_)}}waitForDblTap_(){this.doubleTapTimeoutId_!==void 0?(clearTimeout(this.doubleTapTimeoutId_),this.doubleTapTimeoutId_=void 0):(this.handlingDoubleDownSequence_=!0,this.doubleTapTimeoutId_=setTimeout(this.endInteraction_.bind(this),250))}endInteraction_(){this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0}};const IE="addfeatures";class Ix extends He{constructor(t,i,n,r){super(t),this.features=n,this.file=i,this.projection=r}}var LE=class extends Di{constructor(e){e=e||{},super({handleEvent:Ut}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const t=e.formatConstructors?e.formatConstructors:[];for(let i=0,n=t.length;i<n;++i){let r=t[i];typeof r=="function"&&(r=new r),this.formats_.push(r),this.readAsBuffer_=this.readAsBuffer_||r.getType()==="arraybuffer"}this.projection_=e.projection?X(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,t){const i=t.target.result,n=this.getMap();let r,s=this.projection_;!s&&(s=Qe(),!s)&&(s=n.getView().getProjection());const o=this.formats_;for(let a=0,l=o.length;a<l;++a){const h=o[a];let c=i;this.readAsBuffer_&&h.getType()!=="arraybuffer"&&(r===void 0&&(r=new TextDecoder().decode(i)),c=r);const u=this.tryReadFeatures_(h,c,{featureProjection:s});if(u&&u.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(u)),this.dispatchEvent(new Ix(IE,e,u,s));break}}}registerListeners_(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[W(t,wp,this.handleDrop,this),W(t,aw,this.handleStop,this),W(t,lw,this.handleStop,this),W(t,wp,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,t,i){try{return e.readFeatures(t,i)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(fe),this.dropListenKeys_=null)}handleDrop(e){const t=e.dataTransfer.files;for(let i=0,n=t.length;i<n;++i){const r=t.item(i),s=new FileReader;s.addEventListener(Ep,this.handleResult_.bind(this,r)),this.readAsBuffer_?s.readAsArrayBuffer(r):s.readAsText(r)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},ME=class extends ni{constructor(e){super(e=e||{}),this.condition_=e.condition?e.condition:$o,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=e.duration!==void 0?e.duration:400}handleDragEvent(e){if(!Ar(e))return;const t=e.map,i=t.getSize(),n=e.pixel,r=n[0]-i[0]/2,s=i[1]/2-n[1],o=Math.atan2(s,r),a=Math.sqrt(r*r+s*s),l=t.getView();if(this.lastAngle_!==void 0){const h=this.lastAngle_-o;l.adjustRotationInternal(h)}this.lastAngle_=o,this.lastMagnitude_!==void 0&&l.adjustResolutionInternal(this.lastMagnitude_/a),this.lastMagnitude_!==void 0&&(this.lastScaleDelta_=this.lastMagnitude_/a),this.lastMagnitude_=a}handleUpEvent(e){if(!Ar(e))return!0;const t=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,i),this.lastScaleDelta_=0,!1}handleDownEvent(e){return!!Ar(e)&&!!this.condition_(e)&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0)}};const Lx="drawstart",AE="drawend",OE="drawabort";class Na extends He{constructor(t,i){super(t),this.feature=i}}function ac(e,t){return mi(e[0],e[1],t[0],t[1])}function Ks(e,t){const i=e.length;return t<0?e[t+i]:t>=i?e[t-i]:e[t]}function lc(e,t,i){let n,r;t<i?(n=t,r=i):(n=i,r=t);const s=Math.ceil(n),o=Math.floor(r);if(s>o)return ac(Hs(e,n),Hs(e,r));let a=0;n<s&&(a+=ac(Hs(e,n),Ks(e,s))),o<r&&(a+=ac(Ks(e,o),Hs(e,r)));for(let l=s;l<o-1;++l)a+=ac(Ks(e,l),Ks(e,l+1));return a}function Mx(e,t,i){if(t instanceof Ue)hc(e,t.getCoordinates(),!1,i);else if(t instanceof Et){const n=t.getCoordinates();for(let r=0,s=n.length;r<s;++r)hc(e,n[r],!1,i)}else if(t instanceof ot){const n=t.getCoordinates();for(let r=0,s=n.length;r<s;++r)hc(e,n[r],!0,i)}else if(t instanceof Zt){const n=t.getCoordinates();for(let r=0,s=n.length;r<s;++r){const o=n[r];for(let a=0,l=o.length;a<l;++a)hc(e,o[a],!0,i)}}else if(t instanceof ut){const n=t.getGeometries();for(let r=0;r<n.length;++r)Mx(e,n[r],i)}}const wf={index:-1,endIndex:NaN};function hc(e,t,i,n){const r=e[0],s=e[1];for(let o=0,a=t.length-1;o<a;++o){const l=Ax(r,s,t[o],t[o+1]);if(l.squaredDistance===0){const h=o+l.along;return void n.push({coordinates:t,ring:i,startIndex:h,endIndex:h})}}}const Sf={along:0,squaredDistance:0};function Ax(e,t,i,n){const r=i[0],s=i[1],o=n[0]-r,a=n[1]-s;let l=0,h=r,c=s;return o===0&&a===0||(l=H(((e-r)*o+(t-s)*a)/(o*o+a*a),0,1),h+=o*l,c+=a*l),Sf.along=l,Sf.squaredDistance=An(mi(e,t,h,c),10),Sf}function Hs(e,t){const i=e.length;let n=Math.floor(t);const r=t-n;n>=i?n-=i:n<0&&(n+=i);let s=n+1;s>=i&&(s-=i);const o=e[n],a=o[0],l=o[1],h=e[s];return[a+(h[0]-a)*r,l+(h[1]-l)*r]}function NE(){const e=Ws();return function(t,i){return e[t.getGeometry().getType()]}}var DE=class extends ni{constructor(e){const t=e;t.stopDown||(t.stopDown=bn),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Ut,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const n=this.mode_;if(n==="Circle")i=function(r,s,o){const a=s||new $d([NaN,NaN]),l=Ee(r[0],o),h=Vt(l,Ee(r[r.length-1],o));a.setCenterAndRadius(l,Math.sqrt(h),this.geometryLayout_);const c=Qe();return c&&a.transform(o,c),a};else{let r;n==="Point"?r=Ae:n==="LineString"?r=Ue:n==="Polygon"&&(r=ot),i=function(s,o,a){return o?n==="Polygon"?s[0].length?o.setCoordinates([s[0].concat([s[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(s,this.geometryLayout_):o=new r(s,this.geometryLayout_),o}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Hr({source:new kr({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:NE(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:ah,this.freehandCondition_,e.freehand?this.freehandCondition_=Mr:this.freehandCondition_=e.freehandCondition?e.freehandCondition:$o,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(ih,this.updateState_)}setTrace(e){let t;t=e?e===!0?Mr:e:oh,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Kc&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===re.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===re.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===re.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===re.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===re.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===re.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===re.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Oi(re.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),i=Xe([t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_])]),n=this.traceSource_.getFeaturesInExtent(i);if(n.length===0)return;const r=function(s,o){const a=[];for(let l=0;l<o.length;++l)Mx(s,o[l].getGeometry(),a);return a}(e.coordinate,n);r.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:r,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),i=r-n+1}else{const n=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),i=n-r+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const r=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let o=r;o<=s;++o)n.push(Ks(e.coordinates,o))}else{const r=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let o=r;o>=s;--o)n.push(Ks(e.coordinates,o))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&ps(t.startPx,e.pixel)<this.snapTolerance_)return;const i=function(o,a,l,h){const c=o[0],u=o[1];let g=1/0,f=-1,p=NaN;for(let x=0;x<a.targets.length;++x){const y=a.targets[x],v=y.coordinates;let w,S=1/0;for(let C=0;C<v.length-1;++C){const E=Ax(c,u,v[C],v[C+1]);E.squaredDistance<S&&(S=E.squaredDistance,w=C+E.along)}S<g&&(g=S,y.ring&&a.targetIndex===x&&(y.endIndex>y.startIndex?w<y.startIndex&&(w+=v.length):y.endIndex<y.startIndex&&w>y.startIndex&&(w-=v.length)),p=w,f=x)}const m=a.targets[f];let _=m.ring;if(a.targetIndex===f&&_){const x=Hs(m.coordinates,p);ps(l.getPixelFromCoordinate(x),a.startPx)>h&&(_=!1)}if(_){const x=m.coordinates,y=x.length,v=m.startIndex,w=p;if(v<w){const S=lc(x,v,w);lc(x,v,w-y)<S&&(p-=y)}else{const S=lc(x,v,w);lc(x,v,w+y)<S&&(p+=y)}}return wf.index=f,wf.endIndex=p,wf}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const a=t.targets[t.targetIndex];this.removeTracedCoordinates_(a.startIndex,a.endIndex)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const r=Hs(n.coordinates,n.endIndex),s=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(s[0]),Math.round(s[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():this.freehand_||n&&this.mode_!=="Point"||(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],r=t[1]-i[1],s=n*n+r*r;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,r=[this.finishCoordinate_];const s=this.mode_;if(s==="Point")i=!0;else if(s==="Circle")i=this.sketchCoords_.length===2;else if(s==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(s==="Polygon"){const o=this.sketchCoords_;n=o[0].length>this.minPoints_,r=[o[0][0],o[0][o[0].length-2]],r=t?[o[0][0]]:[o[0][0],o[0][o[0].length-2]]}if(n){const o=this.getMap();for(let a=0,l=r.length;a<l;a++){const h=r[a],c=o.getPixelFromCoordinate(h),u=e[0]-c[0],g=e[1]-c[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(u*u+g*g)<=f,i){this.finishCoordinate_=h;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Se(new Ae(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Se);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new Ue(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=ms(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Se(new Ue(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Se,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new Na(Lx,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),r=ms(this.geometryLayout_);let s,o;for(;e.length<r;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(s=this.sketchCoords_[0],o=s[s.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(s=this.sketchCoords_,o=s[s.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,r;const s=this.mode_;s==="LineString"||s==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),this.geometryFunction_(r,t,i)):s==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),n&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let r=0;r<e;++r){let s;if(n==="LineString"||n==="Circle"){if(s=this.sketchCoords_,s.splice(-2,1),s.length>=2){this.finishCoordinate_=s[s.length-2].slice();const o=this.finishCoordinate_.slice();s[s.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(s,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){s=this.sketchCoords_[0],s.splice(-2,1);const o=this.sketchLine_.getGeometry();if(s.length>=2){const a=s[s.length-2].slice();s[s.length-1]=a,this.createOrUpdateSketchPoint_(a)}o.setCoordinates(s),this.geometryFunction_(this.sketchCoords_,t,i)}if(s.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new ri([t])):this.type_==="MultiLineString"?e.setGeometry(new Et([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Zt([t])),this.dispatchEvent(new Na(AE,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Na(OE,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;let n;if(i&&this.startDrawing_(e[0]),t==="LineString"||t==="Circle")n=this.sketchCoords_;else{if(t!=="Polygon")return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&n.shift(),n.pop();for(let s=0;s<e.length;s++)this.addToDrawing_(e[s]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new Se(new Ae(i)),this.updateSketchFeatures_(),this.dispatchEvent(new Na(Lx,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)}};const kE="extentchanged";class Ox extends He{constructor(t){super(kE),this.extent=t}}function GE(){const e=Ws();return function(t,i){return e.Polygon}}function jE(){const e=Ws();return function(t,i){return e.Point}}function Nx(e){return function(t){return Xe([e,t])}}function Dx(e,t){return e[0]==t[0]?function(i){return Xe([e,[i[0],t[1]]])}:e[1]==t[1]?function(i){return Xe([e,[t[0],i[1]]])}:null}var BE=class extends ni{constructor(e){super(e=e||{}),this.on,this.once,this.un,this.condition_=e.condition?e.condition:Mr,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new Hr({source:new kr({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:GE(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new Hr({source:new kr({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:jE(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){const i=t.getCoordinateFromPixelInternal(e),n=function(s,o){return vl(i,s)-vl(i,o)},r=this.getExtentInternal();if(r){const s=function(h){return[[[h[0],h[1]],[h[0],h[3]]],[[h[0],h[3]],[h[2],h[3]]],[[h[2],h[3]],[h[2],h[1]]],[[h[2],h[1]],[h[0],h[1]]]]}(r);s.sort(n);const o=s[0];let a=Eo(i,o);const l=t.getPixelFromCoordinateInternal(a);if(ps(e,l)<=this.pixelTolerance_){const h=t.getPixelFromCoordinateInternal(o[0]),c=t.getPixelFromCoordinateInternal(o[1]),u=Vt(l,h),g=Vt(l,c),f=Math.sqrt(Math.min(u,g));return this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(a=u>g?o[1]:o[0]),a}}return null}handlePointerMove_(e){const t=e.pixel,i=e.map;let n=this.snapToVertex_(t,i);n||(n=i.getCoordinateFromPixelInternal(t)),this.createOrUpdatePointerFeature_(n)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(Cr(e)):t.setGeometry(void 0):(t=new Se(e?Cr(e):{}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}createOrUpdatePointerFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new Se(new Ae(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t)),t}handleEvent(e){return!e.originalEvent||!this.condition_(e)||(e.type!=re.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),super.handleEvent(e),!1)}handleDownEvent(e){const t=e.pixel,i=e.map,n=this.getExtentInternal();let r=this.snapToVertex_(t,i);const s=function(o){let a=null,l=null;return o[0]==n[0]?a=n[2]:o[0]==n[2]&&(a=n[0]),o[1]==n[1]?l=n[3]:o[1]==n[3]&&(l=n[1]),a!==null&&l!==null?[a,l]:null};if(r&&n){const o=r[0]==n[0]||r[0]==n[2]?r[0]:null,a=r[1]==n[1]||r[1]==n[3]?r[1]:null;o!==null&&a!==null?this.pointerHandler_=Nx(s(r)):o!==null?this.pointerHandler_=Dx(s([o,n[1]]),s([o,n[3]])):a!==null&&(this.pointerHandler_=Dx(s([n[0],a]),s([n[2],a])))}else r=i.getCoordinateFromPixelInternal(t),this.setExtent([r[0],r[1],r[0],r[1]]),this.pointerHandler_=Nx(r);return!0}handleDragEvent(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}}handleUpEvent(e){this.pointerHandler_=null;const t=this.getExtentInternal();return t&&Mn(t)!==0||this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return Ii(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new Ox(this.extent_))}};function Da(e){return parseFloat(e)}function ka(e){return function(t){return An(t,5)}(e).toString()}function cc(e,t){return!isNaN(e)&&e!==Da(ka(t))}var UE=class extends Di{constructor(e){let t;super(),t=(e=Object.assign({animate:!0,params:["x","y","z","r","l"],replace:!1,prefix:""},e||{})).animate===!0?{duration:250}:e.animate?e.animate:null,this.animationOptions_=t,this.params_=e.params.reduce((i,n)=>(i[n]=!0,i),{}),this.replace_=e.replace,this.prefix_=e.prefix,this.listenerKeys_=[],this.initial_=!0,this.updateState_=this.updateState_.bind(this),this.trackedCallbacks_={},this.trackedValues_={}}getParamName_(e){return this.prefix_?this.prefix_+e:e}get_(e,t){return e.get(this.getParamName_(t))}set_(e,t,i){t in this.params_&&e.set(this.getParamName_(t),i)}delete_(e,t){t in this.params_&&e.delete(this.getParamName_(t))}setMap(e){const t=this.getMap();super.setMap(e),e!==t&&(t&&this.unregisterListeners_(t),e&&(this.initial_=!0,this.updateState_(),this.registerListeners_(e)))}registerListeners_(e){this.listenerKeys_.push(W(e,w_,this.updateUrl_,this),W(e.getLayerGroup(),he,this.updateUrl_,this),W(e,"change:layergroup",this.handleChangeLayerGroup_,this)),this.replace_||addEventListener("popstate",this.updateState_)}unregisterListeners_(e){for(let n=0,r=this.listenerKeys_.length;n<r;++n)fe(this.listenerKeys_[n]);this.listenerKeys_.length=0,this.replace_||removeEventListener("popstate",this.updateState_);const t=new URL(window.location.href),i=t.searchParams;this.delete_(i,"x"),this.delete_(i,"y"),this.delete_(i,"z"),this.delete_(i,"r"),this.delete_(i,"l"),window.history.replaceState(null,"",t)}handleChangeLayerGroup_(){const e=this.getMap();e&&(this.unregisterListeners_(e),this.registerListeners_(e),this.initial_=!0,this.updateUrl_())}updateState_(){const e=new URL(window.location.href).searchParams;for(const g in this.trackedCallbacks_){const f=e.get(g);g in this.trackedCallbacks_&&f!==this.trackedValues_[g]&&(this.trackedValues_[g]=f,this.trackedCallbacks_[g](f))}const t=this.getMap();if(!t)return;const i=t.getView();if(!i)return;let n=!1;const r={},s=Da(this.get_(e,"z"));"z"in this.params_&&cc(s,i.getZoom())&&(n=!0,r.zoom=s);const o=Da(this.get_(e,"r"));"r"in this.params_&&cc(o,i.getRotation())&&(n=!0,r.rotation=o);const a=[Da(this.get_(e,"x")),Da(this.get_(e,"y"))];var l,h;("x"in this.params_||"y"in this.params_)&&(l=a,h=i.getCenter(),cc(l[0],h[0])||cc(l[1],h[1]))&&(n=!0,r.center=a),n&&(!this.initial_&&this.animationOptions_?i.animate(Object.assign(r,this.animationOptions_)):(r.center&&i.setCenter(r.center),"zoom"in r&&i.setZoom(r.zoom),"rotation"in r&&i.setRotation(r.rotation)));const c=t.getAllLayers(),u=this.get_(e,"l");if("l"in this.params_&&u&&u.length===c.length)for(let g=0,f=c.length;g<f;++g){const p=parseInt(u[g]);if(!isNaN(p)){const m=!!p,_=c[g];_.getVisible()!==m&&_.setVisible(m)}}}track(e,t){this.trackedCallbacks_[e]=t;const i=new URL(window.location.href).searchParams.get(e);return this.trackedValues_[e]=i,i}update(e,t){const i=new URL(window.location.href),n=i.searchParams;t===null?n.delete(e):n.set(e,t),e in this.trackedValues_&&(this.trackedValues_[e]=t),this.updateHistory_(i)}updateUrl_(){const e=this.getMap();if(!e)return;const t=e.getView();if(!t)return;const i=t.getCenter(),n=t.getZoom(),r=t.getRotation(),s=e.getAllLayers(),o=new Array(s.length);for(let h=0,c=s.length;h<c;++h)o[h]=s[h].getVisible()?"1":"0";const a=new URL(window.location.href),l=a.searchParams;this.set_(l,"x",ka(i[0])),this.set_(l,"y",ka(i[1])),this.set_(l,"z",ka(n)),this.set_(l,"r",ka(r)),this.set_(l,"l",o.join("")),this.updateHistory_(a),this.initial_=!1}updateHistory_(e){e.href!==window.location.href&&(this.initial_||this.replace_?window.history.replaceState(history.state,"",e):window.history.pushState(null,"",e))}};const kx=[0,0,0,0],Js=[],zE="modifystart",Gx="modifyend";class uc extends He{constructor(t,i,n){super(t),this.features=i,this.mapBrowserEvent=n}}function XE(e,t){return e.index-t.index}function jx(e,t,i){const n=t.geometry;if(n.getType()==="Circle"){let s=n;if(t.index===1){const o=Qe();o&&(s=s.clone().transform(o,i));const a=Vt(s.getCenter(),Ee(e,i)),l=Math.sqrt(a)-s.getRadius();return l*l}}const r=Ee(e,i);return Js[0]=Ee(t.segment[0],i),Js[1]=Ee(t.segment[1],i),vl(r,Js)}function Bx(e,t,i){const n=t.geometry;if(n.getType()==="Circle"&&t.index===1){let s=n;const o=Qe();return o&&(s=s.clone().transform(o,i)),Qi(s.getClosestPoint(Ee(e,i)),i)}const r=Ee(e,i);return Js[0]=Ee(t.segment[0],i),Js[1]=Ee(t.segment[1],i),Qi(Eo(r,Js),i)}function VE(){const e=Ws();return function(t,i){return e.Point}}var WE=class extends ni{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Td,this.defaultDeleteCondition_=function(i){return M_(i)&&Sd(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Mr,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ia,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Hr({source:new kr({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:VE(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new Je(this.source_.getFeatures()),this.source_.addEventListener(Un,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Gs,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(di,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(gi,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(he,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Je;const i=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){const s=t[n];for(let o=0,a=s.length;o<a;++o){const l=s[o].feature;l&&!i.includes(l)&&this.featuresBeingModified_.push(l)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new uc(zE,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(he,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const r=i[n];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===r&&this.dragSegments_.splice(s,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n],o={feature:e,geometry:t,depth:[n],index:n,segment:[s,s]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length-1;n<r;++n){const s=i.slice(n,n+2),o={feature:e,geometry:t,index:n,segment:s};this.rBush_.insert(Xe(s),o)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length-1;o<a;++o){const l=s.slice(o,o+2),h={feature:e,geometry:t,depth:[n],index:o,segment:l};this.rBush_.insert(Xe(l),h)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length-1;o<a;++o){const l=s.slice(o,o+2),h={feature:e,geometry:t,depth:[n],index:o,segment:l};this.rBush_.insert(Xe(l),h)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length;o<a;++o){const l=s[o];for(let h=0,c=l.length-1;h<c;++h){const u=l.slice(h,h+2),g={feature:e,geometry:t,depth:[o,n],index:h,segment:u};this.rBush_.insert(Xe(u),g)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:0,segment:[i,i]},r={feature:e,geometry:t,index:1,segment:[i,i]},s=[n,r];n.featureSegments=s,r.featureSegments=s,this.rBush_.insert(gr(i),n);let o=t;const a=Qe();if(a&&this.getMap()){const l=this.getMap().getView().getProjection();o=o.clone().transform(a,l),o=Do(o).transform(l,a)}this.rBush_.insert(o.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const r=i[n];(0,this.SEGMENT_WRITERS_[r.getType()])(e,r)}}createOrUpdateVertexFeature_(e,t,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new Se(new Ae(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=re.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=re.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==re.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let r=0,s=this.dragSegments_.length;r<s;++r){const o=this.dragSegments_[r],a=o[0],l=a.feature;i.includes(l)||i.push(l);const h=a.geometry;n.includes(h)||n.push(h);const c=a.depth;let u;const g=a.segment,f=o[1];for(;t.length<h.getStride();)t.push(g[f][t.length]);switch(h.getType()){case"Point":u=t,g[0]=t,g[1]=t;break;case"MultiPoint":u=h.getCoordinates(),u[a.index]=t,g[0]=t,g[1]=t;break;case"LineString":u=h.getCoordinates(),u[a.index+f]=t,g[f]=t;break;case"MultiLineString":case"Polygon":u=h.getCoordinates(),u[c[0]][a.index+f]=t,g[f]=t;break;case"MultiPolygon":u=h.getCoordinates(),u[c[1]][c[0]][a.index+f]=t,g[f]=t;break;case"Circle":if(g[0]=t,g[1]=t,a.index===0)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const p=e.map.getView().getProjection();let m=ps(Ee(h.getCenter(),p),Ee(t,p));const _=Qe();if(_){const x=h.clone().transform(_,p);x.setRadius(m),m=x.transform(p,_).getRadius()}h.setRadius(m),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(h,u)}this.createOrUpdateVertexFeature_(t,i,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const n=e.map.getView().getProjection(),r=[],s=i.getGeometry().getCoordinates(),o=Xe([s]),a=this.rBush_.getInExtent(o),l={};a.sort(XE);for(let h=0,c=a.length;h<c;++h){const u=a[h],g=u.segment;let f=k(u.geometry);const p=u.depth;if(p&&(f+="-"+p.join("-")),l[f]||(l[f]=new Array(2)),u.geometry.getType()!=="Circle"||u.index!==1)if(!ti(g[0],s)||l[f][0])if(!ti(g[1],s)||l[f][1])k(g)in this.vertexSegments_&&!l[f][0]&&!l[f][1]&&this.insertVertexCondition_(e)&&r.push(u);else{if(l[f][0]&&l[f][0].index===0){let m=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":m=m[p[1]];case"Polygon":if(u.index!==m[p[0]].length-2)continue}}this.dragSegments_.push([u,1]),l[f][1]=u}else this.dragSegments_.push([u,0]),l[f][0]=u;else ti(Bx(t,u,n),s)&&!l[f][0]&&(this.dragSegments_.push([u,0]),l[f][0]=u)}r.length&&this.willModifyFeatures_(e,[r]);for(let h=r.length-1;h>=0;--h)this.insertVertex_(r[h],s)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){const r=n.getCenter(),s=i.featureSegments[0],o=i.featureSegments[1];s.segment[0]=r,s.segment[1]=r,o.segment[0]=r,o.segment[1]=r,this.rBush_.update(gr(r),s);let a=n;const l=Qe();if(l){const h=e.map.getView().getProjection();a=a.clone().transform(l,h),a=Do(a).transform(h,l)}this.rBush_.update(a.getExtent(),o)}else this.rBush_.update(Xe(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new uc(Gx,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const n=i||t.getCoordinateFromPixel(e),r=t.getView().getProjection(),s=function(l,h){return jx(n,l,r)-jx(n,h,r)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(h,c,u)=>{u&&u.getType()==="Point"&&(u=new Ae(Qi(u.getCoordinates(),r)));const g=u||h.getGeometry();if(h instanceof Se&&this.features_.getArray().includes(h)){a=g;const f=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[f,f]}]}return!0},{layerFilter:l})}if(!o){const l=Ii(mt(At(gr(n,kx),r),t.getView().getResolution()*this.pixelTolerance_,kx),r);o=this.rBush_.getInExtent(l)}if(o&&o.length>0){const l=o.sort(s)[0],h=l.segment;let c=Bx(n,l,r);const u=t.getPixelFromCoordinate(c);let g=ps(e,u);if(a||g<=this.pixelTolerance_){const f={};if(f[k(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-n[0],this.delta_[1]=c[1]-n[1]),l.geometry.getType()==="Circle"&&l.index===1)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);else{const p=t.getPixelFromCoordinate(h[0]),m=t.getPixelFromCoordinate(h[1]),_=Vt(u,p),x=Vt(u,m);g=Math.sqrt(Math.min(_,x)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(c=_>x?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);const y={};y[k(l.geometry)]=!0;for(let v=1,w=o.length;v<w;++v){const S=o[v].segment;if(!(ti(h[0],S[0])&&ti(h[1],S[1])||ti(h[0],S[1])&&ti(h[1],S[0])))break;{const C=k(o[v].geometry);C in y||(y[C]=!0,f[k(S)]=!0)}}}return void(this.vertexSegments_=f)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,r=e.geometry,s=e.depth,o=e.index;let a;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":case"Polygon":a=r.getCoordinates(),a[s[0]].splice(o+1,0,t);break;case"MultiPolygon":a=r.getCoordinates(),a[s[1]][s[0]].splice(o+1,0,t);break;case"LineString":a=r.getCoordinates(),a.splice(o+1,0,t);break;default:return}this.setGeometryCoordinates_(r,a);const l=this.rBush_;l.remove(e),this.updateSegmentIndices_(r,o,s,1);const h={segment:[i[0],t],feature:n,geometry:r,depth:s,index:o};l.insert(Xe(h.segment),h),this.dragSegments_.push([h,1]);const c={segment:[t,i[1]],feature:n,geometry:r,depth:s,index:o+1};l.insert(Xe(c.segment),c),this.dragSegments_.push([c,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=re.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new uc(Gx,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i,n,r,s,o,a,l,h,c,u,g,f=!1;for(o=e.length-1;o>=0;--o)r=e[o],u=r[0],g=k(u.feature),u.depth&&(g+="-"+u.depth.join("-")),g in t||(t[g]={}),r[1]===0?(t[g].right=u,t[g].index=u.index):r[1]==1&&(t[g].left=u,t[g].index=u.index+1);for(g in t){switch(c=t[g].right,l=t[g].left,a=t[g].index,h=a-1,u=l!==void 0?l:c,h<0&&(h=0),s=u.geometry,n=s.getCoordinates(),i=n,f=!1,s.getType()){case"MultiLineString":n[u.depth[0]].length>2&&(n[u.depth[0]].splice(a,1),f=!0);break;case"LineString":n.length>2&&(n.splice(a,1),f=!0);break;case"MultiPolygon":i=i[u.depth[1]];case"Polygon":i=i[u.depth[0]],i.length>4&&(a==i.length-1&&(a=0),i.splice(a,1),f=!0,a===0&&(i.pop(),i.push(i[0]),h=i.length-1))}if(f){this.setGeometryCoordinates_(s,n);const p=[];if(l!==void 0&&(this.rBush_.remove(l),p.push(l.segment[0])),c!==void 0&&(this.rBush_.remove(c),p.push(c.segment[1])),l!==void 0&&c!==void 0){const m={depth:u.depth,feature:u.feature,geometry:u.geometry,index:h,segment:p};this.rBush_.insert(Xe(m.segment),m)}this.updateSegmentIndices_(s,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return f}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(i===void 0||r.depth===void 0||ui(r.depth,i))&&r.index>t&&(r.index+=n)})}};const ZE="select";class Ux extends He{constructor(t,i,n,r){super(t),this.selected=i,this.deselected=n,this.mapBrowserEvent=r}}const dc={};class Ef extends Di{constructor(t){let i;if(super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:Sd,this.addCondition_=t.addCondition?t.addCondition:oh,this.removeCondition_=t.removeCondition?t.removeCondition:oh,this.toggleCondition_=t.toggleCondition?t.toggleCondition:$o,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:Ut,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:function(){const n=Ws();return ge(n.Polygon,n.LineString),ge(n.GeometryCollection,n.LineString),function(r){return r.getGeometry()?n[r.getGeometry().getType()]:null}}(),this.features_=t.features||new Je,t.layers)if(typeof t.layers=="function")i=t.layers;else{const n=t.layers;i=function(r){return n.includes(r)}}else i=Ut;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,i){this.featureLayerAssociation_[k(t)]=i}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[k(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(di,this.boundAddFeature_),this.features_.addEventListener(gi,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(di,this.boundAddFeature_),this.features_.removeEventListener(gi,this.boundRemoveFeature_))}addFeature_(t){const i=t.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){const n=this.getMap().getAllLayers().find(function(r){if(r instanceof Hr&&r.getSource()&&r.getSource().hasFeature(i))return r});n&&this.addFeatureLayerAssociation_(i,n)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const i=k(t);i in dc||(dc[i]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const i=this.getMap().getInteractions().getArray();for(let r=i.length-1;r>=0;--r){const s=i[r];if(s!==this&&s instanceof Ef&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(t)!==-1)return void t.setStyle(s.getStyle())}const n=k(t);t.setStyle(dc[n]),delete dc[n]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[k(t)]}handleEvent(t){if(!this.condition_(t))return!0;const i=this.addCondition_(t),n=this.removeCondition_(t),r=this.toggleCondition_(t),s=!i&&!n&&!r,o=t.map,a=this.getFeatures(),l=[],h=[];if(s){Rn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(c instanceof Se&&this.filter_(c,u))return this.addFeatureLayerAssociation_(c,u),h.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=a.getLength()-1;c>=0;--c){const u=a.item(c),g=h.indexOf(u);g>-1?h.splice(g,1):(a.remove(u),l.push(u))}h.length!==0&&a.extend(h)}else{o.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(c instanceof Se&&this.filter_(c,u))return!i&&!r||a.getArray().includes(c)?(n||r)&&a.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)):(this.addFeatureLayerAssociation_(c,u),h.push(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)a.remove(l[c]);a.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new Ux(ZE,h,l,t)),!0}}var $E=Ef;const YE="snap";class zx extends He{constructor(t,i){super(t),this.vertex=i.vertex,this.vertexPixel=i.vertexPixel,this.feature=i.feature,this.segment=i.segment}}function Xx(e){return e.feature?e.feature:e.element?e.element:null}const Tf=[];var qE=class extends ni{constructor(e){const t=e=e||{};t.handleDownEvent||(t.handleDownEvent=Ut),t.stopDown||(t.stopDown=bn),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=e.vertex===void 0||e.vertex,this.edge_=e.edge===void 0||e.edge,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.rBush_=new ia,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=t===void 0||t;const i=k(e),n=e.getGeometry();if(n){const r=this.GEOMETRY_SEGMENTERS_[n.getType()];if(r){this.indexedFeaturesExtents_[i]=n.getExtent([1/0,1/0,-1/0,-1/0]);const s=[];if(r(s,n),s.length===1)this.rBush_.insert(Xe(s[0]),{feature:e,segment:s[0]});else if(s.length>1){const o=s.map(l=>Xe(l)),a=s.map(l=>({feature:e,segment:l}));this.rBush_.load(o,a)}}}t&&(this.featureChangeListenerKeys_[i]=W(e,he,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new zx(YE,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment}))),super.handleEvent(e)}handleFeatureAdd_(e){const t=Xx(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=Xx(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const i=k(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const i=t===void 0||t,n=k(e),r=this.indexedFeaturesExtents_[n];if(r){const s=this.rBush_,o=[];s.forEachInExtent(r,function(a){e===a.feature&&o.push(a)});for(let a=o.length-1;a>=0;--a)s.remove(o[a])}i&&(fe(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}setMap(e){const t=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();t&&(i.forEach(fe),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(fe),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?i.push(W(this.features_,di,this.handleFeatureAdd_,this),W(this.features_,gi,this.handleFeatureRemove_,this)):this.source_&&i.push(W(this.source_,Un,this.handleFeatureAdd_,this),W(this.source_,Gs,this.handleFeatureRemove_,this)),n.forEach(r=>this.addFeature(r)))}snapTo(e,t,i){const n=i.getView().getProjection(),r=Ee(t,n),s=Ii(mt(Xe([r]),i.getView().getResolution()*this.pixelTolerance_),n),o=this.rBush_.getInExtent(s),a=o.length;if(a===0)return null;let l,h,c=1/0,u=null;const g=this.pixelTolerance_*this.pixelTolerance_,f=()=>{if(l){const p=i.getPixelFromCoordinate(l);if(Vt(e,p)<=g)return{vertex:l,vertexPixel:[Math.round(p[0]),Math.round(p[1])],feature:h,segment:u}}return null};if(this.vertex_){for(let m=0;m<a;++m){const _=o[m];_.feature.getGeometry().getType()!=="Circle"&&_.segment.forEach(x=>{const y=Ee(x,n),v=Vt(r,y);v<c&&(l=x,c=v,h=_.feature)})}const p=f();if(p)return p}if(this.edge_){for(let m=0;m<a;++m){let _=null;const x=o[m];if(x.feature.getGeometry().getType()==="Circle"){let y=x.feature.getGeometry();const v=Qe();v&&(y=y.clone().transform(v,n)),_=am(r,y)}else{const[y,v]=x.segment;v&&(Tf[0]=Ee(y,n),Tf[1]=Ee(v,n),_=Eo(r,Tf))}if(_){const y=Vt(r,_);y<c&&(l=Qi(_,n),u=x.feature.getGeometry().getType()==="Circle"?null:x.segment,c=y)}}const p=f();if(p)return p}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){const i=this.getMap().getView().getProjection();let n=t;const r=Qe();r&&(n=n.clone().transform(r,i));const s=Do(n);r&&s.transform(i,r);const o=s.getCoordinates()[0];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}segmentGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const r=this.GEOMETRY_SEGMENTERS_[i[n].getType()];r&&r(e,i[n])}}segmentLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length-1;n<r;++n)e.push(i.slice(n,n+2))}segmentMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length-1;o<a;++o)e.push(s.slice(o,o+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(i=>{e.push([i])})}segmentMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length;o<a;++o){const l=s[o];for(let h=0,c=l.length-1;h<c;++h)e.push(l.slice(h,h+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const s=i[n];for(let o=0,a=s.length-1;o<a;++o)e.push(s.slice(o,o+2))}}};const KE="translatestart",HE="translating",JE="translateend";class gc extends He{constructor(t,i,n,r,s){super(t),this.features=i,this.coordinate=n,this.startCoordinate=r,this.mapBrowserEvent=s}}var QE=class extends ni{constructor(e){let t;if(super(e=e||{}),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null,e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(n){return i.includes(n)}}else t=Ut;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Ut,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Mr,this.lastFeature_=null,this.addChangeListener(ih,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new Je([this.lastFeature_]);return this.dispatchEvent(new gc(KE,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new Je([this.lastFeature_]);return this.dispatchEvent(new gc(JE,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate,i=e.map.getView().getProjection(),n=Ee(t,i),r=Ee(this.lastCoordinate_,i),s=n[0]-r[0],o=n[1]-r[1],a=this.features_||new Je([this.lastFeature_]),l=Qe();a.forEach(function(h){const c=h.getGeometry();l?(c.transform(l,i),c.translate(s,o),c.transform(i,l)):c.translate(s,o),h.setGeometry(c)}),this.lastCoordinate_=t,this.dispatchEvent(new gc(HE,a,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(i,n)=>{if(i instanceof Se&&this.filter_(i,n)&&(!this.features_||this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||e,t)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")}};function Cf(e,t,i,n,r,s){r!==void 0?s=s!==void 0?s:0:(r=[],s=0);let o=t;for(;o<i;){const a=e[o++];r[s++]=e[o++],r[s++]=a;for(let l=2;l<n;++l)r[s++]=e[o++]}return r.length=s,r}var Qs=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Se,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?X(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=X(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return q()}readFeature(e,t){return q()}readFeatures(e,t){return q()}readGeometry(e,t){return q()}readProjection(e){return q()}writeFeature(e,t){return q()}writeFeatures(e,t){return q()}writeGeometry(e,t){return q()}};function Me(e,t,i){const n=i?X(i.featureProjection):null,r=i?X(i.dataProjection):null;let s=e;if(n&&r&&!ct(n,r)){t&&(s=e.clone());const o=t?n:r,a=t?r:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(ii(o,a))}if(t&&i&&i.decimals!==void 0){const o=Math.pow(10,i.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};s===e&&(s=e.clone()),s.applyTransform(a)}return s}function fc(e,t){const i=t?X(t.featureProjection):null,n=t?X(t.dataProjection):null;return i&&n&&!ct(i,n)?Lo(e,n,i):e}const eT={Point:Ae,LineString:Ue,Polygon:ot,MultiPoint:ri,MultiLineString:Et,MultiPolygon:Zt};function bf(e,t){const i=e.geometry;if(!i)return[];if(Array.isArray(i))return i.map(s=>bf({...e,geometry:s})).flat();const n=i.type==="MultiPolygon"?"Polygon":i.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const r=i.layout.length;return Me(new $t(n,n==="Polygon"?function(s,o,a){return Array.isArray(o[0])?(Au(s,0,o,a)||Ul(s=s.slice(),0,o,a),s):(Bl(s,0,o,a)||Oo(s=s.slice(),0,o,a),s)}(i.flatCoordinates,i.ends,r):i.flatCoordinates,i.ends?.flat(),r,e.properties||{},e.id).enableSimplifyTransformed(),!1,t)}function pc(e,t){if(!e)return null;if(Array.isArray(e)){const i=e.map(n=>pc(n,t));return new ut(i)}return Me(new eT[e.type](e.flatCoordinates,e.layout,e.ends),!1,t)}function mc(e){return typeof e=="string"?JSON.parse(e)||null:e!==null?e:null}var _c=class extends Qs{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(mc(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(mc(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return q()}readFeaturesFromObject(e,t){return q()}readGeometry(e,t){return this.readGeometryFromObject(mc(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return q()}readProjection(e){return this.readProjectionFromObject(mc(e))}readProjectionFromObject(e){return q()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return q()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return q()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return q()}};const tT={Point:function(e){let t;return t=e.m!==void 0&&e.z!==void 0?new Ae([e.x,e.y,e.z,e.m],"XYZM"):e.z!==void 0?new Ae([e.x,e.y,e.z],"XYZ"):e.m!==void 0?new Ae([e.x,e.y,e.m],"XYM"):new Ae([e.x,e.y]),t},LineString:function(e){const t=eo(e);return new Ue(e.paths[0],t)},Polygon:function(e){const t=eo(e);return new ot(e.rings,t)},MultiPoint:function(e){const t=eo(e);return new ri(e.points,t)},MultiLineString:function(e){const t=eo(e);return new Et(e.paths,t)},MultiPolygon:function(e){const t=eo(e);return new Zt(e.rings,t)}},iT={Point:function(e,t){const i=e.getCoordinates();let n;const r=e.getLayout();if(r==="XYZ")n={x:i[0],y:i[1],z:i[2]};else if(r==="XYM")n={x:i[0],y:i[1],m:i[2]};else if(r==="XYZM")n={x:i[0],y:i[1],z:i[2],m:i[3]};else{if(r!=="XY")throw new Error("Invalid geometry layout");n={x:i[0],y:i[1]}}return n},LineString:function(e,t){const i=Ga(e);return{hasZ:i.hasZ,hasM:i.hasM,paths:[e.getCoordinates()]}},Polygon:function(e,t){const i=Ga(e);return{hasZ:i.hasZ,hasM:i.hasM,rings:e.getCoordinates(!1)}},MultiPoint:function(e,t){const i=Ga(e);return{hasZ:i.hasZ,hasM:i.hasM,points:e.getCoordinates()}},MultiLineString:function(e,t){const i=Ga(e);return{hasZ:i.hasZ,hasM:i.hasM,paths:e.getCoordinates()}},MultiPolygon:function(e,t){const i=Ga(e),n=e.getCoordinates(!1),r=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)r.push(n[s][o]);return{hasZ:i.hasZ,hasM:i.hasM,rings:r}}};function Vx(e,t){if(!e)return null;let i;if(typeof e.x=="number"&&typeof e.y=="number")i="Point";else if(e.points)i="MultiPoint";else if(e.paths)i=e.paths.length===1?"LineString":"MultiLineString";else if(e.rings){const n=e,r=eo(n),s=function(o,a){const l=[],h=[],c=[];let u,g;for(u=0,g=o.length;u<g;++u)l.length=0,_s(l,0,o[u],a.length),Ao(l,0,l.length,a.length)?h.push([o[u]]):c.push(o[u]);for(;c.length;){const f=c.shift();let p=!1;for(u=h.length-1;u>=0;u--){const m=h[u][0];if(ht(new ws(m).getExtent(),new ws(f).getExtent())){h[u].push(f),p=!0;break}}p||h.push([f.reverse()])}return h}(n.rings,r);s.length===1?(i="Polygon",e=Object.assign({},e,{rings:s[0]})):(i="MultiPolygon",e=Object.assign({},e,{rings:s}))}return Me((0,tT[i])(e),!1,t)}function eo(e){let t="XY";return e.hasZ===!0&&e.hasM===!0?t="XYZM":e.hasZ===!0?t="XYZ":e.hasM===!0&&(t="XYM"),t}function Ga(e){const t=e.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function Wx(e,t){return(0,iT[e.getType()])(Me(e,!0,t),t)}var nT=class extends _c{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,i){const n=e,r=Vx(n.geometry,t),s=new Se;if(this.geometryName_&&s.setGeometryName(this.geometryName_),s.setGeometry(r),n.attributes){s.setProperties(n.attributes,!0);const o=n.attributes[i];o!==void 0&&s.setId(o)}return s}readFeaturesFromObject(e,t){if(t=t||{},e.features){const i=[],n=e.features;for(let r=0,s=n.length;r<s;++r)i.push(this.readFeatureFromObject(n[r],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return Vx(e,t)}readProjectionFromObject(e){return e.spatialReference&&e.spatialReference.wkid!==void 0?X("EPSG:"+e.spatialReference.wkid):null}writeGeometryObject(e,t){return Wx(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={};if(!e.hasProperties())return i.attributes={},i;const n=e.getProperties(),r=e.getGeometry();if(r){i.geometry=Wx(r,t);const s=t&&(t.dataProjection||t.featureProjection);s&&(i.geometry.spatialReference={wkid:Number(X(s).getCode().split(":").pop())}),delete n[e.getGeometryName()]}return qt(n)?i.attributes={}:i.attributes=n,i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,r=e.length;n<r;++n)i.push(this.writeFeatureObject(e[n],t));return{features:i}}},Jr=class extends Qs{constructor(){super(),this.xmlSerializer_=uy()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=oi(e);return this.readFeatureFromDocument(i,t)}return si(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=oi(e);return this.readFeaturesFromDocument(i,t)}return si(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&ge(i,this.readFeaturesFromNode(n,t));return i}readFeaturesFromNode(e,t){return q()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=oi(e);return this.readGeometryFromDocument(i,t)}return si(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=oi(e);return this.readProjectionFromDocument(t)}return si(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}};const zi="http://www.opengis.net/gml",rT=/^\s*$/;class $e extends Jr{constructor(t){super(),t=t||{},this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Z(this.readFeaturesInternal),featureMembers:K(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(t,i){const n=t.localName;let r=null;if(n=="FeatureCollection")r=O([],this.FEATURE_COLLECTION_PARSERS,t,i,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=i[0];let o=s.featureType,a=s.featureNS;const l="p",h="p0";if(!o&&t.childNodes){o=[],a={};for(let g=0,f=t.childNodes.length;g<f;++g){const p=t.childNodes[g];if(p.nodeType===1){const m=p.nodeName.split(":").pop();if(!o.includes(m)){let _="",x=0;const y=p.namespaceURI;for(const v in a){if(a[v]===y){_=v;break}++x}_||(_=l+x,a[_]=y),o.push(_+":"+m)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const g=a;a={},a[h]=g}const c={},u=Array.isArray(o)?o:[o];for(const g in a){const f={};for(let p=0,m=u.length;p<m;++p)(u[p].includes(":")?u[p].split(":")[0]:h)===g&&(f[u[p].split(":").pop()]=n=="featureMembers"?Z(this.readFeatureElement,this):K(this.readFeatureElement,this));c[a[g]]=f}r=O(n=="featureMember"||n=="member"?void 0:[],c,t,i)}return r===null&&(r=[]),r}readGeometryOrExtent(t,i){const n=i[0];return n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension"),O(null,this.GEOMETRY_PARSERS,t,i,this)}readExtentElement(t,i){const n=i[0],r=this.readGeometryOrExtent(t,i);return r?fc(r,n):void 0}readGeometryElement(t,i){const n=i[0],r=this.readGeometryOrExtent(t,i);return r?Me(r,!1,n):void 0}readFeatureElementInternal(t,i,n){let r;const s={};for(let l=t.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=yt(l,!1),rT.test(h)&&(h=void 0)):(n&&(h=c==="boundedBy"?this.readExtentElement(l,i):this.readGeometryElement(l,i)),h?c!=="boundedBy"&&(r=c):h=this.readFeatureElementInternal(l,i,!1));const u=l.attributes.length;if(u>0&&!(h instanceof Pl)){h={_content_:h};for(let g=0;g<u;g++)h[l.attributes[g].name]=l.attributes[g].value}s[c]?(s[c]instanceof Array||(s[c]=[s[c]]),s[c].push(h)):s[c]=h}if(!n)return s;const o=new Se(s);r&&o.setGeometryName(r);const a=t.getAttribute("fid")||cy(t,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(t,i){return this.readFeatureElementInternal(t,i,!0)}readPoint(t,i){const n=this.readFlatCoordinatesFromNode(t,i);if(n)return new Ae(n,"XYZ")}readMultiPoint(t,i){const n=O([],this.MULTIPOINT_PARSERS,t,i,this);if(n)return new ri(n)}readMultiLineString(t,i){const n=O([],this.MULTILINESTRING_PARSERS,t,i,this);if(n)return new Et(n)}readMultiPolygon(t,i){const n=O([],this.MULTIPOLYGON_PARSERS,t,i,this);if(n)return new Zt(n)}pointMemberParser(t,i){Ct(this.POINTMEMBER_PARSERS,t,i,this)}lineStringMemberParser(t,i){Ct(this.LINESTRINGMEMBER_PARSERS,t,i,this)}polygonMemberParser(t,i){Ct(this.POLYGONMEMBER_PARSERS,t,i,this)}readLineString(t,i){const n=this.readFlatCoordinatesFromNode(t,i);if(n)return new Ue(n,"XYZ")}readFlatLinearRing(t,i){const n=O(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,i,this);if(n)return n}readLinearRing(t,i){const n=this.readFlatCoordinatesFromNode(t,i);if(n)return new ws(n,"XYZ")}readPolygon(t,i){const n=O([null],this.FLAT_LINEAR_RINGS_PARSERS,t,i,this);if(n&&n[0]){const r=n[0],s=[r.length];let o,a;for(o=1,a=n.length;o<a;++o)ge(r,n[o]),s.push(r.length);return new ot(r,"XYZ",s)}}readFlatCoordinatesFromNode(t,i){return O(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,i,this)}readGeometryFromNode(t,i){return this.readGeometryElement(t,[this.getReadOptions(t,i||{})])||null}readFeaturesFromNode(t,i){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(t,i)),this.readFeaturesInternal(t,[n])||[]}readProjectionFromNode(t){return X(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))}}$e.prototype.namespace=zi,$e.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},$e.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},$e.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},$e.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Z($e.prototype.pointMemberParser),pointMembers:Z($e.prototype.pointMemberParser)}},$e.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Z($e.prototype.lineStringMemberParser),lineStringMembers:Z($e.prototype.lineStringMemberParser)}},$e.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Z($e.prototype.polygonMemberParser),polygonMembers:Z($e.prototype.polygonMemberParser)}},$e.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Z($e.prototype.readFlatCoordinatesFromNode)}},$e.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Z($e.prototype.readLineString)}},$e.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Z($e.prototype.readPolygon)}},$e.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:K($e.prototype.readFlatLinearRing)}};var ce=$e;function _n(e){return Qn(yt(e,!1))}function Qn(e){const t=/^\s*(true|1)|(false|0)\s*$/.exec(e);if(t)return t[1]!==void 0||!1}function yc(e){const t=yt(e,!1),i=Date.parse(t);return isNaN(i)?void 0:i/1e3}function de(e){return Xi(yt(e,!1))}function Xi(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}function Ye(e){return Vi(yt(e,!1))}function Vi(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}function D(e){return yt(e,!1).trim()}function Qr(e,t){J(e,t?"1":"0")}function Zx(e,t){e.appendChild(Xr().createCDATASection(t))}function $x(e,t){const i=new Date(1e3*t),n=i.getUTCFullYear()+"-"+On(i.getUTCMonth()+1,2)+"-"+On(i.getUTCDate(),2)+"T"+On(i.getUTCHours(),2)+":"+On(i.getUTCMinutes(),2)+":"+On(i.getUTCSeconds(),2)+"Z";e.appendChild(Xr().createTextNode(n))}function Rt(e,t){const i=t.toPrecision();e.appendChild(Xr().createTextNode(i))}function ja(e,t){const i=t.toString();e.appendChild(Xr().createTextNode(i))}function J(e,t){e.appendChild(Xr().createTextNode(t))}const sT=zi+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",oT={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class _e extends ce{constructor(t){super(t=t||{}),this.FEATURE_COLLECTION_PARSERS[zi].featureMember=Z(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:sT}readFlatCoordinates(t,i){const n=yt(t,!1).replace(/^\s*|\s*$/g,""),r=i[0].srsName;let s="enu";if(r){const l=X(r);l&&(s=l.getAxisOrientation())}const o=n.trim().split(/\s+/),a=[];for(let l=0,h=o.length;l<h;l++){const c=o[l].split(/,+/),u=parseFloat(c[0]),g=parseFloat(c[1]),f=c.length===3?parseFloat(c[2]):0;s.substr(0,2)==="en"?a.push(u,g,f):a.push(g,u,f)}return a}readBox(t,i){const n=O([null],this.BOX_PARSERS_,t,i,this);return Xt(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(t,i){const n=O(void 0,this.RING_PARSERS,t,i,this);n&&i[i.length-1].push(n)}outerBoundaryIsParser(t,i){const n=O(void 0,this.RING_PARSERS,t,i,this);n&&(i[i.length-1][0]=n)}GEOMETRY_NODE_FACTORY_(t,i,n){const r=i[i.length-1],s=r.multiSurface,o=r.surface,a=r.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType())==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve"),Q("http://www.opengis.net/gml",n)}writeFeatureElement(t,i,n){const r=i.getId();r&&t.setAttribute("fid",r);const s=n[n.length-1],o=s.featureNS,a=i.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(i.hasProperties()){const u=i.getProperties();for(const g in u){const f=u[g];f!==null&&(l.push(g),h.push(f),g==a||typeof f.getSimplifiedGeometry=="function"?g in s.serializers[o]||(s.serializers[o][g]=b(this.writeGeometryElement,this)):g in s.serializers[o]||(s.serializers[o][g]=b(J)))}}const c=Object.assign({},s);c.node=t,ee(c,s.serializers,ze(void 0,o),h,n,l)}writeCurveOrLineString(t,i,n){const r=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&r&&t.setAttribute("srsName",r),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,i,n)}else if(t.nodeName==="Curve"){const s=Q(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,i,n)}}writeLineStringOrCurveMember(t,i,n){const r=this.GEOMETRY_NODE_FACTORY_(i,n);r&&(t.appendChild(r),this.writeCurveOrLineString(r,i,n))}writeMultiCurveOrLineString(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName,a=r.curve;o&&t.setAttribute("srsName",o);const l=i.getLineStrings();ee({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(t,i,n){const r=n[n.length-1],s=Object.assign({},r);let o;s.node=t,o=Array.isArray(i)?fc(i,r):Me(i,!0,r),ee(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(t){const i=Q(t,"coordinates");return i.setAttribute("decimal","."),i.setAttribute("cs",","),i.setAttribute("ts"," "),i}writeCoordinates_(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName,a=i.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,s)}J(t,h.join(" "))}writeCurveSegments_(t,i,n){const r=Q(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,i,n)}writeSurfaceOrPolygon(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=i.getLinearRings();ee({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=Q(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,i,n)}}RING_NODE_FACTORY_(t,i,n){const r=i[i.length-1],s=r.node,o=r.exteriorWritten;return o===void 0&&(r.exteriorWritten=!0),Q(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(t,i,n){const r=Q(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,i,n)}writeRing(t,i,n){const r=Q(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,i,n)}getCoords_(t,i,n){let r="enu";i&&(r=X(i).getAxisOrientation());let s=r.substr(0,2)==="en"?t[0]+","+t[1]:t[1]+","+t[0];return n&&(s+=","+(t[2]||0)),s}writePoint(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);const a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);const l=i.getCoordinates();J(a,this.getCoords_(l,o,s))}writeMultiPoint(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);const a=i.getPoints();ee({node:t,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,ze("pointMember"),a,n,void 0,this)}writePointMember(t,i,n){const r=Q(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,i,n)}writeLinearRing(t,i,n){const r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,i,n)}writeMultiSurfaceOrPolygon(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName,a=r.surface;o&&t.setAttribute("srsName",o);const l=i.getPolygons();ee({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(t,i,n){const r=this.GEOMETRY_NODE_FACTORY_(i,n);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,i,n))}writeEnvelope(t,i,n){const r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);const s=[i[0]+" "+i[1],i[2]+" "+i[3]];ee({node:t},this.ENVELOPE_SERIALIZERS,at,s,n,["lowerCorner","upperCorner"],this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,i,n){const r=i[i.length-1].node;return Q("http://www.opengis.net/gml",oT[r.nodeName])}}_e.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:K(_e.prototype.readFlatCoordinates)}},_e.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:_e.prototype.innerBoundaryIsParser,outerBoundaryIs:_e.prototype.outerBoundaryIsParser}},_e.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Z(_e.prototype.readFlatCoordinates)}},_e.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:K(ce.prototype.readPoint),MultiPoint:K(ce.prototype.readMultiPoint),LineString:K(ce.prototype.readLineString),MultiLineString:K(ce.prototype.readMultiLineString),LinearRing:K(ce.prototype.readLinearRing),Polygon:K(ce.prototype.readPolygon),MultiPolygon:K(ce.prototype.readMultiPolygon),Box:K(_e.prototype.readBox)}},_e.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:b(_e.prototype.writeCurveOrLineString),MultiCurve:b(_e.prototype.writeMultiCurveOrLineString),Point:b(_e.prototype.writePoint),MultiPoint:b(_e.prototype.writeMultiPoint),LineString:b(_e.prototype.writeCurveOrLineString),MultiLineString:b(_e.prototype.writeMultiCurveOrLineString),LinearRing:b(_e.prototype.writeLinearRing),Polygon:b(_e.prototype.writeSurfaceOrPolygon),MultiPolygon:b(_e.prototype.writeMultiSurfaceOrPolygon),Surface:b(_e.prototype.writeSurfaceOrPolygon),MultiSurface:b(_e.prototype.writeMultiSurfaceOrPolygon),Envelope:b(_e.prototype.writeEnvelope)}},_e.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:b(_e.prototype.writeLineStringOrCurveMember),curveMember:b(_e.prototype.writeLineStringOrCurveMember)}},_e.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:b(_e.prototype.writeRing),innerBoundaryIs:b(_e.prototype.writeRing)}},_e.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:b(_e.prototype.writePointMember)}},_e.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:b(_e.prototype.writeSurfaceOrPolygonMember),polygonMember:b(_e.prototype.writeSurfaceOrPolygonMember)}},_e.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:b(J),upperCorner:b(J)}};var es=_e;const aT=zi+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",lT={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class $ extends ce{constructor(t){super(t=t||{}),this.surface_=t.surface!==void 0&&t.surface,this.curve_=t.curve!==void 0&&t.curve,this.multiCurve_=t.multiCurve===void 0||t.multiCurve,this.multiSurface_=t.multiSurface===void 0||t.multiSurface,this.schemaLocation=t.schemaLocation?t.schemaLocation:aT,this.hasZ=t.hasZ!==void 0&&t.hasZ}readMultiCurve(t,i){const n=O([],this.MULTICURVE_PARSERS,t,i,this);if(n)return new Et(n)}readFlatCurveRing(t,i){const n=O([],this.MULTICURVE_PARSERS,t,i,this),r=[];for(let s=0,o=n.length;s<o;++s)ge(r,n[s].getFlatCoordinates());return r}readMultiSurface(t,i){const n=O([],this.MULTISURFACE_PARSERS,t,i,this);if(n)return new Zt(n)}curveMemberParser(t,i){Ct(this.CURVEMEMBER_PARSERS,t,i,this)}surfaceMemberParser(t,i){Ct(this.SURFACEMEMBER_PARSERS,t,i,this)}readPatch(t,i){return O([null],this.PATCHES_PARSERS,t,i,this)}readSegment(t,i){return O([],this.SEGMENTS_PARSERS,t,i,this)}readPolygonPatch(t,i){return O([null],this.FLAT_LINEAR_RINGS_PARSERS,t,i,this)}readLineStringSegment(t,i){return O([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,i,this)}interiorParser(t,i){const n=O(void 0,this.RING_PARSERS,t,i,this);n&&i[i.length-1].push(n)}exteriorParser(t,i){const n=O(void 0,this.RING_PARSERS,t,i,this);n&&(i[i.length-1][0]=n)}readSurface(t,i){const n=O([null],this.SURFACE_PARSERS,t,i,this);if(n&&n[0]){const r=n[0],s=[r.length];let o,a;for(o=1,a=n.length;o<a;++o)ge(r,n[o]),s.push(r.length);return new ot(r,"XYZ",s)}}readCurve(t,i){const n=O([null],this.CURVE_PARSERS,t,i,this);if(n)return new Ue(n,"XYZ")}readEnvelope(t,i){const n=O([null],this.ENVELOPE_PARSERS,t,i,this);return Xt(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(t,i){let n=yt(t,!1);const r=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=r.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const a=i[0].srsName;let l="enu";if(a&&(l=X(a).getAxisOrientation()),l==="neu"){let c,u;for(c=0,u=s.length;c<u;c+=3){const g=s[c],f=s[c+1];s[c]=f,s[c+1]=g}}const h=s.length;return h==2&&s.push(0),h!==0?s:void 0}readFlatPosList(t,i){const n=yt(t,!1).replace(/^\s*|\s*$/g,""),r=i[0],s=r.srsName,o=r.srsDimension;let a="enu";s&&(a=X(s).getAxisOrientation());const l=n.split(/\s+/);let h,c,u,g=2;t.getAttribute("srsDimension")?g=Vi(t.getAttribute("srsDimension")):t.getAttribute("dimension")?g=Vi(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?g=Vi(t.parentNode.getAttribute("srsDimension")):o&&(g=Vi(o));const f=[];for(let p=0,m=l.length;p<m;p+=g)h=parseFloat(l[p]),c=parseFloat(l[p+1]),u=g===3?parseFloat(l[p+2]):0,a.substr(0,2)==="en"?f.push(h,c,u):f.push(c,h,u);return f}writePos_(t,i,n){const r=n[n.length-1],s=r.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=r.srsName;let l="enu";a&&(l=X(a).getAxisOrientation());const h=i.getCoordinates();let c;c=l.substr(0,2)==="en"?h[0]+" "+h[1]:h[1]+" "+h[0],s&&(c+=" "+(h[2]||0)),J(t,c)}getCoords_(t,i,n){let r="enu";i&&(r=X(i).getAxisOrientation());let s=r.substr(0,2)==="en"?t[0]+" "+t[1]:t[1]+" "+t[0];return n&&(s+=" "+(t[2]||0)),s}writePosList_(t,i,n){const r=n[n.length-1],s=r.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=r.srsName,l=i.getCoordinates(),h=l.length,c=new Array(h);let u;for(let g=0;g<h;++g)u=l[g],c[g]=this.getCoords_(u,a,s);J(t,c.join(" "))}writePoint(t,i,n){const r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);const s=Q(t.namespaceURI,"pos");t.appendChild(s),this.writePos_(s,i,n)}writeEnvelope(t,i,n){const r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);const s=[i[0]+" "+i[1],i[2]+" "+i[3]];ee({node:t},this.ENVELOPE_SERIALIZERS,at,s,n,["lowerCorner","upperCorner"],this)}writeLinearRing(t,i,n){const r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);const s=Q(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,i,n)}RING_NODE_FACTORY_(t,i,n){const r=i[i.length-1],s=r.node,o=r.exteriorWritten;return o===void 0&&(r.exteriorWritten=!0),Q(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=i.getLinearRings();ee({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=Q(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,i,n)}}writeCurveOrLineString(t,i,n){const r=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&r&&t.setAttribute("srsName",r),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=Q(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,i,n)}else if(t.nodeName==="Curve"){const s=Q(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,i,n)}}writeMultiSurfaceOrPolygon(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName,a=r.surface;o&&t.setAttribute("srsName",o);const l=i.getPolygons();ee({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(t,i,n){const r=n[n.length-1],s=r.srsName,o=r.hasZ;s&&t.setAttribute("srsName",s);const a=i.getPoints();ee({node:t,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,ze("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(t,i,n){const r=n[n.length-1],s=r.hasZ,o=r.srsName,a=r.curve;o&&t.setAttribute("srsName",o);const l=i.getLineStrings();ee({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(t,i,n){const r=Q(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,i,n)}writeSurfaceOrPolygonMember(t,i,n){const r=this.GEOMETRY_NODE_FACTORY_(i,n);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,i,n))}writePointMember(t,i,n){const r=Q(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,i,n)}writeLineStringOrCurveMember(t,i,n){const r=this.GEOMETRY_NODE_FACTORY_(i,n);r&&(t.appendChild(r),this.writeCurveOrLineString(r,i,n))}writeSurfacePatches_(t,i,n){const r=Q(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,i,n)}writeCurveSegments_(t,i,n){const r=Q(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,i,n)}writeGeometryElement(t,i,n){const r=n[n.length-1],s=Object.assign({},r);let o;s.node=t,o=Array.isArray(i)?fc(i,r):Me(i,!0,r),ee(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(t,i,n){const r=i.getId();r&&t.setAttribute("fid",r);const s=n[n.length-1],o=s.featureNS,a=i.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(i.hasProperties()){const u=i.getProperties();for(const g in u){const f=u[g];f!==null&&(l.push(g),h.push(f),g==a||typeof f.getSimplifiedGeometry=="function"?g in s.serializers[o]||(s.serializers[o][g]=b(this.writeGeometryElement,this)):g in s.serializers[o]||(s.serializers[o][g]=b(J)))}}const c=Object.assign({},s);c.node=t,ee(c,s.serializers,ze(void 0,o),h,n,l)}writeFeatureMembers_(t,i,n){const r=n[n.length-1],s=r.featureType,o=r.featureNS,a={};a[o]={},a[o][s]=b(this.writeFeatureElement,this);const l=Object.assign({},r);l.node=t,ee(l,a,ze(s,o),i,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,i,n){const r=i[i.length-1].node;return Q(this.namespace,lT[r.nodeName])}GEOMETRY_NODE_FACTORY_(t,i,n){const r=i[i.length-1],s=r.multiSurface,o=r.surface,a=r.curve,l=r.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType())==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve"),Q(this.namespace,n)}writeGeometryNode(t,i){i=this.adaptOptions(i);const n=Q(this.namespace,"geom"),r={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return i&&Object.assign(r,i),this.writeGeometryElement(n,t,[r]),n}writeFeaturesNode(t,i){i=this.adaptOptions(i);const n=Q(this.namespace,"featureMembers");n.setAttributeNS(Wn,"xsi:schemaLocation",this.schemaLocation);const r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return i&&Object.assign(r,i),this.writeFeatureMembers_(n,t,[r]),n}}$.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:K($.prototype.readFlatPos),posList:K($.prototype.readFlatPosList),coordinates:K(es.prototype.readFlatCoordinates)}},$.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:$.prototype.interiorParser,exterior:$.prototype.exteriorParser}},$.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:K(ce.prototype.readPoint),MultiPoint:K(ce.prototype.readMultiPoint),LineString:K(ce.prototype.readLineString),MultiLineString:K(ce.prototype.readMultiLineString),LinearRing:K(ce.prototype.readLinearRing),Polygon:K(ce.prototype.readPolygon),MultiPolygon:K(ce.prototype.readMultiPolygon),Surface:K($.prototype.readSurface),MultiSurface:K($.prototype.readMultiSurface),Curve:K($.prototype.readCurve),MultiCurve:K($.prototype.readMultiCurve),Envelope:K($.prototype.readEnvelope)}},$.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Z($.prototype.curveMemberParser),curveMembers:Z($.prototype.curveMemberParser)}},$.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Z($.prototype.surfaceMemberParser),surfaceMembers:Z($.prototype.surfaceMemberParser)}},$.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Z(ce.prototype.readLineString),Curve:Z($.prototype.readCurve)}},$.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Z(ce.prototype.readPolygon),Surface:Z($.prototype.readSurface)}},$.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:K($.prototype.readPatch)}},$.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:K($.prototype.readSegment)}},$.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Z($.prototype.readFlatPosList),upperCorner:Z($.prototype.readFlatPosList)}},$.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:K($.prototype.readPolygonPatch)}},$.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:da($.prototype.readLineStringSegment)}},ce.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:K(ce.prototype.readFlatLinearRing),Ring:K($.prototype.readFlatCurveRing)}},$.prototype.writeFeatures,$.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:b($.prototype.writeRing),interior:b($.prototype.writeRing)}},$.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:b(J),upperCorner:b(J)}},$.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:b($.prototype.writeSurfaceOrPolygonMember),polygonMember:b($.prototype.writeSurfaceOrPolygonMember)}},$.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:b($.prototype.writePointMember)}},$.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:b($.prototype.writeLineStringOrCurveMember),curveMember:b($.prototype.writeLineStringOrCurveMember)}},$.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:b($.prototype.writeCurveOrLineString),MultiCurve:b($.prototype.writeMultiCurveOrLineString),Point:b($.prototype.writePoint),MultiPoint:b($.prototype.writeMultiPoint),LineString:b($.prototype.writeCurveOrLineString),MultiLineString:b($.prototype.writeMultiCurveOrLineString),LinearRing:b($.prototype.writeLinearRing),Polygon:b($.prototype.writeSurfaceOrPolygon),MultiPolygon:b($.prototype.writeMultiSurfaceOrPolygon),Surface:b($.prototype.writeSurfaceOrPolygon),MultiSurface:b($.prototype.writeMultiSurfaceOrPolygon),Envelope:b($.prototype.writeEnvelope)}};var ue=$;const Rf=ue;Rf.prototype.writeFeatures,Rf.prototype.writeFeaturesNode;var hT=Rf;class be extends ue{constructor(t){super(t=t||{}),this.schemaLocation=t.schemaLocation?t.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(t,i,n){const r=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},r),super.writeGeometryElement(t,i,n)}}be.prototype.namespace="http://www.opengis.net/gml/3.2",be.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:K(ue.prototype.readFlatPos),posList:K(ue.prototype.readFlatPosList),coordinates:K(es.prototype.readFlatCoordinates)}},be.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:ue.prototype.interiorParser,exterior:ue.prototype.exteriorParser}},be.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:K(ce.prototype.readPoint),MultiPoint:K(ce.prototype.readMultiPoint),LineString:K(ce.prototype.readLineString),MultiLineString:K(ce.prototype.readMultiLineString),LinearRing:K(ce.prototype.readLinearRing),Polygon:K(ce.prototype.readPolygon),MultiPolygon:K(ce.prototype.readMultiPolygon),Surface:K(be.prototype.readSurface),MultiSurface:K(ue.prototype.readMultiSurface),Curve:K(be.prototype.readCurve),MultiCurve:K(ue.prototype.readMultiCurve),Envelope:K(be.prototype.readEnvelope)}},be.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Z(ue.prototype.curveMemberParser),curveMembers:Z(ue.prototype.curveMemberParser)}},be.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Z(ue.prototype.surfaceMemberParser),surfaceMembers:Z(ue.prototype.surfaceMemberParser)}},be.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Z(ce.prototype.readLineString),Curve:Z(ue.prototype.readCurve)}},be.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Z(ce.prototype.readPolygon),Surface:Z(ue.prototype.readSurface)}},be.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:K(ue.prototype.readPatch)}},be.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:K(ue.prototype.readSegment)}},be.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Z(ue.prototype.readFlatPosList),upperCorner:Z(ue.prototype.readFlatPosList)}},be.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:K(ue.prototype.readPolygonPatch)}},be.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:da(ue.prototype.readLineStringSegment)}},be.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Z(ce.prototype.pointMemberParser),pointMembers:Z(ce.prototype.pointMemberParser)}},be.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Z(ce.prototype.lineStringMemberParser),lineStringMembers:Z(ce.prototype.lineStringMemberParser)}},be.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Z(ce.prototype.polygonMemberParser),polygonMembers:Z(ce.prototype.polygonMemberParser)}},be.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Z(ce.prototype.readFlatCoordinatesFromNode)}},be.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Z(ce.prototype.readLineString)}},be.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Z(ce.prototype.readPolygon)}},be.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:K(ce.prototype.readFlatLinearRing),Ring:K(be.prototype.readFlatCurveRing)}},be.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:b(ue.prototype.writeRing),interior:b(ue.prototype.writeRing)}},be.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:b(J),upperCorner:b(J)}},be.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:b(ue.prototype.writeSurfaceOrPolygonMember),polygonMember:b(ue.prototype.writeSurfaceOrPolygonMember)}},be.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:b(ue.prototype.writePointMember)}},be.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:b(ue.prototype.writeLineStringOrCurveMember),curveMember:b(ue.prototype.writeLineStringOrCurveMember)}},be.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:b(ue.prototype.writeCurveOrLineString),MultiCurve:b(ue.prototype.writeMultiCurveOrLineString),Point:b(be.prototype.writePoint),MultiPoint:b(ue.prototype.writeMultiPoint),LineString:b(ue.prototype.writeCurveOrLineString),MultiLineString:b(ue.prototype.writeMultiCurveOrLineString),LinearRing:b(ue.prototype.writeLinearRing),Polygon:b(ue.prototype.writeSurfaceOrPolygon),MultiPolygon:b(ue.prototype.writeMultiSurfaceOrPolygon),Surface:b(ue.prototype.writeSurfaceOrPolygon),MultiSurface:b(ue.prototype.writeMultiSurfaceOrPolygon),Envelope:b(ue.prototype.writeEnvelope)}};var xc=be;const it=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],cT={rte:Yx,trk:qx,wpt:Kx},uT=L(it,{rte:Z(Yx),trk:Z(qx),wpt:Z(Kx)}),dT=L(it,{text:T(D,"linkText"),type:T(D,"linkType")}),gT=L(it,{rte:b(function(e,t,i){const n=i[0],r=t.getProperties(),s={node:e};s.properties=r;const o=t.getGeometry();if(o.getType()=="LineString"){const c=Me(o,!0,n);s.geometryLayout=c.getLayout(),r.rtept=c.getCoordinates()}const a=i[i.length-1].node,l=ST[a.namespaceURI],h=Tt(r,l);ee(s,ET,at,h,i,l)}),trk:b(function(e,t,i){const n=i[0],r=t.getProperties(),s={node:e};s.properties=r;const o=t.getGeometry();if(o.getType()=="MultiLineString"){const c=Me(o,!0,n);r.trkseg=c.getLineStrings()}const a=i[i.length-1].node,l=CT[a.namespaceURI],h=Tt(r,l);ee(s,bT,at,h,i,l)}),wpt:b(function(e,t,i){const n=i[0],r=i[i.length-1];r.properties=t.getProperties();const s=t.getGeometry();if(s.getType()=="Point"){const o=Me(s,!0,n);r.geometryLayout=o.getLayout(),Af(e,o.getCoordinates(),i)}})}),fT=L(it,{name:T(D),cmt:T(D),desc:T(D),src:T(D),link:If,number:T(Ye),extensions:Lf,type:T(D),rtept:function(e,t){const i=O({},pT,e,t);if(i){const n=t[t.length-1];Pf(n.flatCoordinates,n.layoutOptions,e,i)}}}),pT=L(it,{ele:T(de),time:T(yc)}),mT=L(it,{name:T(D),cmt:T(D),desc:T(D),src:T(D),link:If,number:T(Ye),type:T(D),extensions:Lf,trkseg:function(e,t){const i=t[t.length-1];Ct(_T,e,t);const n=i.flatCoordinates;i.ends.push(n.length)}}),_T=L(it,{trkpt:function(e,t){const i=O({},yT,e,t);if(i){const n=t[t.length-1];Pf(n.flatCoordinates,n.layoutOptions,e,i)}}}),yT=L(it,{ele:T(de),time:T(yc)}),xT=L(it,{ele:T(de),time:T(yc),magvar:T(de),geoidheight:T(de),name:T(D),cmt:T(D),desc:T(D),src:T(D),link:If,sym:T(D),type:T(D),fix:T(D),sat:T(Ye),hdop:T(de),vdop:T(de),pdop:T(de),ageofdgpsdata:T(de),dgpsid:T(Ye),extensions:Lf}),vT=["text","type"],wT=L(it,{text:b(J),type:b(J)}),ST=L(it,["name","cmt","desc","src","link","number","type","rtept"]),ET=L(it,{name:b(J),cmt:b(J),desc:b(J),src:b(J),link:b(Mf),number:b(ja),type:b(J),rtept:mg(b(Af))}),TT=L(it,["ele","time"]),CT=L(it,["name","cmt","desc","src","link","number","type","trkseg"]),bT=L(it,{name:b(J),cmt:b(J),desc:b(J),src:b(J),link:b(Mf),number:b(ja),type:b(J),trkseg:mg(b(function(e,t,i){const n={node:e};n.geometryLayout=t.getLayout(),n.properties={},ee(n,PT,RT,t.getCoordinates(),i)}))}),RT=ze("trkpt"),PT=L(it,{trkpt:b(Af)}),FT=L(it,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),IT=L(it,{ele:b(Rt),time:b($x),magvar:b(Rt),geoidheight:b(Rt),name:b(J),cmt:b(J),desc:b(J),src:b(J),link:b(Mf),sym:b(J),type:b(J),fix:b(J),sat:b(ja),hdop:b(Rt),vdop:b(Rt),pdop:b(Rt),ageofdgpsdata:b(Rt),dgpsid:b(ja)}),LT={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function MT(e,t,i){const n=e.getGeometry();if(n){const r=LT[n.getType()];if(r)return Q(t[t.length-1].node.namespaceURI,r)}}function Pf(e,t,i,n){return e.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat"))),"ele"in n?(e.push(n.ele),delete n.ele,t.hasZ=!0):e.push(0),"time"in n?(e.push(n.time),delete n.time,t.hasM=!0):e.push(0),e}function Ff(e,t,i){let n="XY",r=2;if(e.hasZ&&e.hasM?(n="XYZM",r=4):e.hasZ?(n="XYZ",r=3):e.hasM&&(n="XYM",r=3),r!==4){for(let s=0,o=t.length/4;s<o;s++)t[s*r]=t[4*s],t[s*r+1]=t[4*s+1],e.hasZ&&(t[s*r+2]=t[4*s+2]),e.hasM&&(t[s*r+2]=t[4*s+3]);if(t.length=t.length/4*r,i)for(let s=0,o=i.length;s<o;s++)i[s]=i[s]/4*r}return n}function If(e,t){const i=t[t.length-1],n=e.getAttribute("href");n!==null&&(i.link=n),Ct(dT,e,t)}function Lf(e,t){t[t.length-1].extensionsNode_=e}function Yx(e,t){const i=t[0],n=O({flatCoordinates:[],layoutOptions:{}},fT,e,t);if(!n)return;const r=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=Ff(s,r),a=new Ue(r,o);Me(a,!1,i);const l=new Se(a);return l.setProperties(n,!0),l}function qx(e,t){const i=t[0],n=O({flatCoordinates:[],ends:[],layoutOptions:{}},mT,e,t);if(!n)return;const r=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=Ff(o,r,s),l=new Et(r,a,s);Me(l,!1,i);const h=new Se(l);return h.setProperties(n,!0),h}function Kx(e,t){const i=t[0],n=O({},xT,e,t);if(!n)return;const r={},s=Pf([],r,e,n),o=Ff(r,s),a=new Ae(s,o);Me(a,!1,i);const l=new Se(a);return l.setProperties(n,!0),l}function Mf(e,t,i){e.setAttribute("href",t);const n=i[i.length-1].properties,r=[n.linkText,n.linkType];ee({node:e},wT,at,r,i,vT)}function Af(e,t,i){const n=i[i.length-1],r=n.node.namespaceURI,s=n.properties;switch(e.setAttributeNS(null,"lat",String(t[1])),e.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":t[3]!==0&&(s.time=t[3]);case"XYZ":t[2]!==0&&(s.ele=t[2]);break;case"XYM":t[2]!==0&&(s.time=t[2])}const o=e.nodeName=="rtept"?TT[r]:FT[r],a=Tt(s,o);ee({node:e,properties:s},IT,at,a,i,o)}var AT=class extends Jr{constructor(e){super(),e=e||{},this.dataProjection=X("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,i=e.length;t<i;++t){const n=e[t];if(this.readExtensions_){const r=n.get("extensionsNode_")||null;this.readExtensions_(n,r)}n.set("extensionsNode_",void 0)}}readFeatureFromNode(e,t){if(!it.includes(e.namespaceURI))return null;const i=cT[e.localName];if(!i)return null;const n=i(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,t){if(!it.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=O([],uT,e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=Q("http://www.topografix.com/GPX/1/1","gpx");return i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Wn),i.setAttributeNS(Wn,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),ee({node:i},gT,MT,e,[t]),i}};function Of(e,t){if(!e)return null;let i;switch(e.type){case"Point":i=function(n){const r=n.coordinates;return{type:"Point",flatCoordinates:r,layout:Dn(r.length)}}(e);break;case"LineString":i=function(n){const r=n.coordinates,s=r.flat();return{type:"LineString",flatCoordinates:s,ends:[s.length],layout:Dn(r[0].length)}}(e);break;case"Polygon":i=function(n){const r=n.coordinates,s=[],o=r[0][0].length,a=ys(s,0,r,o);return{type:"Polygon",flatCoordinates:s,ends:a,layout:Dn(o)}}(e);break;case"MultiPoint":i=function(n){const r=n.coordinates;return{type:"MultiPoint",flatCoordinates:r.flat(),layout:Dn(r[0].length)}}(e);break;case"MultiLineString":i=function(n){const r=n.coordinates,s=r[0][0].length,o=[],a=ys(o,0,r,s);return{type:"MultiLineString",flatCoordinates:o,ends:a,layout:Dn(s)}}(e);break;case"MultiPolygon":i=function(n){const r=n.coordinates,s=[],o=r[0][0][0].length,a=bu(s,0,r,o);return{type:"MultiPolygon",flatCoordinates:s,ends:a,layout:Dn(o)}}(e);break;case"GeometryCollection":i=function(n,r){return n.geometries.map(function(o){return Of(o)})}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return i}function Nf(e,t){const i=(e=Me(e,!0,t)).getType();let n;switch(i){case"Point":n=function(r,s){return{type:"Point",coordinates:r.getCoordinates()}}(e);break;case"LineString":n=function(r,s){return{type:"LineString",coordinates:r.getCoordinates()}}(e);break;case"Polygon":n=function(r,s){let o;return s&&(o=s.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(o)}}(e,t);break;case"MultiPoint":n=function(r,s){return{type:"MultiPoint",coordinates:r.getCoordinates()}}(e);break;case"MultiLineString":n=function(r,s){return{type:"MultiLineString",coordinates:r.getCoordinates()}}(e);break;case"MultiPolygon":n=function(r,s){let o;return s&&(o=s.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(o)}}(e,t);break;case"GeometryCollection":n=function(r,s){return s=Object.assign({},s),delete s.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(a){return Nf(a,s)})}}(e,t);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return n}var OT=class extends _c{constructor(e){e=e||{},super(),this.dataProjection=X(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=X(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;i=e.type==="Feature"?e:{type:"Feature",geometry:e,properties:null};const n=Of(i.geometry);if(this.featureClass===$t)return bf({geometry:n,id:i.id,properties:i.properties},t);const r=new Se;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(pc(n,t)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){let i=null;if(e.type==="FeatureCollection"){i=[];const n=e.features;for(let r=0,s=n.length;r<s;++r){const o=this.readFeatureFromObject(n[r],t);o&&i.push(o)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return function(i,n){const r=Of(i);return pc(r,n)}(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=X(t.properties.name);else{if(t.type!=="EPSG")throw new Error("Unknown SRS type");i=X("EPSG:"+t.properties.code)}else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},n=e.getId();if(n!==void 0&&(i.id=n),!e.hasProperties())return i;const r=e.getProperties(),s=e.getGeometry();return s&&(i.geometry=Nf(s,t),delete r[e.getGeometryName()]),qt(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,r=e.length;n<r;++n)i.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Nf(e,this.adaptOptions(t))}};function vc(e){return typeof e=="string"?e:""}var wc=class extends Qs{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(vc(e),this.adaptOptions(t))}readFeatureFromText(e,t){return q()}readFeatures(e,t){return this.readFeaturesFromText(vc(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return q()}readGeometry(e,t){return this.readGeometryFromText(vc(e),this.adaptOptions(t))}readGeometryFromText(e,t){return q()}readProjection(e){return this.readProjectionFromText(vc(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return q()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return q()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return q()}};const NT=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,DT=/^H.([A-Z]{3}).*?:(.*)/,kT=/^HFDTE(\d{2})(\d{2})(\d{2})/,GT=/\r\n|\r|\n/;var jT=class extends wc{constructor(e){super(),e=e||{},this.dataProjection=X("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const i=this.altitudeMode_,n=e.split(GT),r={},s=[];let o,a,l=2e3,h=0,c=1,u=-1;for(o=0,a=n.length;o<a;++o){const p=n[o];let m;if(p.charAt(0)=="B"){if(m=NT.exec(p),m){const _=parseInt(m[1],10),x=parseInt(m[2],10),y=parseInt(m[3],10);let v=parseInt(m[4],10)+parseInt(m[5],10)/6e4;m[6]=="S"&&(v=-v);let w=parseInt(m[7],10)+parseInt(m[8],10)/6e4;if(m[9]=="W"&&(w=-w),s.push(w,v),i!="none"){let C;C=i=="gps"?parseInt(m[11],10):i=="barometric"?parseInt(m[12],10):0,s.push(C)}let S=Date.UTC(l,h,c,_,x,y);S<u&&(S=Date.UTC(l,h,c+1,_,x,y)),s.push(S/1e3),u=S}}else p.charAt(0)=="H"&&(m=kT.exec(p),m?(c=parseInt(m[1],10),h=parseInt(m[2],10)-1,l=2e3+parseInt(m[3],10)):(m=DT.exec(p),m&&(r[m[1]]=m[2].trim())))}if(s.length===0)return null;const g=new Ue(s,i=="none"?"XYM":"XYZM"),f=new Se(Me(g,!1,t));return f.setProperties(r,!0),f}readFeaturesFromText(e,t){const i=this.readFeatureFromText(e,t);return i?[i]:[]}};const yn=["http://www.google.com/kml/ext/2.2"],Y=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Hx={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},BT=L(Y,{ExtendedData:uv,Region:dv,MultiGeometry:T(lv,"geometry"),LineString:T(ov,"geometry"),LinearRing:T(av,"geometry"),Point:T(hv,"geometry"),Polygon:T(cv,"geometry"),Style:T(zf),StyleMap:function(e,t){const i=nv.call(this,e,t);if(!i)return;const n=t[t.length-1];if(Array.isArray(i))n.Style=i;else{if(typeof i!="string")throw new Error("`styleMapValue` has an unknown type");n.styleUrl=i}},address:T(D),description:T(D),name:T(D),open:T(_n),phoneNumber:T(D),styleUrl:T(tv),visibility:T(_n)},L(yn,{MultiTrack:T(function(e,t){const i=O([],QT,e,t);if(i)return new Et(i)},"geometry"),Track:T(sv,"geometry")})),UT=L(Y,{ExtendedData:uv,Region:dv,Link:function(e,t){Ct(zT,e,t)},address:T(D),description:T(D),name:T(D),open:T(_n),phoneNumber:T(D),visibility:T(_n)}),zT=L(Y,{href:T(ev)}),XT=L(Y,{Altitude:T(de),Longitude:T(de),Latitude:T(de),Tilt:T(de),AltitudeMode:T(D),Heading:T(de),Roll:T(de)}),Jx=L(Y,{LatLonAltBox:function(e,t){const i=O({},cC,e,t);if(!i)return;const n=t[t.length-1],r=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];n.extent=r,n.altitudeMode=i.altitudeMode,n.minAltitude=parseFloat(i.minAltitude),n.maxAltitude=parseFloat(i.maxAltitude)},Lod:function(e,t){const i=O({},uC,e,t);if(!i)return;const n=t[t.length-1];n.minLodPixels=parseFloat(i.minLodPixels),n.maxLodPixels=parseFloat(i.maxLodPixels),n.minFadeExtent=parseFloat(i.minFadeExtent),n.maxFadeExtent=parseFloat(i.maxFadeExtent)}}),VT=L(Y,["Document","Placemark"]),WT=L(Y,{Document:b(function(e,t,i){ee({node:e},fC,pC,t,i,void 0,this)}),Placemark:b(yv)});let to,Df,Ba,Ua,za,Sc,Xa=null,kf,Ec=null,Gf,Tc=null,er=null,jf=null,Cc,bc=null;function Rc(e){return 32/Math.min(e[0],e[1])}function ZT(e){return e}function Qx(e,t,i){return Array.isArray(e)?e:typeof e=="string"?Qx(i[e],t,i):t}function Pc(e){const t=yt(e,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(i){const n=i[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function Bf(e){let t=yt(e,!1);const i=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=n.exec(t);){const s=parseFloat(r[1]),o=parseFloat(r[2]),a=r[3]?parseFloat(r[3]):0;i.push(s,o,a),t=t.substr(r[0].length)}if(t==="")return i}function ev(e){const t=yt(e,!1).trim();let i=e.baseURI;return i&&i!="about:blank"||(i=window.location.href),i?new URL(t,i).href:t}function tv(e){const t=yt(e,!1).trim().replace(/^(?!.*#)/,"#");let i=e.baseURI;return i&&i!="about:blank"||(i=window.location.href),i?new URL(t,i).href:t}function iv(e){return de(e)}const $T=L(Y,{Pair:function(e,t){const i=O({},lC,e,t,this);if(!i)return;const n=i.key;if(n&&n=="normal"){const r=i.styleUrl;r&&(t[t.length-1]=r);const s=i.Style;s&&(t[t.length-1]=s)}}});function nv(e,t){return O(void 0,$T,e,t,this)}const YT=L(Y,{Icon:T(function(e,t){const i=O({},tC,e,t);return i||null}),color:T(Pc),heading:T(de),hotSpot:T(function(e){const t=e.getAttribute("xunits"),i=e.getAttribute("yunits");let n;return n=t!=="insetPixels"?i!=="insetPixels"?"bottom-left":"top-left":i!=="insetPixels"?"bottom-right":"top-right",{x:parseFloat(e.getAttribute("x")),xunits:Hx[t],y:parseFloat(e.getAttribute("y")),yunits:Hx[i],origin:n}}),scale:T(iv)}),qT=L(Y,{color:T(Pc),scale:T(iv)}),KT=L(Y,{color:T(Pc),width:T(de)}),HT=L(Y,{color:T(Pc),fill:T(_n),outline:T(_n)}),JT=L(Y,{coordinates:K(Bf)});function rv(e,t){return O(null,JT,e,t)}const QT=L(yn,{Track:Z(sv)}),eC=L(Y,{when:function(e,t){const i=t[t.length-1].whens,n=yt(e,!1),r=Date.parse(n);i.push(isNaN(r)?0:r)}},L(yn,{coord:function(e,t){const i=t[t.length-1].coordinates,n=yt(e,!1),r=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(r){const s=parseFloat(r[1]),o=parseFloat(r[2]),a=parseFloat(r[3]);i.push([s,o,a])}else i.push([])}}));function sv(e,t){const i=O({coordinates:[],whens:[]},eC,e,t);if(!i)return;const n=[],r=i.coordinates,s=i.whens;for(let o=0,a=Math.min(r.length,s.length);o<a;++o)r[o].length==3&&n.push(r[o][0],r[o][1],r[o][2],s[o]);return new Ue(n,"XYZM")}const tC=L(Y,{href:T(ev)},L(yn,{x:T(de),y:T(de),w:T(de),h:T(de)})),iC=L(Y,{coordinates:K(Bf)});function Uf(e,t){return O(null,iC,e,t)}const Fc=L(Y,{extrude:T(_n),tessellate:T(_n),altitudeMode:T(D)});function ov(e,t){const i=O({},Fc,e,t),n=Uf(e,t);if(n){const r=new Ue(n,"XYZ");return r.setProperties(i,!0),r}}function av(e,t){const i=O({},Fc,e,t),n=Uf(e,t);if(n){const r=new ot(n,"XYZ",[n.length]);return r.setProperties(i,!0),r}}const nC=L(Y,{LineString:Z(ov),LinearRing:Z(av),MultiGeometry:Z(lv),Point:Z(hv),Polygon:Z(cv)});function lv(e,t){const i=O([],nC,e,t);if(!i)return null;if(i.length===0)return new ut(i);let n,r=!0;const s=i[0].getType();let o;for(let a=1,l=i.length;a<l;++a)if(o=i[a],o.getType()!=s){r=!1;break}if(r){let a,l;if(s=="Point"){const h=i[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=i.length;c<u;++c)o=i[c],ge(l,o.getFlatCoordinates());n=new ri(l,a),Xf(n,i)}else if(s=="LineString")n=new Et(i),Xf(n,i);else if(s=="Polygon")n=new Zt(i),Xf(n,i);else{if(s!="GeometryCollection")throw new Error("Unknown geometry type found");n=new ut(i)}}else n=new ut(i);return n}function hv(e,t){const i=O({},Fc,e,t),n=Uf(e,t);if(n){const r=new Ae(n,"XYZ");return r.setProperties(i,!0),r}}const rC=L(Y,{innerBoundaryIs:function(e,t){const i=O([],dC,e,t);i.length>0&&t[t.length-1].push(...i)},outerBoundaryIs:function(e,t){const i=O(void 0,gC,e,t);i&&(t[t.length-1][0]=i)}});function cv(e,t){const i=O({},Fc,e,t),n=O([null],rC,e,t);if(n&&n[0]){const r=n[0],s=[r.length];for(let a=1,l=n.length;a<l;++a)ge(r,n[a]),s.push(r.length);const o=new ot(r,"XYZ",s);return o.setProperties(i,!0),o}}const sC=L(Y,{IconStyle:function(e,t){const i=O({},YT,e,t);if(!i)return;const n=t[t.length-1],r="Icon"in i?i.Icon:{},s=!("Icon"in i)||Object.keys(r).length>0;let o;const a=r.href;let l,h,c;a?o=a:s&&(o=Sc);let u="bottom-left";const g=i.hotSpot;let f;g?(l=[g.x,g.y],h=g.xunits,c=g.yunits,u=g.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=Df,h=Ba,c=Ua):o.includes("arrow-reverse")?(l=[54,42],h=Ba,c=Ua):o.includes("paddle")&&(l=[32,1],h=Ba,c=Ua));const p=r.x,m=r.y;let _;p!==void 0&&m!==void 0&&(f=[p,m]);const x=r.w,y=r.h;let v;x!==void 0&&y!==void 0&&(_=[x,y]);const w=i.heading;w!==void 0&&(v=st(w));const S=i.scale,C=i.color;if(s){o==Sc&&(_=za);const E=new Ea({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:f,offsetOrigin:"bottom-left",rotation:v,scale:S,size:_,src:this.iconUrlFunction_(o),color:C}),R=E.getScaleArray()[0],P=E.getSize();if(P===null){const I=E.getImageState();if(I===wt||I===en){const A=function(){const G=E.getImageState();if(G!==wt&&G!==en){const B=E.getSize();if(B&&B.length==2){const z=Rc(B);E.setScale(R*z)}E.unlistenImageChange(A)}};E.listenImageChange(A),I===wt&&E.load()}}else if(P.length==2){const I=Rc(P);E.setScale(R*I)}n.imageStyle=E}else n.imageStyle=kf},LabelStyle:function(e,t){const i=O({},qT,e,t);if(!i)return;const n=t[t.length-1],r=new Zs({fill:new bi({color:"color"in i?i.color:to}),scale:i.scale});n.textStyle=r},LineStyle:function(e,t){const i=O({},KT,e,t);if(!i)return;const n=t[t.length-1],r=new li({color:"color"in i?i.color:to,width:"width"in i?i.width:1});n.strokeStyle=r},PolyStyle:function(e,t){const i=O({},HT,e,t);if(!i)return;const n=t[t.length-1],r=new bi({color:"color"in i?i.color:to});n.fillStyle=r;const s=i.fill;s!==void 0&&(n.fill=s);const o=i.outline;o!==void 0&&(n.outline=o)}});function zf(e,t){const i=O({},sC,e,t,this);if(!i)return null;let n="fillStyle"in i?i.fillStyle:Xa;const r=i.fill;let s;r===void 0||r||(n=null),"imageStyle"in i?i.imageStyle!=kf&&(s=i.imageStyle):s=Ec;const o="textStyle"in i?i.textStyle:er,a="strokeStyle"in i?i.strokeStyle:Tc,l=i.outline;return l===void 0||l?[new Nt({fill:n,image:s,stroke:a,text:o,zIndex:void 0})]:[new Nt({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection")return new ut(c.getGeometriesArrayRecursive().filter(function(g){const f=g.getType();return f!=="Polygon"&&f!=="MultiPolygon"}));if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:n,image:s,stroke:a,text:o,zIndex:void 0}),new Nt({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection")return new ut(c.getGeometriesArrayRecursive().filter(function(g){const f=g.getType();return f==="Polygon"||f==="MultiPolygon"}));if(u==="Polygon"||u==="MultiPolygon")return c},fill:n,stroke:null,zIndex:void 0})]}function Xf(e,t){const i=t.length,n=new Array(t.length),r=new Array(t.length),s=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<i;++h){const c=t[h];n[h]=c.get("extrude"),r[h]=c.get("tessellate"),s[h]=c.get("altitudeMode"),o=o||n[h]!==void 0,a=a||r[h]!==void 0,l=l||s[h]}o&&e.set("extrude",n),a&&e.set("tessellate",r),l&&e.set("altitudeMode",s)}const oC=L(Y,{displayName:T(D),value:T(D)}),aC=L(Y,{Data:function(e,t){const i=e.getAttribute("name");Ct(oC,e,t);const n=t[t.length-1];i&&n.displayName?n[i]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:i!==null?n[i]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(e,t){Ct(hC,e,t)}});function uv(e,t){Ct(aC,e,t)}function dv(e,t){Ct(Jx,e,t)}const lC=L(Y,{Style:T(zf),key:T(D),styleUrl:T(tv)}),hC=L(Y,{SimpleData:function(e,t){const i=e.getAttribute("name");if(i!==null){const n=D(e);t[t.length-1][i]=n}}}),cC=L(Y,{altitudeMode:T(D),minAltitude:T(de),maxAltitude:T(de),north:T(de),south:T(de),east:T(de),west:T(de)}),uC=L(Y,{minLodPixels:T(de),maxLodPixels:T(de),minFadeExtent:T(de),maxFadeExtent:T(de)}),dC=L(Y,{LinearRing:Z(rv)}),gC=L(Y,{LinearRing:K(rv)});function Ic(e,t){const i=vi(t),n=[255*(i.length==4?i[3]:1),i[2],i[1],i[0]];for(let r=0;r<4;++r){const s=Math.floor(n[r]).toString(16);n[r]=s.length==1?"0"+s:s}J(e,n.join(""))}const Lc=L(Y,{Data:b(function(e,t,i){e.setAttribute("name",t.name);const n={node:e},r=t.value;typeof r=="object"?(r!==null&&r.displayName&&ee(n,Lc,at,[r.displayName],i,["displayName"]),r!==null&&r.value&&ee(n,Lc,at,[r.value],i,["value"])):ee(n,Lc,at,[r],i,["value"])}),value:b(function(e,t){J(e,t)}),displayName:b(function(e,t){Zx(e,t)})}),fC=L(Y,{Placemark:b(yv)}),pC=function(e,t,i){return Q(t[t.length-1].node.namespaceURI,"Placemark")},mC=ze("Data"),gv=L(Y,["href"],L(yn,["x","y","w","h"])),fv=L(Y,{href:b(J)},L(yn,{x:b(Rt),y:b(Rt),w:b(Rt),h:b(Rt)})),_C=function(e,t,i){return Q(yn[0],"gx:"+i)},yC=L(Y,["scale","heading","Icon","color","hotSpot"]),xC=L(Y,{Icon:b(function(e,t,i){const n={node:e},r=i[i.length-1].node;let s=gv[r.namespaceURI],o=Tt(t,s);ee(n,fv,at,o,i,s),s=gv[yn[0]],o=Tt(t,s),ee(n,fv,_C,o,i,s)}),color:b(Ic),heading:b(Rt),hotSpot:b(function(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}),scale:b(wv)}),vC=L(Y,["color","scale"]),wC=L(Y,{color:b(Ic),scale:b(wv)}),SC=L(Y,["color","width"]),EC=L(Y,{color:b(Ic),width:b(Rt)}),TC={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},pv=function(e,t,i){if(e)return Q(t[t.length-1].node.namespaceURI,TC[e.getType()])},CC=ze("Point"),bC=ze("LineString"),RC=ze("LinearRing"),PC=ze("Polygon"),FC=L(Y,{LineString:b(io),Point:b(io),Polygon:b(vv),GeometryCollection:b(mv)});function mv(e,t,i){const n={node:e},r=t.getType();let s,o=[];if(r==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")o=o.concat(a.getPoints());else if(l==="MultiLineString")o=o.concat(a.getLineStrings());else if(l==="MultiPolygon")o=o.concat(a.getPolygons());else{if(l!=="Point"&&l!=="LineString"&&l!=="Polygon")throw new Error("Unknown geometry type");o.push(a)}}),s=pv;else if(r==="MultiPoint")o=t.getPoints(),s=CC;else if(r==="MultiLineString")o=t.getLineStrings(),s=bC;else{if(r!=="MultiPolygon")throw new Error("Unknown geometry type");o=t.getPolygons(),s=PC}ee(n,FC,s,o,i)}const IC=L(Y,{LinearRing:b(io)});function _v(e,t,i){ee({node:e},IC,RC,[t],i)}const Vf=L(Y,{ExtendedData:b(function(e,t,i){const n={node:e},r=t.names,s=t.values,o=r.length;for(let a=0;a<o;a++)ee(n,Lc,mC,[{name:r[a],value:s[a]}],i)}),MultiGeometry:b(mv),LineString:b(io),LinearRing:b(io),Point:b(io),Polygon:b(vv),Style:b(function(e,t,i){const n={node:e},r={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(r.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(r.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!r.LineStyle&&(r.LineStyle=l),r.PolyStyle=t.polyStyles[0]}const s=i[i.length-1].node,o=jC[s.namespaceURI],a=Tt(r,o);ee(n,BC,at,a,i,o)}),address:b(J),description:b(J),name:b(J),open:b(Qr),phoneNumber:b(J),styleUrl:b(J),visibility:b(Qr)}),LC=L(Y,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),MC=ze("ExtendedData");function yv(e,t,i){const n={node:e};t.getId()&&e.setAttribute("id",t.getId());const r=t.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[t.getGeometryName()]=1;const o=Object.keys(r||{}).sort().filter(function(f){return!s[f]}),a=t.getStyleFunction();if(a){const f=a(t,0);if(f){const p=Array.isArray(f)?f:[f];let m=p;if(t.getGeometry()&&(m=p.filter(function(_){const x=_.getGeometryFunction()(t);if(x){const y=x.getType();return y==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(v){const w=v.getType();return w==="Point"||w==="MultiPoint"}).length:y==="Point"||y==="MultiPoint"}})),this.writeStyles_){let _=p,x=p;t.getGeometry()&&(_=p.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const w=v.getType();return w==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(S){const C=S.getType();return C==="LineString"||C==="MultiLineString"}).length:w==="LineString"||w==="MultiLineString"}}),x=p.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const w=v.getType();return w==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(S){const C=S.getType();return C==="Polygon"||C==="MultiPolygon"}).length:w==="Polygon"||w==="MultiPolygon"}})),r.Style={pointStyles:m,lineStyles:_,polyStyles:x}}if(m.length&&r.name===void 0){const _=m[0].getText();_&&(r.name=_.getText())}}}const l=i[i.length-1].node,h=LC[l.namespaceURI],c=Tt(r,h);if(ee(n,Vf,at,c,i,h),o.length>0){const f=Tt(r,o);ee(n,Vf,MC,[{names:o,values:f}],i)}const u=i[0];let g=t.getGeometry();g&&(g=Me(g,!0,u)),ee(n,Vf,pv,[g],i)}const AC=L(Y,["extrude","tessellate","altitudeMode","coordinates"]),OC=L(Y,{extrude:b(Qr),tessellate:b(Qr),altitudeMode:b(J),coordinates:b(function(e,t,i){const n=i[i.length-1],r=n.layout,s=n.stride;let o;if(r=="XY"||r=="XYM")o=2;else{if(r!="XYZ"&&r!="XYZM")throw new Error("Invalid geometry layout");o=3}const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=s;h<a;h+=s){l+=" "+t[h];for(let c=1;c<o;++c)l+=","+t[h+c]}}J(e,l)})});function io(e,t,i){const n=t.getFlatCoordinates(),r={node:e};r.layout=t.getLayout(),r.stride=t.getStride();const s=t.getProperties();s.coordinates=n;const o=i[i.length-1].node,a=AC[o.namespaceURI],l=Tt(s,a);ee(r,OC,at,l,i,a)}const NC=L(Y,["color","fill","outline"]),xv=L(Y,{outerBoundaryIs:b(_v),innerBoundaryIs:b(_v)}),DC=ze("innerBoundaryIs"),kC=ze("outerBoundaryIs");function vv(e,t,i){const n=t.getLinearRings(),r=n.shift(),s={node:e};ee(s,xv,DC,n,i),ee(s,xv,kC,[r],i)}const GC=L(Y,{color:b(Ic),fill:b(Qr),outline:b(Qr)});function wv(e,t){Rt(e,Math.round(1e6*t)/1e6)}const jC=L(Y,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),BC=L(Y,{IconStyle:b(function(e,t,i){const n={node:e},r={},s=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:s};if(o){l.w=o[0],l.h=o[1];const _=t.getAnchor(),x=t.getOrigin();if(x&&a&&x[0]!==0&&x[1]!==o[1]&&(l.x=x[0],l.y=a[1]-(x[1]+o[1])),_&&(_[0]!==o[0]/2||_[1]!==o[1]/2)){const y={x:_[0],xunits:"pixels",y:o[1]-_[1],yunits:"pixels"};r.hotSpot=y}}r.Icon=l;let h=t.getScaleArray()[0],c=o;c===null&&(c=za),c.length==2&&(h/=Rc(c)),h!==1&&(r.scale=h);const u=t.getRotation();u!==0&&(r.heading=u);const g=t.getColor();g&&(r.color=g);const f=i[i.length-1].node,p=yC[f.namespaceURI],m=Tt(r,p);ee(n,xC,at,m,i,p)}),LabelStyle:b(function(e,t,i){const n={node:e},r={},s=t.getFill();s&&(r.color=s.getColor());const o=t.getScale();o&&o!==1&&(r.scale=o);const a=i[i.length-1].node,l=vC[a.namespaceURI],h=Tt(r,l);ee(n,wC,at,h,i,l)}),LineStyle:b(function(e,t,i){const n={node:e},r={color:t.getColor(),width:Number(t.getWidth())||1},s=i[i.length-1].node,o=SC[s.namespaceURI],a=Tt(r,o);ee(n,EC,at,a,i,o)}),PolyStyle:b(function(e,t,i){const n={node:e},r=t.getFill(),s=t.getStroke(),o={color:r?r.getColor():void 0,fill:!!r&&void 0,outline:!!s&&void 0},a=i[i.length-1].node,l=NC[a.namespaceURI],h=Tt(o,l);ee(n,GC,at,h,i,l)})});var UC=class extends Jr{constructor(e){super(),e=e||{},bc||(to=[255,255,255,1],Xa=new bi({color:to}),Df=[20,2],Ba="pixels",Ua="pixels",za=[64,64],Sc="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Ec=new Ea({anchor:Df,anchorOrigin:"bottom-left",anchorXUnits:Ba,anchorYUnits:Ua,crossOrigin:"anonymous",rotation:0,scale:Rc(za),size:za,src:Sc}),kf="NO_IMAGE",Tc=new li({color:to,width:1}),Gf=new li({color:[51,51,51,1],width:2}),er=new Zs({font:"bold 16px Helvetica",fill:Xa,stroke:Gf,scale:.8}),jf=new Nt({fill:Xa,image:Ec,text:er,stroke:Tc,zIndex:0}),bc=[jf]),this.dataProjection=X("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:bc,this.extractStyles_=e.extractStyles===void 0||e.extractStyles,this.writeStyles_=e.writeStyles===void 0||e.writeStyles,this.sharedStyles_={},this.showPointNames_=e.showPointNames===void 0||e.showPointNames,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:ZT,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const i=O([],L(Y,{Document:da(this.readDocumentOrFolder_,this),Folder:da(this.readDocumentOrFolder_,this),Placemark:Z(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),e,t,this);if(i)return i}readPlacemark_(e,t){const i=O({geometry:null},BT,e,t,this);if(!i)return;const n=new Se,r=e.getAttribute("id");r!==null&&n.setId(r);const s=t[0],o=i.geometry;if(o&&Me(o,!1,s),n.setGeometry(o),delete i.geometry,this.extractStyles_){const a=function(l,h,c,u,g){return function(f,p){let m=g,_="",x=[];if(m){const v=f.getGeometry();if(v)if(v instanceof ut)x=v.getGeometriesArrayRecursive().filter(function(w){const S=w.getType();return S==="Point"||S==="MultiPoint"}),m=x.length>0;else{const w=v.getType();m=w==="Point"||w==="MultiPoint"}}m&&(_=f.get("name"),m=m&&!!_,m&&/&[^&]+;/.test(_)&&(Cc||(Cc=document.createElement("textarea")),Cc.innerHTML=_,_=Cc.value));let y=c;if(l?y=l:h&&(y=Qx(h,c,u)),m){const v=function(w,S){const C=[0,0];let E="start";const R=w.getImage();if(R){const A=R.getSize();if(A&&A.length==2){const G=R.getScaleArray(),B=R.getAnchor();C[0]=G[0]*(A[0]-B[0]),C[1]=G[1]*(A[1]/2-B[1]),E="left"}}let P=w.getText();return P?(P=P.clone(),P.setFont(P.getFont()||er.getFont()),P.setScale(P.getScale()||er.getScale()),P.setFill(P.getFill()||er.getFill()),P.setStroke(P.getStroke()||Gf)):P=er.clone(),P.setText(S),P.setOffsetX(C[0]),P.setOffsetY(C[1]),P.setTextAlign(E),new Nt({image:R,text:P})}(y[0],_);return x.length>0?(v.setGeometry(new ut(x)),[v,new Nt({geometry:y[0].getGeometry(),image:null,fill:y[0].getFill(),stroke:y[0].getStroke(),text:null})].concat(y.slice(1))):v}return y}}(i.Style,i.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(a)}return delete i.Style,n.setProperties(i,!0),n}readSharedStyle_(e,t){const i=e.getAttribute("id");if(i!==null){const n=zf.call(this,e,t);if(n){let r,s=e.baseURI;s&&s!="about:blank"||(s=window.location.href),s?r=new URL("#"+i,s).href:r="#"+i,this.sharedStyles_[r]=n}}}readSharedStyleMap_(e,t){const i=e.getAttribute("id");if(i===null)return;const n=nv.call(this,e,t);if(!n)return;let r,s=e.baseURI;s&&s!="about:blank"||(s=window.location.href),s?r=new URL("#"+i,s).href:r="#"+i,this.sharedStyles_[r]=n}readFeatureFromNode(e,t){return Y.includes(e.namespaceURI)&&this.readPlacemark_(e,[this.getReadOptions(e,t)])||null}readFeaturesFromNode(e,t){if(!Y.includes(e.namespaceURI))return[];let i;const n=e.localName;if(n=="Document"||n=="Folder")return i=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),i||[];if(n=="Placemark"){const r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r?[r]:[]}if(n=="kml"){i=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling){const s=this.readFeaturesFromNode(r,t);s&&ge(i,s)}return i}return[]}readName(e){if(e){if(typeof e=="string"){const t=oi(e);return this.readNameFromDocument(t)}return si(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(t);if(i)return i}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Y.includes(t.namespaceURI)&&t.localName=="name")return D(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const i=t.localName;if(Y.includes(t.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const n=this.readNameFromNode(t);if(n)return n}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const i=oi(e);ge(t,this.readNetworkLinksFromDocument(i))}else si(e)?ge(t,this.readNetworkLinksFromDocument(e)):ge(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&ge(t,this.readNetworkLinksFromNode(i));return t}readNetworkLinksFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Y.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const n=O({},UT,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;!Y.includes(i.namespaceURI)||n!="Document"&&n!="Folder"&&n!="kml"||ge(t,this.readNetworkLinksFromNode(i))}return t}readRegion(e){const t=[];if(typeof e=="string"){const i=oi(e);ge(t,this.readRegionFromDocument(i))}else si(e)?ge(t,this.readRegionFromDocument(e)):ge(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&ge(t,this.readRegionFromNode(i));return t}readRegionFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Y.includes(i.namespaceURI)&&i.localName=="Region"){const n=O({},Jx,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;!Y.includes(i.namespaceURI)||n!="Document"&&n!="Folder"&&n!="kml"||ge(t,this.readRegionFromNode(i))}return t}readCamera(e){const t=[];if(typeof e=="string"){const i=oi(e);ge(t,this.readCameraFromDocument(i))}else si(e)?ge(t,this.readCameraFromDocument(e)):ge(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&ge(t,this.readCameraFromNode(i));return t}readCameraFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Y.includes(i.namespaceURI)&&i.localName==="Camera"){const n=O({},XT,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;!Y.includes(i.namespaceURI)||n!=="Document"&&n!=="Folder"&&n!=="Placemark"&&n!=="kml"||ge(t,this.readCameraFromNode(i))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=Q(Y[4],"kml"),n="http://www.w3.org/2000/xmlns/";i.setAttributeNS(n,"xmlns:gx",yn[0]),i.setAttributeNS(n,"xmlns:xsi",Wn),i.setAttributeNS(Wn,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");const r={node:i},s={};e.length>1?s.Document=e:e.length==1&&(s.Placemark=e[0]);const o=VT[i.namespaceURI],a=Tt(s,o);return ee(r,WT,at,a,[t],o,this),i}},zC={read:function(e,t,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=i?r-1:0,g=i?-1:1,f=e[t+u];for(u+=g,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+e[t+u],u+=g,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+e[t+u],u+=g,c-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=h}return(f?-1:1)*o*Math.pow(2,s-n)},write:function(e,t,i,n,r,s){var o,a,l,h=8*s-r-1,c=(1<<h)-1,u=c>>1,g=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?g/l:g*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,r),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;e[i+f]=255&a,f+=p,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;e[i+f]=255&o,f+=p,o/=256,h-=8);e[i+f-p]|=128*m}},XC=Pe,Mc=zC;function Pe(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pe.Varint=0,Pe.Fixed64=1,Pe.Bytes=2,Pe.Fixed32=5;var Wf=4294967296,Sv=1/Wf,Ev=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function xn(e){return e.type===Pe.Bytes?e.readVarint()+e.pos:e.pos+1}function no(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Tv(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function VC(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function WC(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function ZC(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function $C(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function YC(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function qC(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function KC(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function HC(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function JC(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Ac(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function ro(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Cv(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Pe.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,e(r,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ac(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Cv(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ac(this.buf,this.pos)+Ac(this.buf,this.pos+4)*Wf;return this.pos+=8,e},readSFixed64:function(){var e=Ac(this.buf,this.pos)+Cv(this.buf,this.pos+4)*Wf;return this.pos+=8,e},readFloat:function(){var e=Mc.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Mc.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(r,s,o){var a,l,h=o.buf;if(l=h[o.pos++],a=(112&l)>>4,l<128||(l=h[o.pos++],a|=(127&l)<<3,l<128)||(l=h[o.pos++],a|=(127&l)<<10,l<128)||(l=h[o.pos++],a|=(127&l)<<17,l<128)||(l=h[o.pos++],a|=(127&l)<<24,l<128)||(l=h[o.pos++],a|=(1&l)<<31,l<128))return no(r,a,s);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Ev?function(i,n,r){return Ev.decode(i.subarray(n,r))}(this.buf,t,e):function(i,n,r){for(var s="",o=n;o<r;){var a,l,h,c=i[o],u=null,g=c>239?4:c>223?3:c>191?2:1;if(o+g>r)break;g===1?c<128&&(u=c):g===2?(192&(a=i[o+1]))==128&&(u=(31&c)<<6|63&a)<=127&&(u=null):g===3?(a=i[o+1],l=i[o+2],(192&a)==128&&(192&l)==128&&((u=(15&c)<<12|(63&a)<<6|63&l)<=2047||u>=55296&&u<=57343)&&(u=null)):g===4&&(a=i[o+1],l=i[o+2],h=i[o+3],(192&a)==128&&(192&l)==128&&(192&h)==128&&((u=(15&c)<<18|(63&a)<<12|(63&l)<<6|63&h)<=65535||u>=1114112)&&(u=null)),u===null?(u=65533,g=1):u>65535&&(u-=65536,s+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),s+=String.fromCharCode(u),o+=g}return s}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Pe.Bytes)return e.push(this.readVarint(t));var i=xn(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Pe.Bytes)return e.push(this.readSVarint());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Pe.Bytes)return e.push(this.readBoolean());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Pe.Bytes)return e.push(this.readFloat());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Pe.Bytes)return e.push(this.readDouble());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Pe.Bytes)return e.push(this.readFixed32());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Pe.Bytes)return e.push(this.readSFixed32());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Pe.Bytes)return e.push(this.readFixed64());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Pe.Bytes)return e.push(this.readSFixed64());var t=xn(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Pe.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pe.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pe.Fixed32)this.pos+=4;else{if(t!==Pe.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ro(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ro(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ro(this.buf,-1&e,this.pos),ro(this.buf,Math.floor(e*Sv),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ro(this.buf,-1&e,this.pos),ro(this.buf,Math.floor(e*Sv),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(s,o,a){a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos]=127&s}(n,0,i),function(s,o){var a=(7&s)<<4;o.buf[o.pos++]|=a|((s>>>=3)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s)))))}(r,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(n,r,s){for(var o,a,l=0;l<r.length;l++){if((o=r.charCodeAt(l))>55295&&o<57344){if(!a){o>56319||l+1===r.length?(n[s++]=239,n[s++]=191,n[s++]=189):a=o;continue}if(o<56320){n[s++]=239,n[s++]=191,n[s++]=189,a=o;continue}o=a-55296<<10|o-56320|65536,a=null}else a&&(n[s++]=239,n[s++]=191,n[s++]=189,a=null);o<128?n[s++]=o:(o<2048?n[s++]=o>>6|192:(o<65536?n[s++]=o>>12|224:(n[s++]=o>>18|240,n[s++]=o>>12&63|128),n[s++]=o>>6&63|128),n[s++]=63&o|128)}return s}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Tv(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Mc.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Mc.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&Tv(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,Pe.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,VC,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,WC,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,YC,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ZC,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,$C,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,qC,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,KC,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,HC,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,JC,t)},writeBytesField:function(e,t){this.writeTag(e,Pe.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pe.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pe.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pe.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pe.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pe.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pe.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pe.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pe.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pe.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var QC=Bu(XC);function eb(e,t,i){if(e===3){const n={keys:[],values:[],features:[]},r=i.readVarint()+i.pos;i.readFields(tb,n,r),n.length=n.features.length,n.length&&(t[n.name]=n)}}function tb(e,t,i){if(e===15)t.version=i.readVarint();else if(e===1)t.name=i.readString();else if(e===5)t.extent=i.readVarint();else if(e===2)t.features.push(i.pos);else if(e===3)t.keys.push(i.readString());else if(e===4){let n=null;const r=i.readVarint()+i.pos;for(;i.pos<r;)n=(e=i.readVarint()>>3)===1?i.readString():e===2?i.readFloat():e===3?i.readDouble():e===4?i.readVarint64():e===5?i.readVarint():e===6?i.readSVarint():e===7?i.readBoolean():null;t.values.push(n)}}function ib(e,t,i){if(e==1)t.id=i.readVarint();else if(e==2){const n=i.readVarint()+i.pos;for(;i.pos<n;){const r=t.layer.keys[i.readVarint()],s=t.layer.values[i.readVarint()];t.properties[r]=s}}else e==3?t.type=i.readVarint():e==4&&(t.geometry=i.pos)}function nb(e,t,i){e.pos=t.features[i];const n=e.readVarint()+e.pos,r={layer:t,type:0,properties:{}};return e.readFields(ib,r,n),r}var rb=class extends Qs{constructor(e){super(),e=e||{},this.dataProjection=new xr({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:$t,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,n){e.pos=t.geometry;const r=e.readVarint()+e.pos;let s=1,o=0,a=0,l=0,h=0,c=0;for(;e.pos<r;){if(!o){const u=e.readVarint();s=7&u,o=u>>3}if(o--,s===1||s===2)a+=e.readSVarint(),l+=e.readSVarint(),s===1&&h>c&&(n.push(h),c=h),i.push(a,l),h+=2;else{if(s!==7)throw new Error("Invalid command found in the PBF");h>c&&(i.push(i[c],i[c+1]),h+=2)}}h>c&&(n.push(h),c=h)}createFeature_(e,t,i){const n=t.type;if(n===0)return null;let r;const s=t.properties;let o;this.idProperty_?(o=s[this.idProperty_],delete s[this.idProperty_]):o=t.id,s[this.layerName_]=t.layer.name;const a=[],l=[];this.readRawGeometry_(e,t,a,l);const h=function(c,u){let g;return c===1?g=u===1?"Point":"MultiPoint":c===2?g=u===1?"LineString":"MultiLineString":c===3&&(g="Polygon"),g}(n,l.length);if(this.featureClass_===$t)r=new this.featureClass_(h,a,l,2,s,o),r.transform(i.dataProjection);else{let c;if(h=="Polygon"){const g=No(a,l);c=g.length>1?new Zt(a,"XY",g):new ot(a,"XY",l)}else c=h==="Point"?new Ae(a,"XY"):h==="LineString"?new Ue(a,"XY"):h==="MultiPoint"?new ri(a,"XY"):h==="MultiLineString"?new Et(a,"XY",l):null;r=new this.featureClass_,this.geometryName_&&r.setGeometryName(this.geometryName_);const u=Me(c,!1,i);r.setGeometry(u),o!==void 0&&r.setId(o),r.setProperties(s,!0)}return r}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_,n=X((t=this.adaptOptions(t)).dataProjection);n.setWorldExtent(t.extent),t.dataProjection=n;const r=new QC(e),s=r.readFields(eb,{}),o=[];for(const a in s){if(i&&!i.includes(a))continue;const l=s[a],h=l?[0,0,l.extent,l.extent]:null;n.setExtent(h);for(let c=0,u=l.length;c<u;++c){const g=nb(r,l,c),f=this.createFeature_(r,g,t);f!==null&&o.push(f)}}return o}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}};const Zf=[null],sb=L(Zf,{nd:function(e,t){const i=t[t.length-1];i.ndrefs.push(e.getAttribute("ref")),e.hasAttribute("lon")&&e.hasAttribute("lat")&&(i.flatCoordinates.push(parseFloat(e.getAttribute("lon"))),i.flatCoordinates.push(parseFloat(e.getAttribute("lat"))))},tag:bv}),ob=L(Zf,{node:function(e,t){const i=t[0],n=t[t.length-1],r=e.getAttribute("id"),s=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))];n.nodes[r]=s;const o=O({tags:{}},ab,e,t);if(!qt(o.tags)){const a=new Ae(s);Me(a,!1,i);const l=new Se(a);r!==void 0&&l.setId(r),l.setProperties(o.tags,!0),n.features.push(l)}},way:function(e,t){const i=O({id:e.getAttribute("id"),ndrefs:[],flatCoordinates:[],tags:{}},sb,e,t);t[t.length-1].ways.push(i)}}),ab=L(Zf,{tag:bv});function bv(e,t){t[t.length-1].tags[e.getAttribute("k")]=e.getAttribute("v")}var lb=class extends Jr{constructor(){super(),this.dataProjection=X("EPSG:4326")}readFeaturesFromNode(e,t){if(t=this.getReadOptions(e,t),e.localName=="osm"){const i=O({nodes:{},ways:[],features:[]},ob,e,[t]);for(let n=0;n<i.ways.length;n++){const r=i.ways[n],s=r.flatCoordinates;if(!s.length)for(let l=0,h=r.ndrefs.length;l<h;l++)ge(s,i.nodes[r.ndrefs[l]]);let o;o=r.ndrefs[0]==r.ndrefs[r.ndrefs.length-1]?new ot(s,"XY",[s.length]):new Ue(s,"XY"),Me(o,!1,t);const a=new Se(o);r.id!==void 0&&a.setId(r.id),a.setProperties(r.tags,!0),i.features.push(a)}if(i.features)return i.features}return[]}},Oc=class{read(e){if(!e)return null;if(typeof e=="string"){const t=oi(e);return this.readFromDocument(t)}return si(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){q()}};const hb="http://www.w3.org/1999/xlink";function ts(e){return e.getAttributeNS(hb,"href")}const Gt=[null,"http://www.opengis.net/ows/1.1"],cb=L(Gt,{ServiceIdentification:T(function(e,t){return O({},Sb,e,t)}),ServiceProvider:T(function(e,t){return O({},Eb,e,t)}),OperationsMetadata:T(function(e,t){return O({},yb,e,t)})}),ub=L(Gt,{DeliveryPoint:T(D),City:T(D),AdministrativeArea:T(D),PostalCode:T(D),Country:T(D),ElectronicMailAddress:T(D)}),db=L(Gt,{Value:Oe(function(e,t){return D(e)})}),gb=L(Gt,{AllowedValues:T(function(e,t){return O({},db,e,t)})}),fb=L(Gt,{Phone:T(function(e,t){return O({},xb,e,t)}),Address:T(function(e,t){return O({},ub,e,t)})}),pb=L(Gt,{HTTP:T(function(e,t){return O({},mb,e,t)})}),mb=L(Gt,{Get:Oe(function(e,t){const i=ts(e);if(i)return O({href:i},vb,e,t)}),Post:void 0}),_b=L(Gt,{DCP:T(function(e,t){return O({},pb,e,t)})}),yb=L(Gt,{Operation:function(e,t){const i=e.getAttribute("name"),n=O({},_b,e,t);n&&(t[t.length-1][i]=n)}}),xb=L(Gt,{Voice:T(D),Facsimile:T(D)}),vb=L(Gt,{Constraint:Oe(function(e,t){const i=e.getAttribute("name");if(i)return O({name:i},gb,e,t)})}),wb=L(Gt,{IndividualName:T(D),PositionName:T(D),ContactInfo:T(function(e,t){return O({},fb,e,t)})}),Sb=L(Gt,{Abstract:T(D),AccessConstraints:T(D),Fees:T(D),Title:T(D),ServiceTypeVersion:T(D),ServiceType:T(D)}),Eb=L(Gt,{ProviderName:T(D),ProviderSite:T(ts),ServiceContact:T(function(e,t){return O({},wb,e,t)})});var Rv=class extends Oc{constructor(){super()}readFromNode(e){return O({},cb,e,[])||null}};function Pv(e,t,i){let n;i=i||1e5;const r=new Array(t);for(n=0;n<t;++n)r[n]=0;for(let s=0,o=e.length;s<o;)for(n=0;n<t;++n,++s){const a=e[s],l=a-r[n];r[n]=a,e[s]=l}return Iv(e,i)}function Fv(e,t,i){let n;i=i||1e5;const r=new Array(t);for(n=0;n<t;++n)r[n]=0;const s=Lv(e,i);for(let o=0,a=s.length;o<a;)for(n=0;n<t;++n,++o)r[n]+=s[o],s[o]=r[n];return s}function Iv(e,t){t=t||1e5;for(let i=0,n=e.length;i<n;++i)e[i]=Math.round(e[i]*t);return Mv(e)}function Lv(e,t){t=t||1e5;const i=Av(e);for(let n=0,r=i.length;n<r;++n)i[n]/=t;return i}function Mv(e){for(let t=0,i=e.length;t<i;++t){const n=e[t];e[t]=n<0?~(n<<1):n<<1}return Ov(e)}function Av(e){const t=Nv(e);for(let i=0,n=t.length;i<n;++i){const r=t[i];t[i]=1&r?~(r>>1):r>>1}return t}function Ov(e){let t="";for(let i=0,n=e.length;i<n;++i)t+=Dv(e[i]);return t}function Nv(e){const t=[];let i=0,n=0;for(let r=0,s=e.length;r<s;++r){const o=e.charCodeAt(r)-63;i|=(31&o)<<n,o<32?(t.push(i),i=0,n=0):n+=5}return t}function Dv(e){let t,i="";for(;e>=32;)t=63+(32|31&e),i+=String.fromCharCode(t),e>>=5;return t=e+63,i+=String.fromCharCode(t),i}var Tb=class extends wc{constructor(e){super(),e=e||{},this.dataProjection=X("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const i=this.readGeometryFromText(e,t);return new Se(i)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const i=ms(this.geometryLayout_),n=Fv(e,i,this.factor_);Cf(n,0,n.length,i,n);const r=Li(n,0,n.length,i);return Me(new Ue(r,this.geometryLayout_),!1,this.adaptOptions(t))}writeFeatureText(e,t){const i=e.getGeometry();if(i)return this.writeGeometryText(i,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){const i=(e=Me(e,!0,this.adaptOptions(t))).getFlatCoordinates(),n=e.getStride();return Cf(i,0,i.length,n,i),Pv(i,n,this.factor_)}};const Cb={Point:function(e,t,i){const n=e.coordinates;return t&&i&&$f(n,t,i),new Ae(n)},LineString:function(e,t){const i=Nc(e.arcs,t);return new Ue(i)},Polygon:function(e,t){const i=[];for(let n=0,r=e.arcs.length;n<r;++n)i[n]=Nc(e.arcs[n],t);return new ot(i)},MultiPoint:function(e,t,i){const n=e.coordinates;if(t&&i)for(let r=0,s=n.length;r<s;++r)$f(n[r],t,i);return new ri(n)},MultiLineString:function(e,t){const i=[];for(let n=0,r=e.arcs.length;n<r;++n)i[n]=Nc(e.arcs[n],t);return new Et(i)},MultiPolygon:function(e,t){const i=[];for(let n=0,r=e.arcs.length;n<r;++n){const s=e.arcs[n],o=[];for(let a=0,l=s.length;a<l;++a)o[a]=Nc(s[a],t);i[n]=o}return new Zt(i)}};function Nc(e,t){const i=[];let n;for(let r=0,s=e.length;r<s;++r)if(n=e[r],r>0&&i.pop(),n>=0){const o=t[n];for(let a=0,l=o.length;a<l;++a)i.push(o[a].slice(0))}else{const o=t[~n];for(let a=o.length-1;a>=0;--a)i.push(o[a].slice(0))}return i}function bb(e,t,i,n,r,s,o){const a=e.geometries,l=[];for(let h=0,c=a.length;h<c;++h)l[h]=kv(a[h],t,i,n,r,s,o);return l}function kv(e,t,i,n,r,s,o){let a=null;const l=e.type;if(l){const u=Cb[l];a=l==="Point"||l==="MultiPoint"?u(e,i,n):u(e,t),a=Me(a,!1,o)}const h=new Se({geometry:a});e.id!==void 0&&h.setId(e.id);let c=e.properties;return r&&(c||(c={}),c[r]=s),c&&h.setProperties(c,!0),h}function Rb(e,t,i){let n=0,r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];n+=a[0],r+=a[1],a[0]=n,a[1]=r,$f(a,t,i)}}function $f(e,t,i){e[0]=e[0]*t[0]+i[0],e[1]=e[1]*t[1]+i[1]}var Pb=class extends _c{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=X(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if(e.type=="Topology"){const i=e;let n,r=null,s=null;i.transform&&(n=i.transform,r=n.scale,s=n.translate);const o=i.arcs;n&&function(u,g,f){for(let p=0,m=u.length;p<m;++p)Rb(u[p],g,f)}(o,r,s);const a=[],l=i.objects,h=this.layerName_;let c;for(const u in l)this.layers_&&!this.layers_.includes(u)||(l[u].type==="GeometryCollection"?(c=l[u],a.push.apply(a,bb(c,o,r,s,h,u,t))):(c=l[u],a.push(kv(c,o,r,s,h,u,t))));return a}return[]}readProjectionFromObject(e){return this.dataProjection}},is=class{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}},Yf=class extends is{constructor(e,t){super(e),this.conditions=t,ie(this.conditions.length>=2,"At least 2 conditions are required")}},Gv=class extends Yf{constructor(e){super("And",Array.prototype.slice.call(arguments))}},jv=class extends is{constructor(e,t,i){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}},so=class extends is{constructor(e,t,i,n){super(e),this.geometryName=t||"the_geom",this.geometry=i,this.srsName=n}},Bv=class extends so{constructor(e,t,i){super("Contains",e,t,i)}},Uv=class extends so{constructor(e,t,i,n,r){super("DWithin",e,t,r),this.distance=i,this.unit=n}},zv=class extends so{constructor(e,t,i){super("Disjoint",e,t,i)}},oo=class extends is{constructor(e,t){super(e),this.propertyName=t}},Xv=class extends oo{constructor(e,t,i){super("During",e),this.begin=t,this.end=i}},ns=class extends oo{constructor(e,t,i,n){super(e,t),this.expression=i,this.matchCase=n}},Vv=class extends ns{constructor(e,t,i){super("PropertyIsEqualTo",e,t,i)}},Wv=class extends ns{constructor(e,t){super("PropertyIsGreaterThan",e,t)}},Zv=class extends ns{constructor(e,t){super("PropertyIsGreaterThanOrEqualTo",e,t)}},$v=class extends so{constructor(e,t,i){super("Intersects",e,t,i)}},Yv=class extends oo{constructor(e,t,i){super("PropertyIsBetween",e),this.lowerBoundary=t,this.upperBoundary=i}},qv=class extends oo{constructor(e,t,i,n,r,s){super("PropertyIsLike",e),this.pattern=t,this.wildCard=i!==void 0?i:"*",this.singleChar=n!==void 0?n:".",this.escapeChar=r!==void 0?r:"!",this.matchCase=s}},Kv=class extends oo{constructor(e){super("PropertyIsNull",e)}},Hv=class extends ns{constructor(e,t){super("PropertyIsLessThan",e,t)}},Jv=class extends ns{constructor(e,t){super("PropertyIsLessThanOrEqualTo",e,t)}},Qv=class extends is{constructor(e){super("Not"),this.condition=e}},e1=class extends ns{constructor(e,t,i){super("PropertyIsNotEqualTo",e,t,i)}},t1=class extends Yf{constructor(e){super("Or",Array.prototype.slice.call(arguments))}},i1=class extends is{constructor(e){super("ResourceId"),this.rid=e}},n1=class extends so{constructor(e,t,i){super("Within",e,t,i)}};function r1(e){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Gv,t))}function s1(e,t,i){return new jv(e,t,i)}const o1={"http://www.opengis.net/gml":{boundedBy:T(ce.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Z(ce.prototype.readFeaturesInternal)}},Fb={"http://www.opengis.net/wfs":{totalInserted:T(Ye),totalUpdated:T(Ye),totalDeleted:T(Ye)},"http://www.opengis.net/wfs/2.0":{totalInserted:T(Ye),totalUpdated:T(Ye),totalDeleted:T(Ye)}},Ib={"http://www.opengis.net/wfs":{TransactionSummary:T(c1,"transactionSummary"),InsertResults:T(d1,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:T(c1,"transactionSummary"),InsertResults:T(d1,"insertIds")}},Lb={"http://www.opengis.net/wfs":{PropertyName:b(J)},"http://www.opengis.net/wfs/2.0":{PropertyName:b(J)}},a1={"http://www.opengis.net/wfs":{Insert:b(g1),Update:b(m1),Delete:b(p1),Property:b(_1),Native:b(y1)},"http://www.opengis.net/wfs/2.0":{Insert:b(g1),Update:b(m1),Delete:b(p1),Property:b(_1),Native:b(y1)}},l1="feature",qf="http://www.w3.org/2000/xmlns/",Kf={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Hf={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Jf={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},h1={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Qf={"2.0.0":xc,"1.1.0":ue,"1.0.0":es};function Dc(e,t,i,n){ee(n,a1,ze(e),t,i)}function c1(e,t){return O({},Fb,e,t)}const Mb={"http://www.opengis.net/ogc":{FeatureId:Z(function(e,t){return e.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:Z(function(e,t){return e.getAttribute("fid")})}};function u1(e,t){Ct(Mb,e,t)}const Ab={"http://www.opengis.net/wfs":{Feature:u1},"http://www.opengis.net/wfs/2.0":{Feature:u1}};function d1(e,t){return O([],Ab,e,t)}function g1(e,t,i){const n=i[i.length-1],r=n.featureType,s=n.featureNS,o=n.gmlVersion,a=Q(s,r);e.appendChild(a),o===2?es.prototype.writeFeatureElement(a,t,i):o===3?ue.prototype.writeFeatureElement(a,t,i):xc.prototype.writeFeatureElement(a,t,i)}function f1(e,t,i){const n=i[i.length-1].version,r=Kf[n],s=Q(r,"Filter"),o=Q(r,"FeatureId");s.appendChild(o),o.setAttribute("fid",t),e.appendChild(s)}function ep(e,t){const i=(e=e||l1)+":";return t.startsWith(i)?t:i+t}function p1(e,t,i){const n=i[i.length-1];ie(t.getId()!==void 0,"Features must have an id set");const r=n.featureType,s=n.featurePrefix,o=n.featureNS,a=ep(s,r);e.setAttribute("typeName",a),e.setAttributeNS(qf,"xmlns:"+s,o);const l=t.getId();l!==void 0&&f1(e,l,i)}function m1(e,t,i){const n=i[i.length-1];ie(t.getId()!==void 0,"Features must have an id set");const r=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=ep(o,s),h=t.getGeometryName();e.setAttribute("typeName",l),e.setAttributeNS(qf,"xmlns:"+o,a);const c=t.getId();if(c!==void 0){const u=t.getKeys(),g=[];for(let f=0,p=u.length;f<p;f++){const m=t.get(u[f]);if(m!==void 0){let _=u[f];m&&typeof m.getSimplifiedGeometry=="function"&&(_=h),g.push({name:_,value:m})}}ee({version:r,gmlVersion:n.gmlVersion,node:e,hasZ:n.hasZ,srsName:n.srsName},a1,ze("Property"),g,i),f1(e,c,i)}}function _1(e,t,i){const n=i[i.length-1],r=n.version,s=Hf[r],o=Q(s,r==="2.0.0"?"ValueReference":"Name"),a=n.gmlVersion;if(e.appendChild(o),J(o,t.name),t.value!==void 0&&t.value!==null){const l=Q(s,"Value");e.appendChild(l),t.value&&typeof t.value.getSimplifiedGeometry=="function"?a===2?es.prototype.writeGeometryElement(l,t.value,i):a===3?ue.prototype.writeGeometryElement(l,t.value,i):xc.prototype.writeGeometryElement(l,t.value,i):J(l,t.value)}}function y1(e,t,i){t.vendorId&&e.setAttribute("vendorId",t.vendorId),t.safeToIgnore!==void 0&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),t.value!==void 0&&J(e,t.value)}const kc={"http://www.opengis.net/wfs":{Query:b(x1)},"http://www.opengis.net/wfs/2.0":{Query:b(x1)},"http://www.opengis.net/ogc":{During:b(E1),And:b(Gc),Or:b(Gc),Not:b(T1),BBOX:b(w1),Contains:b(tr),Intersects:b(tr),Within:b(tr),DWithin:b(S1),PropertyIsEqualTo:b(hi),PropertyIsNotEqualTo:b(hi),PropertyIsLessThan:b(hi),PropertyIsLessThanOrEqualTo:b(hi),PropertyIsGreaterThan:b(hi),PropertyIsGreaterThanOrEqualTo:b(hi),PropertyIsNull:b(C1),PropertyIsBetween:b(b1),PropertyIsLike:b(R1)},"http://www.opengis.net/fes/2.0":{During:b(E1),And:b(Gc),Or:b(Gc),Not:b(T1),BBOX:b(w1),Contains:b(tr),Disjoint:b(tr),Intersects:b(tr),ResourceId:b(function(e,t,i){e.setAttribute("rid",t.rid)}),Within:b(tr),DWithin:b(S1),PropertyIsEqualTo:b(hi),PropertyIsNotEqualTo:b(hi),PropertyIsLessThan:b(hi),PropertyIsLessThanOrEqualTo:b(hi),PropertyIsGreaterThan:b(hi),PropertyIsGreaterThanOrEqualTo:b(hi),PropertyIsNull:b(C1),PropertyIsBetween:b(b1),PropertyIsLike:b(R1)}};function x1(e,t,i){const n=i[i.length-1],r=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let h,c;h=s?ep(s,t):t,c=r==="2.0.0"?"typeNames":"typeName",e.setAttribute(c,h),l&&e.setAttribute("srsName",l),o&&e.setAttributeNS(qf,"xmlns:"+s,o);const u=Object.assign({},n);u.node=e,ee(u,Lb,ze("PropertyName"),a,i);const g=n.filter;if(g){const f=Q(Va(r),"Filter");e.appendChild(f),v1(f,g,i)}}function v1(e,t,i){const n=i[i.length-1],r={node:e};Object.assign(r,{context:n}),ee(r,kc,ze(t.getTagName()),[t],i)}function w1(e,t,i){const n=i[i.length-1],r=n.context.version;n.srsName=t.srsName;const s=Qf[r];ao(r,e,t.geometryName),s.prototype.writeGeometryElement(e,t.extent,i)}function tr(e,t,i){const n=i[i.length-1],r=n.context.version;n.srsName=t.srsName;const s=Qf[r];ao(r,e,t.geometryName),s.prototype.writeGeometryElement(e,t.geometry,i)}function S1(e,t,i){const n=i[i.length-1].context.version;tr(e,t,i);const r=Q(Va(n),"Distance");J(r,t.distance.toString()),n==="2.0.0"?r.setAttribute("uom",t.unit):r.setAttribute("units",t.unit),e.appendChild(r)}function E1(e,t,i){const n=i[i.length-1].context.version;jc(Jf[n],"ValueReference",e,t.propertyName);const r=Q(zi,"TimePeriod");e.appendChild(r);const s=Q(zi,"begin");r.appendChild(s),P1(s,t.begin);const o=Q(zi,"end");r.appendChild(o),P1(o,t.end)}function Gc(e,t,i){const n=i[i.length-1].context,r={node:e};Object.assign(r,{context:n});const s=t.conditions;for(let o=0,a=s.length;o<a;++o){const l=s[o];ee(r,kc,ze(l.getTagName()),[l],i)}}function T1(e,t,i){const n=i[i.length-1].context,r={node:e};Object.assign(r,{context:n});const s=t.condition;ee(r,kc,ze(s.getTagName()),[s],i)}function hi(e,t,i){const n=i[i.length-1].context.version;t.matchCase!==void 0&&e.setAttribute("matchCase",t.matchCase.toString()),ao(n,e,t.propertyName),Bc(n,e,""+t.expression)}function C1(e,t,i){ao(i[i.length-1].context.version,e,t.propertyName)}function b1(e,t,i){const n=i[i.length-1].context.version,r=Va(n);ao(n,e,t.propertyName);const s=Q(r,"LowerBoundary");e.appendChild(s),Bc(n,s,""+t.lowerBoundary);const o=Q(r,"UpperBoundary");e.appendChild(o),Bc(n,o,""+t.upperBoundary)}function R1(e,t,i){const n=i[i.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),t.matchCase!==void 0&&e.setAttribute("matchCase",t.matchCase.toString()),ao(n,e,t.propertyName),Bc(n,e,""+t.pattern)}function jc(e,t,i,n){const r=Q(e,t);J(r,n),i.appendChild(r)}function Bc(e,t,i){jc(Va(e),"Literal",t,i)}function ao(e,t,i){e==="2.0.0"?jc(Jf[e],"ValueReference",t,i):jc(Kf[e],"PropertyName",t,i)}function P1(e,t){const i=Q(zi,"TimeInstant");e.appendChild(i);const n=Q(zi,"timePosition");i.appendChild(n),J(n,t)}function F1(e,t,i){const n=i[i.length-1],r=Object.assign({},n);r.node=e,ee(r,kc,ze("Query"),t,i)}function Va(e){let t;return t=e==="2.0.0"?Jf[e]:Kf[e],t}var Ob=class extends Jr{constructor(e){super(),e=e||{},this.version_=e.version?e.version:"1.1.0",this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Qf[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:h1[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,t||{}));const n=[i];let r;r=this.version_==="2.0.0"?o1:this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let s=O([],r,e,n,this.gmlFormat_);return s||(s=[]),s}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=oi(e);return this.readTransactionResponseFromDocument(t)}return si(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=oi(e);return this.readFeatureCollectionMetadataFromDocument(t)}return si(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},i=Vi(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=i,O(t,o1,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return O({},Ib,e,[])}writeGetFeature(e){const t=Q(Hf[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Wn,"xsi:schemaLocation",this.schemaLocation_);const i={node:t};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),ie(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let n=e.filter;e.bbox&&(ie(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),n=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,n)),Object.assign(i,{geometryName:e.geometryName,filter:n}),F1(t,e.featureTypes,[i])}else e.featureTypes.forEach(n=>{const r=this.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:n.geometryName,filter:r}),F1(t,[n.name],[i])});return t}combineBboxAndFilter(e,t,i,n){const r=s1(e,t,i);return n?r1(n,r):r}writeTransaction(e,t,i,n){const r=[],s=n.version?n.version:this.version_,o=Q(Hf[s],"Transaction");let a;o.setAttribute("service","WFS"),o.setAttribute("version",s),n&&(a=n.gmlOptions?n.gmlOptions:{},n.handle&&o.setAttribute("handle",n.handle)),o.setAttributeNS(Wn,"xsi:schemaLocation",h1[s]);const l=function(h,c,u,g){const f=g.featurePrefix?g.featurePrefix:l1;let p;return u==="1.0.0"?p=2:u==="1.1.0"?p=3:u==="2.0.0"&&(p=3.2),Object.assign({node:h},{version:u,featureNS:g.featureNS,featureType:g.featureType,featurePrefix:f,gmlVersion:p,hasZ:g.hasZ,srsName:g.srsName},c)}(o,a,s,n);return e&&Dc("Insert",e,r,l),t&&Dc("Update",t,r,l),i&&Dc("Delete",i,r,l),n.nativeElements&&Dc("Native",n.nativeElements,r,l),o}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){for(let t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(t.childNodes.length!==0&&(t.childNodes.length!==1||t.firstChild.nodeType!==3)){const i=[{}];return this.gmlFormat_.readGeometryElement(t,i),X(i.pop().srsName)}}return null}};const Uc=1,zc=2,Xc=3,tp=4,ip=5,np=6,rp=7,I1=15,L1=16,M1=17;class A1{constructor(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(t){return this.view_.getUint32((this.pos_+=4)-4,t!==void 0?t:this.isLittleEndian_)}readDouble(t){return this.view_.getFloat64((this.pos_+=8)-8,t!==void 0?t:this.isLittleEndian_)}readPoint(){const t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t}readLineString(){const t=this.readUint32(),i=[];for(let n=0;n<t;n++)i.push(this.readPoint());return i}readPolygon(){const t=this.readUint32(),i=[];for(let n=0;n<t;n++)i.push(this.readLineString());return i}readWkbHeader(t){const i=this.readUint8()>0,n=this.readUint32(i),r=Math.floor((268435455&n)/1e3),s=!!(2147483648&n)||r===1||r===3,o=!!(1073741824&n)||r===2||r===3,a=!!(536870912&n),l=(268435455&n)%1e3,h=["XY",s?"Z":"",o?"M":""].join(""),c=a?this.readUint32(i):null;if(t!==void 0&&t!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==i)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=i,this.hasZ_=s,this.hasM_=o,this.layout_=h,this.srid_=c,this.initialized_=!0;return l}readWkbPayload(t){switch(t){case Uc:return this.readPoint();case zc:return this.readLineString();case Xc:case M1:return this.readPolygon();case tp:return this.readMultiPoint();case ip:return this.readMultiLineString();case np:case I1:case L1:return this.readMultiPolygon();case rp:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}}readWkbBlock(t){return this.readWkbPayload(this.readWkbHeader(t))}readWkbCollection(t,i){const n=this.readUint32(),r=[];for(let s=0;s<n;s++){const o=t.call(this,i);o&&r.push(o)}return r}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Uc)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,zc)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Xc)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),i=this.readWkbPayload(t);switch(t){case Uc:return new Ae(i,this.layout_);case zc:return new Ue(i,this.layout_);case Xc:case M1:return new ot(i,this.layout_);case tp:return new ri(i,this.layout_);case ip:return new Et(i,this.layout_);case np:case I1:case L1:return new Zt(i,this.layout_);case rp:return new ut(i);default:return null}}getSrid(){return this.srid_}}class Nb{constructor(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=t.littleEndian!==!1,this.isEWKB_=t.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},t.nodata)}writeUint8(t){this.writeQueue_.push([1,t])}writeUint32(t){this.writeQueue_.push([4,t])}writeDouble(t){this.writeQueue_.push([8,t])}writePoint(t,i){const n=Object.assign.apply(null,i.split("").map((r,s)=>({[r]:t[s]})));for(const r of this.layout_)this.writeDouble(r in n?n[r]:this.nodata_[r])}writeLineString(t,i){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writePoint(t[n],i)}writePolygon(t,i){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeLineString(t[n],i)}writeWkbHeader(t,i){t%=1e3,this.layout_.includes("Z")&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(i)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(i)&&this.writeUint32(i)}writeMultiPoint(t,i){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(1),this.writePoint(t[n],i)}writeMultiLineString(t,i){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(2),this.writeLineString(t[n],i)}writeMultiPolygon(t,i){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(3),this.writePolygon(t[n],i)}writeGeometryCollection(t){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writeGeometry(t[i])}findMinimumLayout(t,i="XYZM"){if(t instanceof yi)return(n=t.getLayout())===(r=i)?n:n==="XYZM"?r:r==="XYZM"?n:"XY";var n,r;if(t instanceof ut){const s=t.getGeometriesArray();for(let o=0;o<s.length&&i!=="XY";o++)i=this.findMinimumLayout(s[o],i)}return i}writeGeometry(t,i){const n={Point:Uc,LineString:zc,Polygon:Xc,MultiPoint:tp,MultiLineString:ip,MultiPolygon:np,GeometryCollection:rp},r=t.getType(),s=n[r];if(!s)throw new Error("GeometryType "+r+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(s,i),t instanceof yi?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[r].call(this,t.getCoordinates(),t.getLayout()):t instanceof ut&&this.writeGeometryCollection(t.getGeometriesArray())}getBuffer(){const t=this.writeQueue_.reduce((s,o)=>s+o[0],0),i=new ArrayBuffer(t),n=new DataView(i);let r=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(r,s[1]);break;case 4:n.setUint32(r,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(r,s[1],this.isLittleEndian_)}r+=s[0]}),i}}function O1(e){return typeof e=="string"?function(t){const i=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)i[n]=parseInt(t.substr(2*n,2),16);return new DataView(i.buffer)}(e):ArrayBuffer.isView(e)?e instanceof DataView?e:new DataView(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new DataView(e):null}var Db=class extends Qs{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Se({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let i=[];const n=this.readGeometry(e,t);return i=this.splitCollection&&n instanceof ut?n.getGeometriesArray():[n],i.map(r=>new Se({geometry:r}))}readGeometry(e,t){const i=O1(e);if(!i)return null;const n=new A1(i).readGeometry();return this.viewCache_=i,t=this.getReadOptions(e,t),this.viewCache_=null,Me(n,!1,t)}readProjection(e){const t=this.viewCache_||O1(e);if(!t)return;const i=new A1(t);return i.readWkbHeader(),i.getSrid()&&X("EPSG:"+i.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new ut(e.map(i=>i.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const i=new Nb({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let n=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const s=t.dataProjection&&X(t.dataProjection);if(s){const o=s.getCode();o.startsWith("EPSG:")&&(n=Number(o.substring(5)))}}i.writeGeometry(Me(e,!0,t),n);const r=i.getBuffer();return this.hex_?function(s){const o=new Uint8Array(s);return Array.from(o.values()).map(a=>(a<16?"0":"")+Number(a).toString(16).toUpperCase()).join("")}(r):r}};const kb={POINT:Ae,LINESTRING:Ue,POLYGON:ot,MULTIPOINT:ri,MULTILINESTRING:Et,MULTIPOLYGON:Zt},N1="EMPTY",D1="Z",k1="M",Gb=0,Vc=1,vn=2,ir=3,G1=4,lo=5,jb=6,Bb={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Ub{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,i){return i=i!==void 0&&i,t>="0"&&t<="9"||t=="."&&!i}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),i=this.index_;let n,r=t;if(t=="(")n=vn;else if(t==",")n=lo;else if(t==")")n=ir;else if(this.isNumeric_(t)||t=="-")n=G1,r=this.readNumber_();else if(this.isAlpha_(t))n=Vc,r=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t!=="")throw new Error("Unexpected character: "+t);n=jb}return{position:i,value:r,type:n}}readNumber_(){let t;const i=this.index_;let n=!1,r=!1;do t=="."?n=!0:t!="e"&&t!="E"||(r=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!r&&(t=="e"||t=="E")||r&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(i,this.index_--))}readText_(){let t;const i=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(i,this.index_--).toUpperCase()}}class zb{constructor(t){this.lexer_=t,this.token_={position:0,type:Gb},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const i=this.isTokenType(t);return i&&this.consume_(),i}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t="XY";const i=this.token_;if(this.isTokenType(Vc)){const n=i.value;n===D1?t="XYZ":n===k1?t="XYM":n==="ZM"&&(t="XYZM"),t!=="XY"&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(vn)){const t=[];do t.push(this.parseGeometry_());while(this.match(lo));if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(vn)){const t=this.parsePoint_();if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(vn)){const t=this.parsePointList_();if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(vn)){const t=this.parseLineStringTextList_();if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(vn)){let t;if(t=this.token_.type==vn?this.parsePointTextList_():this.parsePointList_(),this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(vn)){const t=this.parseLineStringTextList_();if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(vn)){const t=this.parsePolygonTextList_();if(this.match(ir))return t}throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],i=this.layout_.length;for(let n=0;n<i;++n){const r=this.token_;if(!this.match(G1))break;t.push(r.value)}if(t.length==i)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(lo);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(lo);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(lo);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(lo);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(Vc)&&this.token_.value==N1;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.token_;if(this.match(Vc)){const i=t.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(i=="GEOMETRYCOLLECTION"){if(n)return new ut([]);const o=this.parseGeometryCollectionText_();return new ut(o)}const r=kb[i];if(!r)throw new Error("Invalid geometry type: "+i);let s;if(n)s=i=="POINT"?[NaN,NaN]:[];else switch(i){case"POINT":s=this.parsePointText_();break;case"LINESTRING":s=this.parseLineStringText_();break;case"POLYGON":s=this.parsePolygonText_();break;case"MULTIPOINT":s=this.parseMultiPointText_();break;case"MULTILINESTRING":s=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":s=this.parseMultiPolygonText_()}return new r(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}function j1(e){const t=e.getCoordinates();return t.length===0?"":t.join(" ")}function sp(e){const t=e.getCoordinates(),i=[];for(let n=0,r=t.length;n<r;++n)i.push(t[n].join(" "));return i.join(",")}function B1(e){const t=[],i=e.getLinearRings();for(let n=0,r=i.length;n<r;++n)t.push("("+sp(i[n])+")");return t.join(",")}const Xb={Point:j1,LineString:sp,Polygon:B1,MultiPoint:function(e){const t=[],i=e.getPoints();for(let n=0,r=i.length;n<r;++n)t.push("("+j1(i[n])+")");return t.join(",")},MultiLineString:function(e){const t=[],i=e.getLineStrings();for(let n=0,r=i.length;n<r;++n)t.push("("+sp(i[n])+")");return t.join(",")},MultiPolygon:function(e){const t=[],i=e.getPolygons();for(let n=0,r=i.length;n<r;++n)t.push("("+B1(i[n])+")");return t.join(",")},GeometryCollection:function(e){const t=[],i=e.getGeometries();for(let n=0,r=i.length;n<r;++n)t.push(U1(i[n]));return t.join(",")}};function U1(e){const t=e.getType(),i=(0,Xb[t])(e);let n=Bb[t];if(typeof e.getFlatCoordinates=="function"){const r=function(s){const o=s.getLayout();let a="";return o!=="XYZ"&&o!=="XYZM"||(a+=D1),o!=="XYM"&&o!=="XYZM"||(a+=k1),a}(e);r.length>0&&(n+=" "+r)}return i.length===0?n+" "+N1:n+"("+i+")"}var Vb=class extends wc{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0&&e.splitCollection}parse_(e){const t=new Ub(e);return new zb(t).parse()}readFeatureFromText(e,t){const i=this.readGeometryFromText(e,t),n=new Se;return n.setGeometry(i),n}readFeaturesFromText(e,t){let i=[];const n=this.readGeometryFromText(e,t);i=this.splitCollection_&&n.getType()=="GeometryCollection"?n.getGeometriesArray():[n];const r=[];for(let s=0,o=i.length;s<o;++s){const a=new Se;a.setGeometry(i[s]),r.push(a)}return r}readGeometryFromText(e,t){return Me(this.parse_(e),!1,t)}writeFeatureText(e,t){const i=e.getGeometry();return i?this.writeGeometryText(i,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const i=[];for(let r=0,s=e.length;r<s;++r)i.push(e[r].getGeometry());const n=new ut(i);return this.writeGeometryText(n,t)}writeGeometryText(e,t){return U1(Me(e,!0,t))}};const gt=[null,"http://www.opengis.net/wms"],Wb=L(gt,{Service:T(function(e,t){return O({},$b,e,t)}),Capability:T(function(e,t){return O({},Zb,e,t)})}),Zb=L(gt,{Request:T(function(e,t){return O({},eR,e,t)}),Exception:T(function(e,t){return O([],Hb,e,t)}),Layer:T(function(e,t){const i=O({},z1,e,t);return i.Layer===void 0?Object.assign(i,X1(e,t)):i})}),$b=L(gt,{Name:T(D),Title:T(D),Abstract:T(D),KeywordList:T(W1),OnlineResource:T(ts),ContactInformation:T(function(e,t){return O({},Yb,e,t)}),Fees:T(D),AccessConstraints:T(D),LayerLimit:T(Ye),MaxWidth:T(Ye),MaxHeight:T(Ye)}),Yb=L(gt,{ContactPersonPrimary:T(function(e,t){return O({},qb,e,t)}),ContactPosition:T(D),ContactAddress:T(function(e,t){return O({},Kb,e,t)}),ContactVoiceTelephone:T(D),ContactFacsimileTelephone:T(D),ContactElectronicMailAddress:T(D)}),qb=L(gt,{ContactPerson:T(D),ContactOrganization:T(D)}),Kb=L(gt,{AddressType:T(D),Address:T(D),City:T(D),StateOrProvince:T(D),PostCode:T(D),Country:T(D)}),Hb=L(gt,{Format:Z(D)}),z1=L(gt,{Name:T(D),Title:T(D),Abstract:T(D),KeywordList:T(W1),CRS:Oe(D),EX_GeographicBoundingBox:T(function(e,t){const i=O({},Qb,e,t);if(!i)return;const n=i.westBoundLongitude,r=i.southBoundLatitude,s=i.eastBoundLongitude,o=i.northBoundLatitude;if(!(n===void 0||r===void 0||s===void 0||o===void 0))return[n,r,s,o]}),BoundingBox:Oe(function(e,t){const i=[Xi(e.getAttribute("minx")),Xi(e.getAttribute("miny")),Xi(e.getAttribute("maxx")),Xi(e.getAttribute("maxy"))],n=[Xi(e.getAttribute("resx")),Xi(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:i,res:n}}),Dimension:Oe(function(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:Qn(e.getAttribute("multipleValues")),nearestValue:Qn(e.getAttribute("nearestValue")),current:Qn(e.getAttribute("current")),values:D(e)}}),Attribution:T(function(e,t){return O({},Jb,e,t)}),AuthorityURL:Oe(function(e,t){const i=wn(e,t);if(i)return i.name=e.getAttribute("name"),i}),Identifier:Oe(D),MetadataURL:Oe(function(e,t){const i=wn(e,t);if(i)return i.type=e.getAttribute("type"),i}),DataURL:Oe(wn),FeatureListURL:Oe(wn),Style:Oe(function(e,t){return O({},rR,e,t)}),MinScaleDenominator:T(de),MaxScaleDenominator:T(de),Layer:Oe(X1)}),Jb=L(gt,{Title:T(D),OnlineResource:T(ts),LogoURL:T(V1)}),Qb=L(gt,{westBoundLongitude:T(de),eastBoundLongitude:T(de),southBoundLatitude:T(de),northBoundLatitude:T(de)}),eR=L(gt,{GetCapabilities:T(op),GetMap:T(op),GetFeatureInfo:T(op)}),tR=L(gt,{Format:Oe(D),DCPType:Oe(function(e,t){return O({},iR,e,t)})}),iR=L(gt,{HTTP:T(function(e,t){return O({},nR,e,t)})}),nR=L(gt,{Get:T(wn),Post:T(wn)}),rR=L(gt,{Name:T(D),Title:T(D),Abstract:T(D),LegendURL:Oe(V1),StyleSheetURL:T(wn),StyleURL:T(wn)}),sR=L(gt,{Format:T(D),OnlineResource:T(ts)}),oR=L(gt,{Keyword:Z(D)});function X1(e,t){const i=t[t.length-1],n=O({},z1,e,t);if(!n)return;let r=Qn(e.getAttribute("queryable"));r===void 0&&(r=i.queryable),n.queryable=r!==void 0&&r;let s=Vi(e.getAttribute("cascaded"));s===void 0&&(s=i.cascaded),n.cascaded=s;let o=Qn(e.getAttribute("opaque"));o===void 0&&(o=i.opaque),n.opaque=o!==void 0&&o;let a=Qn(e.getAttribute("noSubsets"));a===void 0&&(a=i.noSubsets),n.noSubsets=a!==void 0&&a;let l=Xi(e.getAttribute("fixedWidth"));l||(l=i.fixedWidth),n.fixedWidth=l;let h=Xi(e.getAttribute("fixedHeight"));return h||(h=i.fixedHeight),n.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(c){if(c in i){const u=n[c]||[];n[c]=u.concat(i[c])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(c){if(!(c in n)){const u=i[c];n[c]=u}}),n}function wn(e,t){return O({},sR,e,t)}function op(e,t){return O({},tR,e,t)}function V1(e,t){const i=wn(e,t);if(i){const n=[Vi(e.getAttribute("width")),Vi(e.getAttribute("height"))];return i.size=n,i}}function W1(e,t){return O([],oR,e,t)}var aR=class extends Oc{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),O({version:this.version},Wb,e,[])||null}},lR=class extends Jr{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new es,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const i=e.localName;let n=[];if(e.childNodes.length===0)return n;if(i=="msGMLOutput")for(let r=0,s=e.childNodes.length;r<s;r++){const o=e.childNodes[r];if(o.nodeType!==Node.ELEMENT_NODE)continue;const a=o,l=t[0],h="_layer",c=a.localName.replace(h,"");if(this.layers_&&!this.layers_.includes(c))continue;const u=c+"_feature";l.featureType=u,l.featureNS=this.featureNS_;const g={};g[u]=Z(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const f=L([l.featureNS,null],g);a.setAttribute("namespaceURI",this.featureNS_);const p=O([],f,a,t,this.gmlFormat_);p&&ge(n,p)}if(i=="FeatureCollection"){const r=O([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);r&&(n=r)}return n}readFeaturesFromNode(e,t){const i={};return t&&Object.assign(i,this.getReadOptions(e,t)),this.readFeatures_(e,[i])}};const Wi=[null,"http://www.opengis.net/wmts/1.0"],ho=[null,"http://www.opengis.net/ows/1.1"],hR=L(Wi,{Contents:T(function(e,t){return O({},cR,e,t)})}),cR=L(Wi,{Layer:Oe(function(e,t){return O({},uR,e,t)}),TileMatrixSet:Oe(function(e,t){return O({},yR,e,t)})}),uR=L(Wi,{Style:Oe(function(e,t){const i=O({},dR,e,t);if(!i)return;const n=e.getAttribute("isDefault")==="true";return i.isDefault=n,i}),Format:Oe(D),TileMatrixSetLink:Oe(function(e,t){return O({},gR,e,t)}),Dimension:Oe(function(e,t){return O({},mR,e,t)}),ResourceURL:Oe(function(e,t){const i=e.getAttribute("format"),n=e.getAttribute("template"),r=e.getAttribute("resourceType"),s={};return i&&(s.format=i),n&&(s.template=n),r&&(s.resourceType=r),s})},L(ho,{Title:T(D),Abstract:T(D),WGS84BoundingBox:T(Z1),Identifier:T(D)})),dR=L(Wi,{LegendURL:Oe(function(e,t){const i={};return i.format=e.getAttribute("format"),i.href=ts(e),i})},L(ho,{Title:T(D),Identifier:T(D)})),gR=L(Wi,{TileMatrixSet:T(D),TileMatrixSetLimits:T(function(e,t){return O([],fR,e,t)})}),fR=L(Wi,{TileMatrixLimits:Z(function(e,t){return O({},pR,e,t)})}),pR=L(Wi,{TileMatrix:T(D),MinTileRow:T(Ye),MaxTileRow:T(Ye),MinTileCol:T(Ye),MaxTileCol:T(Ye)}),mR=L(Wi,{Default:T(D),Value:Oe(D)},L(ho,{Identifier:T(D)})),_R=L(ho,{LowerCorner:Z(ap),UpperCorner:Z(ap)}),yR=L(Wi,{WellKnownScaleSet:T(D),TileMatrix:Oe(function(e,t){return O({},xR,e,t)})},L(ho,{SupportedCRS:T(D),Identifier:T(D),BoundingBox:T(Z1)})),xR=L(Wi,{TopLeftCorner:T(ap),ScaleDenominator:T(de),TileWidth:T(Ye),TileHeight:T(Ye),MatrixWidth:T(Ye),MatrixHeight:T(Ye)},L(ho,{Identifier:T(D)}));function Z1(e,t){const i=O([],_R,e,t);if(i.length==2)return Xe(i)}function ap(e,t){const i=D(e).split(/\s+/);if(!i||i.length!=2)return;const n=+i[0],r=+i[1];return isNaN(n)||isNaN(r)?void 0:[n,r]}var vR=class extends Oc{constructor(){super(),this.owsParser_=new Rv}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=O(i,hR,e,[]),i||null):null}};const $1=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],wR="enterfullscreen",SR="leavefullscreen";function Y1(e){const t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function q1(e){return!(!e.webkitIsFullScreen&&!e.fullscreenElement)}function K1(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}var ER=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0&&e.keys,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"\u2922";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"\xD7";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const n=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(Fi,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Si} ${jn}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Y1(t))if(q1(t))(function(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()})(t);else{let i;i=this.source_?typeof this.source_=="string"?t.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?function(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():K1(n)}(i):K1(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=q1(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(ur(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(wR)):(ur(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(SR)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Lr,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Lr,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,n=e.length;i<n;++i)fe(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Y1(i)?this.element.classList.remove(ud):this.element.classList.add(ud);for(let n=0,r=$1.length;n<r;++n)e.push(W(i,$1[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};const lp="projection",H1="coordinateFormat";var TR=class extends Ni{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(lp,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(H1)}getProjection(){return this.get(lp)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(W(t,Jl,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(W(t,vw,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(H1,e)}setProjection(e){this.set(lp,X(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const n=this.getProjection();this.transform_=n?Mt(this.mapProjection_,n):Fo}const i=this.getMap().getCoordinateFromPixelInternal(e);if(i){const n=Qe();n&&(this.transform_=Mt(this.mapProjection_,n)),this.transform_(i,i),this.wrapX_&&Co(i,n||this.getProjection()||this.mapProjection_);const r=this.getCoordinateFormat();t=r?r(i):i.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}};const J1=.75,hp=.1;var CR=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed===void 0||e.collapsed,this.collapsible_=e.collapsible===void 0||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0&&e.rotateWithView,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",n=e.collapseLabel!==void 0?e.collapseLabel:"\u2039";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const r=e.label!==void 0?e.label:"\u203A";typeof r=="string"?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;const s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,o=document.createElement("button");o.setAttribute("type","button"),o.title=i,o.appendChild(s),o.addEventListener(Fi,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const a=new J_({view:e.view,controls:new Je,interactions:new Je});this.ovmap_=a,e.layers&&e.layers.forEach(function(_){a.addLayer(_)});const l=document.createElement("div");l.className="ol-overviewmap-box",l.style.boxSizing="border-box",this.boxOverlay_=new Q_({position:[0,0],positioning:"center-center",element:l}),this.ovmap_.addOverlay(this.boxOverlay_);const h=t+" "+Si+" "+jn+(this.collapsed_&&this.collapsible_?" "+zo:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.ovmapDiv_),c.appendChild(o);const u=this,g=this.boxOverlay_,f=this.boxOverlay_.getElement(),p=function(_){const x={clientX:(y=_).clientX,clientY:y.clientY};var y;const v=a.getEventCoordinateInternal(x);g.setPosition(v)},m=function(_){const x=a.getEventCoordinateInternal(_);u.getMap().getView().setCenterInternal(x),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)};f.addEventListener("mousedown",function(){window.addEventListener("mousemove",p),window.addEventListener("mouseup",m)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(W(e,or,this.handleMapPropertyChange_,this));const i=e.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===Fs){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else this.ovmap_.isRendered()||e.key!==Lr&&e.key!==th||this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new wi({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Wt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Wt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&It(n,this.viewExtent_))return;this.viewExtent_=n;const r=t.getSize(),s=t.getView().calculateExtentInternal(r),o=t.getPixelFromCoordinateInternal(Qt(n)),a=t.getPixelFromCoordinateInternal(mr(n)),l=Math.abs(o[0]-a[0]),h=Math.abs(o[1]-a[1]),c=r[0],u=r[1];l<c*hp||h<u*hp||l>c*J1||h>u*J1?this.resetExtent_():ht(s,n)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),n=e.getView().calculateExtentInternal(i),r=t.getView(),s=Math.log(7.5)/Math.LN2;pl(n,1/(Math.pow(2,s/2)*hp)),r.fitInternal(Cr(n))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView(),r=t.getView(),s=this.rotateWithView_?0:-n.getRotation(),o=this.boxOverlay_,a=this.boxOverlay_.getElement(),l=n.getCenterInternal(),h=n.getResolution(),c=r.getResolution(),u=i[0]*h/c,g=i[1]*h/c;if(o.setPosition(l),a){a.style.width=u+"px",a.style.height=g+"px";const f="rotate("+s+"rad)";a.style.transform=f}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=hr(this.ovmap_,Ql,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(zo),this.collapsed_?ur(this.collapseLabel_,this.label_):ur(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const cp="units",bR=[1,2,5],Wa=25.4/.28;var RR=class extends Ni{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Si,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(cp,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(cp)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(cp,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=e.center,i=e.projection,n=this.getUnits(),r=n=="degrees"?"degrees":"m";let s=Io(i,e.resolution,t,r);const o=this.minWidth_*(this.dpi_||Wa)/Wa,a=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Wa)/Wa:void 0;let l=o*s,h="";if(n=="degrees"){const y=yr.degrees;l*=y,l<y/60?(h="\u2033",s*=3600):l<y?(h="\u2032",s*=60):h="\xB0"}else if(n=="imperial")l<.9144?(h="in",s/=.0254):l<1609.344?(h="ft",s/=.3048):(h="mi",s/=1609.344);else if(n=="nautical")s/=1852,h="NM";else if(n=="metric")l<.001?(h="\u03BCm",s*=1e6):l<1?(h="mm",s*=1e3):l<1e3?h="m":(h="km",s/=1e3);else{if(n!="us")throw new Error("Invalid units");l<.9144?(h="in",s*=39.37):l<1609.344?(h="ft",s/=.30480061):(h="mi",s/=1609.3472)}let c,u,g,f,p,m,_=3*Math.floor(Math.log(o*s)/Math.log(10));for(;;){g=Math.floor(_/3);const y=Math.pow(10,g);if(c=bR[(_%3+3)%3]*y,u=Math.round(c/s),isNaN(u))return this.element.style.display="none",void(this.renderedVisible_=!1);if(a!==void 0&&u>=a){c=f,u=p,g=m;break}if(u>=o)break;f=c,p=u,m=g,++_}const x=this.scaleBar_?this.createScaleBar(u,c,h):c.toFixed(g<0?-g:0)+" "+h;this.renderedHTML_!=x&&(this.innerElement_.innerHTML=x,this.renderedHTML_=x),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const n=this.getScaleForResolution(),r=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),s=this.scaleBarSteps_,o=e/s,a=[this.createMarker("absolute")];for(let l=0;l<s;++l){const h=l%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";a.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${o}px;"></div>`+this.createMarker("relative")+(l%2==0||s===2?this.createStepText(l,e,!1,t,i):"")+"</div>")}return a.push(this.createStepText(s,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+a.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,n,r){const s=(e===0?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r);return`<div class="ol-scale-step-text" style="margin-left: ${e===0?-3:t/this.scaleBarSteps_*-1}px;text-align: ${e===0?"left":"center"};min-width: ${e===0?0:t/this.scaleBarSteps_*2}px;left: ${i?t+"px":"unset"};">`+s+"</div>"}getScaleForResolution(){return Io(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||Wa)}render(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}};const Q1=0,up=1;var PR=class extends Ni{constructor(e){super({target:(e=e||{}).target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=Q1,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+Si;const n=this.element;n.className=t+" "+Si+" "+jn,n.appendChild(i),n.addEventListener(yd,this.handleDraggerStart_.bind(this),!1),n.addEventListener(Jl,this.handleDraggerDrag_.bind(this),!1),n.addEventListener(x_,this.handleDraggerEnd_.bind(this),!1),n.addEventListener(Fi,this.handleContainerClick_.bind(this),!1),i.addEventListener(Fi,mp,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);const r=e.firstElementChild,s=getComputedStyle(r),o=r.offsetWidth+parseFloat(s.marginRight)+parseFloat(s.marginLeft),a=r.offsetHeight+parseFloat(s.marginTop)+parseFloat(s.marginBottom);return this.thumbSize_=[o,a],t>i?(this.direction_=up,this.widthLimit_=t-o):(this.direction_=Q1,this.heightLimit_=i-a),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(i),r=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:r,duration:this.duration_,easing:Pn})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,n=this.handleDraggerEnd_,r=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(W(r,Jl,i,this),W(r,x_,n,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,n=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==up?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return i=this.direction_===up?e/this.widthLimit_:t/this.heightLimit_,H(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){return H(1-this.getMap().getView().getValueForResolutionFunction()(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}},FR=class extends Ni{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",n=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",r=document.createElement("button");r.setAttribute("type","button"),r.title=n,r.appendChild(typeof i=="string"?document.createTextNode(i):i),r.addEventListener(Fi,this.handleClick_.bind(this),!1);const s=t+" "+Si+" "+jn,o=this.element;o.className=s,o.appendChild(r)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const e=this.getMap().getView(),t=this.extent?this.extent:e.getProjection().getExtent();e.fitInternal(Cr(t))}},d={};return d.Collection=Je,d.Collection.CollectionEvent=po,d.DataTile=ll,d.DataTile.asArrayLike=al,d.DataTile.asImageLike=_o,d.DataTile.toArray=Dp,d.Disposable=as,d.Feature=Se,d.Feature.createStyleFunction=kp,d.Geolocation=fw,d.Geolocation.GeolocationError=Um,d.Image=ko,d.Image.decode=nn,d.Image.decodeFallback=Gu,d.Image.listenImage=Xm,d.Image.load=Vm,d.ImageCanvas=zl,d.ImageTile=Ss,d.Kinetic=Wm,d.Map=J_,d.MapBrowserEvent=Oi,d.MapBrowserEventHandler=v_,d.MapEvent=Ir,d.Object=zt,d.Object.ObjectEvent=Jc,d.Observable=Hc,d.Observable.unByKey=Cp,d.Overlay=Q_,d.Tile=cr,d.TileCache=Yo,d.TileQueue=xd,d.TileQueue.getTilePriority=C_,d.TileRange=dh,d.TileRange.createOrUpdate=Or,d.VectorRenderTile=r0,d.VectorTile=s0,d.View=wi,d.View.createCenterConstraint=o_,d.View.createResolutionConstraint=a_,d.View.createRotationConstraint=l_,d.View.isNoopAnimation=h_,d.array={},d.array.ascending=qi,d.array.binarySearch=_p,d.array.descending=yp,d.array.equals=ui,d.array.extend=ge,d.array.isSorted=vp,d.array.linearFindNearest=go,d.array.remove=function(e,t){const i=e.indexOf(t),n=i>-1;return n&&e.splice(i,1),n},d.array.reverseSubArray=xp,d.array.stableSort=function(e,t){const i=e.length,n=Array(e.length);let r;for(r=0;r<i;r++)n[r]={index:r,value:e[r]};for(n.sort(function(s,o){return t(s.value,o.value)||s.index-o.index}),r=0;r<e.length;r++)e[r]=n[r].value},d.asserts={},d.asserts.assert=ie,d.centerconstraint={},d.centerconstraint.createExtent=sd,d.centerconstraint.none=t_,d.color={},d.color.asArray=vi,d.color.asString=zu,d.color.fromString=Xl,d.color.isStringColor=Hm,d.color.lchaToRgba=Km,d.color.normalize=Wu,d.color.rgbaToLcha=Vu,d.color.toString=Zu,d.color.withAlpha=qm,d.colorlike={},d.colorlike.asColorLike=Ti,d.console={},d.console.error=Po,d.console.log=function(...e){El>Ro.info||console.log(...e)},d.console.setLevel=function(e){El=Ro[e]},d.console.warn=yu,d.control={},d.control.Attribution=b_,d.control.Control=Ni,d.control.FullScreen=ER,d.control.MousePosition=TR,d.control.OverviewMap=CR,d.control.Rotate=R_,d.control.ScaleLine=RR,d.control.Zoom=P_,d.control.ZoomSlider=PR,d.control.ZoomToExtent=FR,d.control.defaults={},d.control.defaults.defaults=F_,d.coordinate={},d.coordinate.add=fu,d.coordinate.closestOnCircle=am,d.coordinate.closestOnSegment=Eo,d.coordinate.createStringXY=function(e){return function(t){return hm(t,e)}},d.coordinate.degreesToStringHDMS=To,d.coordinate.distance=ps,d.coordinate.equals=ti,d.coordinate.format=lm,d.coordinate.getWorldsAway=mu,d.coordinate.rotate=xl,d.coordinate.scale=pu,d.coordinate.squaredDistance=Vt,d.coordinate.squaredDistanceToSegment=vl,d.coordinate.toStringHDMS=function(e,t){return e?To("NS",e[1],t)+" "+To("EW",e[0],t):""},d.coordinate.toStringXY=hm,d.coordinate.wrapX=Co,d.css={},d.css.CLASS_COLLAPSED=zo,d.css.CLASS_CONTROL=jn,d.css.CLASS_HIDDEN=Uo,d.css.CLASS_SELECTABLE=u_,d.css.CLASS_UNSELECTABLE=Si,d.css.CLASS_UNSUPPORTED=ud,d.css.getFontParameters=dd,d.dom={},d.dom.createCanvasContext2D=ke,d.dom.outerHeight=Op,d.dom.outerWidth=Ap,d.dom.releaseCanvas=In,d.dom.removeChildren=tu,d.dom.removeNode=mo,d.dom.replaceChildren=Np,d.dom.replaceNode=ur,d.easing={},d.easing.easeIn=Qc,d.easing.easeOut=Pn,d.easing.inAndOut=tl,d.easing.linear=Rp,d.easing.upAndDown=function(e){return e<.5?tl(2*e):1-tl(2*(e-.5))},d.events={},d.events.Event=He,d.events.Event.preventDefault=function(e){e.preventDefault()},d.events.Event.stopPropagation=mp,d.events.SnapEvent={},d.events.SnapEvent.SnapEvent=zx,d.events.Target=lr,d.events.condition={},d.events.condition.all=sh,d.events.condition.altKeyOnly=M_,d.events.condition.altShiftKeysOnly=A_,d.events.condition.always=Mr,d.events.condition.click=function(e){return e.type==re.CLICK},d.events.condition.doubleClick=function(e){return e.type==re.DBLCLICK},d.events.condition.focus=O_,d.events.condition.focusWithTabindex=vd,d.events.condition.mouseActionButton=wd,d.events.condition.mouseOnly=Ar,d.events.condition.never=oh,d.events.condition.noModifierKeys=ah,d.events.condition.penOnly=function(e){const t=e.originalEvent;return ie(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType==="pen"},d.events.condition.platformModifierKey=N_,d.events.condition.platformModifierKeyOnly=function(e){const t=e.originalEvent;return!t.altKey&&(il?t.metaKey:t.ctrlKey)&&!t.shiftKey},d.events.condition.pointerMove=function(e){return e.type=="pointermove"},d.events.condition.primaryAction=Td,d.events.condition.shiftKeyOnly=$o,d.events.condition.singleClick=Sd,d.events.condition.targetNotEditable=Ed,d.events.condition.touchOnly=function(e){const t=e.originalEvent;return ie(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType==="touch"},d.events.listen=W,d.events.listenOnce=hr,d.events.unlistenByKey=fe,d.expr={},d.expr.cpu={},d.expr.cpu.buildExpression=dn,d.expr.cpu.newEvaluationContext=eE,d.expr.expression={},d.expr.expression.AnyType=bt,d.expr.expression.BooleanType=je,d.expr.expression.CallExpression=Pg,d.expr.expression.ColorType=Fe,d.expr.expression.LiteralExpression=un,d.expr.expression.NoneType=Zn,d.expr.expression.NumberArrayType=qe,d.expr.expression.NumberType=j,d.expr.expression.Ops=F,d.expr.expression.StringType=dt,d.expr.expression.includesType=Cy,d.expr.expression.isType=zs,d.expr.expression.newParsingContext=Zh,d.expr.expression.overlapsType=ai,d.expr.expression.parse=Te,d.expr.expression.typeName=tt,d.expr.gpu={},d.expr.gpu.PALETTE_TEXTURE_ARRAY=Ng,d.expr.gpu.arrayToGlsl=qh,d.expr.gpu.buildExpression=Ny,d.expr.gpu.colorToGlsl=xa,d.expr.gpu.getStringNumberEquivalent=va,d.expr.gpu.newCompilationContext=qS,d.expr.gpu.numberToGlsl=$n,d.expr.gpu.stringToGlsl=Ui,d.expr.gpu.uniformNameForVariable=Kh,d.extent={},d.extent.applyTransform=_r,d.extent.approximatelyEquals=Xp,d.extent.boundingExtent=Xe,d.extent.buffer=mt,d.extent.clone=ru,d.extent.closestSquaredDistanceXY=Ln,d.extent.containsCoordinate=Jt,d.extent.containsExtent=ht,d.extent.containsXY=cl,d.extent.coordinateRelationship=ul,d.extent.createEmpty=zp,d.extent.createOrUpdate=Xt,d.extent.createOrUpdateEmpty=Hi,d.extent.createOrUpdateFromCoordinate=gr,d.extent.createOrUpdateFromCoordinates=function(e,t){return ou(Hi(t),e)},d.extent.createOrUpdateFromFlatCoordinates=dl,d.extent.createOrUpdateFromRings=function(e,t){return Vp(Hi(t),e)},d.extent.equals=It,d.extent.extend=su,d.extent.extendCoordinate=fr,d.extent.extendCoordinates=ou,d.extent.extendFlatCoordinates=au,d.extent.extendRings=Vp,d.extent.extendXY=Wp,d.extent.forEachCorner=gl,d.extent.getArea=Mn,d.extent.getBottomLeft=pr,d.extent.getBottomRight=mr,d.extent.getCenter=rt,d.extent.getCorner=Zp,d.extent.getEnlargedArea=function(e,t){const i=Math.min(e[0],t[0]),n=Math.min(e[1],t[1]);return(Math.max(e[2],t[2])-i)*(Math.max(e[3],t[3])-n)},d.extent.getForViewAndSize=us,d.extent.getHeight=Le,d.extent.getIntersection=We,d.extent.getIntersectionArea=function(e,t){return Mn(We(e,t))},d.extent.getMargin=function(e){return ne(e)+Le(e)},d.extent.getRotatedViewport=fl,d.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]},d.extent.getTopLeft=Qt,d.extent.getTopRight=ds,d.extent.getWidth=ne,d.extent.intersects=Ie,d.extent.intersectsSegment=Yp,d.extent.isEmpty=fi,d.extent.returnOrUpdate=$p,d.extent.scaleFromCenter=pl,d.extent.wrapAndSliceX=qp,d.extent.wrapX=ml,d.featureloader={},d.featureloader.loadFeaturesXhr=Md,d.featureloader.setWithCredentials=function(e){a0=e},d.featureloader.xhr=Ad,d.format={},d.format.EsriJSON=nT,d.format.Feature=Qs,d.format.Feature.createGeometry=pc,d.format.Feature.createRenderFeature=bf,d.format.Feature.transformExtentWithOptions=fc,d.format.Feature.transformGeometryWithOptions=Me,d.format.GML=hT,d.format.GML2=es,d.format.GML3=ue,d.format.GML32=xc,d.format.GMLBase=ce,d.format.GMLBase.GMLNS=zi,d.format.GPX=AT,d.format.GeoJSON=OT,d.format.IGC=jT,d.format.IIIFInfo=eS,d.format.JSONFeature=_c,d.format.KML=UC,d.format.KML.getDefaultFillStyle=function(){return Xa},d.format.KML.getDefaultImageStyle=function(){return Ec},d.format.KML.getDefaultStrokeStyle=function(){return Tc},d.format.KML.getDefaultStyle=function(){return jf},d.format.KML.getDefaultStyleArray=function(){return bc},d.format.KML.getDefaultTextStyle=function(){return er},d.format.KML.readFlatCoordinates=Bf,d.format.MVT=rb,d.format.OSMXML=lb,d.format.OWS=Rv,d.format.Polyline=Tb,d.format.Polyline.decodeDeltas=Fv,d.format.Polyline.decodeFloats=Lv,d.format.Polyline.decodeSignedIntegers=Av,d.format.Polyline.decodeUnsignedIntegers=Nv,d.format.Polyline.encodeDeltas=Pv,d.format.Polyline.encodeFloats=Iv,d.format.Polyline.encodeSignedIntegers=Mv,d.format.Polyline.encodeUnsignedInteger=Dv,d.format.Polyline.encodeUnsignedIntegers=Ov,d.format.TextFeature=wc,d.format.TopoJSON=Pb,d.format.WFS=Ob,d.format.WFS.writeFilter=function(e,t){const i=Q(Va(t=t||"1.1.0"),"Filter"),n={node:i};return Object.assign(n,{version:t,filter:e}),v1(i,e,[n]),i},d.format.WKB=Db,d.format.WKT=Vb,d.format.WMSCapabilities=aR,d.format.WMSGetFeatureInfo=lR,d.format.WMTSCapabilities=vR,d.format.XML=Oc,d.format.XMLFeature=Jr,d.format.filter={},d.format.filter.And=Gv,d.format.filter.Bbox=jv,d.format.filter.Comparison=oo,d.format.filter.ComparisonBinary=ns,d.format.filter.Contains=Bv,d.format.filter.DWithin=Uv,d.format.filter.Disjoint=zv,d.format.filter.During=Xv,d.format.filter.EqualTo=Vv,d.format.filter.Filter=is,d.format.filter.GreaterThan=Wv,d.format.filter.GreaterThanOrEqualTo=Zv,d.format.filter.Intersects=$v,d.format.filter.IsBetween=Yv,d.format.filter.IsLike=qv,d.format.filter.IsNull=Kv,d.format.filter.LessThan=Hv,d.format.filter.LessThanOrEqualTo=Jv,d.format.filter.LogicalNary=Yf,d.format.filter.Not=Qv,d.format.filter.NotEqualTo=e1,d.format.filter.Or=t1,d.format.filter.ResourceId=i1,d.format.filter.Spatial=so,d.format.filter.Within=n1,d.format.filter.and=r1,d.format.filter.bbox=s1,d.format.filter.between=function(e,t,i){return new Yv(e,t,i)},d.format.filter.contains=function(e,t,i){return new Bv(e,t,i)},d.format.filter.disjoint=function(e,t,i){return new zv(e,t,i)},d.format.filter.during=function(e,t,i){return new Xv(e,t,i)},d.format.filter.dwithin=function(e,t,i,n,r){return new Uv(e,t,i,n,r)},d.format.filter.equalTo=function(e,t,i){return new Vv(e,t,i)},d.format.filter.greaterThan=function(e,t){return new Wv(e,t)},d.format.filter.greaterThanOrEqualTo=function(e,t){return new Zv(e,t)},d.format.filter.intersects=function(e,t,i){return new $v(e,t,i)},d.format.filter.isNull=function(e){return new Kv(e)},d.format.filter.lessThan=function(e,t){return new Hv(e,t)},d.format.filter.lessThanOrEqualTo=function(e,t){return new Jv(e,t)},d.format.filter.like=function(e,t,i,n,r,s){return new qv(e,t,i,n,r,s)},d.format.filter.not=function(e){return new Qv(e)},d.format.filter.notEqualTo=function(e,t,i){return new e1(e,t,i)},d.format.filter.or=function(e){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(t1,t))},d.format.filter.resourceId=function(e){return new i1(e)},d.format.filter.within=function(e,t,i){return new n1(e,t,i)},d.format.xlink={},d.format.xlink.readHref=ts,d.format.xsd={},d.format.xsd.readBoolean=_n,d.format.xsd.readBooleanString=Qn,d.format.xsd.readDateTime=yc,d.format.xsd.readDecimal=de,d.format.xsd.readDecimalString=Xi,d.format.xsd.readNonNegativeIntegerString=Vi,d.format.xsd.readPositiveInteger=Ye,d.format.xsd.readString=D,d.format.xsd.writeBooleanTextNode=Qr,d.format.xsd.writeCDATASection=Zx,d.format.xsd.writeDateTimeTextNode=$x,d.format.xsd.writeDecimalTextNode=Rt,d.format.xsd.writeNonNegativeIntegerTextNode=ja,d.format.xsd.writeStringTextNode=J,d.functions={},d.functions.FALSE=bn,d.functions.TRUE=Ut,d.functions.VOID=ar,d.functions.memoizeOne=Yc,d.functions.toPromise=qc,d.geom={},d.geom.Circle=$d,d.geom.Geometry=Pl,d.geom.GeometryCollection=ut,d.geom.LineString=Ue,d.geom.LinearRing=ws,d.geom.MultiLineString=Et,d.geom.MultiPoint=ri,d.geom.MultiPolygon=Zt,d.geom.Point=Ae,d.geom.Polygon=ot,d.geom.Polygon.circular=Am,d.geom.Polygon.fromCircle=Do,d.geom.Polygon.fromExtent=Cr,d.geom.Polygon.makeRegular=Ou,d.geom.SimpleGeometry=yi,d.geom.SimpleGeometry.getLayoutForStride=Dn,d.geom.SimpleGeometry.getStrideForLayout=ms,d.geom.SimpleGeometry.transformGeom2D=vm,d.geom.flat={},d.geom.flat.area={},d.geom.flat.area.linearRing=Dl,d.geom.flat.area.linearRings=Ru,d.geom.flat.area.linearRingss=Rm,d.geom.flat.center={},d.geom.flat.center.linearRingss=qd,d.geom.flat.closest={},d.geom.flat.closest.arrayMaxSquaredDelta=Il,d.geom.flat.closest.assignClosestArrayPoint=Ml,d.geom.flat.closest.assignClosestMultiArrayPoint=Em,d.geom.flat.closest.assignClosestPoint=Ll,d.geom.flat.closest.maxSquaredDelta=Fl,d.geom.flat.closest.multiArrayMaxSquaredDelta=Sm,d.geom.flat.contains={},d.geom.flat.contains.linearRingContainsExtent=Pm,d.geom.flat.contains.linearRingContainsXY=Gn,d.geom.flat.contains.linearRingsContainsXY=Gl,d.geom.flat.contains.linearRingssContainsXY=Fm,d.geom.flat.deflate={},d.geom.flat.deflate.deflateCoordinate=Cu,d.geom.flat.deflate.deflateCoordinates=_s,d.geom.flat.deflate.deflateCoordinatesArray=ys,d.geom.flat.deflate.deflateMultiCoordinatesArray=bu,d.geom.flat.flip={},d.geom.flat.flip.flipXY=Cf,d.geom.flat.geodesic={},d.geom.flat.geodesic.greatCircleArc=function(e,t,i,n,r,s){const o=X("EPSG:4326"),a=Math.cos(st(t)),l=Math.sin(st(t)),h=Math.cos(st(n)),c=Math.sin(st(n)),u=Math.cos(st(i-e)),g=Math.sin(st(i-e)),f=l*c+a*h*u;return xf(function(p){if(1<=f)return[i,n];const m=p*Math.acos(f),_=Math.cos(m),x=Math.sin(m),y=g*h,v=a*c-l*h*u,w=Math.atan2(y,v),S=Math.asin(l*_+a*x*Math.cos(w));return[wo(st(e)+Math.atan2(Math.sin(w)*x*a,_-l*Math.sin(S))),wo(S)]},ii(o,r),s)},d.geom.flat.geodesic.meridian=bx,d.geom.flat.geodesic.parallel=Rx,d.geom.flat.inflate={},d.geom.flat.inflate.inflateCoordinates=Li,d.geom.flat.inflate.inflateCoordinatesArray=vs,d.geom.flat.inflate.inflateMultiCoordinatesArray=Nl,d.geom.flat.interiorpoint={},d.geom.flat.interiorpoint.getInteriorPointOfArray=jl,d.geom.flat.interiorpoint.getInteriorPointsOfMultiArray=Fu,d.geom.flat.interpolate={},d.geom.flat.interpolate.interpolatePoint=na,d.geom.flat.interpolate.lineStringCoordinateAtM=bh,d.geom.flat.interpolate.lineStringsCoordinateAtM=M0,d.geom.flat.intersectsextent={},d.geom.flat.intersectsextent.intersectsLineString=Mo,d.geom.flat.intersectsextent.intersectsLineStringArray=Im,d.geom.flat.intersectsextent.intersectsLinearRing=Lu,d.geom.flat.intersectsextent.intersectsLinearRingArray=Mu,d.geom.flat.intersectsextent.intersectsLinearRingMultiArray=Lm,d.geom.flat.length={},d.geom.flat.length.lineStringLength=Rh,d.geom.flat.length.linearRingLength=function(e,t,i,n){let r=Rh(e,t,i,n);const s=e[i-n]-e[t],o=e[i-n+1]-e[t+1];return r+=Math.sqrt(s*s+o*o),r},d.geom.flat.orient={},d.geom.flat.orient.inflateEnds=No,d.geom.flat.orient.linearRingIsClockwise=Ao,d.geom.flat.orient.linearRingsAreOriented=Bl,d.geom.flat.orient.linearRingssAreOriented=Au,d.geom.flat.orient.orientLinearRings=Oo,d.geom.flat.orient.orientLinearRingsArray=Ul,d.geom.flat.reverse={},d.geom.flat.reverse.coordinates=Mm,d.geom.flat.segments={},d.geom.flat.segments.forEach=Iu,d.geom.flat.simplify={},d.geom.flat.simplify.douglasPeucker=xs,d.geom.flat.simplify.douglasPeuckerArray=Al,d.geom.flat.simplify.douglasPeuckerMultiArray=function(e,t,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const c=i[l],u=[];o=Al(e,t,c,n,r,s,o,u),a.push(u),t=c[c.length-1]}return o},d.geom.flat.simplify.quantize=Cm,d.geom.flat.simplify.quantizeArray=Ol,d.geom.flat.simplify.quantizeMultiArray=bm,d.geom.flat.simplify.radialDistance=Tm,d.geom.flat.simplify.simplifyLineString=function(e,t,i,n,r,s,o){return o=o!==void 0?o:[],s||(i=Tm(e,t,i,n,r,o,0),e=o,t=0,n=2),o.length=xs(e,t,i,n,r,o,0),o},d.geom.flat.simplify.snap=kn,d.geom.flat.straightchunk={},d.geom.flat.straightchunk.matchingChunk=mx,d.geom.flat.textpath={},d.geom.flat.textpath.drawTextOnPath=yx,d.geom.flat.topology={},d.geom.flat.topology.lineStringIsClosed=function(e,t,i,n){const r=i-n;return e[t]===e[r]&&e[t+1]===e[r+1]&&(i-t)/n>3&&!!Dl(e,t,i,n)},d.geom.flat.transform={},d.geom.flat.transform.rotate=Rl,d.geom.flat.transform.scale=_m,d.geom.flat.transform.transform2D=_i,d.geom.flat.transform.translate=ym,d.has={},d.has.CREATE_IMAGE_BITMAP=Mp,d.has.DEVICE_PIXEL_RATIO=nl,d.has.FIREFOX=Pp,d.has.IMAGE_DECODE=sl,d.has.MAC=il,d.has.PASSIVE_EVENT_LISTENERS=eu,d.has.SAFARI=Fp,d.has.SAFARI_BUG_237906=Ip,d.has.WEBKIT=Lp,d.has.WORKER_OFFSCREEN_CANVAS=rl,d.interaction={},d.interaction.DblClickDragZoom=FE,d.interaction.DoubleClickZoom=L_,d.interaction.DragAndDrop=LE,d.interaction.DragAndDrop.DragAndDropEvent=Ix,d.interaction.DragBox=j_,d.interaction.DragBox.DragBoxEvent=lh,d.interaction.DragPan=D_,d.interaction.DragRotate=k_,d.interaction.DragRotateAndZoom=ME,d.interaction.DragZoom=B_,d.interaction.Draw=DE,d.interaction.Draw.DrawEvent=Na,d.interaction.Draw.createBox=function(){return function(e,t,i){const n=Xe([e[0],e[e.length-1]].map(function(o){return Ee(o,i)})),r=[[pr(n),mr(n),ds(n),Qt(n),pr(n)]];t?t.setCoordinates(r):t=new ot(r);const s=Qe();return s&&t.transform(i,s),t}},d.interaction.Draw.createRegularPolygon=function(e,t){return function(i,n,r){const s=Ee(i[0],r),o=Ee(i[i.length-1],r),a=Math.sqrt(Vt(s,o));n=n||Do(new $d(s),e);let l=t;if(!t&&t!==0){const c=o[0]-s[0],u=o[1]-s[1];l=Math.atan2(u,c)}Ou(n,s,a,l);const h=Qe();return h&&n.transform(r,h),n}},d.interaction.Extent=BE,d.interaction.Extent.ExtentEvent=Ox,d.interaction.Interaction=Di,d.interaction.Interaction.pan=I_,d.interaction.Interaction.zoomByDelta=nh,d.interaction.KeyboardPan=V_,d.interaction.KeyboardZoom=W_,d.interaction.Link=UE,d.interaction.Modify=WE,d.interaction.Modify.ModifyEvent=uc,d.interaction.MouseWheelZoom=Z_,d.interaction.PinchRotate=$_,d.interaction.PinchZoom=Y_,d.interaction.Pointer=ni,d.interaction.Pointer.centroid=rh,d.interaction.Select=$E,d.interaction.Select.SelectEvent=Ux,d.interaction.Snap=qE,d.interaction.Translate=QE,d.interaction.Translate.TranslateEvent=gc,d.interaction.defaults={},d.interaction.defaults.defaults=q_,d.layer={},d.layer.Base=ed,d.layer.BaseImage=ey,d.layer.BaseTile=lg,d.layer.BaseVector=$r,d.layer.Graticule=SE,d.layer.Group=Wo,d.layer.Group.GroupEvent=rn,d.layer.Heatmap=TE,d.layer.Image=ty,d.layer.Layer=Rr,d.layer.Layer.inView=Kl,d.layer.Tile=iy,d.layer.Vector=Hr,d.layer.VectorImage=CE,d.layer.VectorTile=bE,d.layer.WebGLPoints=RE,d.layer.WebGLTile=PE,d.loadingstrategy={},d.loadingstrategy.all=l0,d.loadingstrategy.bbox=function(e,t){return[e]},d.loadingstrategy.tile=function(e){return function(t,i,n){const r=e.getZForResolution(pm(i,n)),s=e.getTileRangeForExtentAndZ(At(t,n),r),o=[],a=[r,0,0];for(a[1]=s.minX;a[1]<=s.maxX;++a[1])for(a[2]=s.minY;a[2]<=s.maxY;++a[2])o.push(Ii(e.getTileCoordExtent(a),n));return o}},d.math={},d.math.ceil=Ji,d.math.clamp=H,d.math.floor=Er,d.math.lerp=Lt,d.math.modulo=ei,d.math.round=So,d.math.solveLinearSystem=om,d.math.squaredDistance=mi,d.math.squaredSegmentDistance=gu,d.math.toDegrees=wo,d.math.toFixed=An,d.math.toRadians=st,d.net={},d.net.ClientError=c0,d.net.ResponseError=h0,d.net.getJSON=Od,d.net.jsonp=gh,d.net.overrideXHR=function(e){typeof XMLHttpRequest<"u"&&(o0=XMLHttpRequest),global.XMLHttpRequest=e},d.net.resolveUrl=Nd,d.net.restoreXHR=function(){global.XMLHttpRequest=o0},d.obj={},d.obj.clear=Rn,d.obj.isEmpty=qt,d.proj={},d.proj.Projection=xr,d.proj.Units={},d.proj.Units.METERS_PER_UNIT=yr,d.proj.Units.fromCode=lu,d.proj.addCommon=mm,d.proj.addCoordinateTransforms=gm,d.proj.addEquivalentProjections=Cl,d.proj.addEquivalentTransforms=dm,d.proj.addProjection=wu,d.proj.addProjections=um,d.proj.clearAllProjections=function(){im(),sm()},d.proj.clearUserProjection=function(){vt=null},d.proj.cloneTransform=Tl,d.proj.createProjection=bl,d.proj.createSafeCoordinateTransform=Tu,d.proj.createTransformFromCoordinateTransform=Su,d.proj.disableCoordinateWarning=vu,d.proj.epsg3857={},d.proj.epsg3857.EXTENT=Kp,d.proj.epsg3857.HALF_SIZE=vr,d.proj.epsg3857.MAX_SAFE_Y=vo,d.proj.epsg3857.PROJECTIONS=hu,d.proj.epsg3857.RADIUS=gs,d.proj.epsg3857.WORLD_EXTENT=Hp,d.proj.epsg3857.fromEPSG4326=Jp,d.proj.epsg3857.toEPSG4326=Qp,d.proj.epsg4326={},d.proj.epsg4326.EXTENT=cu,d.proj.epsg4326.METERS_PER_UNIT=tm,d.proj.epsg4326.PROJECTIONS=uu,d.proj.epsg4326.RADIUS=em,d.proj.equivalent=ct,d.proj.fromLonLat=function(e,t){return vu(),Nn(e,"EPSG:4326",t!==void 0?t:"EPSG:3857")},d.proj.fromUserCoordinate=Ee,d.proj.fromUserExtent=At,d.proj.fromUserResolution=pm,d.proj.get=X,d.proj.getPointResolution=Io,d.proj.getTransform=ii,d.proj.getTransformFromProjections=Mt,d.proj.getUserProjection=Qe,d.proj.identityTransform=Fo,d.proj.proj4={},d.proj.proj4.epsgLookupMapTiler=function(e){return async function(t){const i=await fetch(`https://api.maptiler.com/coordinates/search/code:${t}.json?transformations=true&exports=true&key=${e}`);if(!i.ok)throw new Error(`Unexpected response from maptiler.com: ${i.status}`);return i.json().then(n=>{const r=n.results;if(r?.length>0){const s=r.filter(o=>o.id?.authority==="EPSG"&&o.id?.code===t)[0];if(s){const o=s.transformations;if(o?.length>0){const a=s.default_transformation;if(o.filter(h=>h.id?.authority===a?.authority&&h.id?.code===a?.code&&h.grids?.length===0).length>0)return s.exports?.proj4;const l=o.filter(h=>h.grids?.length===0&&h.target_crs?.authority==="EPSG"&&h.target_crs?.code===4326&&h.deprecated===!1&&h.usable===!0).sort((h,c)=>h.accuracy-c.accuracy)[0]?.exports?.proj4;if(l)return l}return s.exports?.proj4}}})}},d.proj.proj4.fromEPSGCode=async function(e){typeof e=="string"&&(e=parseInt(e.split(":").pop(),10));const t=rc;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const i="EPSG:"+e;return t.defs(i)||(t.defs(i,await yf(e)),Cx(t)),X(i)},d.proj.proj4.getEPSGLookup=function(){return yf},d.proj.proj4.isRegistered=function(){return!!rc},d.proj.proj4.register=Cx,d.proj.proj4.setEPSGLookup=function(e){yf=e},d.proj.proj4.unregister=function(){rc=null},d.proj.projections={},d.proj.projections.add=rm,d.proj.projections.clear=im,d.proj.projections.get=nm,d.proj.setUserProjection=fm,d.proj.toLonLat=function(e,t){const i=Nn(e,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=i[0];return(n<-180||n>180)&&(i[0]=ei(n+180,360)-180),i},d.proj.toUserCoordinate=Qi,d.proj.toUserExtent=Ii,d.proj.toUserResolution=Eu,d.proj.transform=Nn,d.proj.transformExtent=Lo,d.proj.transformWithProjections=function(e,t,i){return Mt(t,i)(e)},d.proj.transforms={},d.proj.transforms.add=Sr,d.proj.transforms.clear=sm,d.proj.transforms.get=du,d.proj.transforms.remove=function(e,t){const i=e.getCode(),n=t.getCode(),r=pi[i][n];return delete pi[i][n],qt(pi[i])&&delete pi[i],r},d.proj.useGeographic=function(){fm("EPSG:4326")},d.render={},d.render.Box=G_,d.render.Event=Ts,d.render.Feature=$t,d.render.Feature.toFeature=function(e,t){const i=e.getId(),n=O0(e),r=e.getProperties(),s=new Se;return t!==void 0&&s.setGeometryName(t),s.setGeometry(n),i!==void 0&&s.setId(i),s.setProperties(r,!0),s},d.render.Feature.toGeometry=O0,d.render.VectorContext=Dd,d.render.canvas={},d.render.canvas.Builder=Ys,d.render.canvas.BuilderGroup=Aa,d.render.canvas.Executor=wx,d.render.canvas.ExecutorGroup=Oa,d.render.canvas.ExecutorGroup.getPixelIndexArray=Sx,d.render.canvas.ImageBuilder=fx,d.render.canvas.Immediate=fh,d.render.canvas.Instruction={},d.render.canvas.Instruction.beginPathInstruction=Kn,d.render.canvas.Instruction.closePathInstruction=cf,d.render.canvas.Instruction.fillInstruction=La,d.render.canvas.Instruction.strokeInstruction=fn,d.render.canvas.LineStringBuilder=px,d.render.canvas.PolygonBuilder=uf,d.render.canvas.TextBuilder=_x,d.render.canvas.TextBuilder.TEXT_ALIGN=Ma,d.render.canvas.checkedFonts=Ai,d.render.canvas.defaultFillStyle=St,d.render.canvas.defaultFont=gd,d.render.canvas.defaultLineCap=Pr,d.render.canvas.defaultLineDash=Mi,d.render.canvas.defaultLineDashOffset=0,d.render.canvas.defaultLineJoin=Fr,d.render.canvas.defaultLineWidth=1,d.render.canvas.defaultMiterLimit=Cs,d.render.canvas.defaultPadding=Bn,d.render.canvas.defaultStrokeStyle=bs,d.render.canvas.defaultTextAlign=Rs,d.render.canvas.defaultTextBaseline=Xo,d.render.canvas.drawImageOrLabel=__,d.render.canvas.getTextDimensions=m_,d.render.canvas.hitdetect={},d.render.canvas.hitdetect.HIT_DETECT_RESOLUTION=kt,d.render.canvas.hitdetect.createHitDetectionImageData=pf,d.render.canvas.hitdetect.hitDetect=mf,d.render.canvas.measureAndCacheTextWidth=pd,d.render.canvas.measureTextHeight=f_,d.render.canvas.measureTextWidth=Vo,d.render.canvas.registerFont=g_,d.render.canvas.rotateAtOffset=function(e,t,i,n){t!==0&&(e.translate(i,n),e.rotate(t),e.translate(-i,-n))},d.render.canvas.style={},d.render.canvas.style.buildRuleSet=$y,d.render.canvas.style.buildStyle=ec,d.render.canvas.style.flatStylesToStyleFunction=Qg,d.render.canvas.style.rulesToStyleFunction=Zy,d.render.canvas.textHeights=Hl,d.render.getRenderPixel=function(e,t){return ye(e.inversePixelTransform,t.slice(0))},d.render.getVectorContext=f0,d.render.toContext=function(e,t){const i=e.canvas,n=(t=t||{}).pixelRatio||nl,r=t.size;r&&(i.width=r[0]*n,i.height=r[1]*n,i.style.width=r[0]+"px",i.style.height=r[1]+"px");const s=[0,0,i.width,i.height],o=dr([1,0,0,1,0,0],n,n);return new fh(e,n,s,o,0)},d.render.webgl={},d.render.webgl.MixedGeometryBatch=kg,d.render.webgl.VectorStyleRenderer=of,d.render.webgl.renderinstructions={},d.render.webgl.renderinstructions.generateLineStringRenderInstructions=sx,d.render.webgl.renderinstructions.generatePointRenderInstructions=rx,d.render.webgl.renderinstructions.generatePolygonRenderInstructions=ox,d.render.webgl.renderinstructions.getCustomAttributesSize=Fa,d.render.webgl.utils={},d.render.webgl.utils.LINESTRING_ANGLE_COSINE_CUTOFF=Tg,d.render.webgl.utils.colorDecodeId=Rg,d.render.webgl.utils.colorEncodeId=bg,d.render.webgl.utils.getBlankImageData=function(){const e=document.createElement("canvas").getContext("2d").createImageData(1,1);return e.data[0]=255,e.data[1]=255,e.data[2]=255,e.data[3]=255,e},d.render.webgl.utils.writeLineSegmentToBuffers=function(e,t,i,n,r,s,o,a,l,h,c){const u=8+a.length,g=s.length/u,f=[e[t+0],e[t+1]],p=[e[i],e[i+1]],m=ye(l,[...f]),_=ye(l,[...p]);function x(E,R,P){const I=Math.sqrt((R[0]-E[0])*(R[0]-E[0])+(R[1]-E[1])*(R[1]-E[1])),A=[(R[0]-E[0])/I,(R[1]-E[1])/I],G=[-A[1],A[0]],B=Math.sqrt((P[0]-E[0])*(P[0]-E[0])+(P[1]-E[1])*(P[1]-E[1])),z=[(P[0]-E[0])/B,(P[1]-E[1])/B],N=I===0||B===0?0:Math.acos(H(z[0]*A[0]+z[1]*A[1],-1,1));return z[0]*G[0]+z[1]*G[1]>0?N:2*Math.PI-N}let y=-1,v=-1,w=c;const S=r!==null;n!==null&&(y=x(m,_,ye(l,[e[n],e[n+1]])),Math.cos(y)<=Tg&&(w+=Math.tan((y-Math.PI)/2))),S&&(v=x(_,m,ye(l,[e[r],e[r+1]])),Math.cos(v)<=Tg&&(w+=Math.tan((Math.PI-v)/2)));function C(E,R){return R===0?1e4*E:Math.sign(R)*(1e4*E+Math.abs(R))}return s.push(f[0],f[1],p[0],p[1],y,v,h,C(0,c)),s.push(...a),s.push(f[0],f[1],p[0],p[1],y,v,h,C(1,c)),s.push(...a),s.push(f[0],f[1],p[0],p[1],y,v,h,C(2,c)),s.push(...a),s.push(f[0],f[1],p[0],p[1],y,v,h,C(3,c)),s.push(...a),o.push(g,g+1,g+2,g+1,g+3,g+2),{length:h+Math.sqrt((_[0]-m[0])*(_[0]-m[0])+(_[1]-m[1])*(_[1]-m[1])),angle:w}},d.render.webgl.utils.writePointFeatureToBuffers=function(e,t,i,n,r,s){const o=3+r,a=e[t+0],l=e[t+1],h=XS;h.length=r;for(let f=0;f<h.length;f++)h[f]=e[t+2+f];let c=s?s.vertexPosition:0,u=s?s.indexPosition:0;const g=c/o;return Wh(i,c,a,l,0),h.length&&i.set(h,c+3),c+=o,Wh(i,c,a,l,1),h.length&&i.set(h,c+3),c+=o,Wh(i,c,a,l,2),h.length&&i.set(h,c+3),c+=o,Wh(i,c,a,l,3),h.length&&i.set(h,c+3),c+=o,n[u++]=g,n[u++]=g+1,n[u++]=g+3,n[u++]=g+1,n[u++]=g+2,n[u++]=g+3,Cg.vertexPosition=c,Cg.indexPosition=u,Cg},d.render.webgl.utils.writePolygonTrianglesToBuffers=function(e,t,i,n,r){const s=2+r;let o=t;const a=e.slice(o,o+r);o+=r;const l=e[o++];let h=0;const c=new Array(l-1);for(let f=0;f<l;f++)h+=e[o++],f<l-1&&(c[f]=h);const u=e.slice(o,o+2*h),g=zS(u,c,2);for(let f=0;f<g.length;f++)n.push(g[f]+i.length/s);for(let f=0;f<u.length;f+=2)i.push(u[f],u[f+1],...a);return o+2*h},d.renderer={},d.renderer.Composite=y_,d.renderer.Layer=sg,d.renderer.Map=c_,d.renderer.canvas={},d.renderer.canvas.ImageLayer=ag,d.renderer.canvas.Layer=Ah,d.renderer.canvas.Layer.canvasPool=og,d.renderer.canvas.TileLayer=hg,d.renderer.canvas.VectorImageLayer=Ex,d.renderer.canvas.VectorLayer=_f,d.renderer.canvas.VectorTileLayer=Tx,d.renderer.vector={},d.renderer.vector.defaultOrder=d0,d.renderer.vector.getSquaredTolerance=ph,d.renderer.vector.getTolerance=mh,d.renderer.vector.renderFeature=qo,d.renderer.webgl={},d.renderer.webgl.Layer=$h,d.renderer.webgl.PointsLayer=nf,d.renderer.webgl.TileLayer=Oy,d.renderer.webgl.TileLayer.Attributes=ya,d.renderer.webgl.TileLayer.Uniforms=ae,d.renderer.webgl.TileLayerBase=Mg,d.renderer.webgl.TileLayerBase.Uniforms=Ig,d.renderer.webgl.TileLayerBase.getCacheKey=Yh,d.renderer.webgl.TileLayerBase.newTileRepresentationLookup=Ly,d.renderer.webgl.VectorLayer=gE,d.renderer.webgl.VectorLayer.Uniforms=Yr,d.renderer.webgl.VectorTileLayer=fE,d.renderer.webgl.VectorTileLayer.Attributes=lx,d.renderer.webgl.VectorTileLayer.Uniforms=Ke,d.reproj={},d.reproj.DataTile=Lh,d.reproj.Image=B0,d.reproj.Tile=Nr,d.reproj.Triangulation=yh,d.reproj.calculateSourceExtentResolution=jd,d.reproj.calculateSourceResolution=Ls,d.reproj.canvasPool=ki,d.reproj.common={},d.reproj.common.ERROR_THRESHOLD=Bd,d.reproj.render=_h,d.resolution={},d.resolution.fromResolutionLike=Ko,d.resolutionconstraint={},d.resolutionconstraint.createMinMaxResolution=ld,d.resolutionconstraint.createSnapToPower=n_,d.resolutionconstraint.createSnapToResolutions=i_,d.rotationconstraint={},d.rotationconstraint.createSnapToN=r_,d.rotationconstraint.createSnapToZero=s_,d.rotationconstraint.disable=Yl,d.rotationconstraint.none=hd,d.size={},d.size.buffer=function(e,t,i){return i===void 0&&(i=[0,0]),i[0]=e[0]+2*t,i[1]=e[1]+2*t,i},d.size.hasArea=Cd,d.size.scale=bd,d.size.toSize=Ge,d.source={},d.source.BingMaps=Iw,d.source.BingMaps.quadKey=P0,d.source.CartoDB=Lw,d.source.Cluster=Uw,d.source.DataTile=N0,d.source.GeoTIFF=Kw,d.source.IIIF=tS,d.source.Image=Xn,d.source.Image.ImageSourceEvent=U0,d.source.Image.defaultImageLoadFunction=aa,d.source.Image.getRequestExtent=la,d.source.ImageArcGISRest=sS,d.source.ImageCanvas=oS,d.source.ImageMapGuide=lS,d.source.ImageStatic=hS,d.source.ImageWMS=cS,d.source.OGCMapTile=gS,d.source.OGCVectorTile=fS,d.source.OSM=pS,d.source.OSM.ATTRIBUTION=rg,d.source.Raster=wS,d.source.Raster.Processor=oy,d.source.Raster.RasterSourceEvent=ug,d.source.Raster.newImageData=ry,d.source.Source=Ms,d.source.StadiaMaps=TS,d.source.Tile=Ho,d.source.Tile.TileSourceEvent=Ud,d.source.TileArcGISRest=CS,d.source.TileDebug=bS,d.source.TileImage=Gi,d.source.TileJSON=RS,d.source.TileWMS=PS,d.source.UTFGrid=FS,d.source.UTFGrid.CustomTile=ly,d.source.UrlTile=Xd,d.source.Vector=kr,d.source.Vector.VectorSourceEvent=ln,d.source.VectorTile=J0,d.source.VectorTile.defaultLoadFunction=Q0,d.source.WMTS=IS,d.source.WMTS.optionsFromCapabilities=function(e,t){const i=e.Contents.Layer.find(function(I){return I.Identifier==t.layer});if(!i)return null;const n=e.Contents.TileMatrixSet;let r;r=i.TileMatrixSetLink.length>1?"projection"in t?i.TileMatrixSetLink.findIndex(function(I){const A=n.find(function(z){return z.Identifier==I.TileMatrixSet}).SupportedCRS,G=X(A),B=X(t.projection);return G&&B?ct(G,B):A==t.projection}):i.TileMatrixSetLink.findIndex(function(I){return I.TileMatrixSet==t.matrixSet}):0,r<0&&(r=0);const s=i.TileMatrixSetLink[r].TileMatrixSet,o=i.TileMatrixSetLink[r].TileMatrixSetLimits;let a=i.Format[0];"format"in t&&(a=t.format),r=i.Style.findIndex(function(I){return"style"in t?I.Title==t.style:I.isDefault}),r<0&&(r=0);const l=i.Style[r].Identifier,h={};"Dimension"in i&&i.Dimension.forEach(function(I,A,G){const B=I.Identifier;let z=I.Default;z===void 0&&(z=I.Value[0]),h[B]=z});const c=e.Contents.TileMatrixSet.find(function(I){return I.Identifier==s});let u;const g=c.SupportedCRS;if(g&&(u=X(g)),"projection"in t){const I=X(t.projection);I&&(u&&!ct(I,u)||(u=I))}let f=!1;const p=u.getAxisOrientation().substr(0,2)=="ne";let m=c.TileMatrix[0],_={MinTileCol:0,MinTileRow:0,MaxTileCol:m.MatrixWidth-1,MaxTileRow:m.MatrixHeight-1};if(o){_=o[o.length-1];const I=c.TileMatrix.find(A=>A.Identifier===_.TileMatrix||c.Identifier+":"+A.Identifier===_.TileMatrix);I&&(m=I)}const x=28e-5*m.ScaleDenominator/u.getMetersPerUnit(),y=p?[m.TopLeftCorner[1],m.TopLeftCorner[0]]:m.TopLeftCorner,v=m.TileWidth*x,w=m.TileHeight*x;let S=c.BoundingBox;S&&p&&(S=[S[1],S[0],S[3],S[2]]);let C=[y[0]+v*_.MinTileCol,y[1]-w*(1+_.MaxTileRow),y[0]+v*(1+_.MaxTileCol),y[1]-w*_.MinTileRow];if(S!==void 0&&!ht(S,C)){const I=i.WGS84BoundingBox,A=X("EPSG:4326").getExtent();if(C=S,I)f=I[0]===A[0]&&I[2]===A[2];else{const G=Lo(S,c.SupportedCRS,"EPSG:4326");f=G[0]-1e-10<=A[0]&&G[2]+1e-10>=A[2]}}const E=w0(c,C,o),R=[];let P=t.requestEncoding;if(P=P!==void 0?P:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const I=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let A=0,G=I.length;A<G;++A)if(I[A].Constraint){const B=I[A].Constraint.find(function(z){return z.name=="GetEncoding"}).AllowedValues.Value;if(P===""&&(P=B[0]),P!=="KVP")break;B.includes("KVP")&&R.push(I[A].href)}else I[A].href&&(P="KVP",R.push(I[A].href))}return R.length===0&&(P="REST",i.ResourceURL.forEach(function(I){I.resourceType==="tile"&&(a=I.format,R.push(I.template))})),{urls:R,layer:t.layer,matrixSet:s,format:a,projection:u,requestEncoding:P,tileGrid:E,style:l,dimensions:h,wrapX:f,crossOrigin:t.crossOrigin}},d.source.XYZ=Jo,d.source.Zoomify=Hw,d.source.Zoomify.CustomTile=Qd,d.source.arcgisRest={},d.source.arcgisRest.createLoader=z0,d.source.arcgisRest.getRequestUrl=eg,d.source.common={},d.source.common.DECIMALS=Ci,d.source.common.DEFAULT_WMS_VERSION="1.3.0",d.source.mapguide={},d.source.mapguide.createLoader=X0,d.source.ogcTileUtil={},d.source.ogcTileUtil.getMapTileUrlTemplate=q0,d.source.ogcTileUtil.getTileSetInfo=ng,d.source.ogcTileUtil.getVectorTileUrlTemplate=K0,d.source.sourcesFromTileGrid=function(e,t){const i=new ch(32),n=e.getExtent();return function(r,s){i.expireCache(),n&&(r=We(n,r));const o=e.getZForResolution(s),a=[];return e.forEachTileCoord(r,o,l=>{const h=l.toString();if(!i.containsKey(h)){const c=t(l);i.set(h,c)}a.push(i.get(h))}),a}},d.source.static={},d.source.static.createLoader=V0,d.source.wms={},d.source.wms.DEFAULT_VERSION=ha,d.source.wms.createLoader=Z0,d.source.wms.getFeatureInfoUrl=$0,d.source.wms.getImageSrc=ig,d.source.wms.getLegendUrl=Y0,d.source.wms.getRequestParams=ca,d.source.wms.getRequestUrl=tg,d.sphere={},d.sphere.DEFAULT_RADIUS=bo,d.sphere.getArea=function e(t,i){const n=(i=i||{}).radius||bo,r=i.projection||"EPSG:3857",s=t.getType();s!=="GeometryCollection"&&(t=t.clone().transform(r,"EPSG:4326"));let o,a,l,h,c,u,g=0;switch(s){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":for(o=t.getCoordinates(),g=Math.abs(Sl(o[0],n)),l=1,h=o.length;l<h;++l)g-=Math.abs(Sl(o[l],n));break;case"MultiPolygon":for(o=t.getCoordinates(),l=0,h=o.length;l<h;++l)for(a=o[l],g+=Math.abs(Sl(a[0],n)),c=1,u=a.length;c<u;++c)g-=Math.abs(Sl(a[c],n));break;case"GeometryCollection":{const f=t.getGeometries();for(l=0,h=f.length;l<h;++l)g+=e(f[l],i);break}default:throw new Error("Unsupported geometry type: "+s)}return g},d.sphere.getDistance=wl,d.sphere.getLength=function e(t,i){const n=(i=i||{}).radius||bo,r=i.projection||"EPSG:3857",s=t.getType();s!=="GeometryCollection"&&(t=t.clone().transform(r,"EPSG:4326"));let o,a,l,h,c,u,g=0;switch(s){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":o=t.getCoordinates(),g=_u(o,n);break;case"MultiLineString":case"Polygon":for(o=t.getCoordinates(),l=0,h=o.length;l<h;++l)g+=_u(o[l],n);break;case"MultiPolygon":for(o=t.getCoordinates(),l=0,h=o.length;l<h;++l)for(a=o[l],c=0,u=a.length;c<u;++c)g+=_u(a[c],n);break;case"GeometryCollection":{const f=t.getGeometries();for(l=0,h=f.length;l<h;++l)g+=e(f[l],i);break}default:throw new Error("Unsupported geometry type: "+s)}return g},d.sphere.offset=cm,d.string={},d.string.compareVersions=yl,d.string.padNumber=On,d.structs={},d.structs.LRUCache=ch,d.structs.LinkedList=QS,d.structs.PriorityQueue=T_,d.structs.PriorityQueue.DROP=Zo,d.structs.RBush=ia,d.style={},d.style.Circle=Qh,d.style.Fill=bi,d.style.Icon=Ea,d.style.IconImage=JS,d.style.IconImage.get=Uy,d.style.IconImageCache=_w,d.style.IconImageCache.shared=Bo,d.style.Image=Vg,d.style.RegularShape=Zg,d.style.Stroke=li,d.style.Style=Nt,d.style.Style.createDefaultStyle=Vy,d.style.Style.createEditingStyle=Ws,d.style.Style.toFunction=Xy,d.style.Text=Zs,d.style.flat={},d.style.flat.createDefaultStyle=HS,d.tilecoord={},d.tilecoord.createOrUpdate=Is,d.tilecoord.fromKey=Ld,d.tilecoord.getCacheKeyForTileKey=e0,d.tilecoord.getKey=sn,d.tilecoord.getKeyZXY=Ei,d.tilecoord.hash=uh,d.tilecoord.withinExtentAndZ=t0,d.tilegrid={},d.tilegrid.TileGrid=on,d.tilegrid.WMTS=Pw,d.tilegrid.WMTS.createFromCapabilitiesMatrixSet=w0,d.tilegrid.common={},d.tilegrid.common.DEFAULT_MAX_ZOOM=rd,d.tilegrid.common.DEFAULT_TILE_SIZE=br,d.tilegrid.createForExtent=E0,d.tilegrid.createForProjection=C0,d.tilegrid.createXYZ=Dr,d.tilegrid.extentFromProjection=an,d.tilegrid.getForProjection=xh,d.tilegrid.wrapX=S0,d.tileurlfunction={},d.tileurlfunction.createFromTemplate=b0,d.tileurlfunction.createFromTemplates=vh,d.tileurlfunction.createFromTileUrlFunctions=Os,d.tileurlfunction.expandUrl=wh,d.tileurlfunction.nullTileUrlFunction=R0,d.transform={},d.transform.apply=ye,d.transform.compose=pt,d.transform.composeCssTransform=function(e,t,i,n,r,s,o){return xo(pt([1,0,0,1,0,0],e,t,i,n,r,s,o))},d.transform.create=uw,d.transform.determinant=Bp,d.transform.invert=function(e){return Ht(e,e)},d.transform.makeInverse=Ht,d.transform.makeScale=jp,d.transform.multiply=Ki,d.transform.reset=hl,d.transform.rotate=Gp,d.transform.scale=dr,d.transform.set=hs,d.transform.setFromArray=yo,d.transform.toString=xo,d.transform.translate=cs,d.uri={},d.uri.appendParams=Vn,d.util={},d.util.VERSION="8.2.0",d.util.abstract=q,d.util.getUid=k,d.vec={},d.vec.mat4={},d.vec.mat4.create=MS,d.vec.mat4.fromTransform=cn,d.webgl={},d.webgl.ARRAY_BUFFER=Ur,d.webgl.BaseTileRepresentation=yg,d.webgl.Buffer=hn,d.webgl.Buffer.getArrayClassForType=Gh,d.webgl.DYNAMIC_DRAW=ua,d.webgl.ELEMENT_ARRAY_BUFFER=zr,d.webgl.FLOAT=dg,d.webgl.Helper=yy,d.webgl.Helper.computeAttributesStride=my,d.webgl.PaletteTexture=xy,d.webgl.PostProcessingPass=xg,d.webgl.RenderTarget=Bh,d.webgl.STATIC_DRAW=Bs,d.webgl.STREAM_DRAW=35040,d.webgl.ShaderBuilder={},d.webgl.ShaderBuilder.COMMON_HEADER=Zr,d.webgl.ShaderBuilder.ShaderBuilder=Hh,d.webgl.TileGeometry=ky,d.webgl.TileTexture=Fy,d.webgl.UNSIGNED_BYTE=5121,d.webgl.UNSIGNED_INT=5125,d.webgl.UNSIGNED_SHORT=5123,d.webgl.getContext=gg,d.webgl.getSupportedExtensions=function(){if(!fg){const e=gg(document.createElement("canvas"));e&&(fg=e.getSupportedExtensions())}return fg},d.webgl.styleparser={},d.webgl.styleparser.computeHash=wa,d.webgl.styleparser.expressionToGlsl=te,d.webgl.styleparser.packColor=Gg,d.webgl.styleparser.parseLiteralStyle=Jh,d.xml={},d.xml.OBJECT_PROPERTY_NODE_FACTORY=at,d.xml.XML_SCHEMA_INSTANCE_URI=Wn,d.xml.createElementNS=Q,d.xml.getAllTextContent=yt,d.xml.getAllTextContent_=pg,d.xml.getAttributeNS=cy,d.xml.getDocument=Xr,d.xml.getXMLSerializer=uy,d.xml.isDocument=si,d.xml.makeArrayExtender=da,d.xml.makeArrayPusher=Z,d.xml.makeArraySerializer=mg,d.xml.makeChildAppender=b,d.xml.makeObjectPropertyPusher=Oe,d.xml.makeObjectPropertySetter=T,d.xml.makeReplacer=K,d.xml.makeSequence=Tt,d.xml.makeSimpleNodeFactory=ze,d.xml.makeStructureNS=L,d.xml.parse=oi,d.xml.parseNode=Ct,d.xml.pushParseAndPop=O,d.xml.pushSerializeAndPop=ee,d.xml.registerDocument=function(e){kh=e},d.xml.registerXMLSerializer=function(e){Dh=e},d.xml.serialize=_g,d}();
